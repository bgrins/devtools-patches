# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1556308304 25200
#      Fri Apr 26 12:51:44 2019 -0700
# Node ID bc4eccc42929a5f3ea02a6761ad4e81322737129
# Parent  ff3ec9547e4f15209af87010ed39a0590c253efe
Bug 1547346 - Upgrade custom elements in dialog anonymous XBL content before accessing them

Differential Revision: https://phabricator.services.mozilla.com/D29062

diff --git a/toolkit/content/widgets/dialog.xml b/toolkit/content/widgets/dialog.xml
--- a/toolkit/content/widgets/dialog.xml
+++ b/toolkit/content/widgets/dialog.xml
@@ -284,16 +284,20 @@
           this._buttons = buttons;
           buttons.accept = document.getAnonymousElementByAttribute(this, "dlgtype", "accept");
           buttons.cancel = document.getAnonymousElementByAttribute(this, "dlgtype", "cancel");
           buttons.extra1 = document.getAnonymousElementByAttribute(this, "dlgtype", "extra1");
           buttons.extra2 = document.getAnonymousElementByAttribute(this, "dlgtype", "extra2");
           buttons.help = document.getAnonymousElementByAttribute(this, "dlgtype", "help");
           buttons.disclosure = document.getAnonymousElementByAttribute(this, "dlgtype", "disclosure");
 
+          for (let button in buttons) {
+            customElements.upgrade(buttons[button]);
+          }
+
           // look for any overriding explicit button elements
           var exBtns = this.getElementsByAttribute("dlgtype", "*");
           var dlgtype;
           var i;
           for (i = 0; i < exBtns.length; ++i) {
             dlgtype = exBtns[i].getAttribute("dlgtype");
             buttons[dlgtype].hidden = true; // hide the anonymous button
             buttons[dlgtype] = exBtns[i];
