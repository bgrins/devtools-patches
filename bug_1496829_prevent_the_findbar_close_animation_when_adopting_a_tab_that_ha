# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1538773061 25200
#      Fri Oct 05 13:57:41 2018 -0700
# Node ID b5d7d8937162009257b258846a92547e5e631ffc
# Parent  97208b5251d7e86cb4051711609b6236a944981e
Bug 1496829 - Prevent the findbar close animation when adopting a tab that has a previously-closed findbar;r=Gijs

The connectedCallback fires after it's already in the DOM, so without this attribute setting [hidden]
will animate it closed.

Differential Revision: https://phabricator.services.mozilla.com/D7930

diff --git a/toolkit/content/widgets/findbar.js b/toolkit/content/widgets/findbar.js
--- a/toolkit/content/widgets/findbar.js
+++ b/toolkit/content/widgets/findbar.js
@@ -43,20 +43,23 @@ class MozFindbar extends XULElement {
         <image anonid="find-status-icon" class="findbar-find-fast find-status-icon" />
         <description anonid="find-status" control="findbar-textbox" class="findbar-find-fast findbar-find-status" />
       </hbox>
       <toolbarbutton anonid="find-closebutton" class="findbar-closebutton close-icon" data-l10n-id="findbar-find-button-close" oncommand="close();" />
     `);
   }
 
   connectedCallback() {
+    // Hide the findbar immediately without animation. This prevents a flicker in the case where
+    // we'll never be shown (i.e. adopting a tab that has a previously-opened-but-now-closed
+    // findbar into a new window).
+    this.setAttribute("noanim", "true");
+    this.hidden = true;
     this.appendChild(document.importNode(this.content, true));
 
-    this.hidden = true;
-
     /**
      * Please keep in sync with toolkit/modules/FindBarChild.jsm
      */
     this.FIND_NORMAL = 0;
 
     this.FIND_TYPEAHEAD = 1;
 
     this.FIND_LINKS = 2;
