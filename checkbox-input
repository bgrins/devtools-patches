# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  ccfd7b716a91241ddbc084cb7116ec561e56d5d1
Bug 1455433 - Use an HTML input for XUL <checkbox>

diff --git a/toolkit/content/widgets/checkbox.xml b/toolkit/content/widgets/checkbox.xml
--- a/toolkit/content/widgets/checkbox.xml
+++ b/toolkit/content/widgets/checkbox.xml
@@ -1,34 +1,35 @@
 <?xml version="1.0"?>
 <!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
 
 <bindings id="checkboxBindings"
    xmlns="http://www.mozilla.org/xbl"
+   xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:xbl="http://www.mozilla.org/xbl">
 
   <binding id="checkbox"
     extends="chrome://global/content/bindings/general.xml#basetext">
     <resources>
       <stylesheet src="chrome://global/skin/checkbox.css"/>
     </resources>
 
     <content>
-      <xul:image class="checkbox-check" xbl:inherits="checked,disabled"/>
+      <html:input class="checkbox-check" type="checkbox" xbl:inherits="checked,disabled" />
       <xul:hbox class="checkbox-label-box" flex="1">
         <xul:image class="checkbox-icon" xbl:inherits="src"/>
         <xul:label class="checkbox-label" xbl:inherits="xbl:text=label,accesskey,crop" flex="1"/>
       </xul:hbox>
     </content>
 
-    <implementation implements="nsIDOMXULCheckboxElement">
+    <implementation>
       <method name="setChecked">
         <parameter name="aValue"/>
         <body>
         <![CDATA[
           var change = (aValue != (this.getAttribute("checked") == "true"));
           if (aValue)
             this.setAttribute("checked", "true");
           else
diff --git a/toolkit/themes/linux/global/in-content/common.css b/toolkit/themes/linux/global/in-content/common.css
--- a/toolkit/themes/linux/global/in-content/common.css
+++ b/toolkit/themes/linux/global/in-content/common.css
@@ -39,27 +39,20 @@ xul|menulist {
 }
 
 xul|menulist:not([editable="true"]) > xul|*.menulist-dropmarker {
   display: -moz-box;
   margin-top: 6px;
   margin-bottom: 6px;
 }
 
-xul|*.checkbox-check,
 xul|*.radio-check {
   background-image: none;
 }
 
-xul|*.checkbox-check[checked] {
-  fill: -moz-dialogText;
-  stroke: none;
-  background-color: -moz-dialog;
-}
-
 xul|*.radio-check[selected] {
   background-color: -moz-dialog;
   fill: -moz-dialogText;
 }
 
 xul|*.radio-label-box {
   -moz-appearance: none;
 }
diff --git a/toolkit/themes/shared/in-content/common.inc.css b/toolkit/themes/shared/in-content/common.inc.css
--- a/toolkit/themes/shared/in-content/common.inc.css
+++ b/toolkit/themes/shared/in-content/common.inc.css
@@ -541,60 +541,46 @@ html|a:hover:active,
 /* Checkboxes and radio buttons */
 
 xul|checkbox {
   -moz-appearance: none;
   height: 30px;
   margin: 2px 0;
 }
 
-xul|*.checkbox-check,
 html|input[type="checkbox"] {
   -moz-appearance: none;
   width: 23px;
   height: 23px;
   border: 1px solid var(--in-content-box-border-color);
   border-radius: 2px;
   margin: 0;
   margin-inline-end: 10px;
   background-color: #f1f1f1;
   background-image: linear-gradient(#fff, rgba(255,255,255,0.8));
   background-position: center center;
   background-repeat: no-repeat;
   box-shadow: 0 1px 1px 0 #fff, inset 0 2px 0 0 rgba(0,0,0,0.03);
 }
 
-xul|checkbox:not([disabled="true"]):hover > xul|*.checkbox-check,
 html|input[type="checkbox"]:not(:disabled):hover {
   border-color: var(--in-content-border-focus);
 }
 
-xul|*.checkbox-check[checked] {
-  list-style-image: url("chrome://global/skin/in-content/check.svg");
-  -moz-context-properties: fill, stroke;
-  fill: #2292d0;
-  stroke: none;
-}
-
 html|input[type="checkbox"]:checked {
   background-image: url("chrome://global/skin/in-content/check.svg"), linear-gradient(#fff, rgba(255,255,255,0.8));
   -moz-context-properties: fill, stroke;
   fill: #2292d0;
   stroke: none;
 }
 
-xul|checkbox[disabled="true"] > xul|*.checkbox-check,
 html|input[type="checkbox"]:disabled {
   opacity: 0.5;
 }
 
-xul|richlistitem > xul|*.checkbox-check {
-  margin: 3px 6px;
-}
-
 html|*.toggle-container-with-text {
   display: flex;
   align-items: center;
 }
 
 xul|radio {
   margin-inline-start: 0;
   -moz-appearance: none;
diff --git a/toolkit/themes/windows/global/in-content/common.css b/toolkit/themes/windows/global/in-content/common.css
--- a/toolkit/themes/windows/global/in-content/common.css
+++ b/toolkit/themes/windows/global/in-content/common.css
@@ -14,27 +14,20 @@ xul|menulist:not([editable="true"]) > xu
 }
 
 xul|checkbox,
 xul|radio {
   padding-inline-start: 0;
 }
 
 @media (-moz-windows-default-theme: 0) {
-  xul|*.checkbox-check,
   xul|*.radio-check {
     background-image: none;
   }
 
-  xul|*.checkbox-check[checked] {
-    fill: -moz-dialogText;
-    stroke: none;
-    background-color: -moz-dialog;
-  }
-
   xul|*.radio-check[selected] {
     background-color: -moz-dialog;
     fill: -moz-dialogText;
   }
 }
 
 /* Never draw a border for the focusring, use outline instead */
 xul|*.menulist-label-box {
