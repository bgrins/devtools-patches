# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  aae374532895ee2297c01f597915065a14ac951a
Bug XXX - Load edit menu script from globalOverlay

diff --git a/devtools/client/scratchpad/scratchpad.js b/devtools/client/scratchpad/scratchpad.js
--- a/devtools/client/scratchpad/scratchpad.js
+++ b/devtools/client/scratchpad/scratchpad.js
@@ -9,18 +9,16 @@
  *
  * Copied and relicensed from the Public Domain.
  * See bug 653934 for details.
  * https://bugzilla.mozilla.org/show_bug.cgi?id=653934
  */
 
 // Via index.xul
 /* import-globals-from ../../../toolkit/content/globalOverlay.js */
-// Via editMenuCommands.inc.xul
-/* import-globals-from ../../../toolkit/content/editMenuOverlay.js */
 
 "use strict";
 
 const SCRATCHPAD_CONTEXT_CONTENT = 1;
 const SCRATCHPAD_CONTEXT_BROWSER = 2;
 const BUTTON_POSITION_SAVE = 0;
 const BUTTON_POSITION_CANCEL = 1;
 const BUTTON_POSITION_DONT_SAVE = 2;
diff --git a/toolkit/content/editMenuCommands.inc.xul b/toolkit/content/editMenuCommands.inc.xul
--- a/toolkit/content/editMenuCommands.inc.xul
+++ b/toolkit/content/editMenuCommands.inc.xul
@@ -1,15 +1,9 @@
-<script type="application/javascript"
-#ifdef BROWSER_XHTML
-xmlns="http://www.w3.org/1999/xhtml"
-#endif
->
-  Services.scriptloader.loadSubScript("chrome://global/content/editMenuOverlay.js", this);
-</script>
+
 <commandset id="editMenuCommands">
   <commandset id="editMenuCommandSetAll" commandupdater="true" events="focus,select"
               oncommandupdate="goUpdateGlobalEditMenuItems()"/>
   <commandset id="editMenuCommandSetUndo" commandupdater="true" events="undo"
               oncommandupdate="goUpdateUndoEditMenuItems()"/>
   <commandset id="editMenuCommandSetPaste" commandupdater="true" events="clipboard"
               oncommandupdate="goUpdatePasteMenuItems()"/>
   <command id="cmd_undo" oncommand="goDoCommand('cmd_undo')"/>
diff --git a/toolkit/content/editMenuOverlay.js b/toolkit/content/editMenuOverlay.js
deleted file mode 100644
--- a/toolkit/content/editMenuOverlay.js
+++ /dev/null
@@ -1,36 +0,0 @@
-// -*- indent-tabs-mode: nil; js-indent-level: 2 -*-
-
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-// update menu items that rely on focus or on the current selection
-function goUpdateGlobalEditMenuItems() {
-  // Don't bother updating the edit commands if they aren't visible in any way
-  // (i.e. the Edit menu isn't open, nor is the context menu open, nor have the
-  // cut, copy, and paste buttons been added to the toolbars) for performance.
-  // This only works in applications/on platforms that set the gEditUIVisible
-  // flag, so we check to see if that flag is defined before using it.
-  if (typeof gEditUIVisible != "undefined" && !gEditUIVisible)
-    return;
-
-  goUpdateCommand("cmd_undo");
-  goUpdateCommand("cmd_redo");
-  goUpdateCommand("cmd_cut");
-  goUpdateCommand("cmd_copy");
-  goUpdateCommand("cmd_paste");
-  goUpdateCommand("cmd_selectAll");
-  goUpdateCommand("cmd_delete");
-  goUpdateCommand("cmd_switchTextDirection");
-}
-
-// update menu items that relate to undo/redo
-function goUpdateUndoEditMenuItems() {
-  goUpdateCommand("cmd_undo");
-  goUpdateCommand("cmd_redo");
-}
-
-// update menu items that depend on clipboard contents
-function goUpdatePasteMenuItems() {
-  goUpdateCommand("cmd_paste");
-}
diff --git a/toolkit/content/globalOverlay.js b/toolkit/content/globalOverlay.js
--- a/toolkit/content/globalOverlay.js
+++ b/toolkit/content/globalOverlay.js
@@ -91,8 +91,39 @@ function goSetCommandEnabled(aID, aEnabl
 
   if (node) {
     if (aEnabled)
       node.removeAttribute("disabled");
     else
       node.setAttribute("disabled", "true");
   }
 }
+
+// update menu items that rely on focus or on the current selection
+function goUpdateGlobalEditMenuItems() {
+  // Don't bother updating the edit commands if they aren't visible in any way
+  // (i.e. the Edit menu isn't open, nor is the context menu open, nor have the
+  // cut, copy, and paste buttons been added to the toolbars) for performance.
+  // This only works in applications/on platforms that set the gEditUIVisible
+  // flag, so we check to see if that flag is defined before using it.
+  if (typeof gEditUIVisible != "undefined" && !gEditUIVisible)
+    return;
+
+  goUpdateCommand("cmd_undo");
+  goUpdateCommand("cmd_redo");
+  goUpdateCommand("cmd_cut");
+  goUpdateCommand("cmd_copy");
+  goUpdateCommand("cmd_paste");
+  goUpdateCommand("cmd_selectAll");
+  goUpdateCommand("cmd_delete");
+  goUpdateCommand("cmd_switchTextDirection");
+}
+
+// update menu items that relate to undo/redo
+function goUpdateUndoEditMenuItems() {
+  goUpdateCommand("cmd_undo");
+  goUpdateCommand("cmd_redo");
+}
+
+// update menu items that depend on clipboard contents
+function goUpdatePasteMenuItems() {
+  goUpdateCommand("cmd_paste");
+}
diff --git a/toolkit/content/jar.mn b/toolkit/content/jar.mn
--- a/toolkit/content/jar.mn
+++ b/toolkit/content/jar.mn
@@ -35,19 +35,16 @@ toolkit.jar:
    content/global/plugins.html
    content/global/plugins.css
    content/global/browser-child.js
    content/global/browser-content.js
 *   content/global/buildconfig.html
    content/global/buildconfig.css
    content/global/contentAreaUtils.js
    content/global/datepicker.xhtml
-#ifndef MOZ_FENNEC
-   content/global/editMenuOverlay.js
-#endif
    content/global/filepicker.properties
    content/global/customElements.js
    content/global/globalOverlay.js
    content/global/mozilla.xhtml
    content/global/aboutMozilla.css
    content/global/preferencesBindings.js
    content/global/process-content.js
    content/global/resetProfile.css
diff --git a/toolkit/content/tests/chrome/bug366992_window.xul b/toolkit/content/tests/chrome/bug366992_window.xul
--- a/toolkit/content/tests/chrome/bug366992_window.xul
+++ b/toolkit/content/tests/chrome/bug366992_window.xul
@@ -27,18 +27,16 @@
     <command id="cmd_paste" oncommand="goDoCommand('cmd_paste')"/>
     <command id="cmd_delete" oncommand="goDoCommand('cmd_delete')"/>
     <command id="cmd_selectAll" oncommand="goDoCommand('cmd_selectAll')"/>
     <command id="cmd_switchTextDirection" oncommand="goDoCommand('cmd_switchTextDirection');"/>
   </commandset>
 
   <script type="application/javascript"
           src="chrome://global/content/globalOverlay.js"/>
-  <script type="application/javascript"
-          src="chrome://global/content/editMenuOverlay.js"/>
   <script type="application/javascript"><![CDATA[
     // Without the fix for bug 366992, the delete command would be enabled
     // for the textbox even though the textbox's controller for this command
     // disables it.
     var gShouldNotBeReachedController = {
       supportsCommand: function(aCommand) {
         return aCommand == "cmd_delete";
       },
diff --git a/tools/lint/eslint.yml b/tools/lint/eslint.yml
--- a/tools/lint/eslint.yml
+++ b/tools/lint/eslint.yml
@@ -17,14 +17,13 @@ eslint:
         - 'browser/components/downloads/content/indicator.js'
         - 'testing/mochitest/tests/SimpleTest/EventUtils.js'
         - 'testing/mochitest/tests/SimpleTest/MockObjects.js'
         - 'testing/mochitest/tests/SimpleTest/SimpleTest.js'
         - 'testing/mochitest/tests/SimpleTest/WindowSnapshot.js'
         - 'toolkit/components/printing/content/printUtils.js'
         - 'toolkit/components/viewsource/content/viewSourceUtils.js'
         - 'toolkit/content/contentAreaUtils.js'
-        - 'toolkit/content/editMenuOverlay.js'
         - 'toolkit/content/globalOverlay.js'
         - 'toolkit/modules/Services.jsm'
     type: external
     payload: eslint:lint
     setup: eslint:setup
diff --git a/tools/lint/eslint/eslint-plugin-mozilla/lib/environments/browser-window.js b/tools/lint/eslint/eslint-plugin-mozilla/lib/environments/browser-window.js
--- a/tools/lint/eslint/eslint-plugin-mozilla/lib/environments/browser-window.js
+++ b/tools/lint/eslint/eslint-plugin-mozilla/lib/environments/browser-window.js
@@ -26,17 +26,16 @@ const rootDir = helpers.rootDir;
 // These are scripts not loaded from browser.xul or global-scripts.inc
 // but via other includes.
 const EXTRA_SCRIPTS = [
   "browser/base/content/nsContextMenu.js",
   "browser/components/places/content/editBookmark.js",
   "browser/components/downloads/content/downloads.js",
   "browser/components/downloads/content/indicator.js",
   "toolkit/content/customElements.js",
-  "toolkit/content/editMenuOverlay.js",
 ];
 
 const extraDefinitions = [
   // Via Components.utils, defineModuleGetter, defineLazyModuleGetters or
   // defineLazyScriptGetter (and map to
   // single) variable.
   {name: "XPCOMUtils", writable: false},
   {name: "Task", writable: false},
