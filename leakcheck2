# HG changeset patch
# Parent cb941f07f44c04cae926a09d104cf1d9bf1dc241
# User Brian Grinstead <bgrinstead@mozilla.com>
more leak checks

diff --git a/browser/base/content/browser-devedition.js b/browser/base/content/browser-devedition.js
--- a/browser/base/content/browser-devedition.js
+++ b/browser/base/content/browser-devedition.js
@@ -76,35 +76,43 @@ let DevEdition = {
     } catch(e) {}
 
     let deveditionThemeEnabled = Services.prefs.getBoolPref(this._prefName) &&
       !lightweightThemeSelected && defaultThemeSelected && devtoolsIsDark;
 
     this._toggleStyleSheet(deveditionThemeEnabled);
   },
 
+  handleEvent: function() {
+    let {console} = Components.utils.import("resource://gre/modules/devtools/Console.jsm", {});
+    console.log("LOAD!", this, this.styleSheet);
+    this.styleSheet.removeEventListener("load", this);
+    gBrowser.tabContainer._positionPinnedTabs();
+    ToolbarIconColor.inferFromText();
+  },
+
   _toggleStyleSheet: function(deveditionThemeEnabled) {
     if (deveditionThemeEnabled && !this.styleSheet) {
       let styleSheetAttr = `href="${this.styleSheetLocation}" type="text/css"`;
-      let styleSheet = this.styleSheet = document.createProcessingInstruction(
+      this.styleSheet = document.createProcessingInstruction(
         'xml-stylesheet', styleSheetAttr);
-      this.styleSheet.addEventListener("load", function onLoad() {
-        styleSheet.removeEventListener("load", onLoad);
-        gBrowser.tabContainer._positionPinnedTabs();
-        ToolbarIconColor.inferFromText();
-      });
+      this.styleSheet.addEventListener("load", this);
       document.insertBefore(this.styleSheet, document.documentElement);
     } else if (!deveditionThemeEnabled && this.styleSheet) {
+      this.styleSheet.removeEventListener("load", this);
       this.styleSheet.remove();
       this.styleSheet = null;
       gBrowser.tabContainer._positionPinnedTabs();
       ToolbarIconColor.inferFromText();
     }
   },
 
   uninit: function () {
     Services.prefs.removeObserver(this._lwThemePrefName, this);
     Services.prefs.removeObserver(this._prefName, this);
     Services.prefs.removeObserver(this._devtoolsThemePrefName, this);
     Services.obs.removeObserver(this, "lightweight-theme-styling-update", false);
+    if (this.styleSheet) {
+      this.styleSheet.removeEventListener("load", this);
+    }
     this.styleSheet = null;
   }
 };
