# HG changeset patch
# Parent 200fa2ac65e4c1d1c947a5cac90e22a9013f07a2
# User Patrick Brosset <pbrosset@mozilla.com>
Bug 932218 - Hides previous image preview tooltip in markup view when another one shows; r=bgrins

diff --git a/browser/devtools/shared/widgets/Tooltip.js b/browser/devtools/shared/widgets/Tooltip.js
--- a/browser/devtools/shared/widgets/Tooltip.js
+++ b/browser/devtools/shared/widgets/Tooltip.js
@@ -176,16 +176,20 @@ Tooltip.prototype = {
    *        An optional delay that will be observed before showing the tooltip.
    *        Defaults to 750ms
    */
   startTogglingOnHover: function(baseNode, targetNodeCb, showDelay = 750) {
     if (this._basedNode) {
       this.stopTogglingOnHover();
     }
 
+    // If no targetNodeCb callback is provided, then we need to hide the tooltip
+    // on mouseleave since baseNode is the target node itself
+    this._hideOnMouseLeave = !targetNodeCb;
+
     this._basedNode = baseNode;
     this._showDelay = showDelay;
     this._targetNodeCb = targetNodeCb || (() => true);
 
     this._onBaseNodeMouseMove = this._onBaseNodeMouseMove.bind(this);
     this._onBaseNodeMouseLeave = this._onBaseNodeMouseLeave.bind(this);
 
     baseNode.addEventListener("mousemove", this._onBaseNodeMouseMove, false);
@@ -216,25 +220,28 @@ Tooltip.prototype = {
       this._lastHovered = null;
       setNamedTimeout(this.uid, this._showDelay, () => {
         this._showOnHover(event.target);
       });
     }
   },
 
   _showOnHover: function(target) {
-    if (this._targetNodeCb && this._targetNodeCb(target, this)) {
+    if (this._targetNodeCb(target, this)) {
       this.show(target);
       this._lastHovered = target;
     }
   },
 
   _onBaseNodeMouseLeave: function() {
     clearNamedTimeout(this.uid);
     this._lastHovered = null;
+    if (this._hideOnMouseLeave) {
+      this.hide();
+    }
   },
 
   /**
    * Set the content of this tooltip. Will first empty the tooltip and then
    * append the new content element.
    * Consider using one of the set<type>Content() functions instead.
    * @param {node} content
    *        A node that can be appended in the tooltip XUL element
