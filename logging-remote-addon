# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  b53035704e0fdf6f064fbc542154c6027e228cfe

diff --git a/browser/base/content/test/newtab/browser_newtab_1188015.js b/browser/base/content/test/newtab/browser_newtab_1188015.js
--- a/browser/base/content/test/newtab/browser_newtab_1188015.js
+++ b/browser/base/content/test/newtab/browser_newtab_1188015.js
@@ -7,16 +7,17 @@ gDirectorySource = "data:application/jso
     enhancedImageURI: "data:image/png;base64,helloWORLD2",
     title: "title1",
     type: "affiliate",
     titleBgColor: "green"
   }]
 });
 
 add_task(async function() {
+  dump("Test logging: " + gBrowser.currentURI.spec + "\n");
   await pushPrefs(["browser.newtab.preload", false]);
 
   // Make the page have a directory link
   await setLinks([]);
   await addNewTabPageTab();
 
   let color = await performOnCell(0, cell => {
     return cell.node.querySelector(".newtab-title").style.backgroundColor;
diff --git a/browser/base/content/test/newtab/head.js b/browser/base/content/test/newtab/head.js
--- a/browser/base/content/test/newtab/head.js
+++ b/browser/base/content/test/newtab/head.js
@@ -38,16 +38,20 @@ requiredSize.innerHeight =
   44 + 32 + // search bar + bottom margin
   (3 * (180 + 32)) + // 3 rows * (tile height + title and bottom margin)
   100; // breathing room
 requiredSize.innerWidth =
   (3 * (290 + 20)) + // 3 cols * (tile width + side margins)
   100; // breathing room
 
 var oldSize = {};
+
+debugger;
+gBrowser.contentWindow;
+dump("TEST URI: " + gBrowser.currentURI.spec + " " + gBrowser.contentWindow.location + "\n");
 Object.keys(requiredSize).forEach(prop => {
   info([prop, gBrowser.contentWindow[prop], requiredSize[prop]]);
   if (gBrowser.contentWindow[prop] < requiredSize[prop]) {
     oldSize[prop] = gBrowser.contentWindow[prop];
     info("Changing browser " + prop + " from " + oldSize[prop] + " to " +
          requiredSize[prop]);
     gBrowser.contentWindow[prop] = requiredSize[prop];
   }
diff --git a/toolkit/components/addoncompat/RemoteAddonsParent.jsm b/toolkit/components/addoncompat/RemoteAddonsParent.jsm
--- a/toolkit/components/addoncompat/RemoteAddonsParent.jsm
+++ b/toolkit/components/addoncompat/RemoteAddonsParent.jsm
@@ -1083,16 +1083,17 @@ var RemoteAddonsParent = {
     register(Ci.nsIWebNavigation, RemoteWebNavigationInterposition);
 
     return result;
   },
 
   getTaggedInterpositions() {
     let result = {};
 
+    dump("\n\n\n\n\ngetTaggedInterpositions\n\n\n\n\n");
     function register(tag, interp) {
       result[tag] = interp;
     }
 
     register("EventTarget", EventTargetInterposition);
     register("ContentDocShellTreeItem", ContentDocShellTreeItemInterposition);
     register("ContentDocument", ContentDocumentInterposition);
     register("RemoteBrowserElement", RemoteBrowserElementInterposition);
diff --git a/toolkit/components/addoncompat/multiprocessShims.js b/toolkit/components/addoncompat/multiprocessShims.js
--- a/toolkit/components/addoncompat/multiprocessShims.js
+++ b/toolkit/components/addoncompat/multiprocessShims.js
@@ -107,24 +107,26 @@ AddonInterpositionService.prototype = {
 
   // When the interface is not known for a method call, this code
   // determines the type of the target object.
   getObjectTag(target) {
     if (Cu.isCrossProcessWrapper(target)) {
       return Cu.getCrossProcessWrapperTag(target);
     }
 
+    dump("\n\n\nLooking at target: " + target + " " + target.__tabbrowser + "\n\n\n");
+    if (target.__tabbrowser) {
+      debugger;
+      return "TabBrowserElement";
+    }
+
     if (target instanceof Ci.nsIDOMXULElement) {
       if (target.localName == "browser" && target.isRemoteBrowser) {
         return "RemoteBrowserElement";
       }
-
-      if (target.localName == "tabbrowser") {
-        return "TabBrowserElement";
-      }
     }
 
     if (target instanceof Ci.nsIDOMChromeWindow && target.gMultiProcessBrowser) {
       return "ChromeWindow";
     }
 
     if (target instanceof Ci.nsIDOMEventTarget) {
       return "EventTarget";
