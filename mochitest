# HG changeset patch
# User Gregory Szorc <gps@mozilla.com>
# Date 1375141272 25200
#      Mon Jul 29 16:41:12 2013 -0700
# Node ID 10e06b683fdfbfc5121c9f222f0739ab9a387256
# Parent  b8c7acba4b40fb752418dce29f5e9835bdcc4c0d
Bug 899292 - Exception constructing environment when topobjdir isn't available

diff --git a/python/mozbuild/mozbuild/base.py b/python/mozbuild/mozbuild/base.py
--- a/python/mozbuild/mozbuild/base.py
+++ b/python/mozbuild/mozbuild/base.py
@@ -158,17 +158,19 @@ class MozbuildObject(ProcessExecutionMix
         # another objdir, we abort. The reasoning here is that if you are
         # inside an objdir you probably want to perform actions on that objdir,
         # not another one.
         if topobjdir and config['topobjdir'] \
             and not samepath(topobjdir, config['topobjdir']):
 
             raise ObjdirMismatchException(topobjdir, config['topobjdir'])
 
-        topobjdir = os.path.normpath(config['topobjdir'] or topobjdir)
+        topobjdir = config['topobjdir'] or topobjdir
+        if topobjdir:
+            topobjdir = os.path.normpath(topobjdir)
 
         # If we can't resolve topobjdir, oh well. The constructor will figure
         # it out via config.guess.
         return cls(topsrcdir, None, None, topobjdir=topobjdir)
 
     @property
     def topobjdir(self):
         if self._topobjdir is None:

