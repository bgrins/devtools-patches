# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  f3da8ae9d1a3e74cd273746da51a035ddc572bee

diff --git a/browser/actors/BrowserTabParent.jsm b/browser/actors/BrowserTabParent.jsm
--- a/browser/actors/BrowserTabParent.jsm
+++ b/browser/actors/BrowserTabParent.jsm
@@ -11,16 +11,20 @@ class BrowserTabParent extends JSWindowA
     if (!browser) {
       return; // Can happen sometimes if browser is being destroyed
     }
 
     if (browser.outerBrowser) {
       browser = browser.outerBrowser; // handle RDM mode
     }
 
+    if (browser.hostBrowser) {
+      return;
+    }
+
     let gBrowser = browser.ownerGlobal.gBrowser;
 
     if (!gBrowser) {
       // Note: gBrowser might be null because this message might be received
       // from the extension process. There's still an embedderElement involved,
       // but it's the one coming from dummy.xul.
       // This should probably be fixed by adding support to specifying "group: 'browsers"
       // in the registerWindowActor options/. See bug 1557118.
diff --git a/browser/base/content/browser.css b/browser/base/content/browser.css
--- a/browser/base/content/browser.css
+++ b/browser/base/content/browser.css
@@ -59,16 +59,72 @@ body {
 :root[customizing] {
   min-width: -moz-fit-content;
 }
 
 /* Prevent shrinking the page content to 0 height and width */
 .browserStack > browser {
   min-height: 25px;
   min-width: 25px;
+  margin-inline-start: 32px;
+  width: calc(100% - 32px);
+}
+.browserStack:not([a11ymode]) > .a11ymode {
+  display: none;
+}
+
+.browserStack > .a11ymode-controls {
+  justify-self: start;
+  width: 32px;
+  background: rgba(255, 255, 255, .8);
+}
+
+.browserStack > .a11ymode-controls > toolbarbutton {
+  width: 32px;
+  height: 32px;
+  /* icons grabbed from https://www.iconfinder.com/iconsets/material-core */
+}
+.browserStack > .a11ymode-controls > toolbarbutton:hover,
+.browserStack > .a11ymode-controls > toolbarbutton[active] {
+  background-color: hsla(240,5%,5%,.1);
+}
+
+.a11ymode-on {
+  background: no-repeat center center url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIyMHB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxOCAyMCIgd2lkdGg9IjE4cHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZXNjLz48ZGVmcy8+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSI+PGcgZmlsbD0iIzAwMDAwMCIgaWQ9IkNvcmUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjAwMDAwMCwgLTIuMDAwMDAwKSI+PGcgaWQ9ImFjY2Vzc2liaWxpdHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMuMDAwMDAwLCAyLjAwMDAwMCkiPjxwYXRoIGQ9Ik05LDAgQzEwLjEsMCAxMSwwLjkgMTEsMiBDMTEsMy4xIDEwLjEsNCA5LDQgQzcuOSw0IDcsMy4xIDcsMiBDNywwLjkgNy45LDAgOSwwIEw5LDAgWiBNMTgsNyBMMTIsNyBMMTIsMjAgTDEwLDIwIEwxMCwxNCBMOCwxNCBMOCwyMCBMNiwyMCBMNiw3IEwwLDcgTDAsNSBMMTgsNSBMMTgsNyBMMTgsNyBaIiBpZD0iU2hhcGUiLz48L2c+PC9nPjwvZz48L3N2Zz4=);
+}
+.a11ymode-split {
+  background: no-repeat center center url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxNnB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMCAxNiIgd2lkdGg9IjIwcHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZXNjLz48ZGVmcy8+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSI+PGcgZmlsbD0iIzAwMDAwMCIgaWQ9IkNvcmUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01MDYuMDAwMDAwLCAtMTMwLjAwMDAwMCkiPjxnIGlkPSJkcmF3ZXIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUwNi4wMDAwMDAsIDEzMC4wMDAwMDApIj48cGF0aCBkPSJNMTgsMCBMMiwwIEMwLjgsMCAwLDAuOCAwLDIgTDAsMTQgQzAsMTUuMiAwLjgsMTYgMiwxNiBMMTgsMTYgQzE5LDE2IDIwLDE1LjIgMjAsMTQgTDIwLDIgQzIwLDAuOCAxOSwwIDE4LDAgTDE4LDAgWiBNMTgsMTQgTDEyLDE0IEwxMiwyIEwxOCwyIEwxOCwxNCBMMTgsMTQgWiIgaWQ9IlNoYXBlIi8+PC9nPjwvZz48L2c+PC9zdmc+);
+}
+.a11ymode-off {
+  background: no-repeat center center url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIyMHB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMCAyMCIgd2lkdGg9IjIwcHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZXNjLz48ZGVmcy8+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSI+PGcgZmlsbD0iIzAwMDAwMCIgaWQ9IkNvcmUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yOTYuMDAwMDAwLCAtMjk2LjAwMDAwMCkiPjxnIGlkPSJsYW5ndWFnZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjk2LjAwMDAwMCwgMjk2LjAwMDAwMCkiPjxwYXRoIGQ9Ik0xMCwwIEM0LjUsMCAwLDQuNSAwLDEwIEMwLDE1LjUgNC41LDIwIDEwLDIwIEMxNS41LDIwIDIwLDE1LjUgMjAsMTAgQzIwLDQuNSAxNS41LDAgMTAsMCBMMTAsMCBaIE0xNi45LDYgTDE0LDYgQzEzLjcsNC43IDEzLjIsMy42IDEyLjYsMi40IEMxNC40LDMuMSAxNiw0LjMgMTYuOSw2IEwxNi45LDYgWiBNMTAsMiBDMTAuOCwzLjIgMTEuNSw0LjUgMTEuOSw2IEw4LjEsNiBDOC41LDQuNiA5LjIsMy4yIDEwLDIgTDEwLDIgWiBNMi4zLDEyIEMyLjEsMTEuNCAyLDEwLjcgMiwxMCBDMiw5LjMgMi4xLDguNiAyLjMsOCBMNS43LDggQzUuNiw4LjcgNS42LDkuMyA1LjYsMTAgQzUuNiwxMC43IDUuNywxMS4zIDUuNywxMiBMMi4zLDEyIEwyLjMsMTIgWiBNMy4xLDE0IEw2LDE0IEM2LjMsMTUuMyA2LjgsMTYuNCA3LjQsMTcuNiBDNS42LDE2LjkgNCwxNS43IDMuMSwxNCBMMy4xLDE0IFogTTYsNiBMMy4xLDYgQzQuMSw0LjMgNS42LDMuMSA3LjQsMi40IEM2LjgsMy42IDYuMyw0LjcgNiw2IEw2LDYgWiBNMTAsMTggQzkuMiwxNi44IDguNSwxNS41IDguMSwxNCBMMTEuOSwxNCBDMTEuNSwxNS40IDEwLjgsMTYuOCAxMCwxOCBMMTAsMTggWiBNMTIuMywxMiBMNy43LDEyIEM3LjYsMTEuMyA3LjUsMTAuNyA3LjUsMTAgQzcuNSw5LjMgNy42LDguNyA3LjcsOCBMMTIuNCw4IEMxMi41LDguNyAxMi42LDkuMyAxMi42LDEwIEMxMi42LDEwLjcgMTIuNCwxMS4zIDEyLjMsMTIgTDEyLjMsMTIgWiBNMTIuNiwxNy42IEMxMy4yLDE2LjUgMTMuNywxNS4zIDE0LDE0IEwxNi45LDE0IEMxNiwxNS43IDE0LjQsMTYuOSAxMi42LDE3LjYgTDEyLjYsMTcuNiBaIE0xNC40LDEyIEMxNC41LDExLjMgMTQuNSwxMC43IDE0LjUsMTAgQzE0LjUsOS4zIDE0LjQsOC43IDE0LjQsOCBMMTcuOCw4IEMxOCw4LjYgMTguMSw5LjMgMTguMSwxMCBDMTguMSwxMC43IDE4LDExLjQgMTcuOCwxMiBMMTQuNCwxMiBMMTQuNCwxMiBaIiBpZD0iU2hhcGUiLz48L2c+PC9nPjwvZz48L3N2Zz4=);
+}
+.a11ymode-media {
+  background: no-repeat center center url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxOHB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxOCAxOCIgd2lkdGg9IjE4cHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZXNjLz48ZGVmcy8+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSI+PGcgZmlsbD0iIzAwMDAwMCIgaWQ9IkNvcmUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNzEuMDAwMDAwLCAtMTcxLjAwMDAwMCkiPjxnIGlkPSJkcml2ZS1pbWFnZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTcxLjAwMDAwMCwgMTcxLjAwMDAwMCkiPjxwYXRoIGQ9Ik0xOCwxNiBMMTgsMiBDMTgsMC45IDE3LjEsMCAxNiwwIEwyLDAgQzAuOSwwIDAsMC45IDAsMiBMMCwxNiBDMCwxNy4xIDAuOSwxOCAyLDE4IEwxNiwxOCBDMTcuMSwxOCAxOCwxNy4xIDE4LDE2IEwxOCwxNiBaIE01LjUsMTAuNSBMOCwxMy41IEwxMS41LDkgTDE2LDE1IEwyLDE1IEw1LjUsMTAuNSBMNS41LDEwLjUgWiIgaWQ9IlNoYXBlIi8+PC9nPjwvZz48L2c+PC9zdmc+);
+}
+.a11ymode-outline {
+  background: no-repeat center center url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxMHB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxOCAxMCIgd2lkdGg9IjE4cHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZXNjLz48ZGVmcy8+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSI+PGcgZmlsbD0iIzAwMDAwMCIgaWQ9IkNvcmUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00MjMuMDAwMDAwLCAtMzAxLjAwMDAwMCkiPjxnIGlkPSJsaXN0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0MjMuMDAwMDAwLCAzMDEuMDAwMDAwKSI+PHBhdGggZD0iTTAsNiBMMiw2IEwyLDQgTDAsNCBMMCw2IEwwLDYgWiBNMCwxMCBMMiwxMCBMMiw4IEwwLDggTDAsMTAgTDAsMTAgWiBNMCwyIEwyLDIgTDIsMCBMMCwwIEwwLDIgTDAsMiBaIE00LDYgTDE4LDYgTDE4LDQgTDQsNCBMNCw2IEw0LDYgWiBNNCwxMCBMMTgsMTAgTDE4LDggTDQsOCBMNCwxMCBMNCwxMCBaIE00LDAgTDQsMiBMMTgsMiBMMTgsMCBMNCwwIEw0LDAgWiIgaWQ9IlNoYXBlIi8+PC9nPjwvZz48L2c+PC9zdmc+);
+}
+.a11ymode-reader {
+  background: no-repeat center center url(chrome://browser/skin/readerMode.svg);
+}
+
+.browserStack[a11ymode="split"] > browser {
+  width: 50%;
+  justify-self: end;
+}
+.browserStack[a11ymode="split"] > .a11ymode {
+  width: calc(50% - 32px);
+  justify-self: start;
+  margin-inline-start: 32px;
+}
+.browserStack[a11ymode="on"] > browser[messagemanagergroup] {
+  z-index: -1;
+}
+.browserStack[a11ymode="on"] > .a11ymode {
+  width: calc(100% - 32px);
 }
 
 body {
   display: -moz-box;
   -moz-box-orient: vertical;
   -moz-box-flex: 1;
 }
 
diff --git a/browser/base/content/tabbrowser.js b/browser/base/content/tabbrowser.js
--- a/browser/base/content/tabbrowser.js
+++ b/browser/base/content/tabbrowser.js
@@ -610,16 +610,19 @@
     /**
      * Create a findbar instance.
      * @param aTab the tab to create the find bar for.
      * @return the created findbar, or null if the window or tab is closed/closing.
      */
     async _createFindBar(aTab) {
       let findBar = document.createXULElement("findbar");
       let browser = this.getBrowserForTab(aTab);
+      if (browser.a11ymodeBrowser) {
+        browser = browser.a11ymodeBrowser;
+      }
 
       // The findbar should be inserted after the browserStack and, if present for
       // this tab, after the StatusPanel as well.
       let insertAfterElement = browser.parentNode;
       if (insertAfterElement.nextElementSibling == StatusPanel.panel) {
         insertAfterElement = StatusPanel.panel;
       }
       insertAfterElement.insertAdjacentElement("afterend", findBar);
@@ -1883,16 +1886,18 @@
       let oldUserTypedValue = aBrowser.userTypedValue;
       let hadStartedLoad = aBrowser.didStartLoadSinceLastUserTyping();
       let parent = aBrowser.parentNode;
 
       // Change the "remote" attribute.
 
       // Make sure the browser is destroyed so it unregisters from observer notifications
       aBrowser.destroy();
+      // XXX: also destroy a11ymode browser?
+
       // Only remove the node if we're not rebuilding the frameloader via nsFrameLoaderOwner.
       let rebuildFrameLoaders =
         E10SUtils.rebuildFrameloadersOnRemotenessChange ||
         window.docShell.nsILoadContext.useRemoteSubframes;
       if (!rebuildFrameLoaders) {
         aBrowser.remove();
       }
 
@@ -2077,16 +2082,17 @@
       remoteType,
       replayExecution,
       sameProcessAsFrameLoader,
       uriIsAboutBlank,
       userContextId,
       skipLoad,
     } = {}) {
       let b = document.createXULElement("browser");
+
       // Use the JSM global to create the permanentKey, so that if the
       // permanentKey is held by something after this window closes, it
       // doesn't keep the window alive.
       b.permanentKey = new (Cu.getGlobalForObject(Services)).Object();
 
       const defaultBrowserAttributes = {
         contextmenu: "contentAreaContextMenu",
         datetimepicker: "DateTimePickerPanel",
@@ -2152,17 +2158,16 @@
 
       if (nextRemoteTabId) {
         if (!remoteType) {
           throw new Error("Cannot have nextRemoteTabId without a remoteType");
         }
         // Gecko is going to read this attribute and use it.
         b.setAttribute("nextRemoteTabId", nextRemoteTabId.toString());
       }
-
       if (sameProcessAsFrameLoader) {
         b.sameProcessAsFrameLoader = sameProcessAsFrameLoader;
       }
 
       // This will be used by gecko to control the name of the opened
       // window.
       if (name) {
         // XXX: The `name` property is special in HTML and XUL. Should
@@ -2176,19 +2181,144 @@
       // We set large flex on both containers to allow the devtools toolbox to
       // set a flex attribute. We don't want the toolbox to actually take up free
       // space, but we do want it to collapse when the window shrinks, and with
       // flex=0 it can't. When the toolbox is on the bottom it's a sibling of
       // browserStack, and when it's on the side it's a sibling of
       // browserContainer.
       let stack = document.createXULElement("stack");
       stack.className = "browserStack";
+
+      let a11yModeControls = document.createXULElement("vbox");
+      a11yModeControls.classList.add("a11ymode-controls");
+
+      function createA11YModeButton(classList, tooltiptext, onClick) {
+        let button = document.createXULElement("toolbarbutton");
+        button.onclick = event => {
+          for (let active of stack.querySelectorAll(
+            ".a11ymode-controls toolbarbutton[active]"
+          )) {
+            active.removeAttribute("active");
+          }
+          button.setAttribute("active", "true");
+          onClick(event);
+        };
+        button.classList.add(classList);
+        button.setAttribute("tooltiptext", tooltiptext);
+        return button;
+      }
+
+      let closeA11YMode = () => {
+        stack.removeAttribute("a11ymode");
+        if (b.a11ymodeBrowser) {
+          this.closeFindbarForTab(this.getTabForBrowser(b));
+          b.destroyA11YModeBrowser();
+        }
+      };
+      let openA11YMode = () => {
+        if (!b.a11ymodeBrowser) {
+          this.closeFindbarForTab(this.getTabForBrowser(b));
+          b.before(b.createA11YModeBrowser());
+        }
+        if (!stack.hasAttribute("a11ymode")) {
+          stack.setAttribute("a11ymode", "on");
+        }
+      };
+
+      let buttonOn = createA11YModeButton("a11ymode-on", "a11y view", () => {
+        openA11YMode();
+        stack.setAttribute("a11ymode", "on");
+      });
+
+      let buttonSplit = createA11YModeButton(
+        "a11ymode-split",
+        "split view",
+        () => {
+          openA11YMode();
+          stack.setAttribute("a11ymode", "split");
+        }
+      );
+
+      let buttonOff = createA11YModeButton(
+        "a11ymode-off",
+        "default web view",
+        closeA11YMode
+      );
+      let buttonMedia = createA11YModeButton(
+        "a11ymode-media",
+        "media view",
+        () => {
+          openA11YMode();
+
+          b.a11ymodeBrowser.browsingContext.currentWindowGlobal
+            .getActor("A11YMode")
+            .sendAsyncMessage("A11YMode:SetMediaView");
+        }
+      );
+
+      let buttonReader = createA11YModeButton(
+        "a11ymode-reader",
+        "reader mode",
+        event => {
+          closeA11YMode();
+          ReaderParent.buttonClick(event);
+        }
+      );
+
+      let buttonOutline = createA11YModeButton(
+        "a11ymode-outline",
+        "outline view",
+        () => {
+          openA11YMode();
+
+          b.a11ymodeBrowser.browsingContext.currentWindowGlobal
+            .getActor("A11YMode")
+            .sendAsyncMessage("A11YMode:SetOutlineView");
+        }
+      );
+
+      // let button4 = document.createElement("input");
+      // button4.type = "checkbox";
+      // button4.classList.add("a11ymode-debug");
+      // button4.onchange = () => {
+      //   openA11YMode();
+      //   b.a11ymodeBrowser.browsingContext.currentWindowGlobal
+      //     .getActor("A11YMode")
+      //     .sendAsyncMessage("A11YMode:ToggleDebug");
+      // };
+
+      a11yModeControls.append(
+        buttonOff,
+        buttonOn,
+        buttonSplit,
+        buttonOutline,
+        buttonMedia,
+        buttonReader /*, button4*/
+      );
+      stack.appendChild(a11yModeControls);
+
       stack.appendChild(b);
       stack.setAttribute("flex", "10000");
 
+      // console.log(isPreloadBrowser);
+      // if (!isPreloadBrowser) {
+      // }
+      // if (b.a11ymodeBrowser) {
+      //   b.a11ymodeBrowser.classList.add("a11ymode");
+      //   stack.appendChild(b.a11ymodeBrowser);
+      // }
+
+      // try {
+      //   a11ymodeBrowser.loadURI("about:a11ymode", {
+      //     triggeringPrincipal: Services.scriptSecurityManager.getSystemPrincipal(),
+      //   });
+      // } catch (ex) {
+      //   Cu.reportError(ex);
+      // }
+
       let browserContainer = document.createXULElement("vbox");
       browserContainer.className = "browserContainer";
       browserContainer.appendChild(notificationbox);
       browserContainer.appendChild(stack);
       browserContainer.setAttribute("flex", "10000");
 
       let browserSidebarContainer = document.createXULElement("hbox");
       browserSidebarContainer.className = "browserSidebarContainer";
@@ -2438,16 +2568,25 @@
         !browser.permitUnload(permitUnloadFlags).permitUnload
       ) {
         return false;
       }
 
       return true;
     },
 
+    closeFindbarForTab(aTab) {
+      // Reset the findbar and remove it if it is attached to the tab.
+      if (aTab._findBar) {
+        aTab._findBar.close(true);
+        aTab._findBar.remove();
+        delete aTab._findBar;
+      }
+    },
+
     discardBrowser(aTab, aForceDiscard) {
       "use strict";
       let browser = aTab.linkedBrowser;
 
       if (!this._mayDiscardBrowser(aTab, aForceDiscard)) {
         return false;
       }
 
@@ -2475,22 +2614,17 @@
       let listener = this._tabListeners.get(aTab);
       browser.webProgress.removeProgressListener(filter);
       filter.removeProgressListener(listener);
       listener.destroy();
 
       this._tabListeners.delete(aTab);
       this._tabFilters.delete(aTab);
 
-      // Reset the findbar and remove it if it is attached to the tab.
-      if (aTab._findBar) {
-        aTab._findBar.close(true);
-        aTab._findBar.remove();
-        delete aTab._findBar;
-      }
+      this.closeFindbarForTab();
 
       browser.destroy();
       this.getPanel(browser).remove();
       aTab.removeAttribute("linkedpanel");
 
       this._createLazyBrowser(aTab);
 
       let evt = new CustomEvent("TabBrowserDiscarded", { bubbles: true });
@@ -3779,16 +3913,19 @@
       if (this._switcher) {
         this._switcher.onTabRemoved(aTab);
       }
 
       // This will unload the document. An unload handler could remove
       // dependant tabs, so it's important that the tabbrowser is now in
       // a consistent state (tab removed, tab positions updated, etc.).
       browser.remove();
+      // if (browser.a11ymodeBrowser) {
+      //   browser.a11ymodeBrowser.remove();
+      // }
 
       // Release the browser in case something is erroneously holding a
       // reference to the tab after its removal.
       this._tabForBrowser.delete(aTab.linkedBrowser);
       aTab.linkedBrowser = null;
 
       panel.remove();
 
@@ -4172,16 +4309,26 @@
 
     announceWindowCreated(browser, userContextId) {
       let tab = this.getTabForBrowser(browser);
       if (tab && userContextId) {
         ContextualIdentityService.telemetry(userContextId);
         tab.setUserContextId(userContextId);
       }
 
+      // Automatically create the a11ymodeBrowser:
+      // XXX: this should only happen if the tab previously had it or if
+      // there's some global state
+      if (tab) {
+        // if (!browser.a11ymodeBrowser) {
+        //   // XXX: Make a module to control the sidebar here instead of random clicking
+        //   browser.parentNode.querySelector(".a11ymode-split").click();
+        // }
+      }
+
       // We don't want to update the container icon and identifier if
       // this is not the selected browser.
       if (browser == gBrowser.selectedBrowser) {
         updateUserContextUIIndicator();
       }
     },
 
     reloadMultiSelectedTabs() {
@@ -5160,17 +5307,16 @@
           openContextMenu(aMessage);
           break;
         }
         case "Browser:Init": {
           let tab = this.getTabForBrowser(browser);
           if (!tab) {
             return undefined;
           }
-
           this._outerWindowIDBrowserMap.set(browser.outerWindowID, browser);
           browser.sendMessageToActor(
             "Browser:AppTab",
             { isAppTab: tab.pinned },
             "BrowserTab"
           );
           break;
         }
@@ -5500,16 +5646,21 @@
 
       this.addEventListener("oop-browser-crashed", event => {
         if (!event.isTrusted) {
           return;
         }
 
         let browser = event.originalTarget;
 
+        if (browser.hostBrowser) {
+          console.error("a11ymode crashed");
+          return;
+        }
+
         // Preloaded browsers do not actually have any tabs. If one crashes,
         // it should be released and removed.
         if (browser === this.preloadedBrowser) {
           NewTabPagePreloading.removePreloadedBrowser(window);
           return;
         }
 
         let icon = browser.mIconURL;
diff --git a/browser/components/BrowserGlue.jsm b/browser/components/BrowserGlue.jsm
--- a/browser/components/BrowserGlue.jsm
+++ b/browser/components/BrowserGlue.jsm
@@ -65,16 +65,31 @@ let ACTORS = {
         AboutLoginsSyncEnable: { wantUntrusted: true },
         AboutLoginsSyncOptions: { wantUntrusted: true },
         AboutLoginsUpdateLogin: { wantUntrusted: true },
       },
     },
     matches: ["about:logins", "about:logins?*"],
   },
 
+  A11YMode: {
+    parent: {
+      moduleURI: "resource:///actors/A11YModeParent.jsm",
+    },
+    child: {
+      moduleURI: "resource:///actors/A11YModeChild.jsm",
+      events: {
+        DOMWindowCreated: {},
+        A11YModeContentLoaded: { wantUntrusted: true },
+        A11YModeContentClicked: { wantUntrusted: true },
+        A11YModeContentEvent: { wantUntrusted: true },
+      },
+    },
+  },
+
   BlockedSite: {
     parent: {
       moduleURI: "resource:///actors/BlockedSiteParent.jsm",
     },
     child: {
       moduleURI: "resource:///actors/BlockedSiteChild.jsm",
       events: {
         AboutBlockedLoaded: { wantUntrusted: true },
diff --git a/browser/components/a11ymode/A11YModeChild.jsm b/browser/components/a11ymode/A11YModeChild.jsm
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/A11YModeChild.jsm
@@ -0,0 +1,633 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+"use strict";
+
+const EXPORTED_SYMBOLS = ["A11YModeChild"];
+
+const { XPCOMUtils } = ChromeUtils.import(
+  "resource://gre/modules/XPCOMUtils.jsm"
+);
+const { Services } = ChromeUtils.import("resource://gre/modules/Services.jsm");
+const { setTimeout } = ChromeUtils.import("resource://gre/modules/Timer.jsm");
+
+const overlayToWalkerMap = new WeakMap();
+const hostToOverlayMap = new WeakMap();
+const overlayToAccIdMap = new Map();
+const overlayToAccMap = new Map();
+
+const {
+  EVENT_SHOW,
+  EVENT_HIDE,
+  EVENT_REORDER,
+  EVENT_ACTIVE_DECENDENT_CHANGED,
+  EVENT_FOCUS,
+  EVENT_STATE_CHANGE,
+  EVENT_LOCATION_CHANGE,
+  EVENT_NAME_CHANGE,
+  EVENT_DESCRIPTION_CHANGE,
+  EVENT_VALUE_CHANGE,
+  EVENT_HELP_CHANGE,
+  EVENT_DEFACTION_CHANGE,
+  EVENT_ACTION_CHANGE,
+  EVENT_ACCELERATOR_CHANGE,
+  EVENT_SELECTION,
+  EVENT_SELECTION_ADD,
+  EVENT_SELECTION_REMOVE,
+  EVENT_SELECTION_WITHIN,
+  EVENT_ALERT,
+  EVENT_FOREGROUND,
+  EVENT_MENU_START,
+  EVENT_MENU_END,
+  EVENT_MENUPOPUP_START,
+  EVENT_MENUPOPUP_END,
+  EVENT_CAPTURE_START,
+  EVENT_CAPTURE_END,
+  EVENT_MOVESIZE_START,
+  EVENT_MOVESIZE_END,
+  EVENT_CONTEXTHELP_START,
+  EVENT_CONTEXTHELP_END,
+  EVENT_DRAGDROP_START,
+  EVENT_DRAGDROP_END,
+  EVENT_DIALOG_START,
+  EVENT_DIALOG_END,
+  EVENT_SCROLLING_START,
+  EVENT_SCROLLING_END,
+  EVENT_MINIMIZE_START,
+  EVENT_MINIMIZE_END,
+  EVENT_DOCUMENT_LOAD_COMPLETE,
+  EVENT_DOCUMENT_RELOAD,
+  EVENT_DOCUMENT_LOAD_STOPPED,
+  EVENT_DOCUMENT_ATTRIBUTES_CHANGED,
+  EVENT_DOCUMENT_CONTENT_CHANGED,
+  EVENT_PROPERTY_CHANGED,
+  EVENT_PAGE_CHANGED,
+  EVENT_TEXT_ATTRIBUTE_CHANGED,
+  EVENT_TEXT_CARET_MOVED,
+  EVENT_TEXT_CHANGED,
+  EVENT_TEXT_INSERTED,
+  EVENT_TEXT_REMOVED,
+  EVENT_TEXT_UPDATED,
+  EVENT_TEXT_SELECTION_CHANGED,
+  EVENT_VISIBLE_DATA_CHANGED,
+  EVENT_TEXT_COLUMN_CHANGED,
+  EVENT_SECTION_CHANGED,
+  EVENT_TABLE_CAPTION_CHANGED,
+  EVENT_TABLE_MODEL_CHANGED,
+  EVENT_TABLE_SUMMARY_CHANGED,
+  EVENT_TABLE_ROW_DESCRIPTION_CHANGED,
+  EVENT_TABLE_ROW_HEADER_CHANGED,
+  EVENT_TABLE_ROW_INSERT,
+  EVENT_TABLE_ROW_DELETE,
+  EVENT_TABLE_ROW_REORDER,
+  EVENT_TABLE_COLUMN_DESCRIPTION_CHANGED,
+  EVENT_TABLE_COLUMN_HEADER_CHANGED,
+  EVENT_TABLE_COLUMN_INSERT,
+  EVENT_TABLE_COLUMN_DELETE,
+  EVENT_TABLE_COLUMN_REORDER,
+  EVENT_WINDOW_ACTIVATE,
+  EVENT_WINDOW_CREATE,
+  EVENT_WINDOW_DEACTIVATE,
+  EVENT_WINDOW_DESTROY,
+  EVENT_WINDOW_MAXIMIZE,
+  EVENT_WINDOW_MINIMIZE,
+  EVENT_WINDOW_RESIZE,
+  EVENT_WINDOW_RESTORE,
+  EVENT_HYPERLINK_END_INDEX_CHANGED,
+  EVENT_HYPERLINK_NUMBER_OF_ANCHORS_CHANGED,
+  EVENT_HYPERLINK_SELECTED_LINK_CHANGED,
+  EVENT_HYPERTEXT_LINK_ACTIVATED,
+  EVENT_HYPERTEXT_LINK_SELECTED,
+  EVENT_HYPERLINK_START_INDEX_CHANGED,
+  EVENT_HYPERTEXT_CHANGED,
+  EVENT_HYPERTEXT_NLINKS_CHANGED,
+  EVENT_OBJECT_ATTRIBUTE_CHANGED,
+  EVENT_VIRTUALCURSOR_CHANGED,
+  EVENT_TEXT_VALUE_CHANGE,
+  EVENT_SCROLLING,
+  EVENT_ANNOUNCEMENT,
+} = Ci.nsIAccessibleEvent;
+
+const RELATIONS_TO_IGNORE = new Set([
+  Ci.nsIAccessibleRelation.RELATION_CONTAINING_APPLICATION,
+  Ci.nsIAccessibleRelation.RELATION_CONTAINING_TAB_PANE,
+  Ci.nsIAccessibleRelation.RELATION_CONTAINING_WINDOW,
+  Ci.nsIAccessibleRelation.RELATION_PARENT_WINDOW_OF,
+  Ci.nsIAccessibleRelation.RELATION_SUBWINDOW_OF,
+]);
+
+const nsIAccessibleRole = Ci.nsIAccessibleRole;
+const TEXT_ROLES = new Set([
+  nsIAccessibleRole.ROLE_TEXT_LEAF,
+  nsIAccessibleRole.ROLE_STATICTEXT,
+]);
+
+const STATE_DEFUNCT = Ci.nsIAccessibleStates.EXT_STATE_DEFUNCT;
+
+function throttle(that, callback, limit) {
+  var wait = false;
+  return function() {
+    if (!wait) {
+      callback.apply(that, arguments);
+      wait = true;
+      setTimeout(function() {
+        wait = false;
+      }, limit);
+    }
+  };
+}
+
+/**
+ * Helper function that determines if nsIAccessible object is in defunct state.
+ *
+ * @param  {nsIAccessible}  accessible
+ *         object to be tested.
+ * @return {Boolean}
+ *         True if accessible object is defunct, false otherwise.
+ */
+function isDefunct(accessible) {
+  // If accessibility is disabled, safely assume that the accessible object is
+  // now dead.
+  if (!Services.appinfo.accessibilityEnabled) {
+    return true;
+  }
+
+  let defunct = false;
+
+  try {
+    const extraState = {};
+    accessible.getState({}, extraState);
+    // extraState.value is a bitmask. We are applying bitwise AND to mask out
+    // irrelevant states.
+    defunct = !!(extraState.value & Ci.nsIAccessibleStates.EXT_STATE_DEFUNCT);
+  } catch (e) {
+    defunct = true;
+  }
+
+  return defunct;
+}
+
+/**
+ * Helper function that determines if nsIAccessible object is in stale state. When an
+ * object is stale it means its subtree is not up to date.
+ *
+ * @param  {nsIAccessible}  accessible
+ *         object to be tested.
+ * @return {Boolean}
+ *         True if accessible object is stale, false otherwise.
+ */
+function isStale(accessible) {
+  const extraState = {};
+  accessible.getState({}, extraState);
+  // extraState.value is a bitmask. We are applying bitwise AND to mask out
+  // irrelevant states.
+  return !!(extraState.value & Ci.nsIAccessibleStates.EXT_STATE_STALE);
+}
+
+function sendToContent(browsingContext, messageType, detail = {}) {
+  let win = browsingContext.window;
+  let message = Object.assign({ messageType }, { value: detail });
+  let event = new win.CustomEvent("A11YModeChromeToContent", {
+    detail: Cu.cloneInto(message, win),
+  });
+  win.dispatchEvent(event);
+}
+
+class SingletonObserver {
+  constructor() {
+    this._listeners = new Set();
+  }
+  get a11yService() {
+    if (!this._a11yService) {
+      // This turns on accessibility automatically (see Services.appinfo.accessibilityEnabled)
+      // See https://searchfox.org/mozilla-central/source/devtools/server/actors/accessibility/accessibility-parent.js#135 for more lifecycle
+      this._a11yService = Cc["@mozilla.org/accessibilityService;1"].getService(
+        Ci.nsIAccessibilityService
+      );
+    }
+    return this._a11yService;
+  }
+
+  on(listener) {
+    if (!this._listeners.size) {
+      this.a11yService;
+      console.log("Adding listener");
+      Services.obs.addObserver(this, "accessible-event");
+    }
+    this._listeners.add(listener);
+    console.log(this._listeners.size, "listenesr");
+  }
+
+  off(listener) {
+    if (this._listeners.has(listener) && this._listeners.size == 1) {
+      console.log("Removing observer");
+      Services.obs.removeObserver(this, "accessible-event");
+    }
+    this._listeners.delete(listener);
+  }
+
+  observe(subject) {
+    const event = subject.QueryInterface(Ci.nsIAccessibleEvent);
+    for (let listener of this._listeners.values()) {
+      try {
+        if (
+          event.accessibleDocument &&
+          listener.hostBrowsingContext.window.document ==
+            event.accessibleDocument.DOMDocument
+        ) {
+          listener.changeObserved(event);
+        }
+      } catch (e) {
+        Cu.reportError(e);
+      }
+    }
+  }
+}
+
+SingletonObserver.prototype.QueryInterface = ChromeUtils.generateQI([
+  Ci.nsIObserver,
+  Ci.nsISupportsWeakReference,
+]);
+const gSingletonObserver = new SingletonObserver();
+
+class A11YWalker {
+  constructor(hostBrowsingContext, overlayBrowsingContext) {
+    this.overlayBrowsingContext = overlayBrowsingContext;
+    this.hostBrowsingContext = hostBrowsingContext;
+    this.accIdUnique = 0;
+    // XXX: this causes some stuff to get missed since we only get the event for
+    // first or last node. We really need to optimize hide / textRemoved
+    this.changeObserved = throttle(this, this.changeObserved, 100);
+    gSingletonObserver.on(this);
+    overlayToAccMap.set(this.overlayBrowsingContext, new WeakMap());
+  }
+
+  destruct() {
+    gSingletonObserver.off(this);
+    this.overlayBrowsingContext = this.hostBrowsingContext = null;
+  }
+
+  get a11yService() {
+    return gSingletonObserver.a11yService;
+  }
+
+  getStringRole(role) {
+    if (!this.KNOWN_ROLES) {
+      this.KNOWN_ROLES = {};
+    }
+    if (!this.KNOWN_ROLES[role]) {
+      this.KNOWN_ROLES[role] = this.a11yService.getStringRole(role);
+    }
+    return this.KNOWN_ROLES[role];
+  }
+
+  /**
+   * Get a snapshot of the nsIAccessible object including its subtree. None of the subtree
+   * queried here is cached via accessible walker's refMap.
+   * @param  {nsIAccessible} acc
+   *         Accessible object to take a snapshot of.
+   * @param  {nsIAccessibilityService} a11yService
+   *         Accessibility service instance in the current process, used to get localized
+   *         string representation of various accessible properties.
+   * @return {JSON}
+   *         JSON snapshot of the accessibility tree with root at current accessible.
+   */
+  doSnapshot(acc, a11yService) {
+    if (isDefunct(acc)) {
+      return {
+        states: [a11yService.getStringStates(0, STATE_DEFUNCT)],
+      };
+    }
+
+    let accIdUnique = ++this.accIdUnique;
+    overlayToAccIdMap.get(this.overlayBrowsingContext).set(accIdUnique, acc);
+
+    const actions = [];
+    for (let i = 0; i < acc.actionCount; i++) {
+      actions.push(acc.getActionDescription(i));
+    }
+
+    const attributes = {};
+    // console.log(acc.attributes);
+    if (acc.attributes) {
+      // This is slow:
+      // for (const { key, value } of acc.attributes.enumerate()) {
+      //   attributes[key] = value;
+      // }
+      // let's only grab what's necesssary
+      try {
+        attributes["xml-roles"] = acc.attributes.getStringProperty("xml-roles");
+      } catch (e) {}
+      try {
+        attributes.tag = acc.attributes.getStringProperty("tag");
+      } catch (e) {}
+    }
+
+    // const state = {};
+    // const extState = {};
+    // acc.getState(state, extState);
+    const states = [
+      // ...a11yService.getStringStates(state.value, extState.value),
+    ];
+
+    const children = [];
+    for (let child = acc.firstChild; child; child = child.nextSibling) {
+      children.push(this.doSnapshot(child, a11yService));
+    }
+
+    return {
+      name: acc.name,
+      role: this.getStringRole(acc.role),
+      actions,
+      value: acc.value,
+      // nodeType: acc.DOMNode.nodeType,
+      description: acc.description,
+      keyboardShortcut: acc.accessKey || acc.keyboardShortcut,
+      // childCount: acc.childCount,
+      // indexInParent: acc.indexInParent, // XXX: Crash on cdc page when navigating to french
+      states,
+      children,
+      attributes,
+      id: accIdUnique,
+    };
+  }
+
+  /**
+   * Get a raw accessible object for a raw node.
+   * @param  {DOMNode} rawNode
+   *         Raw node for which accessible object is being retrieved.
+   * @return {nsIAccessible}
+   *         Accessible object for a given DOMNode.
+   */
+  getRawAccessibleFor(rawNode) {
+    // Accessible can only be retrieved iff accessibility service is enabled.
+    if (!Services.appinfo.accessibilityEnabled) {
+      return null;
+    }
+
+    return this.a11yService.getAccessibleFor(rawNode);
+  }
+
+  getAccessibleForAccID(accId) {
+    const acc = overlayToAccIdMap
+      .get(this.overlayBrowsingContext)
+      .get(parseInt(accId));
+    return acc;
+  }
+
+  doAction(accId) {
+    let acc = this.getAccessibleForAccID(accId);
+    if (!acc) {
+      throw new Error(
+        `No accId ${accId}. We should be sending down actual ids from platform so this doesn't happen.`
+      );
+    }
+
+    for (let i = 0; i < acc.actionCount; i++) {
+      console.log(i, acc.getActionName(i));
+    }
+
+    acc.doAction(0);
+  }
+
+  getSnapshot(acc) {
+    overlayToAccIdMap.set(this.overlayBrowsingContext, new Map());
+    // let start = this.overlayBrowsingContext.window.performance.now();
+    // for (const { key, value } of acc.attributes.enumerate()) {
+    //   console.log(key, value);
+    //   let i = key + value;
+    // }
+
+    // try {
+
+    // let i = acc.attributes.getStringProperty("tag"); //, acc.attributes.toString());
+    //   let j = acc.attributes.getStringProperty("asdfasfd"); //, acc.attributes.toString());
+
+    // } catch(e) {}
+    // for (const key of acc.attributes.keys()) {
+    //   console.log(key);
+    //   // let i = key + value;
+    // }
+    // console.log(
+    //   `Took ${this.overlayBrowsingContext.window.performance.now() - start}`
+    // );
+    return this.doSnapshot(acc, this.a11yService);
+  }
+
+  getSnapshot2(acc, parent) {
+    overlayToAccIdMap.set(this.overlayBrowsingContext, new Map());
+    let el = overlayToAccMap.get(this.overlayBrowsingContext).get(acc)
+      ? overlayToAccMap.get(this.overlayBrowsingContext).get(acc).el
+      : null;
+
+    // let yuck = acc.toString().match(/ \@ (.*) \(/)[1];
+    // console.log(this.a11yService.getStringRole(acc.role), acc.toString(), yuck);
+    if (el) {
+      // console.log(el);
+    } else {
+      el = this.overlayBrowsingContext.window.document.createElement("div");
+      el.textContent = this.getStringRole(acc.role);
+      el.addEventListener("click", () => {
+        // console.log("CLICKED", el);
+      });
+    }
+
+    const children = [];
+    let ret = {
+      self: acc,
+      children,
+      el,
+    };
+    overlayToAccMap.get(this.overlayBrowsingContext).set(acc, ret);
+
+    for (let child = acc.firstChild; child; child = child.nextSibling) {
+      children.push(this.getSnapshot2(child, ret));
+    }
+
+    // let container = parent
+    //   ? parent.el
+    //   : this.overlayBrowsingContext.window.document.body;
+    // container.appendChild(el);
+
+    return ret;
+  }
+  sendSnapshot() {
+    let start = this.overlayBrowsingContext.window.performance.now();
+
+    // this.overlayBrowsingContext.window.document.body.innerHTML = "";
+    // let snapshot = this.getSnapshot(
+    //   this.getRawAccessibleFor(this.hostBrowsingContext.window.document)
+    // );
+    let snapshot = this.getSnapshot(
+      this.getRawAccessibleFor(this.hostBrowsingContext.window.document)
+    );
+
+    console.log(
+      `Created snapshot (traversed ${
+        overlayToAccIdMap.get(this.overlayBrowsingContext).size
+      } nodes)`,
+
+      this.overlayBrowsingContext.window.performance.now() - start
+    );
+    sendToContent(this.overlayBrowsingContext, "TreeChanged", snapshot);
+  }
+
+  /**
+   * Accessible event observer function.
+   *
+   * @param {Ci.nsIAccessibleEvent} subject
+   *                                      accessible event object.
+   */
+  // eslint-disable-next-line complexity
+  changeObserved(event) {
+    // See https://searchfox.org/mozilla-central/rev/c79c0d65a183d9d38676855f455a5c6a7f7dadd3/devtools/server/actors/accessibility/walker.js#621
+    // for a more complete example
+
+    // Don't worry about scrolling. The overlay view doesn't care about it.
+    // XXX: Instead of opting out of events we are opting in to only the ones
+    // we care about below. Leaving this since there are so many events
+    // we may want to go back to something like this
+    // if (
+    //   event.eventType == EVENT_SCROLLING_START ||
+    //   event.eventType == EVENT_SCROLLING_END ||
+    //   event.eventType == EVENT_SCROLLING
+    // ) {
+    //   return;
+    // }
+
+    // XXX: Always sending the whole snapshot for everything.
+    // Some of these should be relatively easy to keep a data source
+    // up to date for exammple name_change. Then the trick will be doing
+    // a minimal amount of updates from that tree into DOM (maybe vdom).
+    if (
+      event.eventType == EVENT_DOCUMENT_LOAD_COMPLETE ||
+      event.eventType == EVENT_TEXT_CHANGED ||
+      event.eventType == EVENT_TEXT_INSERTED ||
+      event.eventType == EVENT_TEXT_REMOVED ||
+      event.eventType == EVENT_ACCELERATOR_CHANGE ||
+      event.eventType == EVENT_ACTION_CHANGE ||
+      event.eventType == EVENT_DEFACTION_CHANGE ||
+      event.eventType == EVENT_DESCRIPTION_CHANGE ||
+      event.eventType == EVENT_DOCUMENT_ATTRIBUTES_CHANGED ||
+      event.eventType == EVENT_HIDE ||
+      event.eventType == EVENT_SHOW ||
+      event.eventType == EVENT_NAME_CHANGE ||
+      event.eventType == EVENT_OBJECT_ATTRIBUTE_CHANGED ||
+      event.eventType == EVENT_REORDER ||
+      event.eventType == EVENT_STATE_CHANGE ||
+      event.eventType == EVENT_TEXT_ATTRIBUTE_CHANGED ||
+      event.eventType == EVENT_VALUE_CHANGE
+    ) {
+      console.log(
+        "Processing change",
+        this.a11yService.getStringEventType(event.eventType)
+      );
+      this.sendSnapshot();
+    } else {
+      console.log(
+        "Ignoring change",
+        this.a11yService.getStringEventType(event.eventType),
+        event.accessible.DOMNode
+      );
+    }
+  }
+}
+
+// See stuff like https://searchfox.org/mozilla-central/source/devtools/server/actors/accessibility/walker.js#499
+
+// Basic idea here is to use this actor to receive the accessibility tree and
+// subsequent events from a 'host' browser, and then to send them along to an
+// 'a11ymode' browser (which are running in the same content process)
+// Maybe this should be two different actors?
+class A11YModeChild extends JSWindowActorChild {
+  willDestroy(e) {
+    // Overlay is destroyed. Kill observing:
+    if (overlayToWalkerMap.has(this.browsingContext)) {
+      overlayToWalkerMap.get(this.browsingContext).destruct();
+      overlayToWalkerMap.delete(this.browsingContext);
+    }
+  }
+  actorCreated(e) {
+    // I think it's better to wait for A11YModeContentLoaded to
+    // signal the connection so there's no races.. but smaybe this
+    // would come in handy somehow?
+  }
+
+  receiveMessage(message) {
+    console.log(
+      "A11YModeChild::receiveMessage",
+      message.name,
+      Services.appinfo.processID,
+      this.browsingContext.window.location.toString()
+    );
+    switch (message.name) {
+      case "A11YMode:UpdateBrowsingContext":
+        const { browsingContext } = message.data;
+        const walker = new A11YWalker(this.browsingContext, browsingContext);
+        hostToOverlayMap.set(this.browsingContext, browsingContext);
+        overlayToWalkerMap.set(browsingContext, walker);
+
+        // This is only called aftter the initial A11YModeContentLoaded happens,
+        // so send an entire snapshot now (we can then observe and signal incrementtal
+        // changes later).
+        walker.sendSnapshot();
+        break;
+      case "A11YMode:ToggleDebug":
+        sendToContent(this.browsingContext, "ToggleDebug");
+        break;
+      case "A11YMode:SetMediaView":
+        sendToContent(this.browsingContext, "SetMediaView");
+        break;
+      case "A11YMode:SetOutlineView":
+        sendToContent(this.browsingContext, "SetOutlineView");
+        break;
+    }
+  }
+  handleEvent(event) {
+    switch (event.type) {
+      case "A11YModeContentLoaded":
+        // We can either sendToContent or directly change the DOM:
+        console.log("A11YModeContentLoaded, PID:", Services.appinfo.processID);
+        let title = this.document.querySelector("#title");
+        title.textContent = `a11ymode from PID: ${Services.appinfo.processID}`;
+        this.sendAsyncMessage("A11YMode:WindowCreated");
+        break;
+      case "A11YModeContentEvent":
+        // XXX: Either accept input on the overlay then use nsIAccessibleEditableText
+        // to set it on the host. Or prevent default on the overlay then EventUtils.synthesizeKey
+        // on the host and wait for a round trip to update the overlay.
+
+        // Also, we could maybe create the DOM for a11ymode.js in this file and keep a direct
+        // reference to overlay DOM node and host DOM node, hooking together key events
+        // that way somehow?
+
+        // XXX: Also check pagehide/pageshow on host
+
+        // XXX: also test findbar wiring with overlay
+
+        // XXX: Unique acc to DOMnode weakmap?
+        if (overlayToWalkerMap.has(this.browsingContext)) {
+          let input = overlayToWalkerMap
+            .get(this.browsingContext)
+            .getAccessibleForAccID(event.detail.accId).DOMNode;
+          console.log("trigger key for", event.detail.event);
+
+          input.setUserInput(event.detail.event.target.value);
+
+          // overlayToWalkerMap
+          //   .get(this.browsingContext)
+          //   .doAction(event.detail.accId);
+        }
+        break;
+      case "A11YModeContentClicked":
+        // console.log("Received command for ", event.detail.accId);
+        if (overlayToWalkerMap.has(this.browsingContext)) {
+          overlayToWalkerMap
+            .get(this.browsingContext)
+            .doAction(event.detail.accId);
+        }
+        break;
+    }
+  }
+}
diff --git a/browser/components/a11ymode/A11YModeParent.jsm b/browser/components/a11ymode/A11YModeParent.jsm
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/A11YModeParent.jsm
@@ -0,0 +1,41 @@
+/* vim: set ts=2 sw=2 sts=2 et tw=80: */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+"use strict";
+
+var EXPORTED_SYMBOLS = ["A11YModeParent"];
+
+const { BrowserWindowTracker } = ChromeUtils.import(
+  "resource:///modules/BrowserWindowTracker.jsm"
+);
+const { E10SUtils } = ChromeUtils.import(
+  "resource://gre/modules/E10SUtils.jsm"
+);
+const { Services } = ChromeUtils.import("resource://gre/modules/Services.jsm");
+const { AppConstants } = ChromeUtils.import(
+  "resource://gre/modules/AppConstants.jsm"
+);
+
+class A11YModeParent extends JSWindowActorParent {
+  receiveMessage(message) {
+    // console.log("A11YModeParent::receiveMessage", message);
+    let browser = this.manager.browsingContext.embedderElement;
+    if (!browser) {
+      return; // Can happen sometimes if browser is being destroyed
+    }
+
+    switch (message.name) {
+      case "A11YMode:WindowCreated": {
+        if (browser.hostBrowser) {
+          browser.hostBrowser.browsingContext.currentWindowGlobal
+            .getActor("A11YMode")
+            .sendAsyncMessage("A11YMode:UpdateBrowsingContext", {
+              browsingContext: browser.browsingContext,
+            });
+        }
+        break;
+      }
+    }
+  }
+}
diff --git a/browser/components/a11ymode/content/a11ymode.css b/browser/components/a11ymode/content/a11ymode.css
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/content/a11ymode.css
@@ -0,0 +1,270 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+
+html, body {
+  margin: 0;
+  padding: 0;
+}
+html {
+  font-family: sans-serif, Arial;
+  font-size: 14px/1.5;
+}
+
+#controls {
+  padding: 3px;
+  border-bottom: 2px solid #eee;
+  position: fixed;
+  background: #fafafa;
+  width: 100%;
+  top: 0;
+  box-sizing: border-box;
+}
+
+#controls label {
+  vertical-align: middle;
+  user-select: none;
+  font-size: 12px;
+  position: absolute;
+  right: 0;
+  top: 0;
+}
+
+#content {
+  box-sizing: border-box;
+  margin: auto;
+  margin-top: 30px;
+  width: 98%;
+  padding: 5px 0;
+}
+
+#content details {
+  padding-left: 5px;
+}
+
+
+
+/* Copied from aboutReader.css: */
+
+
+
+/*======= Article content =======*/
+
+/* Note that any class names from the original article that we want to match on
+ * must be added to CLASSES_TO_PRESERVE in ReaderMode.jsm, so that
+ * Readability.js doesn't strip them out */
+
+ .moz-reader-content {
+  font-size: 1em;
+  line-height: 1.6em;
+}
+
+.moz-reader-content.line-height1 {
+  line-height: 1em;
+}
+
+.moz-reader-content.line-height2 {
+  line-height: 1.2em;
+}
+
+.moz-reader-content.line-height3 {
+  line-height: 1.4em;
+}
+
+.moz-reader-content.line-height4 {
+  line-height: 1.6em;
+}
+
+.moz-reader-content.line-height5 {
+  line-height: 1.8em;
+}
+
+.moz-reader-content.line-height6 {
+  line-height: 2.0em;
+}
+
+.moz-reader-content.line-height7 {
+  line-height: 2.2em;
+}
+
+.moz-reader-content.line-height8 {
+  line-height: 2.4em;
+}
+
+.moz-reader-content.line-height9 {
+  line-height: 2.6em;
+}
+
+@media print {
+  .moz-reader-content p,
+  .moz-reader-content code,
+  .moz-reader-content pre,
+  .moz-reader-content blockquote,
+  .moz-reader-content ul,
+  .moz-reader-content ol,
+  .moz-reader-content li,
+  .moz-reader-content figure,
+  .moz-reader-content .wp-caption {
+    margin: 0 0 10px 0 !important;
+    padding: 0 !important;
+  }
+}
+
+.moz-reader-content h1,
+.moz-reader-content h2,
+.moz-reader-content h3 {
+  font-weight: bold;
+}
+
+.moz-reader-content h1 {
+  font-size: 1.6em;
+  line-height: 1.25em;
+}
+
+.moz-reader-content h2 {
+  font-size: 1.2em;
+  line-height: 1.51em;
+}
+
+.moz-reader-content h3 {
+  font-size: 1em;
+  line-height: 1.66em;
+}
+
+.moz-reader-content a:link {
+  text-decoration: underline;
+  font-weight: normal;
+}
+
+.moz-reader-content a:link,
+.moz-reader-content a:link:hover,
+.moz-reader-content a:link:active {
+  color: #0095dd;
+}
+
+.moz-reader-content a:visited {
+  color: #c2e;
+}
+
+.moz-reader-content * {
+  max-width: 100%;
+  height: auto;
+}
+
+.moz-reader-content p,
+.moz-reader-content p,
+.moz-reader-content code,
+.moz-reader-content pre,
+.moz-reader-content blockquote,
+.moz-reader-content ul,
+.moz-reader-content ol,
+.moz-reader-content li,
+.moz-reader-content figure,
+.moz-reader-content .wp-caption {
+  margin: -10px -10px 20px -10px;
+  padding: 10px;
+  border-radius: 5px;
+}
+
+.moz-reader-content li {
+  margin-bottom: 0;
+}
+
+.moz-reader-content li > ul,
+.moz-reader-content li > ol {
+  margin-bottom: -10px;
+}
+
+.moz-reader-content p > img:only-child,
+.moz-reader-content p > a:only-child > img:only-child,
+.moz-reader-content .wp-caption img,
+.moz-reader-content figure img {
+  display: block;
+}
+
+.moz-reader-content img[moz-reader-center] {
+  margin-left: auto;
+  margin-right: auto;
+}
+
+.moz-reader-content .caption,
+.moz-reader-content .wp-caption-text
+.moz-reader-content figcaption {
+  font-size: 0.9em;
+  line-height: 1.48em;
+  font-style: italic;
+}
+
+.moz-reader-content code,
+.moz-reader-content pre {
+  white-space: pre-wrap;
+}
+
+.moz-reader-content blockquote {
+  padding: 0;
+  padding-inline-start: 16px;
+}
+
+.moz-reader-content ul,
+.moz-reader-content ol {
+  padding: 0;
+}
+
+.moz-reader-content ul {
+  padding-inline-start: 30px;
+  list-style: disc;
+}
+
+.moz-reader-content ol {
+  padding-inline-start: 30px;
+  list-style: decimal;
+}
+
+table,
+th,
+td {
+  border: 1px solid currentColor;
+  border-collapse: collapse;
+  padding: 6px;
+  vertical-align: top;
+}
+
+table {
+  margin: 5px;
+}
+
+/* Visually hide (but don't display: none) screen reader elements */
+.moz-reader-content .visually-hidden,
+.moz-reader-content .visuallyhidden,
+.moz-reader-content .sr-only {
+  display: inline-block;
+  width: 1px;
+  height: 1px;
+  margin: -1px;
+  overflow: hidden;
+  padding: 0;
+  border-width: 0;
+}
+
+/* Hide elements with common "hidden" class names */
+.moz-reader-content .hidden,
+.moz-reader-content .invisible {
+  display: none;
+}
+
+/* Enforce wordpress and similar emoji/smileys aren't sized to be full-width,
+ * see bug 1399616 for context. */
+.moz-reader-content img.wp-smiley,
+.moz-reader-content img.emoji {
+  display: inline-block;
+  border-width: 0;
+  /* height: auto is implied from `.moz-reader-content *` rule. */
+  width: 1em;
+  margin: 0 .07em;
+  padding: 0;
+}
+
+.reader-show-element {
+  display: initial;
+}
diff --git a/browser/components/a11ymode/content/a11ymode.html b/browser/components/a11ymode/content/a11ymode.html
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/content/a11ymode.html
@@ -0,0 +1,24 @@
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+
+<!DOCTYPE html>
+
+<html>
+<head>
+  <meta http-equiv="Content-Security-Policy" content="default-src chrome:; img-src data: *; media-src *; object-src 'none'" />
+  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
+  <meta name="viewport" content="width=device-width; user-scalable=0" />
+  <link rel="stylesheet" href="chrome://browser/content/a11ymode/a11ymode.css">
+</head>
+<body>
+
+  <div id="controls">
+    <div id="title"></div>
+    <label><input id="debug" type="checkbox" /> Debug View</label>
+  </div>
+  <div id="content" class="moz-reader-content"></div>
+  <script src="chrome://browser/content/a11ymode/a11ymode.js"></script>
+  <script src="chrome://browser/content/a11ymode/roles.js"></script>
+</body>
+</html>
diff --git a/browser/components/a11ymode/content/a11ymode.js b/browser/components/a11ymode/content/a11ymode.js
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/content/a11ymode.js
@@ -0,0 +1,184 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+"use strict";
+
+document.querySelector("#content").addEventListener("input", e => {
+  const { accId } = e.target.dataset;
+  console.log(e.target);
+  if (accId) {
+    document.dispatchEvent(
+      new CustomEvent("A11YModeContentEvent", {
+        bubbles: true,
+        detail: { type: e.type, accId, event: e },
+      })
+    );
+  }
+  // e.preventDefault();
+});
+document.querySelector("#content").addEventListener(
+  "click",
+  e => {
+    if (isDebug()) {
+      return;
+    }
+    // XXX: Send this up with accessible id to do command
+    // (see [id] field passed into the snapshot)
+    console.log(e, e.target.dataset.accId);
+    const { accId } = e.target.dataset;
+    if (accId) {
+      document.dispatchEvent(
+        new CustomEvent("A11YModeContentClicked", {
+          bubbles: true,
+          detail: { accId },
+        })
+      );
+    }
+    e.preventDefault();
+  },
+  { capture: true }
+);
+
+let ACC_TREE;
+
+function isDebug() {
+  return debugCheckbox.checked;
+}
+
+function idleRender() {
+  requestIdleCallback(
+    () => {
+      renderFull(ACC_TREE);
+    },
+    { timeout: 100 }
+  );
+}
+
+let debugCheckbox = document.querySelector("#debug");
+debugCheckbox.onchange = idleRender;
+
+function renderDebugContainer(treeItem, children) {
+  let details = document.createElement("details");
+  details.toggleAttribute("open");
+  details.setAttribute(
+    "title",
+    JSON.stringify(
+      Object.assign({}, treeItem, { children: undefined }),
+      null,
+      2
+    )
+  );
+  let summary = document.createElement("summary");
+  summary.textContent = `${treeItem.role}: ${treeItem.name} (${treeItem.id})`;
+  details.append(summary, ...children);
+  return [details];
+}
+
+function buildAccTree(accTree) {
+  // document.querySelector("#content").textContent = buildAccTreeElement(accTree);
+  let content = document.querySelector("#content");
+  content.innerHTML = "";
+  let element = buildAccTreeElement(accTree);
+  content.append(...element);
+}
+
+function buildAccTreeElement(accTree) {
+  let children = accTree.children
+    .map(c => {
+      return buildAccTreeElement(c);
+    })
+    .flat();
+  let currentNode = accTree;
+  // console.log(currentNode.role, children);
+  let role = window.ROLE_MAP[currentNode.role];
+
+  if (!role) {
+    throw new Error(`Unknown role: ${currentNode.role}`);
+  }
+
+  if (isDebug()) {
+    return renderDebugContainer(currentNode, children);
+  }
+
+  let els = role.render(currentNode, children);
+  // XXX: find a better way to map id to element
+  // if (els.length == 1 && els[0] && els[0].nodeType == 1) {
+  //   if (els[0].tagName == "A") {
+  //     console.log("Setting", els[0], currentNode.id);
+  //   }
+  //   els[0].dataset.accId = currentNode.id;
+  // }
+  return els;
+}
+
+function throttle(callback, limit) {
+  var wait = false;
+  return function() {
+    if (!wait) {
+      callback.apply(null, arguments);
+      wait = true;
+      setTimeout(function() {
+        wait = false;
+      }, limit);
+    }
+  };
+}
+
+async function renderFull(snapshot) {
+  let start = performance.now();
+  ACC_TREE = snapshot;
+  buildAccTree(snapshot);
+  console.log(`renderFull time ${performance.now() - start}`);
+}
+
+const throttledRender = throttle(renderFull, 1000);
+
+window.addEventListener("DOMContentLoaded", function() {
+  // startListeningForAccessibilityEvents({
+  //   reorder: function() {
+  //     // console.trace(arguments);
+  //     throttledRender();
+  //   },
+  //   "name-change": function() {
+  //     // console.trace(arguments);
+  //     throttledRender();
+  //   },
+  //   "text-change": function() {
+  //     // console.trace(arguments);
+  //     throttledRender();
+  //   },
+  //   "document-ready": function() {
+  //     // console.trace(arguments);
+  //     throttledRender();
+  //   },
+  // });
+  // console.log(window.ROLE_MAP);
+
+  document.dispatchEvent(
+    new CustomEvent("A11YModeContentLoaded", { bubbles: true })
+  );
+});
+
+window.addEventListener("A11YModeChromeToContent", event => {
+  console.log("A11YModeChromeToContent", event.detail);
+  switch (event.detail.messageType) {
+    case "TreeChanged": {
+      renderFull(event.detail.value);
+      break;
+    }
+    case "ToggleDebug": {
+      debugCheckbox.checked = !debugCheckbox.checked;
+      idleRender();
+      break;
+    }
+    case "SetMediaView": {
+      document.querySelector("#title").textContent = "Media";
+      break;
+    }
+    case "SetOutlineView": {
+      document.querySelector("#title").textContent = "Outline";
+      break;
+    }
+  }
+});
diff --git a/browser/components/a11ymode/content/jar.mn b/browser/components/a11ymode/content/jar.mn
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/content/jar.mn
@@ -0,0 +1,9 @@
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+browser.jar:
+    content/browser/a11ymode/a11ymode.html
+    content/browser/a11ymode/a11ymode.js
+    content/browser/a11ymode/roles.js
+    content/browser/a11ymode/a11ymode.css
diff --git a/browser/components/a11ymode/content/roles.js b/browser/components/a11ymode/content/roles.js
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/content/roles.js
@@ -0,0 +1,1547 @@
+// Built from https://searchfox.org/mozilla-central/source/accessible/base/RoleMap.h
+// Copy in the contents of that file and then
+// VSCode: Find with regex ".*" and then alt+enter to select all
+"use strict";
+
+window.ROLE_MAP = {
+  nothing: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  titlebar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  menubar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  scrollbar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  grip: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  sound: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  cursor: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  caret: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  alert: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  window: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "internal frame": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  menupopup: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  menuitem: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  tooltip: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  AXHelpTag: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  application: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  document: {
+    render(treeItem, children) {
+      return [...children];
+      // let container = document.createElement("h1");
+      // container.textContent = `${treeItem.name}`;
+      // return [container, ...children];
+    },
+  },
+  AXWebArea: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  pane: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  chart: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  dialog: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  border: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  grouping: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  separator: {
+    render(treeItem, children) {
+      let container = document.createElement("hr");
+      return [container];
+    },
+  },
+  toolbar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  statusbar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  table: {
+    render(treeItem, children) {
+      let container = document.createElement("table");
+      container.append(...children);
+      return [container];
+    },
+  },
+  columnheader: {
+    render(treeItem, children) {
+      let container = document.createElement("th");
+      container.append(...children);
+      return [container];
+    },
+  },
+  rowheader: {
+    render(treeItem, children) {
+      let container = document.createElement("th");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  column: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  row: {
+    render(treeItem, children) {
+      let container = document.createElement("tr");
+      container.append(...children);
+      return [container];
+    },
+  },
+  cell: {
+    render(treeItem, children) {
+      let container = document.createElement("td");
+      container.append(...children);
+      return [container];
+    },
+  },
+  link: {
+    render(treeItem, children) {
+      let container = document.createElement("a");
+      container.href = treeItem.value;
+      container.append(...children);
+
+      container.dataset.accId = treeItem.id;
+      return [container, " "];
+    },
+  },
+  AXLink: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  helpballoon: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  AXHelpTag: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  character: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  list: {
+    render(treeItem, children) {
+      let tag = treeItem.attributes.tag == "ol" ? "ol" : "ul";
+      let container = document.createElement(tag);
+      container.append(...children);
+      return [container];
+    },
+  },
+  listitem: {
+    render(treeItem, children) {
+      let container = document.createElement("li");
+      container.append(...children);
+      return [container];
+    },
+  },
+  outline: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  outlineitem: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  pagetab: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  propertypage: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  indicator: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  graphic: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  statictext: {
+    render(treeItem, children) {
+      if (!treeItem.name) {
+        return [];
+      }
+      return [treeItem.name];
+    },
+  },
+  "text leaf": {
+    render(treeItem, children) {
+      return [treeItem.name];
+      // Leafs will be rendered by parents via name. XXX is that always true?
+      // return [];
+    },
+  },
+  pushbutton: {
+    render(treeItem, children) {
+      let container = document.createElement("button");
+      container.dataset.accId = treeItem.id;
+      container.append(...children);
+      return [container];
+    },
+  },
+  checkbutton: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  radiobutton: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "1": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  combobox: {
+    render(treeItem, children) {
+      let container = document.createElement("label");
+      container.textContent = `${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  droplist: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  progressbar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  dial: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  hotkeyfield: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  slider: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  spinbutton: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  diagram: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  animation: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  equation: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  buttondropdown: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  buttonmenu: {
+    render(treeItem, children) {
+      // XXX copy over
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  buttondropdowngrid: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  whitespace: {
+    render(treeItem, children) {
+      return [treeItem.name];
+    },
+  },
+  pagetablist: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  clock: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  splitbutton: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  ipaddress: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "accel label": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  arrow: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  canvas: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "check menu item": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "color chooser": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "date editor": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "desktop icon": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "desktop frame": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "directory pane": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "file chooser": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "font chooser": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "chrome window": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "glass pane": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "html container": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  icon: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  label: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "layered pane": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "option pane": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "password text": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "popup menu": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "radio menu item": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "root pane": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "scroll pane": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "split pane": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "table column header": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "table row header": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "tear off menu item": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  terminal: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "text container": {
+    render(treeItem, children) {
+      return [...children];
+    },
+  },
+  "toggle button": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "tree table": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  viewport: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  header: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  footer: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  paragraph: {
+    render(treeItem, children) {
+      let container = document.createElement("p");
+      container.append(...children);
+      return [container];
+    },
+  },
+  ruler: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  AXRuler: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  autocomplete: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  editbar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  entry: {
+    render(treeItem, children) {
+      // XXX: [relations] is missing from JSON export but would be needed to set up
+      // proper labeling on i.e. amazon.com.
+      let input = document.createElement("input");
+      input.dataset.accId = treeItem.id;
+
+      input.value = treeItem.value;
+      // container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      // container.append(...children);
+      return [input];
+    },
+  },
+  caption: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "non-native document": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  heading: {
+    render(treeItem, children) {
+      let tag = treeItem.attributes.tag;
+      let container = document.createElement(tag); // XXX: make sure it's an h tag
+      container.append(...children);
+      return [container];
+    },
+  },
+  AXHeading: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  page: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  section: {
+    render(treeItem, children) {
+      // XXX: section with only another section child could be ignored
+      let container = document.createElement("div");
+      container.append(...children);
+      return [container];
+    },
+  },
+  "redundant object": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  form: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  ime: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "app root": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "parent menuitem": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  calendar: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "combobox list": {
+    render(treeItem, children) {
+      let container = document.createElement("select");
+      container.append(...children);
+      return [container];
+    },
+  },
+  "combobox option": {
+    render(treeItem /*, children*/) {
+      let container = document.createElement("option");
+      container.textContent = `${treeItem.name}`;
+      return [container];
+    },
+  },
+  "image map": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "listbox option": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "listbox rich option": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  listbox: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "flat equation": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  gridcell: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "embedded object": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  note: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  figure: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "check rich option": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  definitionlist: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  term: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  definition: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  key: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  switch: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  math: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml identifier": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml number": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml operator": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml text": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml string literal": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml glyph": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml row": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml fraction": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml square root": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml root": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml fenced": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml enclosed": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml style": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml sub": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml sup": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml sub sup": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml under": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml over": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml under over": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml multiscripts": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml table": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml labeled row": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml table row": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml cell": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml action": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml error": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml stack": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml long division": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml stack group": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml stack row": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml stack carries": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml stack carry": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "mathml stack line": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  grouping: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  text: {
+    render(treeItem, children) {
+      if (!treeItem.name) {
+        return [];
+      }
+      return [treeItem.name];
+    },
+  },
+  details: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  summary: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  landmark: {
+    render(treeItem, children) {
+      let roles = treeItem.attributes["xml-roles"].split(" ");
+
+      /*
+    <article>
+    <aside>
+    <details>
+    <figcaption>
+    <figure>
+    <footer>
+    <header>
+    <main>
+    <mark>
+    <nav>
+    <section>
+    <summary>
+    <time>
+      */
+
+      let container;
+      if (roles.includes("banner")) {
+        container = document.createElement("div");
+        container.setAttribute("role", "banner");
+      }
+      if (roles.includes("navigation")) {
+        // (e.g., a menu)
+        container = document.createElement("nav");
+      }
+      if (roles.includes("main")) {
+        // (the main content of the page)
+        container = document.createElement("main");
+      }
+      if (roles.includes("complementary")) {
+        // (e.g., a sidebar)
+        container = document.createElement("aside");
+      }
+      if (roles.includes("contentinfo")) {
+        // (meta data about the page, e.g., a copyright statement)
+        container = document.createElement("div");
+        container.setAttribute("role", "contentinfo");
+      }
+      if (roles.includes("search")) {
+        container = document.createElement("form");
+        container.setAttribute("role", "search");
+      }
+      if (roles.includes("form")) {
+        container = document.createElement("form");
+      }
+      if (roles.includes("application")) {
+        // (a web application with its own keyboard interface)
+        container = document.createElement("div");
+        container.setAttribute("role", "application");
+      }
+
+      container.textContent = `${treeItem.role}: ${roles.join(" ")}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  navigation: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  footnote: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  article: {
+    render(treeItem, children) {
+      let container = document.createElement("article");
+      container.append(...children);
+      return [container];
+    },
+  },
+  region: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  editcombobox: {
+    render(treeItem, children) {
+      let container = document.createElement("label");
+      container.textContent = `${treeItem.name}`;
+      let input = document.createElement("input");
+      input.dataset.accId = treeItem.id;
+      input.value = treeItem.value;
+      container.appendChild(input);
+      return [container];
+    },
+  },
+  blockquote: {
+    render(treeItem, children) {
+      let container = document.createElement("blockquote");
+      container.append(...children);
+      return [container];
+    },
+  },
+  "content deletion": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  "content insertion": {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+  // form: { this is FORM_LANDMARK https://searchfox.org/mozilla-central/rev/96f1457323cc598a36f5701f8e67aedaf97acfcf/accessible/base/RoleMap.h#1625-1632
+  //   render(treeItem, children) {
+  //     let container = document.createElement("div");
+  //     container.textContent = `${treeItem.role}: ${treeItem.name}`;
+  //     container.append(...children);
+  //     return [container];
+  //   }
+  // },
+  mark: {
+    render(treeItem, children) {
+      let container = document.createElement("div");
+      container.textContent = `${treeItem.role}: ${treeItem.name}`;
+      container.append(...children);
+      return [container];
+    },
+  },
+};
diff --git a/browser/components/a11ymode/moz.build b/browser/components/a11ymode/moz.build
new file mode 100644
--- /dev/null
+++ b/browser/components/a11ymode/moz.build
@@ -0,0 +1,12 @@
+# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
+# vim: set filetype=python:
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+JAR_MANIFESTS += ['content/jar.mn']
+
+FINAL_TARGET_FILES.actors += [
+    'A11YModeChild.jsm',
+    'A11YModeParent.jsm',
+]
diff --git a/browser/components/about/AboutRedirector.cpp b/browser/components/about/AboutRedirector.cpp
--- a/browser/components/about/AboutRedirector.cpp
+++ b/browser/components/about/AboutRedirector.cpp
@@ -111,16 +111,20 @@ static const RedirEntry kRedirMap[] = {
      nsIAboutModule::ALLOW_SCRIPT},
     {"downloads",
      "chrome://browser/content/downloads/contentAreaDownloadsView.xhtml",
      nsIAboutModule::ALLOW_SCRIPT},
     {"reader", "chrome://global/content/reader/aboutReader.html",
      nsIAboutModule::URI_SAFE_FOR_UNTRUSTED_CONTENT |
          nsIAboutModule::ALLOW_SCRIPT | nsIAboutModule::URI_MUST_LOAD_IN_CHILD |
          nsIAboutModule::HIDE_FROM_ABOUTABOUT},
+    {"a11ymode", "chrome://browser/content/a11ymode/a11ymode.html",
+     nsIAboutModule::URI_SAFE_FOR_UNTRUSTED_CONTENT |
+         nsIAboutModule::ALLOW_SCRIPT | nsIAboutModule::URI_CAN_LOAD_IN_CHILD |
+         nsIAboutModule::HIDE_FROM_ABOUTABOUT},
     {"restartrequired", "chrome://browser/content/aboutRestartRequired.xhtml",
      nsIAboutModule::ALLOW_SCRIPT | nsIAboutModule::HIDE_FROM_ABOUTABOUT},
     {"newinstall", "chrome://browser/content/newInstallPage.html",
      nsIAboutModule::URI_MUST_LOAD_IN_CHILD |
          nsIAboutModule::URI_SAFE_FOR_UNTRUSTED_CONTENT |
          nsIAboutModule::ALLOW_SCRIPT | nsIAboutModule::HIDE_FROM_ABOUTABOUT},
     {"protections", "chrome://browser/content/protections.html",
      nsIAboutModule::URI_SAFE_FOR_UNTRUSTED_CONTENT |
diff --git a/browser/components/about/components.conf b/browser/components/about/components.conf
--- a/browser/components/about/components.conf
+++ b/browser/components/about/components.conf
@@ -1,15 +1,16 @@
 # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
 # vim: set filetype=python:
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 pages = [
+    'a11ymode',
     'blocked',
     'certerror',
     'config',
     'downloads',
     'framecrashed',
     'home',
     'library',
     'logins',
diff --git a/browser/components/moz.build b/browser/components/moz.build
--- a/browser/components/moz.build
+++ b/browser/components/moz.build
@@ -25,16 +25,17 @@ with Files("safebrowsing/**"):
 with Files('controlcenter/**'):
     BUG_COMPONENT = ('Firefox', 'General')
 
 
 DIRS += [
     'about',
     'aboutconfig',
     'aboutlogins',
+    'a11ymode',
     'attribution',
     'contextualidentity',
     'customizableui',
     'dirprovider',
     'doh',
     'downloads',
     'enterprisepolicies',
     'extensions',
diff --git a/browser/modules/ReaderParent.jsm b/browser/modules/ReaderParent.jsm
--- a/browser/modules/ReaderParent.jsm
+++ b/browser/modules/ReaderParent.jsm
@@ -76,31 +76,43 @@ var ReaderParent = {
     }
 
     let button = win.document.getElementById("reader-mode-button");
     let menuitem = win.document.getElementById("menu_readerModeItem");
     let key = win.document.getElementById("key_toggleReaderMode");
     if (browser.currentURI.spec.startsWith("about:reader")) {
       let closeText = gStringBundle.GetStringFromName("readerView.close");
 
+      if (browser.parentNode.querySelector(".a11ymode-reader")) {
+        browser.parentNode
+          .querySelector(".a11ymode-reader")
+          .setAttribute("active", "true");
+      }
+
       button.setAttribute("readeractive", true);
       button.hidden = false;
       button.setAttribute("aria-label", closeText);
 
       menuitem.setAttribute("label", closeText);
       menuitem.setAttribute("hidden", false);
       menuitem.setAttribute(
         "accesskey",
         gStringBundle.GetStringFromName("readerView.close.accesskey")
       );
 
       key.setAttribute("disabled", false);
 
       Services.obs.notifyObservers(null, "reader-mode-available");
     } else {
+      if (browser.parentNode.querySelector(".a11ymode-reader")) {
+        browser.parentNode
+          .querySelector(".a11ymode-reader")
+          .removeAttribute("active");
+      }
+
       let enterText = gStringBundle.GetStringFromName("readerView.enter");
 
       button.removeAttribute("readeractive");
       button.hidden = !browser.isArticle;
       button.setAttribute("aria-label", enterText);
 
       menuitem.setAttribute("label", enterText);
       menuitem.setAttribute("hidden", !browser.isArticle);
diff --git a/toolkit/content/widgets/browser-custom-element.js b/toolkit/content/widgets/browser-custom-element.js
--- a/toolkit/content/widgets/browser-custom-element.js
+++ b/toolkit/content/widgets/browser-custom-element.js
@@ -463,18 +463,69 @@
         if (this.isRemoteBrowser) {
           this._documentContentType = aContentType;
         } else {
           this.contentDocument.documentContentType = aContentType;
         }
       }
     }
 
+    createA11YModeBrowser() {
+      if (!this.a11ymodeBrowser) {
+        this.a11ymodeBrowser = document.createXULElement("browser");
+        this.a11ymodeBrowser.classList.add("a11ymode");
+        this.a11ymodeBrowser.setAttribute("disablehistory", "true");
+        this.a11ymodeBrowser.setAttribute("nodefaultsrc", "true");
+        this.a11ymodeBrowser.setAttribute(
+          "remoteType",
+          this.getAttribute("remoteType")
+        );
+        this.a11ymodeBrowser.setAttribute(
+          "remote",
+          this.getAttribute("remote")
+        );
+        this.a11ymodeBrowser.setAttribute("type", "content");
+        this.a11ymodeBrowser.setAttribute(
+          "contextmenu",
+          this.getAttribute("contextmenu")
+        );
+        this.a11ymodeBrowser.setAttribute(
+          "datetimepicker",
+          this.getAttribute("datetimepicker")
+        );
+        this.a11ymodeBrowser.setAttribute(
+          "selectmenulist",
+          this.getAttribute("selectmenulist")
+        );
+        this.a11ymodeBrowser.setAttribute(
+          "tooltip",
+          this.getAttribute("tooltip")
+        );
+        this.a11ymodeBrowser.setAttribute(
+          "autocompletepopup",
+          this.getAttribute("autocompletepopup")
+        );
+        this.a11ymodeBrowser.setAttribute(
+          "autoscrollpopup",
+          this.getAttribute("autoscrollpopup")
+        );
+        this.a11ymodeBrowser.sameProcessAsFrameLoader = this.frameLoader;
+        this.a11ymodeBrowser.hostBrowser = this;
+        this.a11ymodeBrowser.src = "about:a11ymode";
+      }
+      return this.a11ymodeBrowser;
+    }
+
     set sameProcessAsFrameLoader(val) {
       this._sameProcessAsFrameLoader = Cu.getWeakReference(val);
+      if (this.a11ymodeBrowser) {
+        this.a11ymodeBrowser.sameProcessAsFrameLoader = Cu.getWeakReference(
+          val
+        );
+      }
     }
 
     get sameProcessAsFrameLoader() {
       return (
         this._sameProcessAsFrameLoader && this._sameProcessAsFrameLoader.get()
       );
     }
 
@@ -1323,23 +1374,33 @@
       if (this.messageManager) {
         this.messageManager.addMessageListener(
           "UnselectedTabHover:Toggle",
           this
         );
       }
     }
 
+    destroyA11YModeBrowser() {
+      if (this.a11ymodeBrowser) {
+        this.a11ymodeBrowser.remove();
+        this.a11ymodeBrowser = null;
+      }
+    }
     /**
      * This is necessary because the destructor doesn't always get called when
      * we are removed from a tabbrowser. This will be explicitly called by tabbrowser.
      */
     destroy() {
       elementsToDestroyOnUnload.delete(this);
 
+      // Just remove the a11ymode browser entirely and let it get recreated
+      // when we are re-added (i.e. with a remoteness change)
+      this.destroyA11YModeBrowser();
+
       // Make sure that any open select is closed.
       if (this.hasAttribute("selectmenulist")) {
         let menulist = document.getElementById(
           this.getAttribute("selectmenulist")
         );
         if (menulist && menulist.open) {
           let resourcePath = "resource://gre/actors/SelectParent.jsm";
           let { SelectParentHelper } = ChromeUtils.import(resourcePath);
