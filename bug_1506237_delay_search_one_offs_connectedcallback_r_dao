# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1541795781 28800
#      Fri Nov 09 12:36:21 2018 -0800
# Node ID a64bf8603f349ddece4cfabd98495e5fa84e04fe
# Parent  2f1158e5e0ce2523f93482abf6158db058a782a1
Bug 1506237 - Delay search-one-offs connectedCallback;r=dao

It's best practice in chrome to not run code in the connectedCallback during parse
(see the comment above MozXULElement.delayConnectedCallback).

Differential Revision: https://phabricator.services.mozilla.com/D11520

diff --git a/browser/components/search/content/search-one-offs.js b/browser/components/search/content/search-one-offs.js
--- a/browser/components/search/content/search-one-offs.js
+++ b/browser/components/search/content/search-one-offs.js
@@ -178,18 +178,21 @@ class MozSearchOneOffs extends MozXULEle
       this.contextMenuPopup.openPopupAtScreen(event.screenX, event.screenY, true);
       event.preventDefault();
 
       this._contextEngine = target.engine;
     });
   }
 
   connectedCallback() {
-    this.appendChild(
-      MozXULElement.parseXULToFragment(`
+    if (this.delayConnectedCallback()) {
+      return;
+    }
+
+    this.appendChild(MozXULElement.parseXULToFragment(`
       <deck class="search-panel-one-offs-header search-panel-header search-panel-current-input">
         <label class="searchbar-oneoffheader-search" value="&searchWithHeader.label;"></label>
         <hbox class="search-panel-searchforwith search-panel-current-input">
           <label value="&searchFor.label;"></label>
           <label class="searchbar-oneoffheader-searchtext search-panel-input-value" flex="1" crop="end"></label>
           <label flex="10000" value="&searchWith.label;"></label>
         </hbox>
         <hbox class="search-panel-searchonengine search-panel-current-input">
