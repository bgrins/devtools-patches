# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  cfbaf72d15f0696d00285872813c781557c3f59d
Bug 1482448 - Listen to DOMContentLoaded in xhtml

diff --git a/browser/base/content/browser.js b/browser/base/content/browser.js
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -1135,19 +1135,27 @@ function RedirectLoad({ target: browser,
       }
     };
     Services.obs.addObserver(delayedStartupFinished,
                              "browser-delayed-startup-finished");
   }
 }
 
 if (document.documentElement.getAttribute("windowtype") == "navigator:browser") {
-  window.addEventListener("MozBeforeInitialXULLayout", () => {
-    gBrowserInit.onBeforeInitialXULLayout();
-  }, { once: true });
+  if (document.contentType == "application/xhtml+xml") {
+    // For browser.xhtml (MOZ_BROWSER_XHTML=1)
+    window.addEventListener("DOMContentLoaded", () => {
+      gBrowserInit.onBeforeInitialXULLayout();
+    }, { once: true });
+  } else {
+    window.addEventListener("MozBeforeInitialXULLayout", () => {
+      gBrowserInit.onBeforeInitialXULLayout();
+    }, { once: true });
+  }
+
   // The listener of DOMContentLoaded must be set on window, rather than
   // document, because the window can go away before the event is fired.
   // In that case, we don't want to initialize anything, otherwise we
   // may be leaking things because they will never be destroyed after.
   window.addEventListener("DOMContentLoaded", () => {
     gBrowserInit.onDOMContentLoaded();
   }, { once: true });
 }
