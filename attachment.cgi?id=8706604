# HG changeset patch
# User Alexandre Poirot <poirot.alex@gmail.com>

Bug 1235781 - Fix per platform css and browser css rule for eyedropper. r=bgrins

diff --git a/devtools/client/eyedropper/eyedropper.js b/devtools/client/eyedropper/eyedropper.js
index 30da4f8..b50d021 100644
--- a/devtools/client/eyedropper/eyedropper.js
+++ b/devtools/client/eyedropper/eyedropper.js
@@ -365,16 +365,27 @@ Eyedropper.prototype = {
     let valueBox = this._iframeDocument.querySelector("#color-value-box");
     if (this.format == "hex") {
       valueBox.style.width = HEX_BOX_WIDTH + "px";
     }
     else if (this.format == "hsl") {
       valueBox.style.width = HSL_BOX_WIDTH + "px";
     }
 
+    let os;
+    let platform = this._iframeDocument.defaultView.navigator.platform;
+    if (platform.startsWith("Win")) {
+      os = "win";
+    } else if (platform.startsWith("Mac")) {
+      os = "mac";
+    } else {
+      os = "linux";
+    }
+    this._iframeDocument.documentElement.setAttribute("platform", os);
+
     this._canvas = this._iframeDocument.querySelector("#canvas");
     this._ctx = this._canvas.getContext("2d");
 
     // so we preserve the clear pixel boundaries
     this._ctx.mozImageSmoothingEnabled = false;
 
     this._drawWindow();
 
diff --git a/devtools/client/eyedropper/eyedropper.xul b/devtools/client/eyedropper/eyedropper.xul
index b7c70e3..64542d0 100644
--- a/devtools/client/eyedropper/eyedropper.xul
+++ b/devtools/client/eyedropper/eyedropper.xul
@@ -33,9 +33,9 @@
   <hbox id="color-value-container">
     <hbox id="color-value-box">
       <box id="color-preview">
       </box>
       <label id="color-value" class="devtools-monospace">
       </label>
     </hbox>
   </hbox>
-</window>
\ No newline at end of file
+</window>
diff --git a/devtools/client/themes/common.css b/devtools/client/themes/common.css
index 9759c49..00aa99f 100644
--- a/devtools/client/themes/common.css
+++ b/devtools/client/themes/common.css
@@ -210,27 +210,16 @@
   background-position: 0 0, 10px 10px;
 }
 
 .devtools-tooltip-iframe {
   border: none;
   background: transparent;
 }
 
-/* Eyedropper Widget */
-
-.devtools-eyedropper-panel {
-  pointer-events: none;
-  -moz-appearance: none;
-  width: 156px;
-  height: 120px;
-  background-color: transparent;
-  border: none;
-}
-
 /* links to source code, like displaying `myfile.js:45` */
 
 .devtools-source-link {
   font-family: var(--monospace-font-family);
   color: var(--theme-highlight-blue);
   cursor: pointer;
   white-space: nowrap;
   display: flex;
diff --git a/devtools/client/themes/devtools-browser.css b/devtools/client/themes/devtools-browser.css
index b6f2f04..b95d914 100644
--- a/devtools/client/themes/devtools-browser.css
+++ b/devtools/client/themes/devtools-browser.css
@@ -8,8 +8,20 @@
 .devtools-toolbox-bottom-iframe {
   transition: margin-bottom .1s;
 }
 
 .devtools-toolbox-side-iframe {
   min-width: 465px;
 }
 
+/* Eyedropper Widget */
+/* <panel> added to mainPopupSet */
+
+.devtools-eyedropper-panel {
+  pointer-events: none;
+  -moz-appearance: none;
+  width: 156px;
+  height: 120px;
+  background-color: transparent;
+  border: none;
+}
+

