# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  f737d9b371cb575d5f057b633b193bcbde13b0c0
Bug 1355324 - Remove #sidebar-throbber from the ui;r=Gijs,r=shorlander

The throbber is not shown for local URIs (including the three built in sidebar panels).
This patch is keeping the DOM node in browser.xul since there are addons accessing it.

MozReview-Commit-ID: 79pQr4WcTp4

diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -1130,17 +1130,17 @@
             </panelmultiview>
           </panel>
           <box id="sidebar-switcher-target" flex="1">
             <image id="sidebar-icon"/>
             <label id="sidebar-title" persist="value" crop="end" control="sidebar"/>
             <image id="sidebar-switcher-arrow"/>
             <spacer flex="1"/>
           </box>
-          <image id="sidebar-throbber"/>
+          <image id="sidebar-throbber" hidden="true"/>
           <toolbarbutton id="sidebar-close" class="tabbable" tooltiptext="&sidebarCloseButton.tooltip;" oncommand="SidebarUI.hide();"/>
         </sidebarheader>
         <browser id="sidebar" flex="1" autoscroll="false" disablehistory="true" disablefullscreen="true"
                   style="min-width: 14em; width: 18em; max-width: 36em;" tooltip="aHTMLTooltip"/>
       </vbox>
 
       <splitter id="sidebar-splitter" class="chromeclass-extrachrome sidebar-splitter" hidden="true"/>
       <vbox id="appcontent" flex="1">
diff --git a/browser/base/content/web-panels.js b/browser/base/content/web-panels.js
--- a/browser/base/content/web-panels.js
+++ b/browser/base/content/web-panels.js
@@ -16,32 +16,17 @@ function getPanelBrowser() {
 
 var panelProgressListener = {
     onProgressChange(aWebProgress, aRequest,
                                 aCurSelfProgress, aMaxSelfProgress,
                                 aCurTotalProgress, aMaxTotalProgress) {
     },
 
     onStateChange(aWebProgress, aRequest, aStateFlags, aStatus) {
-        if (!aRequest)
-          return;
-
-        // ignore local/resource:/chrome: files
-        if (aStatus == NS_NET_STATUS_READ_FROM || aStatus == NS_NET_STATUS_WROTE_TO)
-           return;
-
-        if (aStateFlags & Ci.nsIWebProgressListener.STATE_START &&
-            aStateFlags & Ci.nsIWebProgressListener.STATE_IS_NETWORK) {
-            window.parent.document.getElementById("sidebar-throbber").setAttribute("loading", "true");
-        } else if (aStateFlags & Ci.nsIWebProgressListener.STATE_STOP &&
-                aStateFlags & Ci.nsIWebProgressListener.STATE_IS_NETWORK) {
-            window.parent.document.getElementById("sidebar-throbber").removeAttribute("loading");
-        }
-    }
-    ,
+    },
 
     onLocationChange(aWebProgress, aRequest, aLocation, aFlags) {
         UpdateBackForwardCommands(getPanelBrowser().webNavigation);
     },
 
     onStatusChange(aWebProgress, aRequest, aStatus, aMessage) {
     },
 
diff --git a/browser/themes/shared/sidebar.inc.css b/browser/themes/shared/sidebar.inc.css
--- a/browser/themes/shared/sidebar.inc.css
+++ b/browser/themes/shared/sidebar.inc.css
@@ -62,30 +62,16 @@ sidebarheader {
 }
 
 #sidebar-box #sidebar-switcher-target:hover,
 #sidebar-box #sidebarMenu-popup[panelopen] ~ #sidebar-switcher-target,
 #sidebar-close:hover {
   background: rgba(204, 204, 204, 0.6);
 }
 
-.sidebar-throbber[loading="true"],
-#sidebar-throbber[loading="true"] {
-  list-style-image: url("chrome://global/skin/icons/loading.png");
-  margin-inline-end: 4px;
-}
-
-@media (min-resolution: 2dppx) {
-  .sidebar-throbber[loading="true"],
-  #sidebar-throbber[loading="true"] {
-    list-style-image: url("chrome://global/skin/icons/loading@2x.png");
-    width: 16px;
-  }
-}
-
 #sidebarMenu-popup .subviewbutton {
   min-width: 190px;
 }
 
 #sidebar-switcher-bookmarks > .toolbarbutton-icon,
 #sidebar-box[sidebarcommand="viewBookmarksSidebar"] #sidebar-icon {
   list-style-image: url(chrome://browser/skin/sidebar/bookmark-16-outline.svg);
 }
