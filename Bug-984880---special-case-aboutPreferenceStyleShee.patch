# vim: se ft=diff :
# HG changeset patch
# User Tom Tromey <tromey@mozilla.com>
# Date 2015-09-11 12:56
Bug 984880 - special-case about:PreferenceStyleSheet

diff --git a/toolkit/devtools/server/actors/styles.js b/toolkit/devtools/server/actors/styles.js
index ffe75f4..d69ae7c 100644
--- a/toolkit/devtools/server/actors/styles.js
+++ b/toolkit/devtools/server/actors/styles.js
@@ -1133,18 +1133,22 @@ let StyleRuleActor = protocol.ActorClass({
       type: this.type,
       line: this.line || undefined,
       column: this.column,
       traits: {
         // Whether the style rule actor implements the modifySelector2 method
         // that allows for unmatched rule to be added
         modifySelectorUnmatched: true,
         // Whether the style rule actor implements the setRuleText
-        // method.
-        canSetRuleText: !!this._parentSheet,
+        // method.  Special case about:PreferenceStyleSheet, as it is
+        // generated on the fly and the URI is not registered with the
+        // about: handler.
+        // https://bugzilla.mozilla.org/show_bug.cgi?id=935803#c37
+        canSetRuleText: !!(this._parentSheet &&
+                           this._parentSheet.href !== "about:PreferenceStyleSheet"),
       }
     };
 
     if (this.rawRule.parentRule) {
       form.parentRule = this.pageStyle._styleRef(this.rawRule.parentRule).actorID;
 
       // CSS rules that we call media rules are STYLE_RULES that are children
       // of MEDIA_RULEs. We need to check the parentRule to check if a rule is
@@ -1251,17 +1255,21 @@ let StyleRuleActor = protocol.ActorClass({
     }
   },
 
   /**
    * Return the authored form of a rule's text.  This will include
    * invalid and otherwise ignored properties.
    */
   getAuthoredCssText: function*() {
+    // Special case about:PreferenceStyleSheet, as it is generated on the
+    // fly and the URI is not registered with the about: handler.
+    // https://bugzilla.mozilla.org/show_bug.cgi?id=935803#c37
     if (!this._parentSheet ||
+        this._parentSheet.href === "about:PreferenceStyleSheet" ||
         (this.type !== Ci.nsIDOMCSSRule.STYLE_RULE &&
          this.type !== Ci.nsIDOMCSSRule.KEYFRAME_RULE)) {
       return "";
     }
 
     if (typeof this.authoredText === "string") {
       return this.authoredText;
     }
