
# HG changeset patch
# User Tim Nguyen <ntim.bugs@gmail.com>
# Date 1479173480 0
# Node ID a893d972b058028c9a528b1afb0a40a69152f0a6
# Parent  c902386ce1a8b266a34c3c83d5b693d8c47b5ffb
Bug 1307871 - Add new console frontend support for 'Enable timestamps' pref. r=bgrins

MozReview-Commit-ID: FshE769sETL

diff --git a/devtools/client/themes/webconsole.css b/devtools/client/themes/webconsole.css
--- a/devtools/client/themes/webconsole.css
+++ b/devtools/client/themes/webconsole.css
@@ -713,6 +713,10 @@
   flex: 1 1 100%;
 }
 
+.webconsole-output.hideTimestamps > .message > .timestamp {
+  display: none;
+}
+
 .message.startGroup .message-body,
 .message.startGroupCollapsed .message-body {
   color: var(--theme-body-color);
diff --git a/devtools/client/webconsole/new-console-output/actions/messages.js b/devtools/client/webconsole/new-console-output/actions/messages.js
--- a/devtools/client/webconsole/new-console-output/actions/messages.js
+++ b/devtools/client/webconsole/new-console-output/actions/messages.js
@@ -97,4 +97,3 @@
   messageClose,
   messageTableDataGet,
 };
-
diff --git a/devtools/client/webconsole/new-console-output/actions/ui.js b/devtools/client/webconsole/new-console-output/actions/ui.js
--- a/devtools/client/webconsole/new-console-output/actions/ui.js
+++ b/devtools/client/webconsole/new-console-output/actions/ui.js
@@ -12,16 +12,27 @@
 const {
   FILTER_BAR_TOGGLE,
   PREFS,
+  TIMESTAMPS_TOGGLE,
 } = require("devtools/client/webconsole/new-console-output/constants");
 
 function filterBarToggle(show) {
   return (dispatch, getState) => {
     dispatch({
-      type: FILTER_BAR_TOGGLE
+      type: FILTER_BAR_TOGGLE,
     });
     const uiState = getAllUi(getState());
     Services.prefs.setBoolPref(PREFS.UI.FILTER_BAR, uiState.get("filterBarVisible"));
   };
 }
 
-exports.filterBarToggle = filterBarToggle;
+function timestampsToggle(visible) {
+  return {
+    type: TIMESTAMPS_TOGGLE,
+    visible,
+  };
+}
+
+module.exports = {
+  filterBarToggle,
+  timestampsToggle,
+};
diff --git a/devtools/client/webconsole/new-console-output/components/console-output.js b/devtools/client/webconsole/new-console-output/components/console-output.js
--- a/devtools/client/webconsole/new-console-output/components/console-output.js
+++ b/devtools/client/webconsole/new-console-output/components/console-output.js
@@ -68,6 +68,7 @@
       messagesTableData,
       serviceContainer,
       groups,
+      timestampsVisible,
     } = this.props;
 
     let messageNodes = messages.map((message) => {
@@ -89,9 +90,16 @@
         })
       );
     });
+
+    let classList = ["webconsole-output"];
+
+    if (!timestampsVisible) {
+      classList.push("hideTimestamps");
+    }
+
     return (
       dom.div({
-        className: "webconsole-output",
+        className: classList.join(" "),
         ref: node => {
           this.outputNode = node;
         },
@@ -119,6 +127,7 @@
     messagesTableData: getAllMessagesTableDataById(state),
     autoscroll: getScrollSetting(state),
     groups: getAllGroupsById(state),
+    timestampsVisible: state.ui.timestampsVisible
   };
 }
 
diff --git a/devtools/client/webconsole/new-console-output/components/message-types/console-api-call.js b/devtools/client/webconsole/new-console-output/components/message-types/console-api-call.js
--- a/devtools/client/webconsole/new-console-output/components/message-types/console-api-call.js
+++ b/devtools/client/webconsole/new-console-output/components/message-types/console-api-call.js
@@ -49,6 +49,7 @@
     repeat,
     stacktrace,
     frame,
+    timeStamp,
     parameters,
     messageText,
     userProvidedStyles,
@@ -106,6 +107,7 @@
     serviceContainer,
     dispatch,
     indent,
+    timeStamp,
   });
 }
 
diff --git a/devtools/client/webconsole/new-console-output/components/message-types/evaluation-result.js b/devtools/client/webconsole/new-console-output/components/message-types/evaluation-result.js
--- a/devtools/client/webconsole/new-console-output/components/message-types/evaluation-result.js
+++ b/devtools/client/webconsole/new-console-output/components/message-types/evaluation-result.js
@@ -34,6 +34,7 @@
     id: messageId,
     exceptionDocURL,
     frame,
+    timeStamp,
   } = message;
 
   let messageBody;
@@ -57,6 +58,7 @@
     serviceContainer,
     exceptionDocURL,
     frame,
+    timeStamp,
   };
   return Message(childProps);
 }
diff --git a/devtools/client/webconsole/new-console-output/components/message-types/network-event-message.js b/devtools/client/webconsole/new-console-output/components/message-types/network-event-message.js
--- a/devtools/client/webconsole/new-console-output/components/message-types/network-event-message.js
+++ b/devtools/client/webconsole/new-console-output/components/message-types/network-event-message.js
@@ -31,7 +31,7 @@
 
 function NetworkEventMessage(props) {
   const { message, serviceContainer, indent } = props;
-  const { actor, source, type, level, request, isXHR } = message;
+  const { actor, source, type, level, request, isXHR, timeStamp } = message;
 
   const topLevelClasses = [ "cm-s-mozilla" ];
 
@@ -54,6 +54,7 @@
     level,
     indent,
     topLevelClasses,
+    timeStamp,
     messageBody,
     serviceContainer,
   };
diff --git a/devtools/client/webconsole/new-console-output/components/message-types/page-error.js b/devtools/client/webconsole/new-console-output/components/message-types/page-error.js
--- a/devtools/client/webconsole/new-console-output/components/message-types/page-error.js
+++ b/devtools/client/webconsole/new-console-output/components/message-types/page-error.js
@@ -44,6 +44,7 @@
     stacktrace,
     frame,
     exceptionDocURL,
+    timeStamp,
   } = message;
 
   const childProps = {
@@ -62,6 +63,7 @@
     stacktrace,
     serviceContainer,
     exceptionDocURL,
+    timeStamp,
   };
   return Message(childProps);
 }
diff --git a/devtools/client/webconsole/new-console-output/components/message.js b/devtools/client/webconsole/new-console-output/components/message.js
--- a/devtools/client/webconsole/new-console-output/components/message.js
+++ b/devtools/client/webconsole/new-console-output/components/message.js
@@ -90,6 +90,7 @@
       serviceContainer,
       dispatch,
       exceptionDocURL,
+      timeStamp = Date.now(),
     } = this.props;
 
     topLevelClasses.push("message", source, type, level);
@@ -97,6 +98,10 @@
       topLevelClasses.push("open");
     }
 
+    const timestampEl = dom.span({
+      className: "timestamp devtools-monospace"
+    }, l10n.timestampString(timeStamp));
+
     const icon = MessageIcon({level});
 
     // Figure out if there is an expandable part to the message.
@@ -154,7 +159,7 @@
         this.messageNode = node;
       }
     },
-      // @TODO add timestamp
+      timestampEl,
       MessageIndent({indent}),
       icon,
       collapse,
diff --git a/devtools/client/webconsole/new-console-output/constants.js b/devtools/client/webconsole/new-console-output/constants.js
--- a/devtools/client/webconsole/new-console-output/constants.js
+++ b/devtools/client/webconsole/new-console-output/constants.js
@@ -12,6 +12,7 @@
   MESSAGE_OPEN: "MESSAGE_OPEN",
   MESSAGE_CLOSE: "MESSAGE_CLOSE",
   MESSAGE_TABLE_RECEIVE: "MESSAGE_TABLE_RECEIVE",
+  TIMESTAMPS_TOGGLE: "TIMESTAMPS_TOGGLE",
   FILTER_TOGGLE: "FILTER_TOGGLE",
   FILTER_TEXT_SET: "FILTER_TEXT_SET",
   FILTERS_CLEAR: "FILTERS_CLEAR",
diff --git a/devtools/client/webconsole/new-console-output/new-console-output-wrapper.js b/devtools/client/webconsole/new-console-output/new-console-output-wrapper.js
--- a/devtools/client/webconsole/new-console-output/new-console-output-wrapper.js
+++ b/devtools/client/webconsole/new-console-output/new-console-output-wrapper.js
@@ -113,6 +113,11 @@
   dispatchMessagesClear: function () {
     store.dispatch(actions.messagesClear());
   },
+
+  dispatchTimestampsToggle: function (enabled) {
+    store.dispatch(actions.timestampsToggle(enabled));
+  },
+
   // Should be used for test purpose only.
   getStore: function () {
     return store;
diff --git a/devtools/client/webconsole/new-console-output/reducers/messages.js b/devtools/client/webconsole/new-console-output/reducers/messages.js
--- a/devtools/client/webconsole/new-console-output/reducers/messages.js
+++ b/devtools/client/webconsole/new-console-output/reducers/messages.js
@@ -30,7 +30,7 @@
     messagesUiById,
     messagesTableDataById,
     groupsById,
-    currentGroup
+    currentGroup,
   } = state;
 
   switch (action.type) {
diff --git a/devtools/client/webconsole/new-console-output/reducers/ui.js b/devtools/client/webconsole/new-console-output/reducers/ui.js
--- a/devtools/client/webconsole/new-console-output/reducers/ui.js
+++ b/devtools/client/webconsole/new-console-output/reducers/ui.js
@@ -8,6 +8,7 @@
 const {
   FILTER_BAR_TOGGLE,
   MESSAGE_ADD,
+  TIMESTAMPS_TOGGLE
 } = require("devtools/client/webconsole/new-console-output/constants");
 const Immutable = require("devtools/client/shared/vendor/immutable");
 
@@ -15,6 +16,7 @@
   filterBarVisible: false,
   filteredMessageVisible: false,
   autoscroll: true,
+  timestampsVisible: true,
 });
 
 function ui(state = new UiState(), action) {
@@ -28,6 +30,9 @@
   switch (action.type) {
     case FILTER_BAR_TOGGLE:
       return state.set("filterBarVisible", !state.filterBarVisible);
+    case TIMESTAMPS_TOGGLE:
+      return state.set("timestampsVisible", action.visible);
+
   }
 
   return state;
diff --git a/devtools/client/webconsole/new-console-output/test/components/console-api-call.test.js b/devtools/client/webconsole/new-console-output/test/components/console-api-call.test.js
--- a/devtools/client/webconsole/new-console-output/test/components/console-api-call.test.js
+++ b/devtools/client/webconsole/new-console-output/test/components/console-api-call.test.js
@@ -89,6 +89,15 @@
       wrapper = render(ConsoleApiCall({ message, serviceContainer}));
       expect(wrapper.find(".indent").prop("style").width).toBe(`0`);
     });
+
+    it("renders a timestamp", () => {
+      const message = stubPreparedMessages.get("console.log('foobar', 'test')");
+      const wrapper = render(ConsoleApiCall({ message, serviceContainer }));
+      const L10n = require("devtools/client/webconsole/new-console-output/test/fixtures/L10n");
+      const { timestampString } = new L10n();
+
+      expect(wrapper.find(".timestamp").text()).toBe(timestampString(message.timeStamp));
+    });
   });
 
   describe("console.count", () => {
diff --git a/devtools/client/webconsole/new-console-output/test/components/evaluation-result.test.js b/devtools/client/webconsole/new-console-output/test/components/evaluation-result.test.js
--- a/devtools/client/webconsole/new-console-output/test/components/evaluation-result.test.js
+++ b/devtools/client/webconsole/new-console-output/test/components/evaluation-result.test.js
@@ -81,4 +81,13 @@
     expect(locationLink.length).toBe(1);
     expect(locationLink.text()).toBe("debugger eval code:1:4");
   });
+
+  it("has a timestamp", () => {
+    const message = stubPreparedMessages.get("new Date(0)");
+    const wrapper = render(EvaluationResult({ message }));
+    const L10n = require("devtools/client/webconsole/new-console-output/test/fixtures/L10n");
+    const { timestampString } = new L10n();
+
+    expect(wrapper.find(".timestamp").text()).toBe(timestampString(message.timeStamp));
+  });
 });
diff --git a/devtools/client/webconsole/new-console-output/test/components/network-event-message.test.js b/devtools/client/webconsole/new-console-output/test/components/network-event-message.test.js
--- a/devtools/client/webconsole/new-console-output/test/components/network-event-message.test.js
+++ b/devtools/client/webconsole/new-console-output/test/components/network-event-message.test.js
@@ -24,7 +24,10 @@
     it("renders as expected", () => {
       const message = stubPreparedMessages.get("GET request");
       const wrapper = render(NetworkEventMessage({ message, serviceContainer }));
+      const L10n = require("devtools/client/webconsole/new-console-output/test/fixtures/L10n");
+      const { timestampString } = new L10n();
 
+      expect(wrapper.find(".timestamp").text()).toBe(timestampString(message.timeStamp));
       expect(wrapper.find(".message-body .method").text()).toBe("GET");
       expect(wrapper.find(".message-body .xhr").length).toBe(0);
       expect(wrapper.find(".message-body .url").length).toBe(1);
diff --git a/devtools/client/webconsole/new-console-output/test/components/page-error.test.js b/devtools/client/webconsole/new-console-output/test/components/page-error.test.js
--- a/devtools/client/webconsole/new-console-output/test/components/page-error.test.js
+++ b/devtools/client/webconsole/new-console-output/test/components/page-error.test.js
@@ -28,6 +28,10 @@
   it("renders", () => {
     const message = stubPreparedMessages.get("ReferenceError: asdf is not defined");
     const wrapper = render(PageError({ message, serviceContainer }));
+    const L10n = require("devtools/client/webconsole/new-console-output/test/fixtures/L10n");
+    const { timestampString } = new L10n();
+
+    expect(wrapper.find(".timestamp").text()).toBe(timestampString(message.timeStamp));
 
     expect(wrapper.find(".message-body").text())
       .toBe("ReferenceError: asdf is not defined[Learn More]");
@@ -39,7 +43,7 @@
     // There should be the location.
     const locationLink = wrapper.find(`.message-location`);
     expect(locationLink.length).toBe(1);
-    // @TODO Will likely change. See https://github.com/devtools-html/gecko-dev/issues/285
+    // @TODO Will likely change. See bug 1307952
     expect(locationLink.text()).toBe("test-tempfile.js:3:5");
   });
 
diff --git a/devtools/client/webconsole/new-console-output/test/fixtures/L10n.js b/devtools/client/webconsole/new-console-output/test/fixtures/L10n.js
--- a/devtools/client/webconsole/new-console-output/test/fixtures/L10n.js
+++ b/devtools/client/webconsole/new-console-output/test/fixtures/L10n.js
@@ -22,6 +22,29 @@
   getFormatStr(str) {
     return this.getStr(str);
   }
+
+  timestampString(milliseconds) {
+    let d = new Date(milliseconds ? milliseconds : null);
+    let hours = d.getHours(), minutes = d.getMinutes();
+    let seconds = d.getSeconds();
+    milliseconds = d.getMilliseconds();
+
+    // String.prototype.padStart isn't supported in node
+    function padZeros(str, len) {
+      str = new String(str);
+      while (str.len < len) {
+        str = "0" + str;
+      }
+      return str;
+    }
+
+    hours = padZeros(hours, 2);
+    minutes = padZeros(minutes, 2);
+    seconds = padZeros(seconds, 2);
+    milliseconds = padZeros(milliseconds, 3);
+
+    return `${hours}:${minutes}:${seconds}.${milliseconds}`;
+  }
 }
 
 module.exports = L10n;
diff --git a/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/head.js b/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/head.js
--- a/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/head.js
+++ b/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/head.js
@@ -43,7 +43,7 @@
   // (actor, timeStamp, timer, ...) that might changed and "pollute"
   // the diff resulting from this stub generation.
   let res;
-  if(stubPackets.has(safeKey)) {
+  if (stubPackets.has(safeKey)) {
 
     let existingPacket = stubPackets.get(safeKey);
     res = Object.assign({}, packet, {
@@ -51,7 +51,7 @@
     });
 
     // Clean root timestamp.
-    if(res.timestamp) {
+    if (res.timestamp) {
       res.timestamp = existingPacket.timestamp;
     }
 
@@ -70,7 +70,7 @@
         }
       }
 
-      if(Array.isArray(res.message.arguments)) {
+      if (Array.isArray(res.message.arguments)) {
         // Clean actor ids on each message.arguments item.
         res.message.arguments.forEach((argument, i) => {
           if (argument && argument.actor) {
diff --git a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/consoleApi.js b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/consoleApi.js
--- a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/consoleApi.js
+++ b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/consoleApi.js
@@ -17,6 +17,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159894798,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -25,7 +26,7 @@
 		"test"
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"foobar\",\"test\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27foobar%27%2C%20%27test%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159894798,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"foobar\",\"test\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27foobar%27%2C%20%27test%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27foobar%27%2C%20%27test%27)",
@@ -41,6 +42,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159896036,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -50,7 +52,7 @@
 		}
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"undefined\"}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(undefined)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159896036,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"undefined\"}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(undefined)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(undefined)",
@@ -66,6 +68,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159897333,
 	"type": "warn",
 	"level": "warn",
 	"messageText": null,
@@ -73,7 +76,7 @@
 		"danger, will robinson!"
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"warn\",\"level\":\"warn\",\"messageText\":null,\"parameters\":[\"danger, will robinson!\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.warn(%27danger%2C%20will%20robinson!%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159897333,\"type\":\"warn\",\"level\":\"warn\",\"messageText\":null,\"parameters\":[\"danger, will robinson!\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.warn(%27danger%2C%20will%20robinson!%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.warn(%27danger%2C%20will%20robinson!%27)",
@@ -89,6 +92,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159898667,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -98,7 +102,7 @@
 		}
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"NaN\"}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(NaN)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159898667,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"NaN\"}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(NaN)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(NaN)",
@@ -114,6 +118,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159900151,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -123,7 +128,7 @@
 		}
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"null\"}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(null)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159900151,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"null\"}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(null)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(null)",
@@ -139,6 +144,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159901470,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -146,7 +152,7 @@
 		"鼬"
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"鼬\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27%E9%BC%AC%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159901470,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"鼬\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27%E9%BC%AC%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27%E9%BC%AC%27)",
@@ -162,6 +168,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159902721,
 	"type": "clear",
 	"level": "log",
 	"messageText": null,
@@ -169,7 +176,7 @@
 		"Console was cleared."
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"clear\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"Console was cleared.\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.clear()\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159902721,\"type\":\"clear\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"Console was cleared.\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.clear()\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.clear()",
@@ -185,12 +192,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159903982,
 	"type": "log",
 	"level": "debug",
 	"messageText": "bar: 1",
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"debug\",\"messageText\":\"bar: 1\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.count(%27bar%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159903982,\"type\":\"log\",\"level\":\"debug\",\"messageText\":\"bar: 1\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.count(%27bar%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.count(%27bar%27)",
@@ -206,6 +214,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159905182,
 	"type": "assert",
 	"level": "error",
 	"messageText": null,
@@ -234,7 +243,7 @@
 		}
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"assert\",\"level\":\"error\",\"messageText\":null,\"parameters\":[{\"type\":\"object\",\"actor\":\"server1.conn8.child1/obj31\",\"class\":\"Object\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":1,\"preview\":{\"kind\":\"Object\",\"ownProperties\":{\"message\":{\"configurable\":true,\"enumerable\":true,\"writable\":true,\"value\":\"foobar\"}},\"ownPropertiesLength\":1,\"safeGetterValues\":{}}}],\"repeatId\":null,\"stacktrace\":[{\"columnNumber\":27,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.assert(false%2C%20%7Bmessage%3A%20%27foobar%27%7D)\",\"functionName\":\"triggerPacket\",\"language\":2,\"lineNumber\":1}],\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.assert(false%2C%20%7Bmessage%3A%20%27foobar%27%7D)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159905182,\"type\":\"assert\",\"level\":\"error\",\"messageText\":null,\"parameters\":[{\"type\":\"object\",\"actor\":\"server1.conn8.child1/obj31\",\"class\":\"Object\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":1,\"preview\":{\"kind\":\"Object\",\"ownProperties\":{\"message\":{\"configurable\":true,\"enumerable\":true,\"writable\":true,\"value\":\"foobar\"}},\"ownPropertiesLength\":1,\"safeGetterValues\":{}}}],\"repeatId\":null,\"stacktrace\":[{\"columnNumber\":27,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.assert(false%2C%20%7Bmessage%3A%20%27foobar%27%7D)\",\"functionName\":\"triggerPacket\",\"language\":2,\"lineNumber\":1}],\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.assert(false%2C%20%7Bmessage%3A%20%27foobar%27%7D)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": [
 		{
 			"columnNumber": 27,
@@ -258,6 +267,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159906444,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -265,7 +275,7 @@
 		"hello \nfrom \rthe \"string world!"
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"hello \\nfrom \\rthe \\\"string world!\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27hello%20%5Cnfrom%20%5Crthe%20%5C%22string%20world!%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159906444,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"hello \\nfrom \\rthe \\\"string world!\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27hello%20%5Cnfrom%20%5Crthe%20%5C%22string%20world!%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27hello%20%5Cnfrom%20%5Crthe%20%5C%22string%20world!%27)",
@@ -281,6 +291,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159907704,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -288,7 +299,7 @@
 		"úṇĩçödê țĕșť"
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"úṇĩçödê țĕșť\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27%C3%BA%E1%B9%87%C4%A9%C3%A7%C3%B6d%C3%AA%20%C8%9B%C4%95%C8%99%C5%A5%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159907704,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"úṇĩçödê țĕșť\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27%C3%BA%E1%B9%87%C4%A9%C3%A7%C3%B6d%C3%AA%20%C8%9B%C4%95%C8%99%C5%A5%27)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%27%C3%BA%E1%B9%87%C4%A9%C3%A7%C3%B6d%C3%AA%20%C8%9B%C4%95%C8%99%C5%A5%27)",
@@ -304,6 +315,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159908948,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -315,7 +327,7 @@
 			"extensible": true,
 			"frozen": false,
 			"sealed": false,
-			"ownPropertyLength": 804,
+			"ownPropertyLength": 812,
 			"preview": {
 				"kind": "ObjectWithURL",
 				"url": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-console-api.html"
@@ -323,7 +335,7 @@
 		}
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"object\",\"actor\":\"server1.conn11.child1/obj31\",\"class\":\"Window\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":804,\"preview\":{\"kind\":\"ObjectWithURL\",\"url\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-console-api.html\"}}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.dirxml(window)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159908948,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"object\",\"actor\":\"server1.conn11.child1/obj31\",\"class\":\"Window\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":812,\"preview\":{\"kind\":\"ObjectWithURL\",\"url\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-console-api.html\"}}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.dirxml(window)\",\"line\":1,\"column\":27},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.dirxml(window)",
@@ -339,12 +351,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159910198,
 	"type": "trace",
 	"level": "log",
 	"messageText": null,
 	"parameters": [],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"trace\",\"level\":\"log\",\"messageText\":null,\"parameters\":[],\"repeatId\":null,\"stacktrace\":[{\"columnNumber\":3,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"functionName\":\"testStacktraceFiltering\",\"language\":2,\"lineNumber\":3},{\"columnNumber\":3,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"functionName\":\"foo\",\"language\":2,\"lineNumber\":6},{\"columnNumber\":1,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"functionName\":\"triggerPacket\",\"language\":2,\"lineNumber\":9}],\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"line\":3,\"column\":3},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159910198,\"type\":\"trace\",\"level\":\"log\",\"messageText\":null,\"parameters\":[],\"repeatId\":null,\"stacktrace\":[{\"columnNumber\":3,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"functionName\":\"testStacktraceFiltering\",\"language\":2,\"lineNumber\":3},{\"columnNumber\":3,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"functionName\":\"foo\",\"language\":2,\"lineNumber\":6},{\"columnNumber\":1,\"filename\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"functionName\":\"triggerPacket\",\"language\":2,\"lineNumber\":9}],\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.trace()\",\"line\":3,\"column\":3},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": [
 		{
 			"columnNumber": 3,
@@ -382,12 +395,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159911476,
 	"type": "nullMessage",
 	"level": "log",
 	"messageText": null,
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"nullMessage\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.time(%27bar%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159911476,\"type\":\"nullMessage\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.time(%27bar%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.time(%27bar%27)",
@@ -403,12 +417,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159911478,
 	"type": "timeEnd",
 	"level": "log",
 	"messageText": "bar: 1.36ms",
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"timeEnd\",\"level\":\"log\",\"messageText\":\"bar: 1.36ms\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.time(%27bar%27)\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159911478,\"type\":\"timeEnd\",\"level\":\"log\",\"messageText\":\"bar: 1.36ms\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.time(%27bar%27)\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.time(%27bar%27)",
@@ -424,6 +439,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159912655,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -431,7 +447,7 @@
 		"bar"
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"bar\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.table(%27bar%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159912655,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"bar\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.table(%27bar%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.table(%27bar%27)",
@@ -447,6 +463,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159913807,
 	"type": "table",
 	"level": "log",
 	"messageText": null,
@@ -471,7 +488,7 @@
 		}
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"table\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"object\",\"actor\":\"server1.conn15.child1/obj31\",\"class\":\"Array\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":4,\"preview\":{\"kind\":\"ArrayLike\",\"length\":3,\"items\":[\"a\",\"b\",\"c\"]}}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.table(%5B%27a%27%2C%20%27b%27%2C%20%27c%27%5D)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159913807,\"type\":\"table\",\"level\":\"log\",\"messageText\":null,\"parameters\":[{\"type\":\"object\",\"actor\":\"server1.conn15.child1/obj31\",\"class\":\"Array\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":4,\"preview\":{\"kind\":\"ArrayLike\",\"length\":3,\"items\":[\"a\",\"b\",\"c\"]}}],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.table(%5B%27a%27%2C%20%27b%27%2C%20%27c%27%5D)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.table(%5B%27a%27%2C%20%27b%27%2C%20%27c%27%5D)",
@@ -487,12 +504,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159914984,
 	"type": "startGroup",
 	"level": "log",
 	"messageText": "bar",
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"startGroup\",\"level\":\"log\",\"messageText\":\"bar\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group(%27bar%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159914984,\"type\":\"startGroup\",\"level\":\"log\",\"messageText\":\"bar\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group(%27bar%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group(%27bar%27)",
@@ -508,12 +526,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159914987,
 	"type": "endGroup",
 	"level": "log",
 	"messageText": null,
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"endGroup\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group(%27bar%27)\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159914987,\"type\":\"endGroup\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group(%27bar%27)\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group(%27bar%27)",
@@ -529,12 +548,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159916153,
 	"type": "startGroupCollapsed",
 	"level": "log",
 	"messageText": "foo",
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"startGroupCollapsed\",\"level\":\"log\",\"messageText\":\"foo\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.groupCollapsed(%27foo%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159916153,\"type\":\"startGroupCollapsed\",\"level\":\"log\",\"messageText\":\"foo\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.groupCollapsed(%27foo%27)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.groupCollapsed(%27foo%27)",
@@ -550,12 +570,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159916155,
 	"type": "endGroup",
 	"level": "log",
 	"messageText": null,
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"endGroup\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.groupCollapsed(%27foo%27)\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159916155,\"type\":\"endGroup\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.groupCollapsed(%27foo%27)\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.groupCollapsed(%27foo%27)",
@@ -571,12 +592,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159917524,
 	"type": "startGroup",
 	"level": "log",
 	"messageText": "<no group label>",
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"startGroup\",\"level\":\"log\",\"messageText\":\"<no group label>\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group()\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159917524,\"type\":\"startGroup\",\"level\":\"log\",\"messageText\":\"<no group label>\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group()\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group()",
@@ -592,12 +614,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159917526,
 	"type": "endGroup",
 	"level": "log",
 	"messageText": null,
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"endGroup\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group()\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159917526,\"type\":\"endGroup\",\"level\":\"log\",\"messageText\":null,\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group()\",\"line\":3,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.group()",
@@ -613,6 +636,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "console-api",
+	"timeStamp": 1479159919144,
 	"type": "log",
 	"level": "log",
 	"messageText": null,
@@ -621,7 +645,7 @@
 		"bar"
 	],
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"foo\",\"bar\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%25cfoobar)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[\"color:blue;font-size:1.3em;background:url('http://example.com/test');position:absolute;top:10px\",\"color:red;background:url('http://example.com/test')\"]}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"console-api\",\"timeStamp\":1479159919144,\"type\":\"log\",\"level\":\"log\",\"messageText\":null,\"parameters\":[\"foo\",\"bar\"],\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%25cfoobar)\",\"line\":2,\"column\":1},\"groupId\":null,\"exceptionDocURL\":null,\"userProvidedStyles\":[\"color:blue;font-size:1.3em;background:url('http://example.com/test');position:absolute;top:10px\",\"color:red;background:url('http://example.com/test')\"]}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.js?key=console.log(%25cfoobar)",
@@ -662,7 +686,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086261590,
+		"timeStamp": 1479159894798,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -695,7 +719,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086264886,
+		"timeStamp": 1479159896036,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -726,7 +750,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086267284,
+		"timeStamp": 1479159897333,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -759,7 +783,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086269484,
+		"timeStamp": 1479159898667,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -792,7 +816,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086271418,
+		"timeStamp": 1479159900151,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -823,7 +847,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086273549,
+		"timeStamp": 1479159901470,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -851,7 +875,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086275587,
+		"timeStamp": 1479159902721,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -885,7 +909,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086277812,
+		"timeStamp": 1479159903982,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -938,7 +962,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086280131,
+		"timeStamp": 1479159905182,
 		"timer": null,
 		"stacktrace": [
 			{
@@ -978,7 +1002,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086281936,
+		"timeStamp": 1479159906444,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -1009,7 +1033,7 @@
 		},
 		"private": false,
 		"styles": [],
-		"timeStamp": 1477086283713,
+		"timeStamp": 1479159907704,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
@@ -1028,7 +1052,7 @@
 				"extensible": true,
 				"frozen": false,
 				"sealed": false,
-				"ownPropertyLength": 804,
+				"ownPropertyLength": 812,
 				"preview": {
 					"kind": "ObjectWithURL",
 					"url": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-console-api.html"
@@ -1051,7 +1075,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086285483,
+		"timeStamp": 1479159908948,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1080,7 +1104,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086287286,
+		"timeStamp": 1479159910198,
 		"timer": null,
 		"stacktrace": [
 			{
@@ -1134,7 +1158,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086289137,
+		"timeStamp": 1479159911476,
 		"timer": {
 			"name": "bar",
 			"started": 1166.305
@@ -1168,7 +1192,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086289138,
+		"timeStamp": 1479159911478,
 		"timer": {
 			"duration": 1.3550000000000182,
 			"name": "bar"
@@ -1202,7 +1226,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086290984,
+		"timeStamp": 1479159912655,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1250,7 +1274,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086292762,
+		"timeStamp": 1479159913807,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1281,7 +1305,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086294628,
+		"timeStamp": 1479159914984,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1312,7 +1336,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086294630,
+		"timeStamp": 1479159914987,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1343,7 +1367,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086296567,
+		"timeStamp": 1479159916153,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1374,7 +1398,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086296570,
+		"timeStamp": 1479159916155,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1403,7 +1427,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086298462,
+		"timeStamp": 1479159917524,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1432,7 +1456,7 @@
 			"userContextId": 0
 		},
 		"private": false,
-		"timeStamp": 1477086298464,
+		"timeStamp": 1479159917526,
 		"timer": null,
 		"workerType": "none",
 		"styles": [],
@@ -1468,7 +1492,7 @@
 			"color:blue;font-size:1.3em;background:url('http://example.com/test');position:absolute;top:10px",
 			"color:red;background:url('http://example.com/test')"
 		],
-		"timeStamp": 1477086300265,
+		"timeStamp": 1479159919144,
 		"timer": null,
 		"workerType": "none",
 		"category": "webdev"
diff --git a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/cssMessage.js b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/cssMessage.js
--- a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/cssMessage.js
+++ b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/cssMessage.js
@@ -17,12 +17,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "css",
+	"timeStamp": 1479159920406,
 	"type": "log",
 	"level": "warn",
 	"messageText": "Unknown property ‘such-unknown-property’.  Declaration dropped.",
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"css\",\"type\":\"log\",\"level\":\"warn\",\"messageText\":\"Unknown property ‘such-unknown-property’.  Declaration dropped.\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.css?key=Unknown%20property\",\"line\":3,\"column\":23},\"groupId\":null,\"userProvidedStyles\":null}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"css\",\"timeStamp\":1479159920406,\"type\":\"log\",\"level\":\"warn\",\"messageText\":\"Unknown property ‘such-unknown-property’.  Declaration dropped.\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.css?key=Unknown%20property\",\"line\":3,\"column\":23},\"groupId\":null,\"userProvidedStyles\":null}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.css?key=Unknown%20property",
@@ -37,12 +38,13 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "css",
+	"timeStamp": 1479159920465,
 	"type": "log",
 	"level": "warn",
 	"messageText": "Error in parsing value for ‘padding-top’.  Declaration dropped.",
 	"parameters": null,
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"css\",\"type\":\"log\",\"level\":\"warn\",\"messageText\":\"Error in parsing value for ‘padding-top’.  Declaration dropped.\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.css?key=Invalid%20property%20value\",\"line\":3,\"column\":15},\"groupId\":null,\"userProvidedStyles\":null}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"css\",\"timeStamp\":1479159920465,\"type\":\"log\",\"level\":\"warn\",\"messageText\":\"Error in parsing value for ‘padding-top’.  Declaration dropped.\",\"parameters\":null,\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.css?key=Invalid%20property%20value\",\"line\":3,\"column\":15},\"groupId\":null,\"userProvidedStyles\":null}",
 	"stacktrace": null,
 	"frame": {
 		"source": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/test-tempfile.css?key=Invalid%20property%20value",
@@ -65,7 +67,7 @@
 		"lineNumber": 3,
 		"columnNumber": 23,
 		"category": "CSS Parser",
-		"timeStamp": 1478964550247,
+		"timeStamp": 1479159920406,
 		"warning": true,
 		"error": false,
 		"exception": false,
@@ -87,7 +89,7 @@
 		"lineNumber": 3,
 		"columnNumber": 15,
 		"category": "CSS Parser",
-		"timeStamp": 1478964550282,
+		"timeStamp": 1479159920465,
 		"warning": true,
 		"error": false,
 		"exception": false,
diff --git a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/evaluationResult.js b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/evaluationResult.js
--- a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/evaluationResult.js
+++ b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/evaluationResult.js
@@ -17,6 +17,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "javascript",
+	"timeStamp": 1479159921364,
 	"type": "result",
 	"level": "log",
 	"parameters": {
@@ -32,7 +33,7 @@
 		}
 	},
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"javascript\",\"type\":\"result\",\"level\":\"log\",\"parameters\":{\"type\":\"object\",\"actor\":\"server1.conn0.child1/obj30\",\"class\":\"Date\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":0,\"preview\":{\"timestamp\":0}},\"repeatId\":null,\"stacktrace\":null,\"frame\":null,\"groupId\":null,\"userProvidedStyles\":null}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"javascript\",\"timeStamp\":1479159921364,\"type\":\"result\",\"level\":\"log\",\"parameters\":{\"type\":\"object\",\"actor\":\"server1.conn0.child1/obj30\",\"class\":\"Date\",\"extensible\":true,\"frozen\":false,\"sealed\":false,\"ownPropertyLength\":0,\"preview\":{\"timestamp\":0}},\"repeatId\":null,\"stacktrace\":null,\"frame\":null,\"groupId\":null,\"userProvidedStyles\":null}",
 	"stacktrace": null,
 	"frame": null,
 	"groupId": null,
@@ -43,6 +44,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "javascript",
+	"timeStamp": 1479159921377,
 	"type": "result",
 	"level": "error",
 	"messageText": "ReferenceError: asdf is not defined",
@@ -50,13 +52,9 @@
 		"type": "undefined"
 	},
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"javascript\",\"type\":\"result\",\"level\":\"error\",\"messageText\":\"ReferenceError: asdf is not defined\",\"parameters\":{\"type\":\"undefined\"},\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"debugger eval code\",\"line\":1,\"column\":1},\"groupId\":null,\"exceptionDocURL\":\"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Errors/Not_defined?utm_source=mozilla&utm_medium=firefox-console-errors&utm_campaign=default\",\"userProvidedStyles\":null}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"javascript\",\"timeStamp\":1479159921377,\"type\":\"result\",\"level\":\"error\",\"messageText\":\"ReferenceError: asdf is not defined\",\"parameters\":{\"type\":\"undefined\"},\"repeatId\":null,\"stacktrace\":null,\"frame\":null,\"groupId\":null,\"exceptionDocURL\":\"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Errors/Not_defined?utm_source=mozilla&utm_medium=firefox-console-errors&utm_campaign=default\",\"userProvidedStyles\":null}",
 	"stacktrace": null,
-	"frame": {
-		"source": "debugger eval code",
-		"line": 1,
-		"column": 1
-	},
+	"frame": null,
 	"groupId": null,
 	"exceptionDocURL": "https://developer.mozilla.org/docs/Web/JavaScript/Reference/Errors/Not_defined?utm_source=mozilla&utm_medium=firefox-console-errors&utm_campaign=default",
 	"userProvidedStyles": null
@@ -66,6 +64,7 @@
 	"id": "1",
 	"allowRepeating": true,
 	"source": "javascript",
+	"timeStamp": 1479159921399,
 	"type": "result",
 	"level": "error",
 	"messageText": "SyntaxError: illegal character",
@@ -73,13 +72,9 @@
 		"type": "undefined"
 	},
 	"repeat": 1,
-	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"javascript\",\"type\":\"result\",\"level\":\"error\",\"messageText\":\"SyntaxError: illegal character\",\"parameters\":{\"type\":\"undefined\"},\"repeatId\":null,\"stacktrace\":null,\"frame\":{\"source\":\"debugger eval code\",\"line\":1,\"column\":4},\"groupId\":null,\"userProvidedStyles\":null}",
+	"repeatId": "{\"id\":null,\"allowRepeating\":true,\"source\":\"javascript\",\"timeStamp\":1479159921399,\"type\":\"result\",\"level\":\"error\",\"messageText\":\"SyntaxError: illegal character\",\"parameters\":{\"type\":\"undefined\"},\"repeatId\":null,\"stacktrace\":null,\"frame\":null,\"groupId\":null,\"userProvidedStyles\":null}",
 	"stacktrace": null,
-	"frame": {
-		"source": "debugger eval code",
-		"line": 1,
-		"column": 4
-	},
+	"frame": null,
 	"groupId": null,
 	"userProvidedStyles": null
 }));
@@ -100,7 +95,7 @@
 			"timestamp": 0
 		}
 	},
-	"timestamp": 1476573073424,
+	"timestamp": 1479159921364,
 	"exception": null,
 	"frame": null,
 	"helperResult": null
@@ -112,7 +107,7 @@
 	"result": {
 		"type": "undefined"
 	},
-	"timestamp": 1476573073442,
+	"timestamp": 1479159921377,
 	"exception": {
 		"type": "object",
 		"actor": "server1.conn0.child1/obj32",
@@ -133,11 +128,7 @@
 	},
 	"exceptionMessage": "ReferenceError: asdf is not defined",
 	"exceptionDocURL": "https://developer.mozilla.org/docs/Web/JavaScript/Reference/Errors/Not_defined?utm_source=mozilla&utm_medium=firefox-console-errors&utm_campaign=default",
-	"frame": {
-		"source": "debugger eval code",
-		"line": 1,
-		"column": 1
-	},
+	"frame": null,
 	"helperResult": null
 });
 
@@ -147,7 +138,7 @@
 	"result": {
 		"type": "undefined"
 	},
-	"timestamp": 1478755616654,
+	"timestamp": 1479159921399,
 	"exception": {
 		"type": "object",
 		"actor": "server1.conn0.child1/obj33",
@@ -167,11 +158,7 @@
 		}
 	},
 	"exceptionMessage": "SyntaxError: illegal character",
-	"frame": {
-		"source": "debugger eval code",
-		"line": 1,
-		"column": 4
-	},
+	"frame": null,
 	"helperResult": null
 });
 
diff --git a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/networkEvent.js b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/networkEvent.js
--- a/devtools/client/webconsole/new-console-output/test/fixtures/stubs/networkEvent.js
+++ b/devtools/client/webconsole/new-console-output/test/fixtures/stubs/networkEvent.js
@@ -25,6 +25,7 @@
 	"response": {},
 	"source": "network",
 	"type": "log",
+	"timeStamp": 1479159937660,
 	"groupId": null
 }));
 
@@ -40,6 +41,7 @@
 	"response": {},
 	"source": "network",
 	"type": "log",
+	"timeStamp": 1479159938522,
 	"groupId": null
 }));
 
@@ -55,6 +57,7 @@
 	"response": {},
 	"source": "network",
 	"type": "log",
+	"timeStamp": 1479159939328,
 	"groupId": null
 }));
 
@@ -65,7 +68,7 @@
 	"eventActor": {
 		"actor": "server1.conn0.child1/netEvent29",
 		"startedDateTime": "2016-10-15T23:12:04.196Z",
-		"timeStamp": 1476573124196,
+		"timeStamp": 1479159937660,
 		"url": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/inexistent.html",
 		"method": "GET",
 		"isXHR": false,
@@ -106,7 +109,7 @@
 	"eventActor": {
 		"actor": "server1.conn1.child1/netEvent29",
 		"startedDateTime": "2016-10-15T23:12:05.690Z",
-		"timeStamp": 1476573125690,
+		"timeStamp": 1479159938522,
 		"url": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/inexistent.html",
 		"method": "GET",
 		"isXHR": true,
@@ -147,7 +150,7 @@
 	"eventActor": {
 		"actor": "server1.conn2.child1/netEvent29",
 		"startedDateTime": "2016-10-15T23:12:07.158Z",
-		"timeStamp": 1476573127158,
+		"timeStamp": 1479159939328,
 		"url": "http://example.com/browser/devtools/client/webconsole/new-console-output/test/fixtures/stub-generators/inexistent.html",
 		"method": "POST",
 		"isXHR": true,
diff --git a/devtools/client/webconsole/new-console-output/test/mochitest/browser.ini b/devtools/client/webconsole/new-console-output/test/mochitest/browser.ini
--- a/devtools/client/webconsole/new-console-output/test/mochitest/browser.ini
+++ b/devtools/client/webconsole/new-console-output/test/mochitest/browser.ini
@@ -18,4 +18,5 @@
 [browser_webconsole_input_focus.js]
 [browser_webconsole_keyboard_accessibility.js]
 [browser_webconsole_observer_notifications.js]
+[browser_webconsole_timestamps.js]
 [browser_webconsole_vview_close_on_esc_key.js]
diff --git a/devtools/client/webconsole/test/browser_webconsole_expandable_timestamps.js b/devtools/client/webconsole/new-console-output/test/mochitest/browser_webconsole_timestamps.js
copy from devtools/client/webconsole/test/browser_webconsole_expandable_timestamps.js
copy to devtools/client/webconsole/new-console-output/test/mochitest/browser_webconsole_timestamps.js
--- a/devtools/client/webconsole/test/browser_webconsole_expandable_timestamps.js
+++ b/devtools/client/webconsole/new-console-output/test/mochitest/browser_webconsole_timestamps.js
@@ -9,49 +9,48 @@
 "use strict";
 
 const TEST_URI = "data:text/html;charset=utf-8,Web Console test for " +
-                 "bug 722267 - preference for toggling timestamps in messages";
+                 "bug 1307871 - preference for toggling timestamps in messages";
 const PREF_MESSAGE_TIMESTAMP = "devtools.webconsole.timestampMessages";
-var hud;
 
 add_task(function* () {
-  yield loadTab(TEST_URI);
+  let hud = yield openNewTabAndConsole(TEST_URI);
+  let outputNode = hud.ui.experimentalOutputNode;
+  let outputEl = outputNode.querySelector(".webconsole-output");
 
-  hud = yield openConsole();
-  let panel = yield consoleOpened();
+  testPrefDefaults(outputEl);
 
-  yield onOptionsPanelSelected(panel);
-  onPrefChanged();
+  let toolbox = gDevTools.getToolbox(hud.target);
+  let optionsPanel = yield toolbox.selectTool("options");
+  yield togglePref(optionsPanel);
+
+  yield testChangedPref(outputEl);
 
   Services.prefs.clearUserPref(PREF_MESSAGE_TIMESTAMP);
-  hud = null;
 });
 
-function consoleOpened() {
-  info("console opened");
+function testPrefDefaults(outputEl) {
   let prefValue = Services.prefs.getBoolPref(PREF_MESSAGE_TIMESTAMP);
-  ok(!prefValue, "messages have no timestamp by default (pref check)");
-  ok(hud.outputNode.classList.contains("hideTimestamps"),
-     "messages have no timestamp (class name check)");
-
-  let toolbox = gDevTools.getToolbox(hud.target);
-  return toolbox.selectTool("options");
+  ok(!prefValue, "Messages should have no timestamp by default (pref check)");
+  ok(outputEl.classList.contains("hideTimestamps"),
+     "Messages should have no timestamp (class name check)");
 }
 
-function onOptionsPanelSelected(panel) {
-  info("options panel opened");
+function* togglePref(panel) {
+  info("Options panel opened");
 
-  let prefChanged = gDevTools.once("pref-changed", onPrefChanged);
-
+  info("Changing pref");
+  let prefChanged = new Promise(resolve => {
+    gDevTools.once("pref-changed", resolve);
+  });
   let checkbox = panel.panelDoc.getElementById("webconsole-timestamp-messages");
   checkbox.click();
 
-  return prefChanged;
+  yield prefChanged;
 }
 
-function onPrefChanged() {
-  info("pref changed");
+function* testChangedPref(outputEl) {
   let prefValue = Services.prefs.getBoolPref(PREF_MESSAGE_TIMESTAMP);
-  ok(prefValue, "messages have timestamps (pref check)");
-  ok(!hud.outputNode.classList.contains("hideTimestamps"),
-     "messages have timestamps (class name check)");
+  ok(prefValue, "Messages should have timestamps (pref check)");
+  ok(!outputEl.classList.contains("hideTimestamps"),
+     "Messages should have timestamps (class name check)");
 }
diff --git a/devtools/client/webconsole/new-console-output/types.js b/devtools/client/webconsole/new-console-output/types.js
--- a/devtools/client/webconsole/new-console-output/types.js
+++ b/devtools/client/webconsole/new-console-output/types.js
@@ -27,6 +27,7 @@
   id: null,
   allowRepeating: true,
   source: null,
+  timeStamp: null,
   type: null,
   level: null,
   messageText: null,
@@ -49,5 +50,6 @@
   response: null,
   source: MESSAGE_SOURCE.NETWORK,
   type: MESSAGE_TYPE.LOG,
+  timeStamp: null,
   groupId: null,
 });
diff --git a/devtools/client/webconsole/new-console-output/utils/messages.js b/devtools/client/webconsole/new-console-output/utils/messages.js
--- a/devtools/client/webconsole/new-console-output/utils/messages.js
+++ b/devtools/client/webconsole/new-console-output/utils/messages.js
@@ -128,6 +128,7 @@
         messageText,
         stacktrace: message.stacktrace ? message.stacktrace : null,
         frame,
+        timeStamp: message.timeStamp,
         userProvidedStyles: message.styles,
       });
     }
@@ -139,6 +140,7 @@
         type: MESSAGE_TYPE.LOG,
         level: MESSAGE_LEVEL.LOG,
         messageText: "Navigated to " + message.url,
+        timeStamp: message.timeStamp
       });
     }
 
@@ -168,6 +170,7 @@
         stacktrace: pageError.stacktrace ? pageError.stacktrace : null,
         frame,
         exceptionDocURL: pageError.exceptionDocURL,
+        timeStamp: pageError.timeStamp
       });
     }
 
@@ -179,6 +182,7 @@
         isXHR: networkEvent.isXHR,
         request: networkEvent.request,
         response: networkEvent.response,
+        timeStamp: networkEvent.timeStamp
       });
     }
 
@@ -188,7 +192,8 @@
         exceptionMessage: messageText,
         exceptionDocURL,
         frame,
-        result: parameters
+        result: parameters,
+        timestamp: timeStamp,
       } = packet;
 
       const level = messageText ? MESSAGE_LEVEL.ERROR : MESSAGE_LEVEL.LOG;
@@ -200,6 +205,7 @@
         parameters,
         exceptionDocURL,
         frame,
+        timeStamp,
       });
     }
   }
diff --git a/devtools/client/webconsole/webconsole.js b/devtools/client/webconsole/webconsole.js
--- a/devtools/client/webconsole/webconsole.js
+++ b/devtools/client/webconsole/webconsole.js
@@ -2709,7 +2709,9 @@
   */
   _onToolboxPrefChanged: function (event, data) {
     if (data.pref == PREF_MESSAGE_TIMESTAMP) {
-      if (data.newValue) {
+      if (this.NEW_CONSOLE_OUTPUT_ENABLED) {
+        this.newConsoleOutput.dispatchTimestampsToggle(data.newValue);
+      } else if (data.newValue) {
         this.outputNode.classList.remove("hideTimestamps");
       } else {
         this.outputNode.classList.add("hideTimestamps");

