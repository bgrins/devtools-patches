# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  89736b1c392b6cc8eadae40322da09c5f5807831
Bug 1175327 - Move existing Tracking Protection functionality from shield doorhanger to Control Center

diff --git a/browser/base/content/browser-trackingprotection.js b/browser/base/content/browser-trackingprotection.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/browser-trackingprotection.js
@@ -0,0 +1,147 @@
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+let TrackingProtection = {
+  PREF_ENABLED: "privacy.trackingprotection.enabled",
+	init: function() {
+    this.updateEnabled();
+    Services.prefs.addObserver(this.PREF_ENABLED,
+                               this.updateEnabled.bind(this),
+                               false);
+    this.resetUI();
+	},
+
+  updateEnabled: function() {
+    this.enabled = Services.prefs.getBoolPref(this.PREF_ENABLED);
+  },
+
+  resetUI: function() {
+    this.container.hidden = !this.enabled;
+    this.trackingContentBlock.hidden =
+      this.trackingContentUnblock.hidden =
+      this.trackingDetectedEnabled.hidden =
+      this.trackingDetectedDisabled.hidden =
+      this.trackingContentActions.hidden =
+      this.trackingNotDetected.hidden = true;
+    this.container.removeAttribute("trackingblockdisabled");
+  },
+
+  onPopupOpen: function(state) {
+
+    this.resetUI();
+    if (!this.enabled) {
+      return;
+    }
+
+    let {
+      STATE_BLOCKED_TRACKING_CONTENT, STATE_LOADED_TRACKING_CONTENT
+    } = Ci.nsIWebProgressListener;
+
+    if (state & STATE_BLOCKED_TRACKING_CONTENT) {
+      this.trackingContentUnblock.hidden = false;
+      this.trackingDetectedEnabled.hidden = false;
+      this.trackingContentActions.hidden = false;
+    }
+    else if (state & STATE_LOADED_TRACKING_CONTENT) {
+      this.container.setAttribute("trackingblockdisabled", true);
+      this.trackingDetectedDisabled.hidden = false;
+      this.trackingContentBlock.hidden = false;
+      this.trackingContentActions.hidden = false;
+    }
+    else {
+      // no tracking on page
+      this.trackingNotDetected.hidden = false;
+    }
+
+    if (this.enabled) {
+      let histogram = Services.telemetry.getHistogramById("TRACKING_PROTECTION_EVENTS");
+      histogram.add(0);
+    }
+  },
+
+  get featureEnabled() {
+    // XXX: perf - store this with an observer
+    return Services.prefs.getBoolPref("privacy.trackingprotection.enabled");
+  },
+
+  get trackingProtectionImage() {
+    return document.getElementById("tracking-protection-image");
+  },
+
+  get container() {
+    return document.getElementById("tracking-protection-container");
+  },
+
+  get trackingContentUnblock() {
+    return document.getElementById("trackingContentActionUnblock");
+  },
+
+  get trackingDetectedEnabled() {
+    return document.getElementById("tracking-detected-enabled");
+  },
+
+  get trackingDetectedDisabled() {
+    return document.getElementById("tracking-detected-disabled");
+  },
+
+  get trackingNotDetected() {
+    return document.getElementById("tracking-not-detected");
+  },
+
+  get trackingContentUnblock() {
+    return document.getElementById("trackingContentActionUnblock");
+  },
+
+  get trackingContentActions() {
+    return document.getElementById("trackingContentActions");
+  },
+
+  get trackingContentBlock() {
+    return document.getElementById("trackingContentActionBlock");
+  },
+
+  get titleElement() {
+    return document.getElementById("badContentBlockedTitle");
+  },
+
+  get isTrackingContentBlocked() {
+    // XXX: implement this
+    return true;
+    return !!(state &
+      Ci.nsIWebProgressListener.STATE_BLOCKED_TRACKING_CONTENT);
+  },
+
+  disableTrackingContentProtection: function() {
+    // convert document URI into the format used by
+    // nsChannelClassifier::ShouldEnableTrackingProtection
+    // (any scheme turned into https is correct)
+    let normalizedUrl = Services.io.newURI(
+      "https://" + gBrowser.selectedBrowser.currentURI.hostPort,
+      null, null);
+    // Add the current host in the 'trackingprotection' consumer of
+    // the permission manager using a normalized URI. This effectively
+    // places this host on the tracking protection allowlist.
+    Services.perms.add(normalizedUrl,
+      "trackingprotection", Services.perms.ALLOW_ACTION);
+    // Telemetry for disable protection
+    let histogram = Services.telemetry.getHistogramById(
+        "TRACKING_PROTECTION_EVENTS");
+    histogram.add(1);
+    BrowserReload();
+  },
+
+  enableTrackingContentProtection: function() {
+    // Remove the current host from the 'trackingprotection' consumer
+    // of the permission manager. This effectively removes this host
+    // from the tracking protection allowlist.
+    Services.perms.remove(gBrowser.selectedBrowser.currentURI.host,
+      "trackingprotection");
+    // Telemetry for enable protection
+    let histogram = Services.telemetry.getHistogramById(
+        "TRACKING_PROTECTION_EVENTS");
+    histogram.add(2);
+    BrowserReload();
+  },
+
+};
diff --git a/browser/base/content/browser.js b/browser/base/content/browser.js
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -273,16 +273,17 @@ let gInitialPages = [
 #include browser-places.js
 #include browser-plugins.js
 #include browser-readinglist.js
 #include browser-safebrowsing.js
 #include browser-sidebar.js
 #include browser-social.js
 #include browser-tabview.js
 #include browser-thumbnails.js
+#include browser-trackingprotection.js
 
 #ifdef MOZ_DATA_REPORTING
 #include browser-data-submission-info-bar.js
 #endif
 
 #ifdef MOZ_SERVICES_SYNC
 #include browser-syncui.js
 #endif
@@ -957,16 +958,17 @@ var gBrowserInit = {
     // message sent between when the frame script is loaded and when
     // the listener is registered.
     DOMLinkHandler.init();
     gPageStyleMenu.init();
     LanguageDetectionListener.init();
     BrowserOnClick.init();
     DevEdition.init();
     AboutPrivateBrowsingListener.init();
+    TrackingProtection.init();
 
     let mm = window.getGroupMessageManager("browsers");
     mm.loadFrameScript("chrome://browser/content/tab-content.js", true);
     mm.loadFrameScript("chrome://browser/content/content.js", true);
     mm.loadFrameScript("chrome://browser/content/content-UITour.js", true);
     mm.loadFrameScript("chrome://global/content/manifestMessages.js", true);
 
     window.messageManager.addMessageListener("Browser:LoadURI", RedirectLoad);
@@ -6722,16 +6724,18 @@ var gIdentityHandler = {
    * Determine the identity of the page being displayed by examining its SSL cert
    * (if available) and, if necessary, update the UI to reflect this.  Intended to
    * be called by onSecurityChange
    *
    * @param PRUint32 state
    * @param nsIURI uri The address for which the UI should be updated.
    */
   checkIdentity : function(state, uri) {
+    console.log("Check identity", state, uri);
+    console.trace();
     var currentStatus = gBrowser.securityUI
                                 .QueryInterface(Components.interfaces.nsISSLStatusProvider)
                                 .SSLStatus;
     this._lastStatus = currentStatus;
     this._lastUri = uri;
 
     let nsIWebProgressListener = Ci.nsIWebProgressListener;
 
@@ -6772,20 +6776,22 @@ var gIdentityHandler = {
     // - tracking content is blocked
     // - tracking content is not blocked
     if (state &
         (nsIWebProgressListener.STATE_BLOCKED_MIXED_ACTIVE_CONTENT |
          nsIWebProgressListener.STATE_LOADED_MIXED_ACTIVE_CONTENT  |
          nsIWebProgressListener.STATE_BLOCKED_TRACKING_CONTENT     |
          nsIWebProgressListener.STATE_LOADED_TRACKING_CONTENT)) {
       this.showBadContentDoorhanger(state);
+      TrackingProtection.onPopupOpen(state);
     } else if (gPrefService.getBoolPref("privacy.trackingprotection.enabled")) {
       // We didn't show the shield
       Services.telemetry.getHistogramById("TRACKING_PROTECTION_SHIELD")
         .add(0);
+      TrackingProtection.onPopupOpen(state);
     }
   },
 
   showBadContentDoorhanger : function(state) {
     var currentNotification =
       PopupNotifications.getNotification("bad-content",
         gBrowser.selectedBrowser);
 
diff --git a/browser/components/controlcenter/content/panel.inc.xul b/browser/components/controlcenter/content/panel.inc.xul
--- a/browser/components/controlcenter/content/panel.inc.xul
+++ b/browser/components/controlcenter/content/panel.inc.xul
@@ -30,15 +30,68 @@
                    class="identity-popup-description"/>
       <vbox id="identity-popup-permissions">
         <label class="identity-popup-label header"
                value="&identity.permissions;"/>
         <vbox id="identity-popup-permission-list" class="indent"/>
       </vbox>
     </vbox>
   </hbox>
+
+  <separator class="groove" />
+
+  <!-- Tracking protection -->
+  <hbox id="tracking-protection-container">
+    <hbox align="top">
+      <image id="tracking-protection-image" />
+      <vbox id="tracking-protection-content-box" align="top">
+        <label id="tracking-protection-title"
+               class="identity-popup-description2"
+               crop="end"
+               value="&trackingProtection.title;">
+        </label>
+
+        <label id="tracking-detected-enabled"
+               class="tracking-protection-label"
+               crop="end">
+          &trackingProtection.detectedBlocked;
+        </label>
+        <label id="tracking-detected-disabled"
+               class="tracking-protection-label"
+               crop="end">
+          &trackingProtection.detectedNotBlocked;
+        </label>
+        <label id="tracking-not-detected"
+               class="tracking-protection-label"
+               crop="end">
+          &trackingProtection.notDetected;
+        </label>
+
+        <button id="trackingContentActions"
+          type="menu" label="&trackingContentBlocked.options;"
+          sizetopopup="none">
+          <menupopup>
+            <menuitem
+              id="trackingContentActionUnblock"
+              label="&trackingContentBlocked.unblock2.label;"
+              accesskey="&trackingContentBlocked.unblock2.accesskey;"
+              oncommand="TrackingProtection.disableTrackingContentProtection();"/>
+            <menuitem
+              id="trackingContentActionBlock"
+              label="&trackingContentBlocked.block.label;"
+              accesskey="&trackingContentBlocked.block.accesskey;"
+              oncommand="TrackingProtection.enableTrackingContentProtection();"/>
+          </menupopup>
+        </button>
+      </vbox>
+    </hbox>
+
+  </hbox>
+
+
+
   <!-- Footer button to open security page info -->
   <hbox id="identity-popup-button-container" align="center">
     <button id="identity-popup-more-info-button" flex="1"
             label="&identity.moreInfoLinkText2;"
             oncommand="gIdentityHandler.handleMoreInfoClick(event);"/>
   </hbox>
 </panel>
diff --git a/browser/locales/en-US/chrome/browser/browser.dtd b/browser/locales/en-US/chrome/browser/browser.dtd
--- a/browser/locales/en-US/chrome/browser/browser.dtd
+++ b/browser/locales/en-US/chrome/browser/browser.dtd
@@ -761,25 +761,33 @@ you can use these alternative items. Oth
 <!ENTITY mixedContentBlocked2.learnMore "Learn More">
 <!ENTITY mixedContentBlocked2.options "Options">
 <!ENTITY mixedContentBlocked2.unblock.label "Disable protection for now">
 <!ENTITY mixedContentBlocked2.unblock.accesskey "D">
 <!ENTITY mixedContentBlocked2.block.label "Enable protection">
 <!ENTITY mixedContentBlocked2.block.accesskey "E">
 <!ENTITY mixedContentBlocked2.disabled.message "Protection is disabled">
 
+<!ENTITY trackingProtection.title "Tracking Protection">
+<!ENTITY trackingProtection.detectedBlocked "Attempts to track your online behavior have been blocked.">
+<!ENTITY trackingProtection.detectedNotBlocked "Tracking elements detected.  You have disabled protection on this site.">
+<!ENTITY trackingProtection.notDetected "No tracking elements detected on this website.">
+
+<!-- XXX: Update or remove the messages -->
 <!ENTITY trackingContentBlocked.message "Tracking">
 <!ENTITY trackingContentBlocked.moreinfo "Parts of the page that track your online activity have been blocked.">
+<!ENTITY trackingContentBlocked.disabled.message "Tracking protection is disabled">
 <!ENTITY trackingContentBlocked.learnMore "Learn More">
 <!ENTITY trackingContentBlocked.options "Options">
+<!-- /XXX -->
+
 <!ENTITY trackingContentBlocked.unblock2.label "Disable protection for this site">
 <!ENTITY trackingContentBlocked.unblock2.accesskey "D">
 <!ENTITY trackingContentBlocked.block.label "Enable protection">
 <!ENTITY trackingContentBlocked.block.accesskey "E">
-<!ENTITY trackingContentBlocked.disabled.message "Tracking protection is disabled">
 
 <!ENTITY pointerLock.notification.message "Press ESC at any time to show it again.">
 
 <!ENTITY pluginNotification.showAll.label "Show All">
 <!ENTITY pluginNotification.showAll.accesskey "S">
 
 <!-- LOCALIZATION NOTE (pluginActivateNow.label, pluginActivateAlways.label, pluginBlockNow.label): These should be the same as the matching strings in browser.properties -->
 <!ENTITY pluginActivateNow.label "Allow Now">
diff --git a/browser/themes/linux/jar.mn b/browser/themes/linux/jar.mn
--- a/browser/themes/linux/jar.mn
+++ b/browser/themes/linux/jar.mn
@@ -141,16 +141,18 @@ browser.jar:
   skin/classic/browser/webRTC-screen-white-16.png     (../shared/webrtc/screen-white-16.png)
   skin/classic/browser/loop/menuPanel.png             (loop/menuPanel.png)
   skin/classic/browser/loop/menuPanel@2x.png          (loop/menuPanel@2x.png)
   skin/classic/browser/loop/toolbar.png               (loop/toolbar.png)
   skin/classic/browser/loop/toolbar@2x.png            (loop/toolbar@2x.png)
   skin/classic/browser/loop/toolbar-inverted.png      (loop/toolbar-inverted.png)
   skin/classic/browser/loop/toolbar-inverted@2x.png   (loop/toolbar-inverted@2x.png)
 * skin/classic/browser/controlcenter/panel.css        (controlcenter/panel.css)
+  skin/classic/browser/controlcenter/tracking-protection.svg                 (../shared/controlcenter/tracking-protection.svg)
+  skin/classic/browser/controlcenter/tracking-protection-disabled.svg        (../shared/controlcenter/tracking-protection-disabled.svg)
   skin/classic/browser/customizableui/background-noise-toolbar.png  (customizableui/background-noise-toolbar.png)
   skin/classic/browser/customizableui/customize-illustration.png  (../shared/customizableui/customize-illustration.png)
   skin/classic/browser/customizableui/customize-illustration-rtl.png  (../shared/customizableui/customize-illustration-rtl.png)
   skin/classic/browser/customizableui/customizeMode-gridTexture.png  (customizableui/customizeMode-gridTexture.png)
   skin/classic/browser/customizableui/customizeMode-separatorHorizontal.png  (customizableui/customizeMode-separatorHorizontal.png)
   skin/classic/browser/customizableui/customizeMode-separatorVertical.png  (customizableui/customizeMode-separatorVertical.png)
   skin/classic/browser/customizableui/customizeFavicon.ico  (../shared/customizableui/customizeFavicon.ico)
   skin/classic/browser/customizableui/info-icon-customizeTip.png  (../shared/customizableui/info-icon-customizeTip.png)
diff --git a/browser/themes/osx/jar.mn b/browser/themes/osx/jar.mn
--- a/browser/themes/osx/jar.mn
+++ b/browser/themes/osx/jar.mn
@@ -186,16 +186,18 @@ browser.jar:
   skin/classic/browser/loop/toolbar@2x.png            (loop/toolbar@2x.png)
   skin/classic/browser/loop/toolbar-inverted.png      (loop/toolbar-inverted.png)
   skin/classic/browser/loop/toolbar-inverted@2x.png   (loop/toolbar-inverted@2x.png)
   skin/classic/browser/yosemite/loop/menuPanel.png          (loop/menuPanel-yosemite.png)
   skin/classic/browser/yosemite/loop/menuPanel@2x.png       (loop/menuPanel-yosemite@2x.png)
   skin/classic/browser/yosemite/loop/toolbar.png            (loop/toolbar-yosemite.png)
   skin/classic/browser/yosemite/loop/toolbar@2x.png         (loop/toolbar-yosemite@2x.png)
 * skin/classic/browser/controlcenter/panel.css        (controlcenter/panel.css)
+  skin/classic/browser/controlcenter/tracking-protection.svg                 (../shared/controlcenter/tracking-protection.svg)
+  skin/classic/browser/controlcenter/tracking-protection-disabled.svg        (../shared/controlcenter/tracking-protection-disabled.svg)
   skin/classic/browser/customizableui/background-noise-toolbar.png  (customizableui/background-noise-toolbar.png)
   skin/classic/browser/customizableui/customize-titleBar-toggle.png  (customizableui/customize-titleBar-toggle.png)
   skin/classic/browser/customizableui/customize-titleBar-toggle@2x.png  (customizableui/customize-titleBar-toggle@2x.png)
   skin/classic/browser/customizableui/customize-illustration.png  (../shared/customizableui/customize-illustration.png)
   skin/classic/browser/customizableui/customize-illustration@2x.png  (../shared/customizableui/customize-illustration@2x.png)
   skin/classic/browser/customizableui/customize-illustration-rtl.png  (../shared/customizableui/customize-illustration-rtl.png)
   skin/classic/browser/customizableui/customize-illustration-rtl@2x.png  (../shared/customizableui/customize-illustration-rtl@2x.png)
   skin/classic/browser/customizableui/customizeFavicon.ico  (../shared/customizableui/customizeFavicon.ico)
diff --git a/browser/themes/shared/controlcenter/panel.inc.css b/browser/themes/shared/controlcenter/panel.inc.css
--- a/browser/themes/shared/controlcenter/panel.inc.css
+++ b/browser/themes/shared/controlcenter/panel.inc.css
@@ -103,8 +103,54 @@
   background-color: hsla(210,4%,10%,.07);
 }
 
 #identity-popup-more-info-button:hover:active {
   color: inherit;
   background-color: hsla(210,4%,10%,.12);
   box-shadow: 0 1px 0 hsla(210,4%,10%,.05) inset;
 }
+
+
+/* Tracking protection changes */
+
+/* Tracking protection icons */
+#tracking-protection-image {
+  height: 64px;
+  width: 64px;
+  padding: 0;
+  list-style-image: url("chrome://browser/skin/controlcenter/tracking-protection.svg");
+}
+
+/* XXX: share this with identity styling */
+#tracking-protection-container {
+  min-width: 25em;
+  padding: 10px;
+}
+
+/* XXX: share this with identity styling */
+.tracking-protection-label {
+  font-size: 120%;
+  -moz-padding-start: 15px;
+  margin: 0;
+  max-width: 300px;
+}
+
+#trackingContentActions {
+  -moz-padding-start: 15px;
+}
+
+/* XXX: share this with identity styling */
+#tracking-protection-title {
+  font-size: 140%;
+  white-space: pre-wrap;
+  -moz-padding-start: 15px;
+  margin: 0;
+}
+
+/* XXX: share this with identity styling */
+#tracking-protection-content-box {
+  width: 40ch;
+}
+
+#tracking-protection-container[trackingblockdisabled] #tracking-protection-image  {
+  list-style-image: url("chrome://browser/skin/controlcenter/tracking-protection-disabled.svg");
+}
diff --git a/browser/themes/shared/controlcenter/tracking-protection-disabled.svg b/browser/themes/shared/controlcenter/tracking-protection-disabled.svg
new file mode 100644
--- /dev/null
+++ b/browser/themes/shared/controlcenter/tracking-protection-disabled.svg
@@ -0,0 +1,31 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg version="1.1"
+     xmlns="http://www.w3.org/2000/svg"
+     xmlns:xlink="http://www.w3.org/1999/xlink"
+     width="16"
+     height="16"
+     viewBox="0 0 16 16">
+  <style>
+    .icon-default {
+      fill: #808080;
+    }
+  </style>
+  <defs>
+    <path id="shape-shield-outer" d="M8,1L2.8,1.9C2.4,1.9,2,2.4,2,2.8C2,4,2,6.1,2.1,7.1c0.3,2.7,0.8,4,1.9,5.6C5.6,14.7,8,15,8,15s2.4-0.3,4-2.4 c1.2-1.5,1.7-2.9,1.9-5.6C14,6.1,14,4,14,2.8c0-0.5-0.4-0.9-0.8-1L8,1L8,1z"/>
+    <path id="shape-shield-inner" d="M8,2l5,0.8c0,2,0,3.5-0.1,4.1c-0.3,2.7-0.8,3.8-1.7,5.1c-1.1,1.5-2.7,1.9-3.2,2c-0.4-0.1-2.1-0.5-3.2-2 c-1-1.3-1.5-2.4-1.7-5.1C3,6.3,3,4.8,3,2.8L8,2"/>
+    <path id="shape-shield-detail" d="M8,13c-0.5-0.1-1.6-0.5-2.4-1.5c-0.9-1.2-1.3-2.1-1.5-4.6C4,6.3,4,5.2,4,3.7L8,3 V13z"/>
+    <mask id="mask-shield-cutout">
+      <rect width="16" height="16" fill="#000" />
+      <use xlink:href="#shape-shield-outer" fill="#fff" />
+      <use xlink:href="#shape-shield-inner" fill="#000" />
+      <use xlink:href="#shape-shield-detail" fill="#fff" />
+      <line x1="3" y1="15" x2="15" y2="3" stroke="#000" stroke-width="2" />
+    </mask>
+  </defs>
+  <use xlink:href="#shape-shield-outer" mask="url(#mask-shield-cutout)" class="icon-default" />
+  <line x1="3" y1="14" x2="15" y2="2" stroke="#d92d21" stroke-width="2" />
+</svg>
diff --git a/browser/themes/shared/controlcenter/tracking-protection.svg b/browser/themes/shared/controlcenter/tracking-protection.svg
new file mode 100644
--- /dev/null
+++ b/browser/themes/shared/controlcenter/tracking-protection.svg
@@ -0,0 +1,29 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg version="1.1"
+     xmlns="http://www.w3.org/2000/svg"
+     xmlns:xlink="http://www.w3.org/1999/xlink"
+     width="16"
+     height="16"
+     viewBox="0 0 16 16">
+  <style>
+    .icon-default {
+      fill: #808080;
+    }
+  </style>
+  <defs>
+    <path id="shape-shield-outer" d="M8,1L2.8,1.9C2.4,1.9,2,2.4,2,2.8C2,4,2,6.1,2.1,7.1c0.3,2.7,0.8,4,1.9,5.6C5.6,14.7,8,15,8,15s2.4-0.3,4-2.4 c1.2-1.5,1.7-2.9,1.9-5.6C14,6.1,14,4,14,2.8c0-0.5-0.4-0.9-0.8-1L8,1L8,1z"/>
+    <path id="shape-shield-inner" d="M8,2l5,0.8c0,2,0,3.5-0.1,4.1c-0.3,2.7-0.8,3.8-1.7,5.1c-1.1,1.5-2.7,1.9-3.2,2c-0.4-0.1-2.1-0.5-3.2-2 c-1-1.3-1.5-2.4-1.7-5.1C3,6.3,3,4.8,3,2.8L8,2"/>
+    <path id="shape-shield-detail" d="M8,13c-0.5-0.1-1.6-0.5-2.4-1.5c-0.9-1.2-1.3-2.1-1.5-4.6C4,6.3,4,5.2,4,3.7L8,3 V13z"/>
+    <mask id="mask-shield-cutout">
+      <rect width="16" height="16" fill="#000" />
+      <use xlink:href="#shape-shield-outer" fill="#fff" />
+      <use xlink:href="#shape-shield-inner" fill="#000" />
+      <use xlink:href="#shape-shield-detail" fill="#fff" />
+    </mask>
+  </defs>
+  <use xlink:href="#shape-shield-outer" mask="url(#mask-shield-cutout)" class="icon-default" />
+</svg>
diff --git a/browser/themes/windows/jar.mn b/browser/themes/windows/jar.mn
--- a/browser/themes/windows/jar.mn
+++ b/browser/themes/windows/jar.mn
@@ -187,16 +187,18 @@ browser.jar:
         skin/classic/browser/loop/toolbar-aero@2x.png                (loop/toolbar-aero@2x.png)
         skin/classic/browser/loop/toolbar-inverted.png               (loop/toolbar-inverted.png)
         skin/classic/browser/loop/toolbar-inverted@2x.png            (loop/toolbar-inverted@2x.png)
         skin/classic/browser/loop/toolbar-XP.png                     (loop/toolbar-XP.png)
         skin/classic/browser/loop/toolbar-XP@2x.png                  (loop/toolbar-XP@2x.png)
         skin/classic/browser/loop/toolbar-lunaSilver.png             (loop/toolbar-lunaSilver.png)
         skin/classic/browser/loop/toolbar-lunaSilver@2x.png          (loop/toolbar-lunaSilver@2x.png)
 *       skin/classic/browser/controlcenter/panel.css                 (controlcenter/panel.css)
+        skin/classic/browser/controlcenter/tracking-protection.svg                 (../shared/controlcenter/tracking-protection.svg)
+        skin/classic/browser/controlcenter/tracking-protection-disabled.svg        (../shared/controlcenter/tracking-protection-disabled.svg)
         skin/classic/browser/customizableui/background-noise-toolbar.png  (customizableui/background-noise-toolbar.png)
         skin/classic/browser/customizableui/customizeFavicon.ico  (../shared/customizableui/customizeFavicon.ico)
         skin/classic/browser/customizableui/customize-illustration.png  (../shared/customizableui/customize-illustration.png)
         skin/classic/browser/customizableui/customize-illustration-rtl.png  (../shared/customizableui/customize-illustration-rtl.png)
         skin/classic/browser/customizableui/customize-titleBar-toggle.png  (customizableui/customize-titleBar-toggle.png)
         skin/classic/browser/customizableui/customize-titleBar-toggle@2x.png  (customizableui/customize-titleBar-toggle@2x.png)
         skin/classic/browser/customizableui/customizeMode-gridTexture.png  (customizableui/customizeMode-gridTexture.png)
         skin/classic/browser/customizableui/customizeMode-separatorHorizontal.png  (customizableui/customizeMode-separatorHorizontal.png)
