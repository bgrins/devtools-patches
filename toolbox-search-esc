# HG changeset patch
# Parent 09be153f13771d3b7fea088a417e2e2b573dcc09
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 1055085 - make toolbox ignore ESC events that originated on input[type=search]

diff --git a/devtools/client/framework/toolbox.js b/devtools/client/framework/toolbox.js
--- a/devtools/client/framework/toolbox.js
+++ b/devtools/client/framework/toolbox.js
@@ -350,17 +350,32 @@ Toolbox.prototype = {
     let key = this.doc.getElementById("toolbox-options-key");
     key.addEventListener("command", () => {
       this.selectTool("options");
     }, true);
   },
 
   _splitConsoleOnKeypress: function(e) {
     if (e.keyCode === e.DOM_VK_ESCAPE) {
-      this.toggleSplitConsole();
+      let shouldToggle = true;
+
+      // XXX: for some reason, the value is already "" by the time that
+      // the keydown fires
+
+      // If this is an input[type=search] and ESC is going to clear the
+      // value, then don't toggle.
+      if (e.originalTarget.getAttribute("type") === "search" &&
+         (e.originalTarget.value || "").trim().length > 0) {
+        shouldToggle = false;
+      }
+
+      if (shouldToggle) {
+        this.toggleSplitConsole();
+      }
+
       // If the debugger is paused, don't let the ESC key stop any pending
       // navigation.
       let jsdebugger = this.getPanel("jsdebugger");
       if (jsdebugger && jsdebugger.panelWin.gThreadClient.state == "paused") {
         e.preventDefault();
       }
     }
   },
