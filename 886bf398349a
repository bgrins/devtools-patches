
# HG changeset patch
# User Gabriel Luong <gabriel.luong@gmail.com>
# Date 1517062963 18000
# Node ID 886bf398349aec3679ab7d49c863f8eb73ac6b84
# Parent  67d31806afb667c1b33ca18e63a77a4a284112b6
Bug 1433611 - Adjust the widths of the split box on toggling of the split rule view. r=bgrins

MozReview-Commit-ID: 2r0rGXc30L4

diff --git a/devtools/client/inspector/inspector.js b/devtools/client/inspector/inspector.js
--- a/devtools/client/inspector/inspector.js
+++ b/devtools/client/inspector/inspector.js
@@ -607,18 +607,38 @@
       // sidebar.
       ruleViewSidebar.style.display = "block";
 
       // The sidebar toggle might not be setup yet on the initial setup.
       if (this.sidebarToggle) {
         this.sidebarToggle.setState({ collapsed: false });
       }
 
-      // Show the splitter inside the sidebar split box.
-      this.sidebarSplitBox.setState({ splitterSize: 1 });
+      // Get the toolbox's width and host type, and split the panels to be equal widths of
+      // the toolbox's width.
+      let hostType = this.toolbox.hostType;
+      let toolboxWidth = this.splitBox.startPanelContainer.clientWidth;
+
+      if (hostType != "side") {
+        // Set the split box end panel container's width to be 2/3 of the toolbox's width.
+        // The end panel container consists of the split rule view and the inspector
+        // sidebar.
+        toolboxWidth += this.splitBox.state.width;
+        this.splitBox.setState({
+          width: toolboxWidth * 2 / 3,
+        });
+      }
+
+      // Show the splitter inside the sidebar split box and set the width of the
+      // inspector's sidebar to be 1/2 (side) or 1/3 (bottom) of the toolbox's width
+      // depending on the toolbox's host type.
+      this.sidebarSplitBox.setState({
+        splitterSize: 1,
+        width: toolboxWidth / (hostType != "side" ? 3 : 2),
+      });
 
       // Force the rule view panel creation by calling getPanel
       this.getPanel("ruleview");
 
       await this.sidebar.removeTab("ruleview");
 
       this.ruleViewSideBar.addExistingTab(
         "ruleview",
@@ -631,16 +651,21 @@
       // sidebar.
       ruleViewSidebar.style.display = "none";
 
       // The sidebar toggle might not be setup yet on the initial setup.
       if (this.sidebarToggle) {
         this.sidebarToggle.setState({ collapsed: true });
       }
 
+      // Set the width of the split box to the width of the inspector sidebar.
+      this.splitBox.setState({
+        width: this.splitBox.state.width - this.sidebarSplitBox.state.width,
+      });
+
       // Hide the splitter to prevent any drag events in the sidebar split box.
       this.sidebarSplitBox.setState({ splitterSize: 0 });
 
       this.ruleViewSideBar.hide();
       await this.ruleViewSideBar.removeTab("ruleview");
 
       this.sidebar.addExistingTab(
         "ruleview",
diff --git a/devtools/client/themes/inspector.css b/devtools/client/themes/inspector.css
--- a/devtools/client/themes/inspector.css
+++ b/devtools/client/themes/inspector.css
@@ -168,16 +168,20 @@
 #inspector-sidebar {
   position: absolute;
   top: 0;
   bottom: 0;
   left: 0;
   right: 0;
 }
 
+#inspector-sidebar-toggle-box .sidebar-toggle::before {
+  transform: unset;
+}
+
 /* Override `-moz-user-focus:ignore;` from toolkit/content/minimal-xul.css */
 .inspector-tabpanel > * {
   -moz-user-focus: normal;
 }
 
 /* Markup Box */
 
 iframe {

