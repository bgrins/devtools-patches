# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1537300680 25200
#      Tue Sep 18 12:58:00 2018 -0700
# Node ID f7aeec9f9d0705a90a093f24a99824d402461b5c
# Parent  b7f409bd51c8ae7260c1675785c698a9cb061244
Bug 1492247 - Allow for null document.head when inserting localization links;r=zbraniecki

This prevents an exception in browser.xhtml when there's no head, since
it's currently sharing the markup with browser.xul.

Differential Revision: https://phabricator.services.mozilla.com/D6194

diff --git a/toolkit/content/customElements.js b/toolkit/content/customElements.js
--- a/toolkit/content/customElements.js
+++ b/toolkit/content/customElements.js
@@ -78,21 +78,24 @@ class MozXULElement extends XULElement {
    * present in the markup.
    *
    * @param path
    *        The path to the FTL file
    */
   static insertFTLIfNeeded(path) {
     let container = document.head || document.querySelector("linkset");
     if (!container) {
-      if (document.contentType != "application/vnd.mozilla.xul+xml") {
-        throw new Error("Attempt to inject localization link before document.head is available");
+      if (document.contentType == "application/vnd.mozilla.xul+xml") {
+        container = document.createXULElement("linkset");
+        document.documentElement.appendChild(container);
+      } else {
+        // In case there's no <head> in an HTML document, put the
+        // links under the root node.
+        container = document.documentElement;
       }
-      container = document.createXULElement("linkset");
-      document.documentElement.appendChild(container);
     }
 
     for (let link of container.querySelectorAll("link")) {
       if (link.getAttribute("href") == path) {
         return;
       }
     }
 
