Bug 1093820 - DevEdition theme improvements Windows;r=MattN

diff --git a/browser/themes/shared/devedition.inc.css b/browser/themes/shared/devedition.inc.css
--- a/browser/themes/shared/devedition.inc.css
+++ b/browser/themes/shared/devedition.inc.css
@@ -12,6 +12,9 @@
   --toolbarbutton-text-shadow: none;
   --panel-ui-button-background-size: 1px calc(100% - 1px);
   --panel-ui-button-background-position: 1px 0px;
+
+  /* Matches the #browser-border-start, #browser-border-end color */
+  --chrome-window-separator-color: rgba(10, 31, 51, 0.35);
 }
 
 :root[devtoolstheme="dark"] {
@@ -19,8 +22,6 @@
   --chrome-background-color: #1C2126;
   --chrome-color: #F5F7FA;
   --chrome-secondary-background-color: #39424D;
-  --chrome-navigator-toolbox-separator-color: rgba(0,0,0,.2);
-  --chrome-nav-bar-separator-color: rgba(0,0,0,.2);
   --chrome-nav-buttons-background: #252C33;
   --chrome-nav-buttons-hover-background: #1B2127;
   --chrome-selection-color: #fff;
@@ -81,8 +82,6 @@
   --chrome-background-color: #E3E4E6;
   --chrome-color: #18191a;
   --chrome-secondary-background-color: #f0f1f2;
-  --chrome-navigator-toolbox-separator-color: #cccccc;
-  --chrome-nav-bar-separator-color: #B6B6B8;
   --chrome-nav-buttons-background: #f0f1f2;
   --chrome-nav-buttons-hover-background: #DADBDB;
   --chrome-selection-color: #f5f7fa;
@@ -172,7 +171,7 @@
 }
 
 #navigator-toolbox::after {
-  background: var(--chrome-navigator-toolbox-separator-color);
+  background: var(--chrome-window-separator-color);
 }
 
 #navigator-toolbox > toolbar:not(#TabsToolbar):not(#toolbar-menubar),
@@ -231,7 +230,7 @@ window:not([chromehidden~="toolbar"]) #u
   border-top: none !important;
   border-bottom: none !important;
   border-radius: 0 !important;
-  box-shadow: 0 -1px var(--chrome-nav-bar-separator-color) !important;
+  box-shadow: 0 -1px var(--chrome-window-separator-color) !important;
   background-image: none !important;
 }
 
@@ -273,6 +272,7 @@ searchbar:not([oneoffui]) .search-go-but
 
 .tabbrowser-arrowscrollbox > .scrollbutton-down,
 .tabbrowser-arrowscrollbox > .scrollbutton-up {
+  background-image: none;
   background-color: var(--tab-background-color);
   border-color: transparent;
 }
@@ -299,6 +299,7 @@ searchbar:not([oneoffui]) .search-go-but
 .tabbrowser-arrowscrollbox > .scrollbutton-up:not([disabled]):hover,
 .tabbrowser-tab:hover {
   background-color: var(--tab-hover-background-color);
+  background-image: none;
 }
 
 .tabbrowser-tab[selected] {
@@ -312,7 +313,6 @@ searchbar:not([oneoffui]) .search-go-but
   width: 36px;
 }
 
-#TabsToolbar > #new-tab-button:hover,
 .tabs-newtab-button:hover {
   /* Important needed because !important is used in browser.css */
   background-color: var(--tab-hover-background-color) !important;
diff --git a/browser/themes/windows/devedition.css b/browser/themes/windows/devedition.css
--- a/browser/themes/windows/devedition.css
+++ b/browser/themes/windows/devedition.css
@@ -43,13 +43,55 @@
   padding-bottom: 2px;
 }
 
+/* It'd be nice if there was an element in the scrollbox's inner content
+   that collapsed to the current width of the tabs. Since there isn't we
+   need to handle overflowing and non-overflowing tabs separately.
+   
+   In the case of overflowing tabs, set a border-top on the entire container,
+   otherwise we need to set it on each element individually */
+#main-window[sizemode=normal]:not([customizing]) .tabbrowser-tabs[overflow="true"] {
+  background-clip: padding-box;
+  border-top: 1px solid var(--chrome-window-separator-color);
+  -moz-border-end: 1px solid var(--chrome-window-separator-color);
+  background-color: var(--tab-background-color); /* Make sure there is no transparent gap during tab close animation */
+}
+
+#main-window[sizemode=normal] .tabbrowser-tabs:not([overflow="true"]) .tabbrowser-tab {
+  -moz-border-top-colors: none;
+}
+
+#main-window[sizemode=normal] .tabbrowser-tabs:not([overflow="true"]) .tabbrowser-tab,
+#main-window[sizemode=normal] .tabbrowser-tabs:not([overflow="true"]) .tabbrowser-arrowscrollbox > .scrollbutton-down,
+#main-window[sizemode=normal] .tabbrowser-tabs:not([overflow="true"]) .tabbrowser-arrowscrollbox > .scrollbutton-up,
+#main-window[sizemode=normal] .tabbrowser-tabs:not([overflow="true"]) .tabs-newtab-button {
+  background-clip: padding-box;
+  border-top: 1px solid var(--chrome-window-separator-color);
+}
+
+#main-window[sizemode=normal] .tabbrowser-tabs:not([overflow="true"]) .closing-tabs-spacer {
+  background-clip: padding-box;
+  -moz-border-start: 1px solid var(--chrome-window-separator-color);
+}
+
+.tabs-newtab-button {
+ /*XXX:  Allow a pixel of space at the start for the tab splitter to appear 
+  background-image: linear-gradient(var(--tab-background-color), var(--tab-background-color));
+  background-position: 1px top;
+  background-repeat: no-repeat;
+  */
+  background: var(--tab-background-color);
+}
+
+/* Use default window colors when in non-maximized mode */
+#tabbrowser-tabs,
+#TabsToolbar,
 #browser-panel,
 #titlebar-content {
   background: transparent;
 }
 
 /* Ensure that the entire background is styled when maximized */
-#main-window[sizemode="maximized"] #browser-panel {
+#main-window[sizemode="maximized"]:not([customizing]) #browser-panel {
   background: var(--chrome-background-color) !important;
 }
 
@@ -63,45 +105,29 @@
   color: inherit;
 }
 
+/* Use less opacity than normal since this is very dark, and on top of the default toolbar color */
+.tabbrowser-arrowscrollbox > .scrollbutton-up[disabled],
+.tabbrowser-arrowscrollbox > .scrollbutton-down[disabled] {
+  opacity: .6;
+}
+
 /* Restore draggable space on the sides of tabs when maximized */
 #main-window[sizemode="maximized"] .tabbrowser-arrowscrollbox > .arrowscrollbox-scrollbox {
   padding-left: 15px;
   padding-right: 15px;
 }
 
-@media (-moz-windows-classic) {
-  #main-window[sizemode="maximized"] #TabsToolbar {
-    background: transparent;
-  }
-}
-
 #toolbar-menubar {
   text-shadow: none !important;
 }
 
 /* Override the padding that's intended to compensate for tabs that can overlap border-radius on nav-bar in default theme. */
-#main-window[sizemode=normal] #TabsToolbar {
+#main-window[sizemode=normal]:not([customizing]) #TabsToolbar {
   padding-left: 0;
   padding-right: 0;
-}
-
-#main-window[tabsintitlebar][sizemode="normal"]:not([inFullscreen])[chromehidden~="menubar"] #toolbar-menubar ~ #TabsToolbar,
-#main-window[tabsintitlebar][sizemode="normal"]:not([inFullscreen]) #toolbar-menubar[autohide="true"][inactive] ~ #TabsToolbar {
-  margin-top: 22px;
-}
-
-
-/* Enough space so that the dark background doesn't begin until after the
- * window resize controls end on Aero Basic, which has different positioning for the
- * window caption buttons, and therefore needs to be special-cased.
- */
-@media (-moz-windows-default-theme) {
-  @media not all and (-moz-windows-compositor) {
-    #main-window[tabsintitlebar][sizemode="normal"]:not([inFullscreen])[chromehidden~="menubar"] #toolbar-menubar ~ #TabsToolbar,
-    #main-window[tabsintitlebar][sizemode="normal"]:not([inFullscreen]) #toolbar-menubar[autohide="true"][inactive] ~ #TabsToolbar {
-      margin-top: 28px;
-    }
-  }
+  background-clip: padding-box;
+  -moz-border-start: 1px solid var(--chrome-window-separator-color);
+  -moz-border-end: 1px solid transparent;
 }
 
 /* This rule is specific to the dark theme, because we only set the dropdown image there */
