# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  4e2ea1a75e878ae392e4775f2eddd9f83d1b008e
Use type="content" for devtools host

diff --git a/devtools/client/framework/toolbox-host-manager.js b/devtools/client/framework/toolbox-host-manager.js
--- a/devtools/client/framework/toolbox-host-manager.js
+++ b/devtools/client/framework/toolbox-host-manager.js
@@ -136,16 +136,17 @@ ToolboxHostManager.prototype = {
 
   onMessage(event) {
     if (!event.data) {
       return;
     }
     const msg = event.data;
     // Toolbox document is still chrome and disallow identifying message
     // origin via event.source as it is null. So use a custom id.
+    console.log(msg, msg.frameId, this.frameId);
     if (msg.frameId != this.frameId) {
       return;
     }
     switch (msg.name) {
       case "switch-host":
         this.switchHost(msg.hostType);
         break;
       case "raise-host":
@@ -188,16 +189,17 @@ ToolboxHostManager.prototype = {
       throw new Error("Unknown hostType: " + hostType);
     }
 
     const newHost = new Hosts[hostType](this.target.tab, options);
     return newHost;
   },
 
   async switchHost(hostType) {
+    console.trace("switchHost");
     if (hostType == "previous") {
       // Switch to the last used host for the toolbox UI.
       // This is determined by the devtools.toolbox.previousHost pref.
       hostType = Services.prefs.getCharPref(PREVIOUS_HOST);
 
       // Handle the case where the previous host happens to match the current
       // host. If so, switch to bottom if it's not already used, and right side if not.
       if (hostType === this.hostType) {
@@ -207,16 +209,17 @@ ToolboxHostManager.prototype = {
           hostType = Toolbox.HostType.BOTTOM;
         }
       }
     }
     const iframe = this.host.frame;
     const newHost = this.createHost(hostType);
     const newIframe = await newHost.create();
     // change toolbox document's parent to the new host
+    console.log("About to swap", iframe, iframe.getAttribute("type"));
     newIframe.swapFrameLoaders(iframe);
 
     this.destroyHost();
 
     if (this.hostType !== Toolbox.HostType.CUSTOM &&
         this.hostType !== Toolbox.HostType.PAGE) {
       Services.prefs.setCharPref(PREVIOUS_HOST, this.hostType);
     }
diff --git a/devtools/client/framework/toolbox-hosts.js b/devtools/client/framework/toolbox-hosts.js
--- a/devtools/client/framework/toolbox-hosts.js
+++ b/devtools/client/framework/toolbox-hosts.js
@@ -54,16 +54,17 @@ BottomHost.prototype = {
       gBrowser.getBrowserContainer(this.hostTab.linkedBrowser);
 
     this._splitter = ownerDocument.createXULElement("splitter");
     this._splitter.setAttribute("class", "devtools-horizontal-splitter");
     // Avoid resizing notification containers
     this._splitter.setAttribute("resizebefore", "flex");
 
     this.frame = ownerDocument.createXULElement("iframe");
+    this.frame.setAttribute("type", "content");
     this.frame.flex = 1; // Required to be able to shrink when the window shrinks
     this.frame.className = "devtools-toolbox-bottom-iframe";
     this.frame.height = Math.min(
       Services.prefs.getIntPref(this.heightPref),
       this._browserContainer.clientHeight - MIN_PAGE_SIZE
     );
 
     this._browserContainer.appendChild(this._splitter);
@@ -140,16 +141,17 @@ class SidebarHost {
     const ownerDocument = gBrowser.ownerDocument;
     this._browserContainer = gBrowser.getBrowserContainer(this.hostTab.linkedBrowser);
     this._browserPanel = gBrowser.getPanel(this.hostTab.linkedBrowser);
 
     this._splitter = ownerDocument.createXULElement("splitter");
     this._splitter.setAttribute("class", "devtools-side-splitter");
 
     this.frame = ownerDocument.createXULElement("iframe");
+    this.frame.setAttribute("type", "content");
     this.frame.flex = 1; // Required to be able to shrink when the window shrinks
     this.frame.className = "devtools-toolbox-side-iframe";
 
     this.frame.width = Math.min(
       Services.prefs.getIntPref(this.widthPref),
       this._browserPanel.clientWidth - MIN_PAGE_SIZE
     );
 
diff --git a/devtools/client/framework/toolbox-window.xul b/devtools/client/framework/toolbox-window.xul
--- a/devtools/client/framework/toolbox-window.xul
+++ b/devtools/client/framework/toolbox-window.xul
@@ -9,10 +9,10 @@
 <window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
         id="devtools-toolbox-window"
         macanimationtype="document"
         fullscreenbutton="true"
         windowtype="devtools:toolbox"
         width="900" height="320"
         persist="screenX screenY width height sizemode">
   <tooltip id="aHTMLTooltip" page="true"/>
-  <iframe id="toolbox-iframe" flex="1" forceOwnRefreshDriver="" tooltip="aHTMLTooltip"></iframe>
+  <iframe id="toolbox-iframe" type="content" flex="1" forceOwnRefreshDriver="" tooltip="aHTMLTooltip"></iframe>
 </window>
