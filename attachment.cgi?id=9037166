# HG changeset patch
# User Victor Porof <vporof@mozilla.com>
# Date 1547718833 -3600
#      Thu Jan 17 10:53:53 2019 +0100
# Node ID 67a17a3ef2ef13421aeb6663d9f4904911577930
# Parent  a559b84032a8d570a64f0bb67ce917c9d696d4fc
Bug 1503826 - Remove the treerows binding, r=bgrins

diff --git a/toolkit/content/widgets/tree.xml b/toolkit/content/widgets/tree.xml
--- a/toolkit/content/widgets/tree.xml
+++ b/toolkit/content/widgets/tree.xml
@@ -13,19 +13,26 @@
    xmlns="http://www.mozilla.org/xbl"
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:xbl="http://www.mozilla.org/xbl">
 
   <binding id="tree" extends="chrome://global/content/bindings/general.xml#basecontrol">
     <content hidevscroll="true" hidehscroll="true" clickthrough="never">
       <children includes="treecols"/>
       <xul:stack class="tree-stack" flex="1">
-        <xul:treerows class="tree-rows" flex="1" xbl:inherits="hidevscroll">
-          <children/>
-        </xul:treerows>
+        <xul:hbox class="tree-rows" flex="1">
+          <xul:hbox flex="1" class="tree-bodybox">
+            <children/>
+          </xul:hbox>
+          <xul:scrollbar height="0" minwidth="0" minheight="0" orient="vertical" xbl:inherits="collapsed=hidevscroll" style="position:relative; z-index:2147483647;"
+            oncontextmenu="event.stopPropagation(); event.preventDefault();"
+            onclick="event.stopPropagation(); event.preventDefault();"
+            ondblclick="event.stopPropagation();"
+            oncommand="event.stopPropagation();"/>
+          </xul:hbox>
         <xul:textbox anonid="input" class="tree-input" left="0" top="0" hidden="true"/>
       </xul:stack>
       <xul:hbox xbl:inherits="collapsed=hidehscroll">
         <xul:scrollbar orient="horizontal" flex="1" increment="16" style="position:relative; z-index:2147483647;"
           oncontextmenu="event.stopPropagation(); event.preventDefault();"
           onclick="event.stopPropagation(); event.preventDefault();"
           ondblclick="event.stopPropagation();"
           oncommand="event.stopPropagation();"/>
@@ -596,16 +603,38 @@
           }
 
           return this.changeOpenState(this.currentIndex);
         ]]></body>
       </method>
     </implementation>
 
     <handlers>
+      <handler event="underflow">
+        <![CDATA[
+          // Scrollport event orientation
+          // 0: vertical
+          // 1: horizontal
+          // 2: both (not used)
+          if (event.detail == 1)
+            this.setAttribute("hidehscroll", "true");
+          else if (event.detail == 0)
+            this.setAttribute("hidevscroll", "true");
+          event.stopPropagation();
+        ]]>
+      </handler>
+      <handler event="overflow">
+        <![CDATA[
+          if (event.detail == 1)
+            this.removeAttribute("hidehscroll");
+          else if (event.detail == 0)
+            this.removeAttribute("hidevscroll");
+          event.stopPropagation();
+        ]]>
+      </handler>
       <handler event="touchstart">
         <![CDATA[
           function isScrollbarElement(target) {
             return (target.localName == "thumb" || target.localName == "slider")
                 && target.namespaceURI == "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";
           }
           if (event.touches.length > 1 || isScrollbarElement(event.touches[0].target)) {
             // Multiple touch points detected, abort. In particular this aborts
@@ -867,55 +896,16 @@
            }
            event.preventDefault();
          }
          ]]>
       </handler>
     </handlers>
   </binding>
 
-  <binding id="treerows" extends="chrome://global/content/bindings/general.xml#basecontrol">
-    <content>
-      <xul:hbox flex="1" class="tree-bodybox">
-        <children/>
-      </xul:hbox>
-      <xul:scrollbar height="0" minwidth="0" minheight="0" orient="vertical" xbl:inherits="collapsed=hidevscroll" style="position:relative; z-index:2147483647;"
-        oncontextmenu="event.stopPropagation(); event.preventDefault();"
-        onclick="event.stopPropagation(); event.preventDefault();"
-        ondblclick="event.stopPropagation();"
-        oncommand="event.stopPropagation();"/>
-    </content>
-    <handlers>
-      <handler event="underflow">
-        <![CDATA[
-          // Scrollport event orientation
-          // 0: vertical
-          // 1: horizontal
-          // 2: both (not used)
-          var tree = document.getBindingParent(this);
-          if (event.detail == 1)
-            tree.setAttribute("hidehscroll", "true");
-          else if (event.detail == 0)
-            tree.setAttribute("hidevscroll", "true");
-          event.stopPropagation();
-        ]]>
-      </handler>
-      <handler event="overflow">
-        <![CDATA[
-          var tree = document.getBindingParent(this);
-          if (event.detail == 1)
-            tree.removeAttribute("hidehscroll");
-          else if (event.detail == 0)
-            tree.removeAttribute("hidevscroll");
-          event.stopPropagation();
-        ]]>
-      </handler>
-    </handlers>
-  </binding>
-
   <binding id="columnpicker" display="xul:button"
            extends="chrome://global/content/bindings/general.xml#basecontrol">
     <content>
       <xul:image class="tree-columnpicker-icon"/>
       <xul:menupopup anonid="popup">
         <xul:menuseparator anonid="menuseparator"/>
         <xul:menuitem anonid="menuitem" label="&restoreColumnOrder.label;"/>
       </xul:menupopup>
diff --git a/toolkit/content/xul.css b/toolkit/content/xul.css
--- a/toolkit/content/xul.css
+++ b/toolkit/content/xul.css
@@ -439,20 +439,16 @@ treecolpicker {
 }
 
 tree > treechildren {
   display: -moz-box;
   -moz-user-select: none;
   -moz-box-flex: 1;
 }
 
-treerows {
-  -moz-binding: url("chrome://global/content/bindings/tree.xml#treerows");
-}
-
 treecolpicker {
   -moz-binding: url("chrome://global/content/bindings/tree.xml#columnpicker");
 }
 
 tree {
   -moz-box-orient: vertical;
   min-width: 0px;
   min-height: 0px;
