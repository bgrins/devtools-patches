# HG changeset patch
# Parent  8398e65a3d7e02ad66d0225a1ef2a8312e16ef8f

diff --git a/browser/components/controlcenter/content/protectionsPanel.inc.xul b/browser/components/controlcenter/content/protectionsPanel.inc.xul
--- a/browser/components/controlcenter/content/protectionsPanel.inc.xul
+++ b/browser/components/controlcenter/content/protectionsPanel.inc.xul
@@ -143,18 +143,17 @@
           <toolbarbutton id="protections-popup-show-report-button"
                          class="protections-popup-footer-button"
                          wrap="true"
                          oncommand="gProtectionsHandler.openProtections(true); gProtectionsHandler.recordClick('full_report');">
             <image class="protections-popup-footer-icon protections-popup-show-report-icon"/>
             <label class="protections-popup-footer-button-label" flex="1">&protections.showreport.label;</label>
           </toolbarbutton>
           <hbox id="protections-popup-trackers-blocked-counter-box"
-                align="center"
-                end="0">
+                align="center">
             <description id="protections-popup-trackers-blocked-counter-description"
                          onclick="gProtectionsHandler.openProtections(true);"/>
           </hbox>
         </stack>
       </vbox>
     </panelview>
 
     <!-- Site Not Working? SubView -->
diff --git a/browser/components/preferences/in-content/preferences.xul b/browser/components/preferences/in-content/preferences.xul
--- a/browser/components/preferences/in-content/preferences.xul
+++ b/browser/components/preferences/in-content/preferences.xul
@@ -64,17 +64,17 @@
   <script src="chrome://browser/content/preferences/in-content/subdialogs.js"/>
 
   <stringbundle id="pkiBundle"
                 src="chrome://pippki/locale/pippki.properties"/>
   <stringbundle id="browserBundle"
                 src="chrome://browser/locale/browser.properties"/>
 
   <stack flex="1">
-  <hbox flex="1">
+  <hbox>
 
     <vbox class="navigation">
       <!-- category list -->
       <richlistbox id="categories">
         <richlistitem id="category-general"
                       class="category"
                       value="paneGeneral"
                       helpTopic="prefs-main"
diff --git a/browser/themes/shared/controlcenter/panel.inc.css b/browser/themes/shared/controlcenter/panel.inc.css
--- a/browser/themes/shared/controlcenter/panel.inc.css
+++ b/browser/themes/shared/controlcenter/panel.inc.css
@@ -1080,16 +1080,17 @@ description#identity-popup-content-verif
   padding: var(--vertical-section-padding) 0;
 }
 
 #protections-popup-trackers-blocked-counter-box {
   margin-inline-end: var(--horizontal-padding);
   visibility: hidden;
   opacity: 0;
   transition: opacity 200ms linear;
+  justify-self: end;
 }
 
 #protections-popup-trackers-blocked-counter-box[showing] {
   visibility: visible;
   opacity: 1;
 }
 
 #protections-popup-trackers-blocked-counter-description {
diff --git a/browser/themes/shared/incontentprefs/preferences.inc.css b/browser/themes/shared/incontentprefs/preferences.inc.css
--- a/browser/themes/shared/incontentprefs/preferences.inc.css
+++ b/browser/themes/shared/incontentprefs/preferences.inc.css
@@ -18,16 +18,17 @@
 }
 
 * {
   -moz-user-select: text;
 }
 
 .main-content {
   padding-top: 0;
+  height: 0; /* Allow the stack to scroll */
 }
 
 .pane-container {
   /* A workaround to keep the container always float on the `top: 0` (Bug 1377009) */
   display: block;
   width: 664px;
 }
 
diff --git a/toolkit/content/widgets/toolbarbutton.js b/toolkit/content/widgets/toolbarbutton.js
--- a/toolkit/content/widgets/toolbarbutton.js
+++ b/toolkit/content/widgets/toolbarbutton.js
@@ -56,17 +56,17 @@
       return frag;
     }
 
     static get badgedFragment() {
       let frag = document.importNode(
         MozXULElement.parseXULToFragment(`
         <stack class="toolbarbutton-badge-stack">
           <image class="toolbarbutton-icon"/>
-          <label class="toolbarbutton-badge" top="0" end="0" crop="none"/>
+          <label class="toolbarbutton-badge" crop="none"/>
         </stack>
         <label class="toolbarbutton-text" crop="right" flex="1"/>
         <label class="toolbarbutton-multiline-text" flex="1"/>
         <dropmarker anonid="dropmarker" type="menu"
                     class="toolbarbutton-menu-dropmarker"/>`),
         true
       );
       Object.defineProperty(this, "badgedFragment", { value: frag });
diff --git a/toolkit/content/xul.css b/toolkit/content/xul.css
--- a/toolkit/content/xul.css
+++ b/toolkit/content/xul.css
@@ -384,17 +384,27 @@ treechildren::-moz-tree-cell(ltr) {
 
 /********** deck & stack *********/
 
 deck {
   display: -moz-deck;
 }
 
 stack {
-  display: -moz-stack;
+  display: grid;
+}
+
+stack > * {
+  grid-area: 1 / 1;
+  /* z-index: 1; */
+  position: relative;
+  height: 100%;
+  width: 100%;
+  /* inline-size: 100%; */
+  -moz-box-flex: 0;
 }
 
 /********** tabbox *********/
 
 tabbox {
   -moz-box-orient: vertical;
 }
 
diff --git a/toolkit/themes/osx/global/toolbarbutton.css b/toolkit/themes/osx/global/toolbarbutton.css
--- a/toolkit/themes/osx/global/toolbarbutton.css
+++ b/toolkit/themes/osx/global/toolbarbutton.css
@@ -48,16 +48,18 @@ toolbarbutton[disabled="true"] {
               0 1px 0 hsla(206, 50%, 10%, .2);
   margin: -6px 0 0 !important;
   margin-inline-end: -6px !important;
   min-width: 14px;
   max-width: 28px;
   line-height: 10px;
   text-align: center;
   -moz-stack-sizing: ignore;
+  align-self: start;
+  justify-self: end;
 }
 
 toolbar[mode="icons"] > *|* > .toolbarbutton-badge {
   margin-inline-end: -10px !important;
 }
 
 toolbarbutton.tabbable {
   -moz-user-focus: normal !important;
