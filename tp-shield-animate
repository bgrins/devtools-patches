# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  7493f7d4086814aad45547f68df3e97cb579eeda
Bug 1175858 - TP shield should be animated when TP has blocked content on the page;r=MattN

diff --git a/browser/base/content/browser.js b/browser/base/content/browser.js
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -6807,27 +6807,27 @@ var gIdentityHandler = {
       this.setMode(this.IDENTITY_MODE_UNKNOWN);
     }
 
     // Show the doorhanger when:
     // - mixed active content is blocked
     // - mixed active content is loaded (detected but not blocked)
     // - tracking content is blocked
     // - tracking content is not blocked
-    if (state &
-        (nsIWebProgressListener.STATE_BLOCKED_MIXED_ACTIVE_CONTENT |
-         nsIWebProgressListener.STATE_LOADED_MIXED_ACTIVE_CONTENT  |
-         nsIWebProgressListener.STATE_BLOCKED_TRACKING_CONTENT     |
-         nsIWebProgressListener.STATE_LOADED_TRACKING_CONTENT)) {
-      this.showBadContentDoorhanger(state);
-    } else if (TrackingProtection.enabled) {
-      // We didn't show the shield
-      Services.telemetry.getHistogramById("TRACKING_PROTECTION_SHIELD")
-        .add(0);
-    }
+    // if (state &
+    //     (nsIWebProgressListener.STATE_BLOCKED_MIXED_ACTIVE_CONTENT |
+    //      nsIWebProgressListener.STATE_LOADED_MIXED_ACTIVE_CONTENT  |
+    //      nsIWebProgressListener.STATE_BLOCKED_TRACKING_CONTENT     |
+    //      nsIWebProgressListener.STATE_LOADED_TRACKING_CONTENT)) {
+    //   this.showBadContentDoorhanger(state);
+    // } else if (TrackingProtection.enabled) {
+    //   // We didn't show the shield
+    //   Services.telemetry.getHistogramById("TRACKING_PROTECTION_SHIELD")
+    //     .add(0);
+    // }
   },
 
   showBadContentDoorhanger : function(state) {
     var currentNotification =
       PopupNotifications.getNotification("bad-content",
         gBrowser.selectedBrowser);
 
     // Avoid showing the same notification (same state) repeatedly.
diff --git a/browser/themes/shared/identity-block/identity-block.inc.css b/browser/themes/shared/identity-block/identity-block.inc.css
--- a/browser/themes/shared/identity-block/identity-block.inc.css
+++ b/browser/themes/shared/identity-block/identity-block.inc.css
@@ -38,16 +38,17 @@
 %endif
 }
 
 #identity-box {
   background-position: right;
   background-size: 1px;
   background-repeat: no-repeat;
   background-image: var(--identity-box-background-image);
+  overflow: hidden;
 }
 
 #identity-box:-moz-locale-dir(rtl) {
   background-position: left;
 }
 
 #identity-box:hover,
 #identity-box[open=true] {
@@ -65,24 +66,31 @@
 }
 
 /* TRACKING PROTECTION ICON */
 
 #tracking-protection-icon {
   width: 16px;
   height: 16px;
   list-style-image: url(chrome://browser/skin/tracking-protection-16.svg);
+  margin-left: 0;
+  transition: margin-left 200ms ease-out;
+  opacity: 1;
 }
 
 #tracking-protection-icon[state="loaded-tracking-content"] {
   list-style-image: url(chrome://browser/skin/tracking-protection-disabled-16.svg);
 }
 
 #tracking-protection-icon:not([state]) {
-  display: none;
+  margin-left: -16px;
+  pointer-events: none;
+  opacity: 0;
+  /* Only animate the shield in, when it disappears hide it immediately. */
+  transition: none;
 }
 
 /* MAIN IDENTITY ICON */
 
 #page-proxy-favicon {
   width: 16px;
   height: 16px;
   list-style-image: url(chrome://browser/skin/identity-not-secure.svg);
