
# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1519161562 28800
# Node ID 8c199328cb0e19b6d1a337436f2e89e5d9ea64d9
# Parent  861067332bac96a44bbf41ef366f58a30476057b
Bug 1439616 - Enable the new frontend in the Browser Console in nightly builds;r=nchevobbe

MozReview-Commit-ID: GQsNstY9jFB

diff --git a/devtools/client/preferences/devtools.js b/devtools/client/preferences/devtools.js
--- a/devtools/client/preferences/devtools.js
+++ b/devtools/client/preferences/devtools.js
@@ -311,17 +311,21 @@
 // Web Console automatic multiline mode: |true| if you want incomplete statements
 // to automatically trigger multiline editing (equivalent to shift + enter).
 pref("devtools.webconsole.autoMultiline", true);
 
 // Enable the new webconsole frontend
 pref("devtools.webconsole.new-frontend-enabled", true);
 
 // Enable the new webconsole frontend in the browser console
+#if defined(NIGHTLY_BUILD)
+pref("devtools.browserconsole.new-frontend-enabled", true);
+#else
 pref("devtools.browserconsole.new-frontend-enabled", false);
+#endif
 
 // Enable the webconsole sidebar toggle
 pref("devtools.webconsole.sidebarToggle", false);
 
 // Disable the new performance recording panel by default
 pref("devtools.performance.new-panel-enabled", false);
 
 // Enable client-side mapping service for source maps
diff --git a/devtools/client/webconsole/test/head.js b/devtools/client/webconsole/test/head.js
--- a/devtools/client/webconsole/test/head.js
+++ b/devtools/client/webconsole/test/head.js
@@ -40,16 +40,21 @@
 var WCUL10n = require("devtools/client/webconsole/webconsole-l10n");
 
 const DOCS_GA_PARAMS = "?utm_source=mozilla" +
                        "&utm_medium=firefox-console-errors" +
                        "&utm_campaign=default";
 
 flags.testing = true;
 
+Services.prefs.setBoolPref("devtools.browserconsole.new-frontend-enabled", false);
+registerCleanupFunction(async function () {
+  Services.prefs.clearUserPref("devtools.browserconsole.new-frontend-enabled");
+});
+
 function loadTab(url, preferredRemoteType) {
   return addTab(url, { preferredRemoteType }).then( tab => {
     return { tab, browser: tab.linkedBrowser };
   });
 }
 
 function loadBrowser(browser) {
   return BrowserTestUtils.browserLoaded(browser);

