# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  a12d60c18af96fbd0a5064b8a1daf2adb3476b20
Bug 1214663 - Make CodeMirror not break when encountering a <constructor> tag;r=Gijs

diff --git a/devtools/client/sourceeditor/codemirror/mode/htmlmixed.js b/devtools/client/sourceeditor/codemirror/mode/htmlmixed.js
--- a/devtools/client/sourceeditor/codemirror/mode/htmlmixed.js
+++ b/devtools/client/sourceeditor/codemirror/mode/htmlmixed.js
@@ -84,18 +84,18 @@
     var tags = {};
     var configTags = parserConfig && parserConfig.tags, configScript = parserConfig && parserConfig.scriptTypes;
     addTags(defaultTags, tags);
     if (configTags) addTags(configTags, tags);
     if (configScript) for (var i = configScript.length - 1; i >= 0; i--)
       tags.script.unshift(["type", configScript[i].matches, configScript[i].mode])
 
     function html(stream, state) {
-      var tagName = state.htmlState.tagName;
-      var tagInfo = tagName && tags[tagName.toLowerCase()];
+      var tagName = state.htmlState.tagName && state.htmlState.tagName.toLowerCase();
+      var tagInfo = tagName && tags.hasOwnProperty(tagName) && tags[tagName];
 
       var style = htmlMode.token(stream, state.htmlState), modeSpec;
 
       if (tagInfo && /\btag\b/.test(style) && stream.current() === ">" &&
           (modeSpec = findMatchingMode(tagInfo, stream))) {
         var mode = CodeMirror.getMode(config, modeSpec);
         var endTagA = getTagRegexp(tagName, true), endTag = getTagRegexp(tagName, false);
         state.token = function (stream, state) {
