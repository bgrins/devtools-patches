# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  5c1b92397903a2a5885707c664bc6dafd5a5e657
Bug 1608278 - Remove global `this` setter for LOG_LEVEL in Credentials.jsm

We need to stop relying on the global `this` in order to support ES Modules.
This instance was harder to fix by a script than others since it is in a try/catch,
so this patch is a manual change.

diff --git a/services/fxaccounts/Credentials.jsm b/services/fxaccounts/Credentials.jsm
--- a/services/fxaccounts/Credentials.jsm
+++ b/services/fxaccounts/Credentials.jsm
@@ -27,24 +27,23 @@ const PBKDF2_ROUNDS = 1000;
 const STRETCHED_PW_LENGTH_BYTES = 32;
 const HKDF_SALT = CommonUtils.hexToBytes("00");
 const HKDF_LENGTH = 32;
 
 // loglevel preference should be one of: "FATAL", "ERROR", "WARN", "INFO",
 // "CONFIG", "DEBUG", "TRACE" or "ALL". We will be logging error messages by
 // default.
 const PREF_LOG_LEVEL = "identity.fxaccounts.loglevel";
+let LOG_LEVEL = Log.Level.Error;
 try {
-  this.LOG_LEVEL =
+  LOG_LEVEL =
     Services.prefs.getPrefType(PREF_LOG_LEVEL) ==
       Ci.nsIPrefBranch.PREF_STRING &&
     Services.prefs.getCharPref(PREF_LOG_LEVEL);
-} catch (e) {
-  this.LOG_LEVEL = Log.Level.Error;
-}
+} catch (e) {}
 
 var log = Log.repository.getLogger("Identity.FxAccounts");
 log.level = LOG_LEVEL;
 log.addAppender(new Log.ConsoleAppender(new Log.BasicFormatter()));
 
 var Credentials = Object.freeze({
   /**
    * Make constants accessible to tests
