# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  128f438c1a9f7291bd892a4ec608dd939bf0a063
Bug 1173604 - Editing a css property auto-inserts autocomplete text

diff --git a/devtools/client/shared/autocomplete-popup.js b/devtools/client/shared/autocomplete-popup.js
--- a/devtools/client/shared/autocomplete-popup.js
+++ b/devtools/client/shared/autocomplete-popup.js
@@ -164,16 +164,22 @@ AutocompletePopup.prototype = {
   /**
    * Check if the autocomplete popup is open.
    */
   get isOpen() {
     return this._panel &&
            (this._panel.state == "open" || this._panel.state == "showing");
   },
 
+  ensureSelectedIndexIsVisible: function() {
+    if (this._list.ensureIndexIsVisible) {
+      this._list.ensureIndexIsVisible(this._list.selectedIndex);
+    }
+  },
+
   /**
    * Destroy the object instance. Please note that the panel DOM elements remain
    * in the DOM, because they might still be in use by other instances of the
    * same code. It is the responsability of the client code to perform DOM
    * cleanup.
    */
   destroy: function AP_destroy()
   {
@@ -261,17 +267,17 @@ AutocompletePopup.prototype = {
   selectFirstItem: function AP_selectFirstItem()
   {
     if (this.position.includes("before")) {
       this.selectedIndex = this.itemCount - 1;
     }
     else {
       this.selectedIndex = 0;
     }
-    this._list.ensureIndexIsVisible(this._list.selectedIndex);
+    this.ensureSelectedIndexIsVisible();
   },
 
   __maxLabelLength: -1,
 
   get _maxLabelLength() {
     if (this.__maxLabelLength != -1) {
       return this.__maxLabelLength;
     }
@@ -297,17 +303,17 @@ AutocompletePopup.prototype = {
    */
   _updateSize: function AP__updateSize()
   {
     if (!this._panel) {
       return;
     }
 
     this._list.style.width = (this._maxLabelLength + 3) +"ch";
-    this._list.ensureIndexIsVisible(this._list.selectedIndex);
+    this.ensureSelectedIndexIsVisible();
   },
 
   /**
    * Update accessibility appropriately when the selected item is changed.
    *
    * @private
    */
   _updateAriaActiveDescendant: function AP__updateAriaActiveDescendant()
@@ -359,18 +365,18 @@ AutocompletePopup.prototype = {
   /**
    * Setter for the selected index.
    *
    * @param number aIndex
    *        The number (index) of the item you want to select in the list.
    */
   set selectedIndex(aIndex) {
     this._list.selectedIndex = aIndex;
-    if (this.isOpen && this._list.ensureIndexIsVisible) {
-      this._list.ensureIndexIsVisible(this._list.selectedIndex);
+    if (this.isOpen) {
+      this.ensureSelectedIndexIsVisible();
     }
     this._updateAriaActiveDescendant();
   },
 
   /**
    * Getter for the selected item.
    * @type object
    */
@@ -383,17 +389,17 @@ AutocompletePopup.prototype = {
    * Setter for the selected item.
    *
    * @param object aItem
    *        The object you want selected in the list.
    */
   set selectedItem(aItem) {
     this._list.selectedItem = this._findListItem(aItem);
     if (this.isOpen) {
-      this._list.ensureIndexIsVisible(this._list.selectedIndex);
+      this.ensureSelectedIndexIsVisible();
     }
     this._updateAriaActiveDescendant();
   },
 
   /**
    * Append an item into the autocomplete list.
    *
    * @param object aItem
