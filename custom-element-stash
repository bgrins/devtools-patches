# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  464b2a3c25aa1065760d9ecbb0870bca4a66c62e

diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -198,17 +198,17 @@
            tabspecific="true"
            onpopupshown="StarUI.panelShown(event);"
            aria-labelledby="editBookmarkPanelTitle">
       <row id="editBookmarkPanelHeader" align="center" hidden="true">
         <vbox align="center">
           <image id="editBookmarkPanelStarIcon"/>
         </vbox>
         <vbox>
-          <label id="editBookmarkPanelTitle"/>
+          <html:accesskey-label id="editBookmarkPanelTitle"/>
           <description id="editBookmarkPanelDescription"/>
         </vbox>
       </row>
       <vbox id="editBookmarkPanelContent" flex="1" hidden="true"/>
       <hbox id="editBookmarkPanelBottomButtons" pack="end">
 #ifndef XP_UNIX
         <button id="editBookmarkPanelDoneButton"
                 class="editBookmarkPanelBottomButton"
@@ -242,17 +242,17 @@
            align="start"
            orient="vertical"
            role="alert">
      <vbox>
       <hbox id="UITourTooltipBody">
         <image id="UITourTooltipIcon"/>
         <vbox flex="1">
           <hbox id="UITourTooltipTitleContainer">
-            <label id="UITourTooltipTitle" flex="1"/>
+            <html:accesskey-label id="UITourTooltipTitle" flex="1"/>
             <toolbarbutton id="UITourTooltipClose" class="close-icon"
                            tooltiptext="&uiTour.infoPanel.close;"/>
           </hbox>
           <description id="UITourTooltipDescription" flex="1"/>
         </vbox>
       </hbox>
       <hbox id="UITourTooltipButtons" flex="1" align="center"/>
      </vbox>
@@ -504,36 +504,36 @@
     </panel>
 
     <!-- Bookmarks and history tooltip -->
     <tooltip id="bhTooltip"/>
 
     <tooltip id="tabbrowser-tab-tooltip" onpopupshowing="gBrowser.createTooltip(event);"/>
 
     <tooltip id="back-button-tooltip">
-      <label class="tooltip-label" value="&backButton.tooltip;"/>
+      <html:accesskey-label class="tooltip-label" value="&backButton.tooltip;"/>
 #ifdef XP_MACOSX
-      <label class="tooltip-label" value="&backForwardButtonMenuMac.tooltip;"/>
+      <html:accesskey-label class="tooltip-label" value="&backForwardButtonMenuMac.tooltip;"/>
 #else
-      <label class="tooltip-label" value="&backForwardButtonMenu.tooltip;"/>
+      <html:accesskey-label class="tooltip-label" value="&backForwardButtonMenu.tooltip;"/>
 #endif
     </tooltip>
 
     <tooltip id="forward-button-tooltip">
-      <label class="tooltip-label" value="&forwardButton.tooltip;"/>
+      <html:accesskey-label class="tooltip-label" value="&forwardButton.tooltip;"/>
 #ifdef XP_MACOSX
-      <label class="tooltip-label" value="&backForwardButtonMenuMac.tooltip;"/>
+      <html:accesskey-label class="tooltip-label" value="&backForwardButtonMenuMac.tooltip;"/>
 #else
-      <label class="tooltip-label" value="&backForwardButtonMenu.tooltip;"/>
+      <html:accesskey-label class="tooltip-label" value="&backForwardButtonMenu.tooltip;"/>
 #endif
     </tooltip>
 
     <tooltip id="share-button-tooltip" onpopupshowing="SocialShare.createTooltip(event);">
-      <label class="tooltip-label"/>
-      <label class="tooltip-label"/>
+      <html:accesskey-label class="tooltip-label"/>
+      <html:accesskey-label class="tooltip-label"/>
     </tooltip>
 
 #include popup-notifications.inc
 
 #include ../../components/customizableui/content/panelUI.inc.xul
 #include ../../components/controlcenter/content/panel.inc.xul
 
     <hbox id="downloads-animation-container" mousethrough="always">
@@ -884,23 +884,23 @@
                   <image id="persistent-storage-notification-icon" class="notification-anchor-icon persistent-storage-icon" role="button"
                          tooltiptext="&urlbar.persistentStorageNotificationAnchor.tooltip;"/>
                 </box>
                 <image id="connection-icon"/>
                 <image id="extension-icon"/>
                 <image id="remote-control-icon"
                        tooltiptext="&urlbar.remoteControlNotificationAnchor.tooltip;"/>
                 <hbox id="identity-icon-labels">
-                  <label id="identity-icon-label" class="plain" flex="1"/>
-                  <label id="identity-icon-country-label" class="plain"/>
+                  <html:accesskey-label id="identity-icon-label" class="plain" flex="1"/>
+                  <html:accesskey-label id="identity-icon-country-label" class="plain"/>
                 </hbox>
               </box>
               <box id="urlbar-display-box" align="center">
-                <label id="switchtab" class="urlbar-display urlbar-display-switchtab" value="&urlbar.switchToTab.label;"/>
-                <label id="extension" class="urlbar-display urlbar-display-extension" value="&urlbar.extension.label;"/>
+                <html:accesskey-label id="switchtab" class="urlbar-display urlbar-display-switchtab" value="&urlbar.switchToTab.label;"/>
+                <html:accesskey-label id="extension" class="urlbar-display urlbar-display-extension" value="&urlbar.extension.label;"/>
               </box>
               <hbox id="urlbar-icons">
                 <image id="page-report-button"
                        class="urlbar-icon"
                        hidden="true"
                        tooltiptext="&pageReportIcon.tooltip;"
                        onmousedown="gPopupBlockerObserver.onReportButtonMousedown(event);"/>
                 <image id="reader-mode-button"
@@ -908,17 +908,17 @@
                        hidden="true"
                        onclick="ReaderParent.buttonClick(event);"/>
                 <toolbarbutton id="urlbar-zoom-button"
                        onclick="FullZoom.reset();"
                        tooltip="dynamic-shortcut-tooltip"
                        hidden="true"/>
               </hbox>
               <hbox id="userContext-icons" hidden="true">
-                <label id="userContext-label"/>
+                <html:accesskey-label id="userContext-label"/>
                 <image id="userContext-indicator"/>
               </hbox>
 #ifndef MOZ_PHOTON_THEME
               <toolbarbutton id="urlbar-go-button"
                              class="chromeclass-toolbar-additional"
                              onclick="gURLBar.handleCommand(event);"
                              tooltiptext="&goEndCap.tooltip;"/>
               <toolbarbutton id="reload-button"
@@ -1210,17 +1210,17 @@
 
   <deck id="content-deck" flex="1">
     <hbox flex="1" id="browser">
       <vbox id="browser-border-start" hidden="true" layer="true"/>
       <vbox id="sidebar-box" hidden="true" class="chromeclass-extrachrome">
         <sidebarheader id="sidebar-header" align="center">
           <toolbarbutton id="sidebar-switcher-target" flex="1" class="tabbable">
             <image id="sidebar-icon" consumeanchor="sidebar-switcher-target"/>
-            <label id="sidebar-title" persist="value" crop="end" flex="1" control="sidebar"/>
+            <html:accesskey-label id="sidebar-title" persist="value" crop="end" flex="1" control="sidebar"/>
             <image id="sidebar-switcher-arrow"/>
           </toolbarbutton>
           <image id="sidebar-throbber"/>
 # To ensure the button label's intrinsic width doesn't expand the sidebar
 # if the label is long, the button needs flex=1.
 # To ensure the button doesn't expand unnecessarily for short labels, the
 # spacer should significantly out-flex the button.
           <spacer flex="1000"/>
@@ -1292,16 +1292,18 @@
     </svg:clipPath>
 #ifdef XP_WIN
     <svg:clipPath id="urlbar-back-button-clip-path-win10">
       <svg:path d="M -6,-2 l 0,1 a 15 15 0 0,1 0,30 l 0,1 l 10000,0 l 0,-32 l -10000,0 z" />
     </svg:clipPath>
 #endif
 #endif
   </svg:svg>
-
 </vbox>
 # <iframe id="tab-view"> is dynamically appended as the 2nd child of #tab-view-deck.
 #     Introducing the iframe dynamically, as needed, was found to be better than
 #     starting with an empty iframe here in browser.xul from a Ts standpoint.
 </deck>
 
+<script type="application/javascript" src="chrome://browser/content/customelements/custom-elements.js"/>
+<script type="application/javascript" src="chrome://browser/content/customelements/base-element.js"/>
+<script type="application/javascript" src="chrome://browser/content/customelements/access-key-label.js"/>
 </window>
diff --git a/browser/base/content/customelements/access-key-label.js b/browser/base/content/customelements/access-key-label.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/customelements/access-key-label.js
@@ -0,0 +1,232 @@
+class AccessKeyLabel extends BaseElement {
+  constructor() {
+    super();
+    console.log("AccessKeyLabel constructor");
+  }
+  connectedCallback() {
+    super.connectedCallback();
+    console.log("AccessKeyLabel connectedCallback", this, this.parentNode);
+
+    const textContent = this.textContent;
+    // this.attachShadow({mode: 'open'});
+    const shadowRoot = this; // .shadowRoot
+
+    shadowRoot.innerHTML = `<html:label inherits="for=control,text=value"></html:label><html:span anonid="accessKeyParens"></html:span>`;
+
+    if (textContent) {
+      this.htmlLabelElement.textContent = textContent;
+    }
+    this.formatAccessKey(true);
+  }
+  disconnectedCallback() {}
+
+  get htmlLabelElement() {
+    return this.querySelector("label");
+  }
+
+  set accessKey(val) {
+    // If this label already has an accesskey attribute store it here as well
+    if (this.hasAttribute("accesskey")) {
+      this.setAttribute("accesskey", val);
+    }
+    var control = this.labeledControlElement;
+    if (control) {
+      control.setAttribute("accesskey", val);
+    }
+    this.formatAccessKey(false);
+    return val;
+  }
+
+  get accessKey() {
+    var accessKey = null;
+    var labeledEl = this.labeledControlElement;
+    if (labeledEl) {
+      accessKey = labeledEl.getAttribute("accesskey");
+    }
+    if (!accessKey) {
+      accessKey = this.getAttribute("accesskey");
+    }
+    return accessKey ? accessKey[0] : null;
+  }
+
+  get labeledControlElement() {
+    var control = this.control;
+    return control ? document.getElementById(control) : null;
+  }
+
+  get value() {
+    return this.getAttribute("value");
+  }
+
+  set value(val) {
+    this.setAttribute("value", val);
+    this.formatAccessKey(false);
+  }
+
+  set control(val) {
+    var control = this.labeledControlElement;
+    if (control) {
+      control.labelElement = null; // No longer pointed to be this label
+    }
+    this.setAttribute("control", val);
+    this.formatAccessKey(false);
+    return val;
+  }
+
+  get control() {
+    return this.getAttribute("control") || this.getAttribute("for");
+  }
+  formatAccessKey(firstTime) {
+    var control = this.labeledControlElement;
+    // if (!control) {
+    //   var bindingParent = document.getBindingParent(this);
+    //   if (
+    //     bindingParent instanceof
+    //     Components.interfaces.nsIDOMXULLabeledControlElement
+    //   ) {
+    //     control = bindingParent; // For controls that make the <label> an anon child
+    //   }
+    // }
+    // if (control) {
+    //   control.labelElement = this;
+    // }
+
+    var accessKey = this.accessKey;
+    // No need to remove existing formatting the first time.
+    if (firstTime && !accessKey) return;
+
+    if (this.mInsertSeparator === undefined) {
+      this.mUnderlineAccesskey = true;
+      this.mInsertSeparator = this.mAlwaysAppendAccessKey = false;
+      // try {
+      //   var prefs = Components.classes[
+      //     "@mozilla.org/preferences-service;1"
+      //   ].getService(Components.interfaces.nsIPrefBranch);
+      //   this.mUnderlineAccesskey = prefs.getIntPref("ui.key.menuAccessKey") != 0;
+
+      //   const nsIPrefLocalizedString =
+      //     Components.interfaces.nsIPrefLocalizedString;
+
+      //   const prefNameInsertSeparator =
+      //     "intl.menuitems.insertseparatorbeforeaccesskeys";
+      //   const prefNameAlwaysAppendAccessKey =
+      //     "intl.menuitems.alwaysappendaccesskeys";
+
+      //   var val = prefs.getComplexValue(
+      //     prefNameInsertSeparator,
+      //     nsIPrefLocalizedString
+      //   ).data;
+      //   this.mInsertSeparator = val == "true";
+
+      //   val = prefs.getComplexValue(
+      //     prefNameAlwaysAppendAccessKey,
+      //     nsIPrefLocalizedString
+      //   ).data;
+      //   this.mAlwaysAppendAccessKey = val == "true";
+      // } catch (e) {
+      //   this.mInsertSeparator = true;
+      // }
+    }
+
+    if (!this.mUnderlineAccesskey) return;
+    const shadowRoot = this; //.shadowRoot;
+
+    var afterLabel = shadowRoot.querySelector("[anonid=accessKeyParens]");
+    afterLabel.textContent = "";
+
+    var oldAccessKey = shadowRoot.querySelector(".accesskey");
+    if (oldAccessKey) {
+      // Clear old accesskey
+      this.mergeElement(oldAccessKey);
+    }
+
+    var oldHiddenSpan = shadowRoot.querySelector(".hiddenColon");
+    if (oldHiddenSpan) {
+      this.mergeElement(oldHiddenSpan);
+    }
+
+    var labelText = shadowRoot.textContent;
+    if (!accessKey || !labelText || !control) {
+      return;
+    }
+    var accessKeyIndex = -1;
+    if (!this.mAlwaysAppendAccessKey) {
+      accessKeyIndex = labelText.indexOf(accessKey);
+      if (accessKeyIndex < 0) {
+        // Try again in upper case
+        accessKeyIndex = labelText
+          .toUpperCase()
+          .indexOf(accessKey.toUpperCase());
+      }
+    }
+
+    const HTML_NS = "http://www.w3.org/1999/xhtml";
+    var span = document.createElementNS(HTML_NS, "span");
+    span.className = "accesskey";
+
+    // Note that if you change the following code, see the comment of
+    // nsTextBoxFrame::UpdateAccessTitle.
+
+    // If accesskey is not in string, append in parentheses
+    if (accessKeyIndex < 0) {
+      // If end is colon, we should insert before colon.
+      // i.e., "label:" -> "label(X):"
+      var colonHidden = false;
+      if (/:$/.test(labelText)) {
+        labelText = labelText.slice(0, -1);
+        var hiddenSpan = document.createElementNS(HTML_NS, "span");
+        hiddenSpan.className = "hiddenColon";
+        hiddenSpan.style.display = "none";
+        // Hide the last colon by using span element.
+        // I.e., label<span style="display:none;">:</span>
+        this.wrapChar(hiddenSpan, labelText.length);
+        colonHidden = true;
+      }
+      // If end is space(U+20),
+      // we should not add space before parentheses.
+      var endIsSpace = false;
+      if (/ $/.test(labelText)) {
+        endIsSpace = true;
+      }
+      if (this.mInsertSeparator && !endIsSpace) afterLabel.textContent = " (";
+      else afterLabel.textContent = "(";
+      span.textContent = accessKey.toUpperCase();
+      afterLabel.appendChild(span);
+      if (!colonHidden) afterLabel.appendChild(document.createTextNode(")"));
+      else afterLabel.appendChild(document.createTextNode("):"));
+      return;
+    }
+    this.wrapChar(span, accessKeyIndex);
+  }
+  wrapChar(element, index) {
+    var treeWalker = document.createTreeWalker(
+      this,
+      NodeFilter.SHOW_TEXT,
+      null
+    );
+    var node = treeWalker.nextNode();
+    while (index >= node.length) {
+      index -= node.length;
+      node = treeWalker.nextNode();
+    }
+    if (index) {
+      node = node.splitText(index);
+    }
+    node.parentNode.insertBefore(element, node);
+    if (node.length > 1) {
+      node.splitText(1);
+    }
+    element.appendChild(node);
+  }
+  mergeElement(element) {
+    if (element.previousSibling instanceof Text) {
+      element.previousSibling.appendData(element.textContent);
+    } else {
+      element.parentNode.insertBefore(element.firstChild, element);
+    }
+    element.remove();
+  }
+}
+customElements.define("accesskey-label", AccessKeyLabel);
+console.log("Defining", "accesskey-label", AccessKeyLabel, customElements);
+
diff --git a/browser/base/content/customelements/base-element.js b/browser/base/content/customelements/base-element.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/customelements/base-element.js
@@ -0,0 +1,146 @@
+
+
+// https://html.spec.whatwg.org/multipage/scripting.html#custom-elements-autonomous-example
+
+class BaseElement extends HTMLElement {
+  constructor() {
+    super();
+    this.observerConnector = new ObserverConnector(this);
+    this.inheritsConnector = new InheritsConnector(this);
+  }
+
+  connectedCallback() {
+
+  }
+
+  disconnectedCallback() {
+
+  }
+
+  static get observedAttributes() { return ["observes"]; }
+
+  attributeChangedCallback(name, oldValue, newValue) {
+    if (name === "observes") {
+      this.observerConnector.watch(newValue);
+    }
+  }
+}
+
+function InheritsConnector(host) {
+  this._host = host;
+  this._nodesToAttributes = new Map();
+  this.watch();
+}
+InheritsConnector.prototype.destroy = function() {
+
+}
+InheritsConnector.prototype.setInherits = function(node) {
+  let inherits = node.getAttribute("inherits");
+  if (inherits) {
+    this._nodesToAttributes.set(node, inherits.split(','));
+  }
+}
+InheritsConnector.prototype.copyAttribute = function(attributeName) {
+  if (attributeName === "id") {
+    return;
+  }
+
+  for (let [node, list] of this._nodesToAttributes.entries()) {
+    // Handle both inherits="accesskey" and inherits="text=label"
+    list.forEach(a => {
+      if (a === attributeName) {
+        node.setAttribute(a, this._host.getAttribute(a));
+      } else if (a.endsWith('=' + attributeName)) {
+        let mapFrom = a.split('=')[1];
+        let mapTo = a.split('=')[0];
+        if (mapTo === "text") {
+          console.log("Copying text", this._host.getAttribute(mapFrom), this._host, this._host.parentNode);
+          node.textContent = this._host.getAttribute(mapFrom);
+        } else {
+          node.setAttribute(mapTo, this._host.getAttribute(a));
+        }
+      }
+    });
+  }
+};
+
+InheritsConnector.prototype.watch = function() {
+  if (this._observer) {
+    this._observer.disconnect();
+    this._observer = null;
+  }
+
+  this._observer = new MutationObserver(mutations => {
+    mutations.forEach(mutation => {
+      if (mutation.type === "childList") {
+        mutation.addedNodes.forEach(added => {
+          if (added.nodeType !== 1) {
+            return;
+          }
+          this.setInherits(added);
+          [...added.querySelectorAll("[inherits]")].forEach(child => this.setInherits(child));
+          for (var i = 0; i < this._host.attributes.length; i++) {
+            var attrib = this._host.attributes[i];
+            this.copyAttribute(attrib.name);
+          }
+        });
+      }
+
+      if (mutation.type === "attributes" && mutation.target === this._host) {
+        this.copyAttribute(mutation.attributeName);
+      }
+    });
+
+    // this.copyAttributes();
+  });
+  this._observer.observe(this._host, {
+    attributes: true,
+    subtree: true,
+    childList: true,
+  });
+
+}
+
+function ObserverConnector(host) {
+  this._host = host;
+}
+ObserverConnector.prototype.destroy = function() {
+
+}
+
+ObserverConnector.prototype.copyAttributes = function() {
+  if (!this._observeTarget) {
+    return;
+  }
+
+  for (var i = 0; i < this._observeTarget.attributes.length; i++) {
+    var attrib = this._observeTarget.attributes[i];
+    if (attrib.name !== "id") {
+      this._host.setAttribute(attrib.name, attrib.value);
+    }
+  }
+}
+
+ObserverConnector.prototype.watch = function(targetID) {
+  if (this._observer) {
+    this._observer.disconnect();
+    this._observer = null;
+  }
+
+  this._observeTarget = document.getElementById(targetID);
+  if (this._observeTarget) {
+    this._observer = new MutationObserver(mutations => {
+      mutations.forEach(mutation => {
+        if (!this._observeTarget.hasAttribute(mutation.attributeName)) {
+          this.removeAttribute(mutation.attributeName);
+        }
+      });
+
+      this.copyAttributes();
+    });
+    this._observer.observe(this._observeTarget, {
+      attributes: true,
+    });
+    this.copyAttributes();
+  }
+}
diff --git a/browser/base/content/customelements/custom-elements.js b/browser/base/content/customelements/custom-elements.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/customelements/custom-elements.js
@@ -0,0 +1,37 @@
+(function(){
+'use strict';var g=new function(){};var aa=new Set("annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" "));function k(b){var a=aa.has(b);b=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(b);return!a&&b}function l(b){var a=b.isConnected;if(void 0!==a)return a;for(;b&&!(b.__CE_isImportDocument||b instanceof Document);)b=b.parentNode||(window.ShadowRoot&&b instanceof ShadowRoot?b.host:void 0);return!(!b||!(b.__CE_isImportDocument||b instanceof Document))}
+function m(b,a){for(;a&&a!==b&&!a.nextSibling;)a=a.parentNode;return a&&a!==b?a.nextSibling:null}
+function n(b,a,e){e=e?e:new Set;for(var c=b;c;){if(c.nodeType===Node.ELEMENT_NODE){var d=c;a(d);var h=d.localName;if("link"===h&&"import"===d.getAttribute("rel")){c=d.import;if(c instanceof Node&&!e.has(c))for(e.add(c),c=c.firstChild;c;c=c.nextSibling)n(c,a,e);c=m(b,d);continue}else if("template"===h){c=m(b,d);continue}if(d=d.__CE_shadowRoot)for(d=d.firstChild;d;d=d.nextSibling)n(d,a,e)}c=c.firstChild?c.firstChild:m(b,c)}}function q(b,a,e){b[a]=e};function r(){this.a=new Map;this.m=new Map;this.f=[];this.b=!1}function ba(b,a,e){b.a.set(a,e);b.m.set(e.constructor,e)}function t(b,a){b.b=!0;b.f.push(a)}function v(b,a){b.b&&n(a,function(a){return w(b,a)})}function w(b,a){if(b.b&&!a.__CE_patched){a.__CE_patched=!0;for(var e=0;e<b.f.length;e++)b.f[e](a)}}function x(b,a){var e=[];n(a,function(b){return e.push(b)});for(a=0;a<e.length;a++){var c=e[a];1===c.__CE_state?b.connectedCallback(c):y(b,c)}}
+function z(b,a){var e=[];n(a,function(b){return e.push(b)});for(a=0;a<e.length;a++){var c=e[a];1===c.__CE_state&&b.disconnectedCallback(c)}}
+function A(b,a,e){e=e?e:new Set;var c=[];n(a,function(d){if("link"===d.localName&&"import"===d.getAttribute("rel")){var a=d.import;a instanceof Node&&"complete"===a.readyState?(a.__CE_isImportDocument=!0,a.__CE_hasRegistry=!0):d.addEventListener("load",function(){var a=d.import;a.__CE_documentLoadHandled||(a.__CE_documentLoadHandled=!0,a.__CE_isImportDocument=!0,a.__CE_hasRegistry=!0,e.delete(a),A(b,a,e))})}else c.push(d)},e);if(b.b)for(a=0;a<c.length;a++)w(b,c[a]);for(a=0;a<c.length;a++)y(b,c[a])}
+function y(b,a){if(void 0===a.__CE_state){var e=b.a.get(a.localName);if(e){e.constructionStack.push(a);var c=e.constructor;try{try{if(new c!==a)throw Error("The custom element constructor did not produce the element being upgraded.");}finally{e.constructionStack.pop()}}catch(f){throw a.__CE_state=2,f;}a.__CE_state=1;a.__CE_definition=e;if(e.attributeChangedCallback)for(e=e.observedAttributes,c=0;c<e.length;c++){var d=e[c],h=a.getAttribute(d);null!==h&&b.attributeChangedCallback(a,d,null,h,null)}l(a)&&
+b.connectedCallback(a)}}}r.prototype.connectedCallback=function(b){var a=b.__CE_definition;a.connectedCallback&&a.connectedCallback.call(b)};r.prototype.disconnectedCallback=function(b){var a=b.__CE_definition;a.disconnectedCallback&&a.disconnectedCallback.call(b)};r.prototype.attributeChangedCallback=function(b,a,e,c,d){var h=b.__CE_definition;h.attributeChangedCallback&&-1<h.observedAttributes.indexOf(a)&&h.attributeChangedCallback.call(b,a,e,c,d)};function B(b,a){this.c=b;this.a=a;this.b=void 0;A(this.c,this.a);"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function C(b){b.b&&b.b.disconnect()}B.prototype.f=function(b){var a=this.a.readyState;"interactive"!==a&&"complete"!==a||C(this);for(a=0;a<b.length;a++)for(var e=b[a].addedNodes,c=0;c<e.length;c++)A(this.c,e[c])};function ca(){var b=this;this.b=this.a=void 0;this.f=new Promise(function(a){b.b=a;b.a&&a(b.a)})}function D(b){if(b.a)throw Error("Already resolved.");b.a=void 0;b.b&&b.b(void 0)};function E(b){this.i=!1;this.c=b;this.l=new Map;this.j=function(b){return b()};this.g=!1;this.h=[];this.s=new B(b,document)}
+E.prototype.define=function(b,a){var e=this;if(!(a instanceof Function))throw new TypeError("Custom element constructors must be functions.");if(!k(b))throw new SyntaxError("The element name '"+b+"' is not valid.");if(this.c.a.get(b))throw Error("A custom element with name '"+b+"' has already been defined.");if(this.i)throw Error("A custom element is already being defined.");this.i=!0;var c,d,h,f,u;try{var p=function(b){var a=P[b];if(void 0!==a&&!(a instanceof Function))throw Error("The '"+b+"' callback must be a function.");
+return a},P=a.prototype;if(!(P instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");c=p("connectedCallback");d=p("disconnectedCallback");h=p("adoptedCallback");f=p("attributeChangedCallback");u=a.observedAttributes||[]}catch(ua){return}finally{this.i=!1}ba(this.c,b,{localName:b,constructor:a,connectedCallback:c,disconnectedCallback:d,adoptedCallback:h,attributeChangedCallback:f,observedAttributes:u,constructionStack:[]});this.h.push(b);this.g||(this.g=
+!0,this.j(function(){if(!1!==e.g)for(e.g=!1,A(e.c,document);0<e.h.length;){var b=e.h.shift();(b=e.l.get(b))&&D(b)}}))};E.prototype.get=function(b){if(b=this.c.a.get(b))return b.constructor};E.prototype.whenDefined=function(b){if(!k(b))return Promise.reject(new SyntaxError("'"+b+"' is not a valid custom element name."));var a=this.l.get(b);if(a)return a.f;a=new ca;this.l.set(b,a);this.c.a.get(b)&&-1===this.h.indexOf(b)&&D(a);return a.f};E.prototype.u=function(b){C(this.s);var a=this.j;this.j=function(e){return b(function(){return a(e)})}};
+window.CustomElementRegistry=E;E.prototype.define=E.prototype.define;E.prototype.get=E.prototype.get;E.prototype.whenDefined=E.prototype.whenDefined;E.prototype.polyfillWrapFlushCallback=E.prototype.u;var F=window.Document.prototype.createElement,da=window.Document.prototype.createElementNS,ea=window.Document.prototype.importNode,fa=window.Document.prototype.prepend,ga=window.Document.prototype.append,G=window.Node.prototype.cloneNode,H=window.Node.prototype.appendChild,I=window.Node.prototype.insertBefore,J=window.Node.prototype.removeChild,K=window.Node.prototype.replaceChild,L=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),M=window.Element.prototype.attachShadow,N=Object.getOwnPropertyDescriptor(window.Element.prototype,
+"innerHTML"),O=window.Element.prototype.getAttribute,Q=window.Element.prototype.setAttribute,R=window.Element.prototype.removeAttribute,S=window.Element.prototype.getAttributeNS,T=window.Element.prototype.setAttributeNS,U=window.Element.prototype.removeAttributeNS,V=window.Element.prototype.insertAdjacentElement,ha=window.Element.prototype.prepend,ia=window.Element.prototype.append,ja=window.Element.prototype.before,ka=window.Element.prototype.after,la=window.Element.prototype.replaceWith,ma=window.Element.prototype.remove,
+na=window.HTMLElement,W=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),X=window.HTMLElement.prototype.insertAdjacentElement;function oa(){var b=Y;window.HTMLElement=function(){function a(){var a=this.constructor,c=b.m.get(a);if(!c)throw Error("The custom element being constructed was not registered with `customElements`.");var d=c.constructionStack;if(!d.length)return d=F.call(document,c.localName),Object.setPrototypeOf(d,a.prototype),d.__CE_state=1,d.__CE_definition=c,w(b,d),d;var c=d.length-1,h=d[c];if(h===g)throw Error("The HTMLElement constructor was either called reentrantly for this constructor or called multiple times.");
+d[c]=g;Object.setPrototypeOf(h,a.prototype);w(b,h);return h}a.prototype=na.prototype;return a}()};function pa(b,a,e){a.prepend=function(a){for(var d=[],c=0;c<arguments.length;++c)d[c-0]=arguments[c];c=d.filter(function(b){return b instanceof Node&&l(b)});e.o.apply(this,d);for(var f=0;f<c.length;f++)z(b,c[f]);if(l(this))for(c=0;c<d.length;c++)f=d[c],f instanceof Element&&x(b,f)};a.append=function(a){for(var d=[],c=0;c<arguments.length;++c)d[c-0]=arguments[c];c=d.filter(function(b){return b instanceof Node&&l(b)});e.append.apply(this,d);for(var f=0;f<c.length;f++)z(b,c[f]);if(l(this))for(c=0;c<
+d.length;c++)f=d[c],f instanceof Element&&x(b,f)}};function qa(){var b=Y;q(Document.prototype,"createElement",function(a){if(this.__CE_hasRegistry){var e=b.a.get(a);if(e)return new e.constructor}a=F.call(this,a);w(b,a);return a});q(Document.prototype,"importNode",function(a,e){a=ea.call(this,a,e);this.__CE_hasRegistry?A(b,a):v(b,a);return a});q(Document.prototype,"createElementNS",function(a,e){if(this.__CE_hasRegistry&&(null===a||"http://www.w3.org/1999/xhtml"===a)){var c=b.a.get(e);if(c)return new c.constructor}a=da.call(this,a,e);w(b,a);return a});
+pa(b,Document.prototype,{o:fa,append:ga})};function ra(){var b=Y;function a(a,c){Object.defineProperty(a,"textContent",{enumerable:c.enumerable,configurable:!0,get:c.get,set:function(a){if(this.nodeType===Node.TEXT_NODE)c.set.call(this,a);else{var d=void 0;if(this.firstChild){var e=this.childNodes,u=e.length;if(0<u&&l(this))for(var d=Array(u),p=0;p<u;p++)d[p]=e[p]}c.set.call(this,a);if(d)for(a=0;a<d.length;a++)z(b,d[a])}}})}q(Node.prototype,"insertBefore",function(a,c){if(a instanceof DocumentFragment){var d=Array.prototype.slice.apply(a.childNodes);
+a=I.call(this,a,c);if(l(this))for(c=0;c<d.length;c++)x(b,d[c]);return a}d=l(a);c=I.call(this,a,c);d&&z(b,a);l(this)&&x(b,a);return c});q(Node.prototype,"appendChild",function(a){if(a instanceof DocumentFragment){var c=Array.prototype.slice.apply(a.childNodes);a=H.call(this,a);if(l(this))for(var d=0;d<c.length;d++)x(b,c[d]);return a}c=l(a);d=H.call(this,a);c&&z(b,a);l(this)&&x(b,a);return d});q(Node.prototype,"cloneNode",function(a){a=G.call(this,a);this.ownerDocument.__CE_hasRegistry?A(b,a):v(b,a);
+return a});q(Node.prototype,"removeChild",function(a){var c=l(a),d=J.call(this,a);c&&z(b,a);return d});q(Node.prototype,"replaceChild",function(a,c){if(a instanceof DocumentFragment){var d=Array.prototype.slice.apply(a.childNodes);a=K.call(this,a,c);if(l(this))for(z(b,c),c=0;c<d.length;c++)x(b,d[c]);return a}var d=l(a),e=K.call(this,a,c),f=l(this);f&&z(b,c);d&&z(b,a);f&&x(b,a);return e});L&&L.get?a(Node.prototype,L):t(b,function(b){a(b,{enumerable:!0,configurable:!0,get:function(){for(var a=[],b=
+0;b<this.childNodes.length;b++)a.push(this.childNodes[b].textContent);return a.join("")},set:function(a){for(;this.firstChild;)J.call(this,this.firstChild);H.call(this,document.createTextNode(a))}})})};function sa(b){var a=Element.prototype;a.before=function(a){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];d=c.filter(function(a){return a instanceof Node&&l(a)});ja.apply(this,c);for(var e=0;e<d.length;e++)z(b,d[e]);if(l(this))for(d=0;d<c.length;d++)e=c[d],e instanceof Element&&x(b,e)};a.after=function(a){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];d=c.filter(function(a){return a instanceof Node&&l(a)});ka.apply(this,c);for(var e=0;e<d.length;e++)z(b,d[e]);if(l(this))for(d=
+0;d<c.length;d++)e=c[d],e instanceof Element&&x(b,e)};a.replaceWith=function(a){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];var d=c.filter(function(a){return a instanceof Node&&l(a)}),e=l(this);la.apply(this,c);for(var f=0;f<d.length;f++)z(b,d[f]);if(e)for(z(b,this),d=0;d<c.length;d++)e=c[d],e instanceof Element&&x(b,e)};a.remove=function(){var a=l(this);ma.call(this);a&&z(b,this)}};function ta(){var b=Y;function a(a,c){Object.defineProperty(a,"innerHTML",{enumerable:c.enumerable,configurable:!0,get:c.get,set:function(a){var d=this,e=void 0;l(this)&&(e=[],n(this,function(a){a!==d&&e.push(a)}));c.set.call(this,a);if(e)for(var f=0;f<e.length;f++){var h=e[f];1===h.__CE_state&&b.disconnectedCallback(h)}this.ownerDocument.__CE_hasRegistry?A(b,this):v(b,this);return a}})}function e(a,c){q(a,"insertAdjacentElement",function(a,d){var e=l(d);a=c.call(this,a,d);e&&z(b,d);l(a)&&x(b,d);
+return a})}M?q(Element.prototype,"attachShadow",function(a){return this.__CE_shadowRoot=a=M.call(this,a)}):console.warn("Custom Elements: `Element#attachShadow` was not patched.");if(N&&N.get)a(Element.prototype,N);else if(W&&W.get)a(HTMLElement.prototype,W);else{var c=F.call(document,"div");t(b,function(b){a(b,{enumerable:!0,configurable:!0,get:function(){return G.call(this,!0).innerHTML},set:function(a){var b="template"===this.localName?this.content:this;for(c.innerHTML=a;0<b.childNodes.length;)J.call(b,
+b.childNodes[0]);for(;0<c.childNodes.length;)H.call(b,c.childNodes[0])}})})}q(Element.prototype,"setAttribute",function(a,c){if(1!==this.__CE_state)return Q.call(this,a,c);var d=O.call(this,a);Q.call(this,a,c);c=O.call(this,a);b.attributeChangedCallback(this,a,d,c,null)});q(Element.prototype,"setAttributeNS",function(a,c,e){if(1!==this.__CE_state)return T.call(this,a,c,e);var d=S.call(this,a,c);T.call(this,a,c,e);e=S.call(this,a,c);b.attributeChangedCallback(this,c,d,e,a)});q(Element.prototype,"removeAttribute",
+function(a){if(1!==this.__CE_state)return R.call(this,a);var c=O.call(this,a);R.call(this,a);null!==c&&b.attributeChangedCallback(this,a,c,null,null)});q(Element.prototype,"removeAttributeNS",function(a,c){if(1!==this.__CE_state)return U.call(this,a,c);var d=S.call(this,a,c);U.call(this,a,c);var e=S.call(this,a,c);d!==e&&b.attributeChangedCallback(this,c,d,e,a)});X?e(HTMLElement.prototype,X):V?e(Element.prototype,V):console.warn("Custom Elements: `Element#insertAdjacentElement` was not patched.");
+pa(b,Element.prototype,{o:ha,append:ia});sa(b)};/*
+
+ Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
+ This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
+ The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
+ The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
+ Code distributed by Google as part of the polymer project is also
+ subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
+*/
+var Z=window.customElements;if(!Z||Z.forcePolyfill||"function"!=typeof Z.define||"function"!=typeof Z.get){var Y=new r;oa();qa();ra();ta();document.__CE_hasRegistry=!0;var customElements=new E(Y);Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:customElements})};
+}).call(self);
+
+//# sourceMappingURL=custom-elements.min.js.map
diff --git a/browser/base/jar.mn b/browser/base/jar.mn
--- a/browser/base/jar.mn
+++ b/browser/base/jar.mn
@@ -86,16 +86,19 @@ browser.jar:
         content/browser/browser-tabsintitlebar.js       (content/browser-tabsintitlebar.js)
 #else
         content/browser/browser-tabsintitlebar.js       (content/browser-tabsintitlebar-stub.js)
 #endif
         content/browser/browser-thumbnails.js         (content/browser-thumbnails.js)
         content/browser/browser-trackingprotection.js (content/browser-trackingprotection.js)
         content/browser/tab-content.js                (content/tab-content.js)
         content/browser/content.js                    (content/content.js)
+        content/browser/customelements/access-key-label.js    (content/customelements/access-key-label.js)
+        content/browser/customelements/base-element.js        (content/customelements/base-element.js)
+        content/browser/customelements/custom-elements.js (content/customelements/custom-elements.js)
         content/browser/social-content.js             (content/social-content.js)
         content/browser/default-theme-icon.svg        (content/default-theme-icon.svg)
         content/browser/defaultthemes/1.header.jpg    (content/defaultthemes/1.header.jpg)
         content/browser/defaultthemes/1.icon.jpg      (content/defaultthemes/1.icon.jpg)
         content/browser/defaultthemes/1.preview.jpg   (content/defaultthemes/1.preview.jpg)
         content/browser/defaultthemes/2.header.jpg    (content/defaultthemes/2.header.jpg)
         content/browser/defaultthemes/2.icon.jpg      (content/defaultthemes/2.icon.jpg)
         content/browser/defaultthemes/2.preview.jpg   (content/defaultthemes/2.preview.jpg)
diff --git a/browser/components/controlcenter/content/panel.inc.xul b/browser/components/controlcenter/content/panel.inc.xul
--- a/browser/components/controlcenter/content/panel.inc.xul
+++ b/browser/components/controlcenter/content/panel.inc.xul
@@ -19,18 +19,18 @@
                   mainViewId="identity-popup-mainView"
                   descriptionheightworkaround="true">
     <panelview id="identity-popup-mainView" flex="1">
 
       <!-- Security Section -->
       <hbox id="identity-popup-security" class="identity-popup-section">
         <vbox id="identity-popup-security-content" flex="1">
           <label class="plain">
-            <label class="identity-popup-headline identity-popup-host"></label>
-            <label class="identity-popup-headline identity-popup-hostless" crop="end"/>
+            <html:accesskey-label class="identity-popup-headline identity-popup-host"></html:accesskey-label>
+            <html:accesskey-label class="identity-popup-headline identity-popup-hostless" crop="end"/>
           </label>
           <description class="identity-popup-connection-not-secure"
                        when-connection="not-secure secure-cert-user-overridden">&identity.connectionNotSecure;</description>
           <description class="identity-popup-connection-secure"
                        when-connection="secure secure-ev">&identity.connectionSecure;</description>
           <description when-connection="chrome">&identity.connectionInternal;</description>
           <description when-connection="file">&identity.connectionFile;</description>
           <description when-connection="extension">&identity.extensionPage;</description>
diff --git a/browser/components/preferences/in-content-new/preferences.xul b/browser/components/preferences/in-content-new/preferences.xul
--- a/browser/components/preferences/in-content-new/preferences.xul
+++ b/browser/components/preferences/in-content-new/preferences.xul
@@ -98,16 +98,19 @@
               href="chrome://browser/skin/preferences/in-content-new/favicon.ico"/>
 
   <script type="application/javascript"
           src="chrome://browser/content/utilityOverlay.js"/>
   <script type="application/javascript"
           src="chrome://browser/content/preferences/in-content-new/preferences.js"/>
   <script src="chrome://browser/content/preferences/in-content-new/findInPage.js"/>
   <script src="chrome://browser/content/preferences/in-content-new/subdialogs.js"/>
+  <script type="application/javascript" src="chrome://browser/content/customelements/custom-elements.js"/>
+  <script type="application/javascript" src="chrome://browser/content/customelements/base-element.js"/>
+  <script type="application/javascript" src="chrome://browser/content/customelements/access-key-label.js"/>
 
   <stringbundle id="bundleBrand"
                 src="chrome://branding/locale/brand.properties"/>
   <stringbundle id="bundlePreferences"
                 src="chrome://browser/locale/preferences/preferences.properties"/>
   <stringbundle id="pkiBundle"
                 src="chrome://pippki/locale/pippki.properties"/>
   <stringbundle id="browserBundle"
@@ -126,73 +129,73 @@
       <richlistitem id="category-search-results"
                     class="category"
                     value="paneSearchResults"
                     helpTopic="prefs-main"
                     tooltiptext="&paneSearchResults.title;"
                     align="center"
                     hidden="true">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneSearchResults.title;</label>
+        <html:accesskey-label class="category-name" flex="1">&paneSearchResults.title;</html:accesskey-label>
       </richlistitem>
 
       <richlistitem id="category-general"
                     class="category"
                     value="paneGeneral"
                     helpTopic="prefs-main"
                     tooltiptext="&paneGeneral.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneGeneral.title;</label>
+        <html:accesskey-label class="category-name" flex="1">&paneGeneral.title;</html:accesskey-label>
       </richlistitem>
 
       <richlistitem id="category-application"
                     class="category"
                     value="paneApplications"
                     helpTopic="prefs-applications"
                     tooltiptext="&paneFilesApplications.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneFilesApplications.title;</label>
+        <html:accesskey-label class="category-name" flex="1">&paneFilesApplications.title;</html:accesskey-label>
       </richlistitem>
 
       <richlistitem id="category-containers"
                     class="category"
                     value="paneContainers"
                     helpTopic="prefs-containers"
                     hidden="true"/>
 
       <richlistitem id="category-sync"
                     class="category"
                     value="paneSync"
                     helpTopic="prefs-weave"
                     tooltiptext="&paneSync1.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneSync1.title;</label>
+        <html:accesskey-label class="category-name" flex="1">&paneSync1.title;</html:accesskey-label>
       </richlistitem>
 
       <richlistitem id="category-privacy"
                     class="category"
                     value="panePrivacy"
                     helpTopic="prefs-privacy"
                     tooltiptext="&panePrivacySecurity.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&panePrivacySecurity.title;</label>
+        <html:accesskey-label class="category-name" flex="1">&panePrivacySecurity.title;</html:accesskey-label>
       </richlistitem>
 
       <richlistitem id="category-advanced"
                     class="category"
                     value="paneAdvanced"
                     helpTopic="prefs-advanced-general"
                     tooltiptext="&paneUpdates.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneUpdates.title;</label>
+        <html:accesskey-label class="category-name" flex="1">&paneUpdates.title;</html:accesskey-label>
       </richlistitem>
     </richlistbox>
 
     <keyset>
       <!-- Disable the findbar because it doesn't work properly.
            Remove this keyset once bug 1094240 ("disablefastfind" attribute
            broken in e10s mode) is fixed. -->
       <key key="&focusSearch1.key;" modifiers="accel" id="focusSearch1" oncommand=";"/>
@@ -220,19 +223,20 @@
   <stack id="dialogStack" hidden="true"/>
   <vbox id="dialogTemplate" class="dialogOverlay" align="center" pack="center" topmost="true" hidden="true">
     <groupbox class="dialogBox"
               orient="vertical"
               pack="end"
               role="dialog"
               aria-labelledby="dialogTitle">
       <caption flex="1" align="center">
-        <label class="dialogTitle" flex="1"></label>
+        <html:accesskey-label class="dialogTitle" flex="1"></html:accesskey-label>
         <button class="dialogClose close-icon"
                 aria-label="&preferencesCloseButton.label;"/>
       </caption>
       <browser class="dialogFrame"
                autoscroll="false"
                disablehistory="true"/>
     </groupbox>
   </vbox>
   </stack>
+
 </page>
diff --git a/browser/themes/linux/browser.css b/browser/themes/linux/browser.css
--- a/browser/themes/linux/browser.css
+++ b/browser/themes/linux/browser.css
@@ -467,16 +467,17 @@ menuitem.bookmark-item {
   border-bottom-right-radius: 1.5px;
 }
 
 #identity-box:-moz-focusring {
   outline: 1px dotted;
   outline-offset: -3px;
 }
 
+%include ../shared/customelements/custom-elements.inc.css
 %include ../shared/identity-block/identity-block.inc.css
 
 %include ../shared/notification-icons.inc.css
 
 .popup-notification-body[popupid="addon-progress"],
 .popup-notification-body[popupid="addon-install-confirmation"] {
   width: 28em;
   max-width: 28em;
diff --git a/browser/themes/osx/browser.css b/browser/themes/osx/browser.css
--- a/browser/themes/osx/browser.css
+++ b/browser/themes/osx/browser.css
@@ -618,16 +618,17 @@ toolbarpaletteitem[place="palette"] > #p
   transform: scaleX(-1);
 }
 
 @conditionalForwardWithUrlbar@:-moz-locale-dir(rtl) {
   -moz-box-direction: reverse;
 }
 %endif
 
+%include ../shared/customelements/custom-elements.inc.css
 %include ../shared/identity-block/identity-block.inc.css
 
 #identity-box {
   padding-top: 2px;
   padding-bottom: 2px;
 }
 
 #urlbar:not([focused="true"]) > #identity-box {
diff --git a/browser/themes/shared/customelements/custom-elements.inc.css b/browser/themes/shared/customelements/custom-elements.inc.css
new file mode 100644
--- /dev/null
+++ b/browser/themes/shared/customelements/custom-elements.inc.css
@@ -0,0 +1,15 @@
+%if 0
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+%endif
+
+html|accesskey-label {
+  background: red;
+  display: -moz-box;
+}
+
+/* By default, label text does not wrap. To enable wrapping, use a text node instead of the value attribute. */
+html|accesskey-label[value] {
+  
+}
\ No newline at end of file
diff --git a/browser/themes/shared/incontentprefs/preferences.inc.css b/browser/themes/shared/incontentprefs/preferences.inc.css
--- a/browser/themes/shared/incontentprefs/preferences.inc.css
+++ b/browser/themes/shared/incontentprefs/preferences.inc.css
@@ -1,15 +1,17 @@
 %if 0
 /* - This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this file,
    - You can obtain one at http://mozilla.org/MPL/2.0/. */
 %endif
 @namespace html "http://www.w3.org/1999/xhtml";
 
+%include ../customelements/custom-elements.inc.css
+
 #mainPrefPane {
   max-width: 800px;
   padding: 0;
   font: message-box;
   font-size: 1.25rem;
 }
 
 * {
diff --git a/browser/themes/shared/jar.inc.mn b/browser/themes/shared/jar.inc.mn
--- a/browser/themes/shared/jar.inc.mn
+++ b/browser/themes/shared/jar.inc.mn
@@ -28,16 +28,17 @@
 * skin/classic/browser/controlcenter/conn-not-secure.svg       (../shared/controlcenter/conn-not-secure.svg)
 * skin/classic/browser/controlcenter/connection.svg            (../shared/controlcenter/connection.svg)
 * skin/classic/browser/controlcenter/mcb-disabled.svg          (../shared/controlcenter/mcb-disabled.svg)
   skin/classic/browser/controlcenter/extension.svg             (../shared/controlcenter/extension.svg)
 * skin/classic/browser/controlcenter/permissions.svg           (../shared/controlcenter/permissions.svg)
 * skin/classic/browser/controlcenter/tracking-protection.svg   (../shared/controlcenter/tracking-protection.svg)
   skin/classic/browser/controlcenter/warning-gray.svg          (../shared/controlcenter/warning-gray.svg)
   skin/classic/browser/controlcenter/warning-yellow.svg        (../shared/controlcenter/warning-yellow.svg)
+* skin/classic/browser/customelements/custom-elements.inc.css  (../shared/customelements/custom-elements.inc.css)
   skin/classic/browser/customizableui/customizeFavicon.ico     (../shared/customizableui/customizeFavicon.ico)
   skin/classic/browser/customizableui/customize-illustration.png  (../shared/customizableui/customize-illustration.png)
   skin/classic/browser/customizableui/customize-illustration@2x.png  (../shared/customizableui/customize-illustration@2x.png)
   skin/classic/browser/customizableui/customize-illustration-rtl.png  (../shared/customizableui/customize-illustration-rtl.png)
   skin/classic/browser/customizableui/customize-illustration-rtl@2x.png  (../shared/customizableui/customize-illustration-rtl@2x.png)
   skin/classic/browser/customizableui/info-icon-customizeTip.png  (../shared/customizableui/info-icon-customizeTip.png)
   skin/classic/browser/customizableui/info-icon-customizeTip@2x.png  (../shared/customizableui/info-icon-customizeTip@2x.png)
   skin/classic/browser/customizableui/menuPanel-customizeFinish.png  (../shared/customizableui/menuPanel-customizeFinish.png)
diff --git a/browser/themes/windows/browser.css b/browser/themes/windows/browser.css
--- a/browser/themes/windows/browser.css
+++ b/browser/themes/windows/browser.css
@@ -959,16 +959,18 @@ html|*.urlbar-input:-moz-lwtheme::placeh
     -moz-image-region: var(--urlbar-dropmarker-active-2x-region);
   }
 
   .urlbar-history-dropmarker > .dropmarker-icon {
     width: 11px;
   }
 }
 
+%include ../shared/customelements/custom-elements.inc.css
+
 /* page proxy icon */
 
 %include ../shared/identity-block/identity-block.inc.css
 
 /* autocomplete */
 
 %include ../shared/autocomplete.inc.css
 
