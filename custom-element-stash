# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  c03f906e6579fce0b61524c4f5c8445dfa76ffe0

diff --git a/browser/base/content/aboutNetError.xhtml b/browser/base/content/aboutNetError.xhtml
--- a/browser/base/content/aboutNetError.xhtml
+++ b/browser/base/content/aboutNetError.xhtml
@@ -12,17 +12,17 @@
     SYSTEM "chrome://global/locale/global.dtd">
   %globalDTD;
 ]>
 
 <!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
-<html xmlns="http://www.w3.org/1999/xhtml">
+<html xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml">
   <head>
     <title>&loadError.label;</title>
     <link rel="stylesheet" href="chrome://browser/skin/aboutNetError.css" type="text/css" media="all" />
     <!-- If the location of the favicon is changed here, the FAVICON_ERRORPAGE_URL symbol in
          toolkit/components/places/src/nsFaviconService.h should be updated. -->
     <link rel="icon" type="image/png" id="favicon" href="chrome://global/skin/icons/warning-16.png"/>
 
     <script type="application/javascript"><![CDATA[
@@ -573,16 +573,17 @@
       </div>
     </div>
 
     <!-- PAGE CONTAINER (for styling purposes only) -->
     <div id="errorPageContainer" class="container">
       <!-- Error Title -->
       <div class="title">
         <h1 class="title-text"/>
+        <html:firefox-label value="Hi"></html:firefox-label>
       </div>
 
       <!-- LONG CONTENT (the section most likely to require scrolling) -->
       <div id="errorLongContent">
 
         <!-- Short Description -->
         <div id="errorShortDesc">
           <p id="errorShortDescText" />
@@ -647,12 +648,21 @@
 
     <!--
     - Note: It is important to run the script this way, instead of using
     - an onload handler. This is because error pages are loaded as
     - LOAD_BACKGROUND, which means that onload handlers will not be executed.
     -->
     <script type="application/javascript">
       initPage();
+      setTimeout(() => {
+        var el = document.createElement("firefox-label");
+        el.setAttribute("value", "bar");
+        document.body.appendChild(el);
+      }, 1000);
     </script>
 
+  <script type="application/javascript" src="chrome://browser/content/customelements/custom-elements.js"/>
+  <script type="application/javascript" src="chrome://browser/content/customelements/base-element.js"/>
+  <script type="application/javascript" src="chrome://browser/content/customelements/firefox-label.js"/>
+
   </body>
 </html>
diff --git a/browser/base/content/customelements/base-element.js b/browser/base/content/customelements/base-element.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/customelements/base-element.js
@@ -0,0 +1,145 @@
+
+
+// https://html.spec.whatwg.org/multipage/scripting.html#custom-elements-autonomous-example
+
+class BaseElement extends HTMLElement {
+  constructor() {
+    super();
+    this.observerConnector = new ObserverConnector(this);
+    this.inheritsConnector = new InheritsConnector(this);
+  }
+
+  connectedCallback() {
+
+  }
+
+  disconnectedCallback() {
+
+  }
+
+  static get observedAttributes() { return ["observes"]; }
+
+  attributeChangedCallback(name, oldValue, newValue) {
+    if (name === "observes") {
+      this.observerConnector.watch(newValue);
+    }
+  }
+}
+
+function InheritsConnector(host) {
+  this._host = host;
+  this._nodesToAttributes = new Map();
+  this.watch();
+}
+InheritsConnector.prototype.destroy = function() {
+
+}
+InheritsConnector.prototype.setInherits = function(node) {
+  let inherits = node.getAttribute("inherits");
+  if (inherits) {
+    this._nodesToAttributes.set(node, inherits.split(','));
+  }
+}
+InheritsConnector.prototype.copyAttribute = function(attributeName) {
+  if (attributeName === "id") {
+    return;
+  }
+
+  for (let [node, list] of this._nodesToAttributes.entries()) {
+    // Handle both inherits="accesskey" and inherits="text=label"
+    list.forEach(a => {
+      if (a === attributeName) {
+        node.setAttribute(a, this._host.getAttribute(a));
+      } else if (a.endsWith('=' + attributeName)) {
+        let mapFrom = a.split('=')[1];
+        let mapTo = a.split('=')[0];
+        if (mapTo === "text") {
+          node.textContent = this._host.getAttribute(mapFrom);
+        } else {
+          node.setAttribute(mapTo, this._host.getAttribute(mapFrom));
+        }
+      }
+    });
+  }
+};
+
+InheritsConnector.prototype.watch = function() {
+  if (this._observer) {
+    this._observer.disconnect();
+    this._observer = null;
+  }
+
+  this._observer = new MutationObserver(mutations => {
+    mutations.forEach(mutation => {
+      if (mutation.type === "childList") {
+        mutation.addedNodes.forEach(added => {
+          if (added.nodeType !== 1) {
+            return;
+          }
+          this.setInherits(added);
+          [...added.querySelectorAll("[inherits]")].forEach(child => this.setInherits(child));
+          for (var i = 0; i < this._host.attributes.length; i++) {
+            var attrib = this._host.attributes[i];
+            this.copyAttribute(attrib.name);
+          }
+        });
+      }
+
+      if (mutation.type === "attributes" && mutation.target === this._host) {
+        this.copyAttribute(mutation.attributeName);
+      }
+    });
+
+    // this.copyAttributes();
+  });
+  this._observer.observe(this._host, {
+    attributes: true,
+    subtree: true,
+    childList: true,
+  });
+
+}
+
+function ObserverConnector(host) {
+  this._host = host;
+}
+ObserverConnector.prototype.destroy = function() {
+
+}
+
+ObserverConnector.prototype.copyAttributes = function() {
+  if (!this._observeTarget) {
+    return;
+  }
+
+  for (var i = 0; i < this._observeTarget.attributes.length; i++) {
+    var attrib = this._observeTarget.attributes[i];
+    if (attrib.name !== "id") {
+      this._host.setAttribute(attrib.name, attrib.value);
+    }
+  }
+}
+
+ObserverConnector.prototype.watch = function(targetID) {
+  if (this._observer) {
+    this._observer.disconnect();
+    this._observer = null;
+  }
+
+  this._observeTarget = document.getElementById(targetID);
+  if (this._observeTarget) {
+    this._observer = new MutationObserver(mutations => {
+      mutations.forEach(mutation => {
+        if (!this._observeTarget.hasAttribute(mutation.attributeName)) {
+          this.removeAttribute(mutation.attributeName);
+        }
+      });
+
+      this.copyAttributes();
+    });
+    this._observer.observe(this._observeTarget, {
+      attributes: true,
+    });
+    this.copyAttributes();
+  }
+}
diff --git a/browser/base/content/customelements/custom-elements.js b/browser/base/content/customelements/custom-elements.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/customelements/custom-elements.js
@@ -0,0 +1,37 @@
+(function(){
+'use strict';var g=new function(){};var aa=new Set("annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" "));function k(b){var a=aa.has(b);b=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(b);return!a&&b}function l(b){var a=b.isConnected;if(void 0!==a)return a;for(;b&&!(b.__CE_isImportDocument||b instanceof Document);)b=b.parentNode||(window.ShadowRoot&&b instanceof ShadowRoot?b.host:void 0);return!(!b||!(b.__CE_isImportDocument||b instanceof Document))}
+function m(b,a){for(;a&&a!==b&&!a.nextSibling;)a=a.parentNode;return a&&a!==b?a.nextSibling:null}
+function n(b,a,e){e=e?e:new Set;for(var c=b;c;){if(c.nodeType===Node.ELEMENT_NODE){var d=c;a(d);var h=d.localName;if("link"===h&&"import"===d.getAttribute("rel")){c=d.import;if(c instanceof Node&&!e.has(c))for(e.add(c),c=c.firstChild;c;c=c.nextSibling)n(c,a,e);c=m(b,d);continue}else if("template"===h){c=m(b,d);continue}if(d=d.__CE_shadowRoot)for(d=d.firstChild;d;d=d.nextSibling)n(d,a,e)}c=c.firstChild?c.firstChild:m(b,c)}}function q(b,a,e){b[a]=e};function r(){this.a=new Map;this.m=new Map;this.f=[];this.b=!1}function ba(b,a,e){b.a.set(a,e);b.m.set(e.constructor,e)}function t(b,a){b.b=!0;b.f.push(a)}function v(b,a){b.b&&n(a,function(a){return w(b,a)})}function w(b,a){if(b.b&&!a.__CE_patched){a.__CE_patched=!0;for(var e=0;e<b.f.length;e++)b.f[e](a)}}function x(b,a){var e=[];n(a,function(b){return e.push(b)});for(a=0;a<e.length;a++){var c=e[a];1===c.__CE_state?b.connectedCallback(c):y(b,c)}}
+function z(b,a){var e=[];n(a,function(b){return e.push(b)});for(a=0;a<e.length;a++){var c=e[a];1===c.__CE_state&&b.disconnectedCallback(c)}}
+function A(b,a,e){e=e?e:new Set;var c=[];n(a,function(d){if("link"===d.localName&&"import"===d.getAttribute("rel")){var a=d.import;a instanceof Node&&"complete"===a.readyState?(a.__CE_isImportDocument=!0,a.__CE_hasRegistry=!0):d.addEventListener("load",function(){var a=d.import;a.__CE_documentLoadHandled||(a.__CE_documentLoadHandled=!0,a.__CE_isImportDocument=!0,a.__CE_hasRegistry=!0,e.delete(a),A(b,a,e))})}else c.push(d)},e);if(b.b)for(a=0;a<c.length;a++)w(b,c[a]);for(a=0;a<c.length;a++)y(b,c[a])}
+function y(b,a){if(void 0===a.__CE_state){var e=b.a.get(a.localName);if(e){e.constructionStack.push(a);var c=e.constructor;try{try{if(new c!==a)throw Error("The custom element constructor did not produce the element being upgraded.");}finally{e.constructionStack.pop()}}catch(f){throw a.__CE_state=2,f;}a.__CE_state=1;a.__CE_definition=e;if(e.attributeChangedCallback)for(e=e.observedAttributes,c=0;c<e.length;c++){var d=e[c],h=a.getAttribute(d);null!==h&&b.attributeChangedCallback(a,d,null,h,null)}l(a)&&
+b.connectedCallback(a)}}}r.prototype.connectedCallback=function(b){var a=b.__CE_definition;a.connectedCallback&&a.connectedCallback.call(b)};r.prototype.disconnectedCallback=function(b){var a=b.__CE_definition;a.disconnectedCallback&&a.disconnectedCallback.call(b)};r.prototype.attributeChangedCallback=function(b,a,e,c,d){var h=b.__CE_definition;h.attributeChangedCallback&&-1<h.observedAttributes.indexOf(a)&&h.attributeChangedCallback.call(b,a,e,c,d)};function B(b,a){this.c=b;this.a=a;this.b=void 0;A(this.c,this.a);"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function C(b){b.b&&b.b.disconnect()}B.prototype.f=function(b){var a=this.a.readyState;"interactive"!==a&&"complete"!==a||C(this);for(a=0;a<b.length;a++)for(var e=b[a].addedNodes,c=0;c<e.length;c++)A(this.c,e[c])};function ca(){var b=this;this.b=this.a=void 0;this.f=new Promise(function(a){b.b=a;b.a&&a(b.a)})}function D(b){if(b.a)throw Error("Already resolved.");b.a=void 0;b.b&&b.b(void 0)};function E(b){this.i=!1;this.c=b;this.l=new Map;this.j=function(b){return b()};this.g=!1;this.h=[];this.s=new B(b,document)}
+E.prototype.define=function(b,a){var e=this;if(!(a instanceof Function))throw new TypeError("Custom element constructors must be functions.");if(!k(b))throw new SyntaxError("The element name '"+b+"' is not valid.");if(this.c.a.get(b))throw Error("A custom element with name '"+b+"' has already been defined.");if(this.i)throw Error("A custom element is already being defined.");this.i=!0;var c,d,h,f,u;try{var p=function(b){var a=P[b];if(void 0!==a&&!(a instanceof Function))throw Error("The '"+b+"' callback must be a function.");
+return a},P=a.prototype;if(!(P instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");c=p("connectedCallback");d=p("disconnectedCallback");h=p("adoptedCallback");f=p("attributeChangedCallback");u=a.observedAttributes||[]}catch(ua){return}finally{this.i=!1}ba(this.c,b,{localName:b,constructor:a,connectedCallback:c,disconnectedCallback:d,adoptedCallback:h,attributeChangedCallback:f,observedAttributes:u,constructionStack:[]});this.h.push(b);this.g||(this.g=
+!0,this.j(function(){if(!1!==e.g)for(e.g=!1,A(e.c,document);0<e.h.length;){var b=e.h.shift();(b=e.l.get(b))&&D(b)}}))};E.prototype.get=function(b){if(b=this.c.a.get(b))return b.constructor};E.prototype.whenDefined=function(b){if(!k(b))return Promise.reject(new SyntaxError("'"+b+"' is not a valid custom element name."));var a=this.l.get(b);if(a)return a.f;a=new ca;this.l.set(b,a);this.c.a.get(b)&&-1===this.h.indexOf(b)&&D(a);return a.f};E.prototype.u=function(b){C(this.s);var a=this.j;this.j=function(e){return b(function(){return a(e)})}};
+window.CustomElementRegistry=E;E.prototype.define=E.prototype.define;E.prototype.get=E.prototype.get;E.prototype.whenDefined=E.prototype.whenDefined;E.prototype.polyfillWrapFlushCallback=E.prototype.u;var F=window.Document.prototype.createElement,da=window.Document.prototype.createElementNS,ea=window.Document.prototype.importNode,fa=window.Document.prototype.prepend,ga=window.Document.prototype.append,G=window.Node.prototype.cloneNode,H=window.Node.prototype.appendChild,I=window.Node.prototype.insertBefore,J=window.Node.prototype.removeChild,K=window.Node.prototype.replaceChild,L=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),M=window.Element.prototype.attachShadow,N=Object.getOwnPropertyDescriptor(window.Element.prototype,
+"innerHTML"),O=window.Element.prototype.getAttribute,Q=window.Element.prototype.setAttribute,R=window.Element.prototype.removeAttribute,S=window.Element.prototype.getAttributeNS,T=window.Element.prototype.setAttributeNS,U=window.Element.prototype.removeAttributeNS,V=window.Element.prototype.insertAdjacentElement,ha=window.Element.prototype.prepend,ia=window.Element.prototype.append,ja=window.Element.prototype.before,ka=window.Element.prototype.after,la=window.Element.prototype.replaceWith,ma=window.Element.prototype.remove,
+na=window.HTMLElement,W=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),X=window.HTMLElement.prototype.insertAdjacentElement;function oa(){var b=Y;window.HTMLElement=function(){function a(){var a=this.constructor,c=b.m.get(a);if(!c)throw Error("The custom element being constructed was not registered with `customElements`.");var d=c.constructionStack;if(!d.length)return d=F.call(document,c.localName),Object.setPrototypeOf(d,a.prototype),d.__CE_state=1,d.__CE_definition=c,w(b,d),d;var c=d.length-1,h=d[c];if(h===g)throw Error("The HTMLElement constructor was either called reentrantly for this constructor or called multiple times.");
+d[c]=g;Object.setPrototypeOf(h,a.prototype);w(b,h);return h}a.prototype=na.prototype;return a}()};function pa(b,a,e){a.prepend=function(a){for(var d=[],c=0;c<arguments.length;++c)d[c-0]=arguments[c];c=d.filter(function(b){return b instanceof Node&&l(b)});e.o.apply(this,d);for(var f=0;f<c.length;f++)z(b,c[f]);if(l(this))for(c=0;c<d.length;c++)f=d[c],f instanceof Element&&x(b,f)};a.append=function(a){for(var d=[],c=0;c<arguments.length;++c)d[c-0]=arguments[c];c=d.filter(function(b){return b instanceof Node&&l(b)});e.append.apply(this,d);for(var f=0;f<c.length;f++)z(b,c[f]);if(l(this))for(c=0;c<
+d.length;c++)f=d[c],f instanceof Element&&x(b,f)}};function qa(){var b=Y;q(Document.prototype,"createElement",function(a){if(this.__CE_hasRegistry){var e=b.a.get(a);if(e)return new e.constructor}a=F.call(this,a);w(b,a);return a});q(Document.prototype,"importNode",function(a,e){a=ea.call(this,a,e);this.__CE_hasRegistry?A(b,a):v(b,a);return a});q(Document.prototype,"createElementNS",function(a,e){if(this.__CE_hasRegistry&&(null===a||"http://www.w3.org/1999/xhtml"===a)){var c=b.a.get(e);if(c)return new c.constructor}a=da.call(this,a,e);w(b,a);return a});
+pa(b,Document.prototype,{o:fa,append:ga})};function ra(){var b=Y;function a(a,c){Object.defineProperty(a,"textContent",{enumerable:c.enumerable,configurable:!0,get:c.get,set:function(a){if(this.nodeType===Node.TEXT_NODE)c.set.call(this,a);else{var d=void 0;if(this.firstChild){var e=this.childNodes,u=e.length;if(0<u&&l(this))for(var d=Array(u),p=0;p<u;p++)d[p]=e[p]}c.set.call(this,a);if(d)for(a=0;a<d.length;a++)z(b,d[a])}}})}q(Node.prototype,"insertBefore",function(a,c){if(a instanceof DocumentFragment){var d=Array.prototype.slice.apply(a.childNodes);
+a=I.call(this,a,c);if(l(this))for(c=0;c<d.length;c++)x(b,d[c]);return a}d=l(a);c=I.call(this,a,c);d&&z(b,a);l(this)&&x(b,a);return c});q(Node.prototype,"appendChild",function(a){if(a instanceof DocumentFragment){var c=Array.prototype.slice.apply(a.childNodes);a=H.call(this,a);if(l(this))for(var d=0;d<c.length;d++)x(b,c[d]);return a}c=l(a);d=H.call(this,a);c&&z(b,a);l(this)&&x(b,a);return d});q(Node.prototype,"cloneNode",function(a){a=G.call(this,a);this.ownerDocument.__CE_hasRegistry?A(b,a):v(b,a);
+return a});q(Node.prototype,"removeChild",function(a){var c=l(a),d=J.call(this,a);c&&z(b,a);return d});q(Node.prototype,"replaceChild",function(a,c){if(a instanceof DocumentFragment){var d=Array.prototype.slice.apply(a.childNodes);a=K.call(this,a,c);if(l(this))for(z(b,c),c=0;c<d.length;c++)x(b,d[c]);return a}var d=l(a),e=K.call(this,a,c),f=l(this);f&&z(b,c);d&&z(b,a);f&&x(b,a);return e});L&&L.get?a(Node.prototype,L):t(b,function(b){a(b,{enumerable:!0,configurable:!0,get:function(){for(var a=[],b=
+0;b<this.childNodes.length;b++)a.push(this.childNodes[b].textContent);return a.join("")},set:function(a){for(;this.firstChild;)J.call(this,this.firstChild);H.call(this,document.createTextNode(a))}})})};function sa(b){var a=Element.prototype;a.before=function(a){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];d=c.filter(function(a){return a instanceof Node&&l(a)});ja.apply(this,c);for(var e=0;e<d.length;e++)z(b,d[e]);if(l(this))for(d=0;d<c.length;d++)e=c[d],e instanceof Element&&x(b,e)};a.after=function(a){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];d=c.filter(function(a){return a instanceof Node&&l(a)});ka.apply(this,c);for(var e=0;e<d.length;e++)z(b,d[e]);if(l(this))for(d=
+0;d<c.length;d++)e=c[d],e instanceof Element&&x(b,e)};a.replaceWith=function(a){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];var d=c.filter(function(a){return a instanceof Node&&l(a)}),e=l(this);la.apply(this,c);for(var f=0;f<d.length;f++)z(b,d[f]);if(e)for(z(b,this),d=0;d<c.length;d++)e=c[d],e instanceof Element&&x(b,e)};a.remove=function(){var a=l(this);ma.call(this);a&&z(b,this)}};function ta(){var b=Y;function a(a,c){Object.defineProperty(a,"innerHTML",{enumerable:c.enumerable,configurable:!0,get:c.get,set:function(a){var d=this,e=void 0;l(this)&&(e=[],n(this,function(a){a!==d&&e.push(a)}));c.set.call(this,a);if(e)for(var f=0;f<e.length;f++){var h=e[f];1===h.__CE_state&&b.disconnectedCallback(h)}this.ownerDocument.__CE_hasRegistry?A(b,this):v(b,this);return a}})}function e(a,c){q(a,"insertAdjacentElement",function(a,d){var e=l(d);a=c.call(this,a,d);e&&z(b,d);l(a)&&x(b,d);
+return a})}M?q(Element.prototype,"attachShadow",function(a){return this.__CE_shadowRoot=a=M.call(this,a)}):console.warn("Custom Elements: `Element#attachShadow` was not patched.");if(N&&N.get)a(Element.prototype,N);else if(W&&W.get)a(HTMLElement.prototype,W);else{var c=F.call(document,"div");t(b,function(b){a(b,{enumerable:!0,configurable:!0,get:function(){return G.call(this,!0).innerHTML},set:function(a){var b="template"===this.localName?this.content:this;for(c.innerHTML=a;0<b.childNodes.length;)J.call(b,
+b.childNodes[0]);for(;0<c.childNodes.length;)H.call(b,c.childNodes[0])}})})}q(Element.prototype,"setAttribute",function(a,c){if(1!==this.__CE_state)return Q.call(this,a,c);var d=O.call(this,a);Q.call(this,a,c);c=O.call(this,a);b.attributeChangedCallback(this,a,d,c,null)});q(Element.prototype,"setAttributeNS",function(a,c,e){if(1!==this.__CE_state)return T.call(this,a,c,e);var d=S.call(this,a,c);T.call(this,a,c,e);e=S.call(this,a,c);b.attributeChangedCallback(this,c,d,e,a)});q(Element.prototype,"removeAttribute",
+function(a){if(1!==this.__CE_state)return R.call(this,a);var c=O.call(this,a);R.call(this,a);null!==c&&b.attributeChangedCallback(this,a,c,null,null)});q(Element.prototype,"removeAttributeNS",function(a,c){if(1!==this.__CE_state)return U.call(this,a,c);var d=S.call(this,a,c);U.call(this,a,c);var e=S.call(this,a,c);d!==e&&b.attributeChangedCallback(this,c,d,e,a)});X?e(HTMLElement.prototype,X):V?e(Element.prototype,V):console.warn("Custom Elements: `Element#insertAdjacentElement` was not patched.");
+pa(b,Element.prototype,{o:ha,append:ia});sa(b)};/*
+
+ Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
+ This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
+ The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
+ The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
+ Code distributed by Google as part of the polymer project is also
+ subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
+*/
+var Z=window.customElements;if(!Z||Z.forcePolyfill||"function"!=typeof Z.define||"function"!=typeof Z.get){var Y=new r;oa();qa();ra();ta();document.__CE_hasRegistry=!0;var customElements=new E(Y);Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:customElements})};
+}).call(self);
+
+//# sourceMappingURL=custom-elements.min.js.map
diff --git a/browser/base/jar.mn b/browser/base/jar.mn
--- a/browser/base/jar.mn
+++ b/browser/base/jar.mn
@@ -86,16 +86,19 @@ browser.jar:
         content/browser/browser-tabsintitlebar.js       (content/browser-tabsintitlebar.js)
 #else
         content/browser/browser-tabsintitlebar.js       (content/browser-tabsintitlebar-stub.js)
 #endif
         content/browser/browser-thumbnails.js         (content/browser-thumbnails.js)
         content/browser/browser-trackingprotection.js (content/browser-trackingprotection.js)
         content/browser/tab-content.js                (content/tab-content.js)
         content/browser/content.js                    (content/content.js)
+        content/browser/customelements/firefox-label.js   (content/customelements/firefox-label.js)
+        content/browser/customelements/base-element.js    (content/customelements/base-element.js)
+        content/browser/customelements/custom-elements.js (content/customelements/custom-elements.js)
         content/browser/social-content.js             (content/social-content.js)
         content/browser/default-theme-icon.svg        (content/default-theme-icon.svg)
         content/browser/defaultthemes/1.header.jpg    (content/defaultthemes/1.header.jpg)
         content/browser/defaultthemes/1.icon.jpg      (content/defaultthemes/1.icon.jpg)
         content/browser/defaultthemes/1.preview.jpg   (content/defaultthemes/1.preview.jpg)
         content/browser/defaultthemes/2.header.jpg    (content/defaultthemes/2.header.jpg)
         content/browser/defaultthemes/2.icon.jpg      (content/defaultthemes/2.icon.jpg)
         content/browser/defaultthemes/2.preview.jpg   (content/defaultthemes/2.preview.jpg)
diff --git a/browser/components/preferences/in-content-new/advanced.xul b/browser/components/preferences/in-content-new/advanced.xul
--- a/browser/components/preferences/in-content-new/advanced.xul
+++ b/browser/components/preferences/in-content-new/advanced.xul
@@ -45,27 +45,27 @@
   <stringbundle id="bundleShell" src="chrome://browser/locale/shellservice.properties"/>
   <stringbundle id="bundleBrand" src="chrome://branding/locale/brand.properties"/>
 #endif
 
 <hbox id="header-advanced"
       class="header"
       hidden="true"
       data-category="paneAdvanced">
-  <label class="header-name" flex="1">&paneUpdates.title;</label>
+  <html:firefox-label class="header-name" flex="1">&paneUpdates.title;</html:firefox-label>
 </hbox>
 
 <!-- Update -->
 <groupbox id="updateApp" data-category="paneAdvanced" hidden="true">
-  <caption><label>&updateApplication.label;</label></caption>
+  <caption><html:firefox-label>&updateApplication.label;</html:firefox-label></caption>
   <hbox align="start">
     <vbox flex="1">
       <description>
-        &updateApplication.version.pre;<label id="version"/>&updateApplication.version.post;
-        <label id="releasenotes" class="learnMore text-link" hidden="true">&releaseNotes.link;</label>
+        &updateApplication.version.pre;<html:firefox-label id="version"/>&updateApplication.version.post;
+        <html:firefox-label id="releasenotes" class="learnMore text-link" hidden="true">&releaseNotes.link;</html:firefox-label>
       </description>
       <description id="distribution" class="text-blurb" hidden="true"/>
       <description id="distributionId" class="text-blurb" hidden="true"/>
     </vbox>
 #ifdef MOZ_UPDATER
     <spacer flex="1"/>
     <vbox>
       <button id="showUpdateHistory"
@@ -96,72 +96,72 @@
       <hbox id="apply" align="center">
         <spacer flex="1"/>
         <button id="updateButton"
                 label="&update.updateButton.label3;"
                 accesskey="&update.updateButton.accesskey;"
                 oncommand="gAppUpdater.buttonRestartAfterDownload();"/>
       </hbox>
       <hbox id="checkingForUpdates" align="center">
-        <image class="update-throbber"/><label>&update.checkingForUpdates;</label>
+        <image class="update-throbber"/><html:firefox-label>&update.checkingForUpdates;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.checkForUpdatesButton.label;"
                 accesskey="&update.checkForUpdatesButton.accesskey;"
                 disabled="true"/>
       </hbox>
       <hbox id="downloading" align="center">
-        <image class="update-throbber"/><label>&update.downloading.start;</label><label id="downloadStatus"/><label>&update.downloading.end;</label>
+        <image class="update-throbber"/><html:firefox-label>&update.downloading.start;</html:firefox-label><html:firefox-label id="downloadStatus"/><html:firefox-label>&update.downloading.end;</html:firefox-label>
       </hbox>
       <hbox id="applying" align="center">
-        <image class="update-throbber"/><label>&update.applying;</label>
+        <image class="update-throbber"/><html:firefox-label>&update.applying;</html:firefox-label>
       </hbox>
       <hbox id="downloadFailed" align="center">
-        <label>&update.failed.start;</label><label id="failedLink" class="text-link">&update.failed.linkText;</label><label>&update.failed.end;</label>
+        <html:firefox-label>&update.failed.start;</html:firefox-label><html:firefox-label id="failedLink" class="text-link">&update.failed.linkText;</html:firefox-label><html:firefox-label>&update.failed.end;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.checkForUpdatesButton.label;"
                 accesskey="&update.checkForUpdatesButton.accesskey;"
                 oncommand="gAppUpdater.checkForUpdates();"/>
       </hbox>
       <hbox id="adminDisabled" align="center">
-        <label>&update.adminDisabled;</label>
+        <html:firefox-label>&update.adminDisabled;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.checkForUpdatesButton.label;"
                 accesskey="&update.checkForUpdatesButton.accesskey;"
                 disabled="true"/>
       </hbox>
       <hbox id="noUpdatesFound" align="center">
-        <label>&update.noUpdatesFound;</label>
+        <html:firefox-label>&update.noUpdatesFound;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.checkForUpdatesButton.label;"
                 accesskey="&update.checkForUpdatesButton.accesskey;"
                 oncommand="gAppUpdater.checkForUpdates();"/>
       </hbox>
       <hbox id="otherInstanceHandlingUpdates" align="center">
-        <label>&update.otherInstanceHandlingUpdates;</label>
+        <html:firefox-label>&update.otherInstanceHandlingUpdates;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.checkForUpdatesButton.label;"
                 accesskey="&update.checkForUpdatesButton.accesskey;"
                 disabled="true"/>
       </hbox>
       <hbox id="manualUpdate" align="center">
-        <label>&update.manual.start;</label><label id="manualLink" class="text-link"/><label>&update.manual.end;</label>
+        <html:firefox-label>&update.manual.start;</html:firefox-label><html:firefox-label id="manualLink" class="text-link"/><html:firefox-label>&update.manual.end;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.checkForUpdatesButton.label;"
                 accesskey="&update.checkForUpdatesButton.accesskey;"
                 disabled="true"/>
       </hbox>
       <hbox id="unsupportedSystem" align="center">
-        <label>&update.unsupported.start;</label><label id="unsupportedLink" class="text-link">&update.unsupported.linkText;</label><label>&update.unsupported.end;</label>
+        <html:firefox-label>&update.unsupported.start;</html:firefox-label><html:firefox-label id="unsupportedLink" class="text-link">&update.unsupported.linkText;</html:firefox-label><html:firefox-label>&update.unsupported.end;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.checkForUpdatesButton.label;"
                 accesskey="&update.checkForUpdatesButton.accesskey;"
                 disabled="true"/>
       </hbox>
       <hbox id="restarting" align="center">
-        <image class="update-throbber"/><label>&update.restarting;</label>
+        <image class="update-throbber"/><html:firefox-label>&update.restarting;</html:firefox-label>
         <spacer flex="1"/>
         <button label="&update.updateButton.label3;"
                 accesskey="&update.updateButton.accesskey;"
                 disabled="true"/>
       </hbox>
     </deck>
   </vbox>
 #endif
diff --git a/browser/components/preferences/in-content-new/applications.xul b/browser/components/preferences/in-content-new/applications.xul
--- a/browser/components/preferences/in-content-new/applications.xul
+++ b/browser/components/preferences/in-content-new/applications.xul
@@ -58,27 +58,27 @@
   <key key="&focusSearch1.key;" modifiers="accel" id="focusSearch1" oncommand=";"/>
   <key key="&focusSearch2.key;" modifiers="accel" id="focusSearch2" oncommand=";"/>
 </keyset>
 
 <hbox id="header-applications"
       class="header"
       hidden="true"
       data-category="paneApplications">
-  <label class="header-name" flex="1">&paneFilesApplications.title;</label>
+  <html:firefox-label class="header-name" flex="1">&paneFilesApplications.title;</html:firefox-label>
 </hbox>
 
 <vbox id="applicationsContent"
       data-category="paneApplications"
       hidden="true"
       flex="1">
 
   <!--Downloads-->
   <groupbox id="downloadsGroup">
-    <caption><label>&downloads.label;</label></caption>
+    <caption><html:firefox-label>&downloads.label;</html:firefox-label></caption>
 
     <radiogroup id="saveWhere"
                 preference="browser.download.useDownloadDir"
                 onsyncfrompreference="return gApplicationsPane.readUseDownloadDir();">
       <hbox id="saveToRow">
         <radio id="saveTo"
               value="true"
               label="&saveTo.label;"
@@ -103,17 +103,17 @@
       <radio id="alwaysAsk"
             value="false"
             label="&alwaysAskWhere.label;"
             accesskey="&alwaysAskWhere.accesskey;"/>
     </radiogroup>
   </groupbox>
 
   <groupbox id="applicationsGroup">
-    <caption><label>&applications.label;</label></caption>
+    <caption><html:firefox-label>&applications.label;</html:firefox-label></caption>
     <description>&applications.description;</description>
     <textbox id="filter" flex="1"
              type="search"
              placeholder="&filter2.emptytext;"
              aria-controls="handlersView"/>
 
     <richlistbox id="handlersView" orient="vertical" persist="lastSelectedType"
                  preference="pref.downloads.disable_button.edit_actions"
diff --git a/browser/components/preferences/in-content-new/containers.xul b/browser/components/preferences/in-content-new/containers.xul
--- a/browser/components/preferences/in-content-new/containers.xul
+++ b/browser/components/preferences/in-content-new/containers.xul
@@ -13,24 +13,24 @@
               name="privacy.userContext.enabled"
               type="bool"/>
 
 </preferences>
 
 <hbox hidden="true"
       class="container-header-links"
       data-category="paneContainers">
-  <label class="text-link" id="backContainersLink">&backLink.label;</label>
+  <html:firefox-label class="text-link" id="backContainersLink">&backLink.label;</html:firefox-label>
 </hbox>
 
 <hbox id="header-containers"
       class="header"
       hidden="true"
       data-category="paneContainers">
-  <label class="header-name" flex="1">&paneContainers.title;</label>
+  <html:firefox-label class="header-name" flex="1">&paneContainers.title;</html:firefox-label>
 </hbox>
 
 <!-- Containers -->
 <groupbox id="browserContainersGroupPane" data-category="paneContainers" hidden="true"
           data-hidden-from-search="true" data-subpanel="true">
   <vbox id="browserContainersbox">
 
     <richlistbox id="containersView" orient="vertical" persist="lastSelectedType"
diff --git a/browser/components/preferences/in-content-new/main.xul b/browser/components/preferences/in-content-new/main.xul
--- a/browser/components/preferences/in-content-new/main.xul
+++ b/browser/components/preferences/in-content-new/main.xul
@@ -200,69 +200,69 @@
               type="bool"
               inverted="true"/>
 </preferences>
 
 <hbox id="header-general"
       class="header"
       hidden="true"
       data-category="paneGeneral">
-  <label class="header-name" flex="1">&paneGeneral.title;</label>
+  <html:firefox-label class="header-name" flex="1">&paneGeneral.title;</html:firefox-label>
 </hbox>
 
 <!-- Startup -->
 <groupbox id="startupGroup"
           data-category="paneGeneral"
           hidden="true">
-  <caption><label>&startup.label;</label></caption>
+  <caption><html:firefox-label>&startup.label;</html:firefox-label></caption>
 
 #ifdef MOZ_DEV_EDITION
   <vbox id="separateProfileBox">
     <checkbox id="separateProfileMode"
               label="&separateProfileMode.label;"/>
     <hbox align="center" class="indent">
-      <label id="useFirefoxSync">&useFirefoxSync.label;</label>
+      <html:firefox-label id="useFirefoxSync">&useFirefoxSync.label;</html:firefox-label>
       <deck id="getStarted">
-        <label class="text-link">&getStarted.notloggedin.label;</label>
-        <label class="text-link">&getStarted.configured.label;</label>
+        <html:firefox-label class="text-link">&getStarted.notloggedin.label;</html:firefox-label>
+        <html:firefox-label class="text-link">&getStarted.configured.label;</html:firefox-label>
       </deck>
     </hbox>
   </vbox>
 #endif
 
 #ifdef E10S_TESTING_ONLY
   <checkbox id="e10sAutoStart"
             label="&e10sEnabled.label;"/>
 #endif
 
 #ifdef HAVE_SHELL_SERVICE
   <vbox id="defaultBrowserBox">
     <checkbox id="alwaysCheckDefault" preference="browser.shell.checkDefaultBrowser"
               label="&alwaysCheckDefault2.label;" accesskey="&alwaysCheckDefault2.accesskey;"/>
     <deck id="setDefaultPane">
       <hbox align="center" class="indent">
-        <label id="isNotDefaultLabel" flex="1">&isNotDefault.label;</label>
+        <html:firefox-label id="isNotDefaultLabel" flex="1">&isNotDefault.label;</html:firefox-label>
         <button id="setDefaultButton"
                 class="accessory-button"
                 label="&setAsMyDefaultBrowser2.label;" accesskey="&setAsMyDefaultBrowser2.accesskey;"
                 preference="pref.general.disable_button.default_browser"/>
       </hbox>
       <hbox align="center" class="indent">
-        <label id="isDefaultLabel" flex="1">&isDefault.label;</label>
+        <html:firefox-label id="isDefaultLabel" flex="1">&isDefault.label;</html:firefox-label>
       </hbox>
     </deck>
     <separator class="thin"/>
   </vbox>
 #endif
 
   <html:table id="startupTable">
     <html:tr>
       <html:td class="label-cell">
-        <label accesskey="&startupPage2.accesskey;"
-               control="browserStartupPage">&startupPage2.label;</label>
+        <html:firefox-label accesskey="&startupPage2.accesskey;"
+               control="browserStartupPage">&startupPage2.label;</html:firefox-label>
       </html:td>
       <html:td class="content-cell">
         <menulist id="browserStartupPage"
                   class="content-cell-item"
                   preference="browser.startup.page">
           <menupopup>
           <menuitem label="&startupUserHomePage.label;"
                     value="1"
@@ -274,18 +274,18 @@
                     value="3"
                     id="browserStartupLastSession"/>
           </menupopup>
         </menulist>
       </html:td>
     </html:tr>
     <html:tr>
       <html:td class="label-cell">
-        <label accesskey="&homepage2.accesskey;"
-               control="browserHomePage">&homepage2.label;</label>
+        <html:firefox-label accesskey="&homepage2.accesskey;"
+               control="browserHomePage">&homepage2.label;</html:firefox-label>
       </html:td>
       <html:td class="content-cell">
         <textbox id="browserHomePage"
                  class="padded uri-element content-cell-item"
                  type="autocomplete"
                  autocompletesearch="unifiedcomplete"
                  onsyncfrompreference="return gMainPane.syncFromHomePref();"
                  onsynctopreference="return gMainPane.syncToHomePref(this.value);"
@@ -316,41 +316,41 @@
                 preference="pref.browser.homepage.disable_button.restore_default"/>
       </html:td>
     </html:tr>
   </html:table>
 </groupbox>
 
 <!-- Default Search Engine -->
 <groupbox id="defaultEngineGroup" data-category="paneGeneral" data-subcategory="search">
-  <caption><label>&defaultSearchEngine.label;</label></caption>
-  <label>&chooseYourDefaultSearchEngine.label;</label>
+  <caption><html:firefox-label>&defaultSearchEngine.label;</html:firefox-label></caption>
+  <html:firefox-label>&chooseYourDefaultSearchEngine.label;</html:firefox-label>
   <box align="start">
     <menulist id="defaultEngine">
       <menupopup/>
     </menulist>
   </box>
   <checkbox id="suggestionsInSearchFieldsCheckbox"
             label="&provideSearchSuggestions.label;"
             accesskey="&provideSearchSuggestions.accesskey;"
             preference="browser.search.suggest.enabled"/>
   <vbox class="indent">
     <checkbox id="urlBarSuggestion" label="&showURLBarSuggestions.label;"
               accesskey="&showURLBarSuggestions.accesskey;"
               preference="browser.urlbar.suggest.searches"/>
     <hbox id="urlBarSuggestionPermanentPBLabel"
           align="center" class="indent">
-      <label flex="1">&urlBarSuggestionsPermanentPB.label;</label>
+      <html:firefox-label flex="1">&urlBarSuggestionsPermanentPB.label;</html:firefox-label>
     </hbox>
   </vbox>
 </groupbox>
 
 <groupbox id="oneClickSearchProvidersGroup" data-category="paneGeneral" data-subcategory="search">
-  <caption><label>&oneClickSearchEngines.label;</label></caption>
-  <label>&chooseWhichOneToDisplay.label;</label>
+  <caption><html:firefox-label>&oneClickSearchEngines.label;</html:firefox-label></caption>
+  <html:firefox-label>&chooseWhichOneToDisplay.label;</html:firefox-label>
 
   <tree id="engineList" flex="1" rows="8" hidecolumnpicker="true" editable="true"
         seltype="single" allowunderflowscroll="true">
     <treechildren id="engineChildren" flex="1"/>
     <treecols>
       <treecol id="engineShown" type="checkbox" editable="true" sortable="false"/>
       <treecol id="engineName" flex="4" label="&engineNameColumn.label;" sortable="false"/>
       <treecol id="engineKeyword" flex="1" label="&engineKeywordColumn.label;" editable="true"
@@ -368,24 +368,24 @@
             label="&removeEngine.label;"
             accesskey="&removeEngine.accesskey;"
             disabled="true"/>
   </hbox>
 
   <separator class="thin"/>
 
   <hbox id="addEnginesBox" pack="start">
-    <label id="addEngines" class="text-link">&addMoreSearchEngines2.label;</label>
+    <html:firefox-label id="addEngines" class="text-link">&addMoreSearchEngines2.label;</html:firefox-label>
   </hbox>
 </groupbox>
 
 <!-- Tab preferences -->
 <groupbox data-category="paneGeneral"
           hidden="true">
-    <caption><label>&tabsGroup.label;</label></caption>
+    <caption><html:firefox-label>&tabsGroup.label;</html:firefox-label></caption>
 
     <checkbox id="ctrlTabRecentlyUsedOrder" label="&ctrlTabRecentlyUsedOrder.label;"
               accesskey="&ctrlTabRecentlyUsedOrder.accesskey;"
               preference="browser.ctrlTab.previews"/>
 
     <checkbox id="linkTargeting" label="&newWindowsAsTabs.label;"
               accesskey="&newWindowsAsTabs.accesskey;"
               preference="browser.link.open_newwindow"
@@ -408,17 +408,17 @@
     <checkbox id="showTabsInTaskbar" label="&showTabsInTaskbar.label;"
               accesskey="&showTabsInTaskbar.accesskey;"
               preference="browser.taskbar.previews.enable"/>
 #endif
 </groupbox>
 
 <!-- Accessibility -->
 <groupbox data-category="paneGeneral" id="accessibilityGroup">
-  <caption><label>&accessibility.label;</label></caption>
+  <caption><html:firefox-label>&accessibility.label;</html:firefox-label></caption>
 
 #ifdef XP_WIN
   <checkbox id="useOnScreenKeyboard"
             hidden="true"
             label="&useOnScreenKeyboard.label;"
             accesskey="&useOnScreenKeyboard.accesskey;"
             preference="ui.osk.enabled"/>
 #endif
@@ -433,17 +433,17 @@
   <checkbox id="blockAutoRefresh"
             label="&blockAutoReload.label;"
             accesskey="&blockAutoReload.accesskey;"
             preference="accessibility.blockautorefresh"/>
 </groupbox>
 
 <!-- Languages -->
 <groupbox id="languagesGroup" data-category="paneGeneral" hidden="true">
-  <caption><label>&languages.label;</label></caption>
+  <caption><html:firefox-label>&languages.label;</html:firefox-label></caption>
 
   <hbox id="languagesBox" align="center">
     <description flex="1" control="chooseLanguage">&chooseLanguage.label;</description>
     <button id="chooseLanguage"
             class="accessory-button"
             label="&chooseButton.label;"
             accesskey="&chooseButton.accesskey;"
             searchkeywords="&languages.customize.Header;
@@ -457,22 +457,22 @@
 
   <hbox id="translationBox" hidden="true">
     <hbox align="center" flex="1">
       <checkbox id="translate" preference="browser.translation.detectLanguage"
                 label="&translateWebPages.label;." accesskey="&translateWebPages.accesskey;"
                 onsyncfrompreference="return gMainPane.updateButtons('translateButton',
                                               'browser.translation.detectLanguage');"/>
       <hbox id="bingAttribution" hidden="true">
-        <label>&translation.options.attribution.beforeLogo;</label>
+        <html:firefox-label>&translation.options.attribution.beforeLogo;</html:firefox-label>
         <separator orient="vertical" class="thin"/>
         <image id="translationAttributionImage" aria-label="Microsoft Translator"
                src="chrome://browser/content/microsoft-translator-attribution.png"/>
         <separator orient="vertical" class="thin"/>
-        <label>&translation.options.attribution.afterLogo;</label>
+        <html:firefox-label>&translation.options.attribution.afterLogo;</html:firefox-label>
       </hbox>
     </hbox>
     <button id="translateButton"
             class="accessory-button"
             label="&translateExceptions.label;"
             accesskey="&translateExceptions.accesskey;"/>
   </hbox>
   <checkbox id="checkSpelling"
@@ -481,24 +481,24 @@
           onsyncfrompreference="return gMainPane.readCheckSpelling();"
           onsynctopreference="return gMainPane.writeCheckSpelling();"
           preference="layout.spellcheckDefault"/>
 </groupbox>
 
 
 <!-- Fonts and Colors -->
 <groupbox id="fontsGroup" data-category="paneGeneral" hidden="true">
-  <caption><label>&fontsAndColors.label;</label></caption>
+  <caption><html:firefox-label>&fontsAndColors.label;</html:firefox-label></caption>
 
   <vbox>
     <hbox id="fontSettings">
       <hbox align="center">
-        <label control="defaultFont" accesskey="&defaultFont2.accesskey;">&defaultFont2.label;</label>
+        <html:firefox-label control="defaultFont" accesskey="&defaultFont2.accesskey;">&defaultFont2.label;</html:firefox-label>
         <menulist id="defaultFont" delayprefsave="true" onsyncfrompreference="return FontBuilder.readFontSelection(this);"/>
-        <label id="defaultFontSizeLabel" control="defaultFontSize" accesskey="&defaultSize2.accesskey;">&defaultSize2.label;</label>
+        <html:firefox-label id="defaultFontSizeLabel" control="defaultFontSize" accesskey="&defaultSize2.accesskey;">&defaultSize2.label;</html:firefox-label>
         <menulist id="defaultFontSize" delayprefsave="true">
           <menupopup>
             <menuitem value="9" label="9"/>
             <menuitem value="10" label="10"/>
             <menuitem value="11" label="11"/>
             <menuitem value="12" label="12"/>
             <menuitem value="13" label="13"/>
             <menuitem value="14" label="14"/>
@@ -607,56 +607,56 @@
                               &linkColor.label;
                               &visitedLinkColor.label;"/>
     </hbox>
   </vbox>
 </groupbox>
 
 <!-- Browsing -->
 <groupbox id="browsingGroup" data-category="paneGeneral">
-  <caption><label>&browsing.label;</label></caption>
+  <caption><html:firefox-label>&browsing.label;</html:firefox-label></caption>
 
   <checkbox id="useAutoScroll"
             label="&useAutoScroll.label;"
             accesskey="&useAutoScroll.accesskey;"
             preference="general.autoScroll"/>
   <checkbox id="useSmoothScrolling"
             label="&useSmoothScrolling.label;"
             accesskey="&useSmoothScrolling.accesskey;"
             preference="general.smoothScroll"/>
 </groupbox>
 
 <!-- Performance -->
 <groupbox id="performanceGroup" data-category="paneGeneral" hidden="true">
-  <caption><label>&performance.label;</label></caption>
+  <caption><html:firefox-label>&performance.label;</html:firefox-label></caption>
 
   <hbox align="center">
     <checkbox id="useRecommendedPerformanceSettings"
               label="&useRecommendedPerformanceSettings2.label;"
               accesskey="&useRecommendedPerformanceSettings2.accesskey;"
               preference="browser.preferences.defaultPerformanceSettings.enabled"/>
-    <label id="performanceSettingsLearnMore" class="learnMore text-link">&performanceSettingsLearnMore.label;</label>
+    <html:firefox-label id="performanceSettingsLearnMore" class="learnMore text-link">&performanceSettingsLearnMore.label;</html:firefox-label>
   </hbox>
   <description class="indent">&useRecommendedPerformanceSettings2.description;</description>
 
   <vbox id="performanceSettings" class="indent" hidden="true">
     <checkbox id="allowHWAccel"
               label="&allowHWAccel.label;"
               accesskey="&allowHWAccel.accesskey;"
               preference="layers.acceleration.disabled"/>
     <hbox align="center">
-      <label id="limitContentProcess" accesskey="&limitContentProcessOption.accesskey;" control="contentProcessCount">&limitContentProcessOption.label;</label>
+      <html:firefox-label id="limitContentProcess" accesskey="&limitContentProcessOption.accesskey;" control="contentProcessCount">&limitContentProcessOption.label;</html:firefox-label>
       <menulist id="contentProcessCount" preference="dom.ipc.processCount">
         <menupopup>
           <menuitem label="1" value="1"/>
           <menuitem label="2" value="2"/>
           <menuitem label="3" value="3"/>
           <menuitem label="4" value="4"/>
           <menuitem label="5" value="5"/>
           <menuitem label="6" value="6"/>
           <menuitem label="7" value="7"/>
         </menupopup>
       </menulist>
     </hbox>
     <description id="contentProcessCountEnabledDescription">&limitContentProcessOption.description;</description>
-    <description id="contentProcessCountDisabledDescription">&limitContentProcessOption.disabledDescription;<label class="text-link" href="https://wiki.mozilla.org/Electrolysis">&limitContentProcessOption.disabledDescriptionLink;</label></description>
+    <description id="contentProcessCountDisabledDescription">&limitContentProcessOption.disabledDescription;<html:firefox-label class="text-link" href="https://wiki.mozilla.org/Electrolysis">&limitContentProcessOption.disabledDescriptionLink;</html:firefox-label></description>
   </vbox>
 </groupbox>
diff --git a/browser/components/preferences/in-content-new/preferences.xul b/browser/components/preferences/in-content-new/preferences.xul
--- a/browser/components/preferences/in-content-new/preferences.xul
+++ b/browser/components/preferences/in-content-new/preferences.xul
@@ -126,73 +126,73 @@
       <richlistitem id="category-search-results"
                     class="category"
                     value="paneSearchResults"
                     helpTopic="prefs-main"
                     tooltiptext="&paneSearchResults.title;"
                     align="center"
                     hidden="true">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneSearchResults.title;</label>
+        <html:firefox-label class="category-name" flex="1">Hi</html:firefox-label>
       </richlistitem>
 
       <richlistitem id="category-general"
                     class="category"
                     value="paneGeneral"
                     helpTopic="prefs-main"
                     tooltiptext="&paneGeneral.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneGeneral.title;</label>
+        <html:firefox-label class="category-name" flex="1">&paneGeneral.title;</html:firefox-label>
       </richlistitem>
 
       <richlistitem id="category-application"
                     class="category"
                     value="paneApplications"
                     helpTopic="prefs-applications"
                     tooltiptext="&paneFilesApplications.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneFilesApplications.title;</label>
+        <html:firefox-label class="category-name" flex="1">&paneFilesApplications.title;</html:firefox-label>
       </richlistitem>
 
       <richlistitem id="category-containers"
                     class="category"
                     value="paneContainers"
                     helpTopic="prefs-containers"
                     hidden="true"/>
 
       <richlistitem id="category-sync"
                     class="category"
                     value="paneSync"
                     helpTopic="prefs-weave"
                     tooltiptext="&paneSync1.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneSync1.title;</label>
+        <html:firefox-label class="category-name" flex="1">&paneSync1.title;</html:firefox-label>
       </richlistitem>
 
       <richlistitem id="category-privacy"
                     class="category"
                     value="panePrivacy"
                     helpTopic="prefs-privacy"
                     tooltiptext="&panePrivacySecurity.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&panePrivacySecurity.title;</label>
+        <html:firefox-label class="category-name" flex="1">&panePrivacySecurity.title;</html:firefox-label>
       </richlistitem>
 
       <richlistitem id="category-advanced"
                     class="category"
                     value="paneAdvanced"
                     helpTopic="prefs-advanced-general"
                     tooltiptext="&paneUpdates.title;"
                     align="center">
         <image class="category-icon"/>
-        <label class="category-name" flex="1">&paneUpdates.title;</label>
+        <html:firefox-label class="category-name" flex="1">&paneUpdates.title;</html:firefox-label>
       </richlistitem>
     </richlistbox>
 
     <keyset>
       <!-- Disable the findbar because it doesn't work properly.
            Remove this keyset once bug 1094240 ("disablefastfind" attribute
            broken in e10s mode) is fixed. -->
       <key key="&focusSearch1.key;" modifiers="accel" id="focusSearch1" oncommand=";"/>
@@ -230,9 +230,13 @@
                 aria-label="&preferencesCloseButton.label;"/>
       </caption>
       <browser class="dialogFrame"
                autoscroll="false"
                disablehistory="true"/>
     </groupbox>
   </vbox>
   </stack>
+
+  <script type="application/javascript" src="chrome://browser/content/customelements/custom-elements.js"/>
+  <script type="application/javascript" src="chrome://browser/content/customelements/base-element.js"/>
+  <script type="application/javascript" src="chrome://browser/content/customelements/firefox-label.js"/>
 </page>
diff --git a/browser/components/preferences/in-content-new/searchResults.xul b/browser/components/preferences/in-content-new/searchResults.xul
--- a/browser/components/preferences/in-content-new/searchResults.xul
+++ b/browser/components/preferences/in-content-new/searchResults.xul
@@ -3,15 +3,15 @@
    - You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
 <stringbundle id="searchResultBundle" src="chrome://browser/locale/preferences/preferences.properties"/>
 
 <hbox id="header-searchResults"
       class="header"
       hidden="true"
       data-category="paneSearchResults">
-  <label class="header-name" flex="1">&paneSearchResults.title;</label>
+  <html:firefox-label class="header-name" flex="1">&paneSearchResults.title;</html:firefox-label>
 </hbox>
 
 <groupbox class="no-results-message" align="start" data-category="paneSearchResults" hidden="true">
-  <label id="sorry-message"></label>
-  <label id="need-help"></label>
+  <html:firefox-label id="sorry-message"></html:firefox-label>
+  <html:firefox-label id="need-help"></html:firefox-label>
 </groupbox>
diff --git a/browser/components/preferences/in-content-new/sync.xul b/browser/components/preferences/in-content-new/sync.xul
--- a/browser/components/preferences/in-content-new/sync.xul
+++ b/browser/components/preferences/in-content-new/sync.xul
@@ -27,78 +27,78 @@
 
 <script type="application/javascript"
         src="chrome://browser/content/preferences/in-content-new/sync.js"/>
 
 <hbox id="header-sync"
       class="header"
       hidden="true"
       data-category="paneSync">
-  <label class="header-name" flex="1">&paneSync1.title;</label>
+  <html:firefox-label class="header-name" flex="1">&paneSync1.title;</html:firefox-label>
 </hbox>
 
 <deck id="weavePrefsDeck" data-category="paneSync" hidden="true">
   <vbox id="noFxaAccount">
     <hbox>
       <vbox id="fxaContentWrapper">
         <groupbox id="noFxaGroup">
           <vbox>
-            <label id="noFxaCaption">&signedOut.caption;</label>
+            <html:firefox-label id="noFxaCaption">&signedOut.caption;</html:firefox-label>
             <description id="noFxaDescription" flex="1">&signedOut.description;</description>
             <hbox class="fxaAccountBox">
               <vbox>
                 <image class="fxaFirefoxLogo"/>
               </vbox>
               <vbox flex="1">
-                <label id="signedOutAccountBoxTitle">&signedOut.accountBox.title;</label>
+                <html:firefox-label id="signedOutAccountBoxTitle">&signedOut.accountBox.title;</html:firefox-label>
                 <hbox class="fxaAccountBoxButtons">
                   <button id="noFxaSignUp" label="&signedOut.accountBox.create;" accesskey="&signedOut.accountBox.create.accesskey;"></button>
                   <button id="noFxaSignIn" label="&signedOut.accountBox.signin;" accesskey="&signedOut.accountBox.signin.accesskey;"></button>
                 </hbox>
               </vbox>
             </hbox>
           </vbox>
         </groupbox>
       </vbox>
       <vbox>
         <html:img class="fxaSyncIllustration" src="chrome://browser/skin/fxa/sync-illustration.svg"/>
       </vbox>
     </hbox>
-    <label class="fxaMobilePromo">
+    <html:firefox-label class="fxaMobilePromo">
         &mobilePromo3.start;<!-- We put these comments to avoid inserting white spaces
-        --><label id="fxaMobilePromo-android"
+        --><html:firefox-label id="fxaMobilePromo-android"
                   class="androidLink text-link"><!--
-        -->&mobilePromo3.androidLink;</label><!--
+        -->&mobilePromo3.androidLink;</html:firefox-label><!--
         -->&mobilePromo3.iOSBefore;<!--
-        --><label id="fxaMobilePromo-ios"
+        --><html:firefox-label id="fxaMobilePromo-ios"
                   class="iOSLink text-link"><!--
-        -->&mobilePromo3.iOSLink;</label><!--
+        -->&mobilePromo3.iOSLink;</html:firefox-label><!--
         -->&mobilePromo3.end;
-    </label>
+    </html:firefox-label>
   </vbox>
 
   <vbox id="hasFxaAccount">
     <hbox>
       <vbox id="fxaContentWrapper">
         <groupbox id="fxaGroup">
-          <caption><label>&syncBrand.fxAccount.label;</label></caption>
+          <caption><html:firefox-label>&syncBrand.fxAccount.label;</html:firefox-label></caption>
           <deck id="fxaLoginStatus">
 
             <!-- logged in and verified and all is good -->
             <hbox id="fxaLoginVerified" class="fxaAccountBox">
               <vbox align="center" pack="center">
                 <image id="fxaProfileImage" class="actionable"
                     role="button"
                     onclick="gSyncPane.openChangeProfileImage(event);"
                     onkeypress="gSyncPane.openChangeProfileImage(event);"
                     tooltiptext="&profilePicture.tooltip;"/>
               </vbox>
               <vbox flex="1" pack="center">
-                <label id="fxaDisplayName" hidden="true"/>
-                <label id="fxaEmailAddress1"/>
+                <html:firefox-label id="fxaDisplayName" hidden="true"/>
+                <html:firefox-label id="fxaEmailAddress1"/>
                 <hbox class="fxaAccountBoxButtons">
                   <button id="fxaUnlinkButton" label="&disconnect3.label;" accesskey="&disconnect3.accesskey;"/>
                   <html:a id="verifiedManage" target="_blank"
                          accesskey="&verifiedManage.accesskey;"
                          onkeypress="gSyncPane.openManageFirefoxAccount(event);"><!--
                   -->&verifiedManage.label;</html:a>
                 </hbox>
               </vbox>
@@ -109,17 +109,17 @@
               <vbox>
                 <image id="fxaProfileImage"/>
               </vbox>
               <vbox flex="1">
                 <hbox>
                   <vbox><image id="fxaLoginRejectedWarning"/></vbox>
                   <description flex="1">
                     &signedInUnverified.beforename.label;
-                    <label id="fxaEmailAddress2"/>
+                    <html:firefox-label id="fxaEmailAddress2"/>
                     &signedInUnverified.aftername.label;
                   </description>
                 </hbox>
                 <hbox class="fxaAccountBoxButtons">
                   <button id="verifyFxaAccount" label="&verify.label;" accesskey="&verify.accesskey;"></button>
                   <button id="unverifiedUnlinkFxaAccount" label="&forget.label;" accesskey="&forget.accesskey;"></button>
                 </hbox>
               </vbox>
@@ -130,30 +130,30 @@
               <vbox>
                 <image id="fxaProfileImage"/>
               </vbox>
               <vbox flex="1">
                 <hbox>
                   <vbox><image id="fxaLoginRejectedWarning"/></vbox>
                   <description flex="1">
                     &signedInLoginFailure.beforename.label;
-                    <label id="fxaEmailAddress3"/>
+                    <html:firefox-label id="fxaEmailAddress3"/>
                     &signedInLoginFailure.aftername.label;
                   </description>
                 </hbox>
                 <hbox class="fxaAccountBoxButtons">
                   <button id="rejectReSignIn" label="&signIn.label;" accesskey="&signIn.accesskey;"></button>
                   <button id="rejectUnlinkFxaAccount" label="&forget.label;" accesskey="&forget.accesskey;"></button>
                 </hbox>
               </vbox>
             </hbox>
           </deck>
         </groupbox>
         <groupbox id="syncOptions">
-          <caption><label>&signedIn.settings.label;</label></caption>
+          <caption><html:firefox-label>&signedIn.settings.label;</html:firefox-label></caption>
           <description>&signedIn.settings.description;</description>
           <hbox id="fxaSyncEngines">
             <vbox align="start" flex="1">
               <checkbox label="&engine.tabs.label2;"
                         accesskey="&engine.tabs.accesskey;"
                         preference="engine.tabs"/>
               <checkbox label="&engine.bookmarks.label;"
                         accesskey="&engine.bookmarks.accesskey;"
@@ -178,19 +178,19 @@
         </groupbox>
       </vbox>
       <vbox>
         <html:img  class="fxaSyncIllustration" src="chrome://browser/skin/fxa/sync-illustration.svg"/>
       </vbox>
     </hbox>
     <groupbox>
       <caption>
-        <label control="fxaSyncComputerName">
+        <html:firefox-label control="fxaSyncComputerName">
           &fxaSyncDeviceName.label;
-        </label>
+        </html:firefox-label>
       </caption>
       <hbox id="fxaDeviceName">
         <textbox id="fxaSyncComputerName" disabled="true"/>
         <hbox>
           <button id="fxaChangeDeviceName"
                   label="&changeSyncDeviceName2.label;"
                   accesskey="&changeSyncDeviceName2.accesskey;"/>
           <button id="fxaCancelChangeDeviceName"
@@ -199,27 +199,27 @@
                   hidden="true"/>
           <button id="fxaSaveChangeDeviceName"
                   label="&saveChangeSyncDeviceName.label;"
                   accesskey="&saveChangeSyncDeviceName.accesskey;"
                   hidden="true"/>
         </hbox>
       </hbox>
     </groupbox>
-    <label class="fxaMobilePromo">
+    <html:firefox-label class="fxaMobilePromo">
         &mobilePromo3.start;<!-- We put these comments to avoid inserting white spaces
-        --><label class="androidLink text-link" id="fxaMobilePromo-android-hasFxaAccount"><!--
-        -->&mobilePromo3.androidLink;</label><!--
+        --><html:firefox-label class="androidLink text-link" id="fxaMobilePromo-android-hasFxaAccount"><!--
+        -->&mobilePromo3.androidLink;</html:firefox-label><!--
         -->&mobilePromo3.iOSBefore;<!--
-        --><label class="iOSLink text-link" id="fxaMobilePromo-ios-hasFxaAccount"><!--
-        -->&mobilePromo3.iOSLink;</label><!--
+        --><html:firefox-label class="iOSLink text-link" id="fxaMobilePromo-ios-hasFxaAccount"><!--
+        -->&mobilePromo3.iOSLink;</html:firefox-label><!--
         -->&mobilePromo3.end;
-    </label>
+    </html:firefox-label>
     <vbox id="tosPP-small" align="start">
-      <label id="tosPP-small-ToS" class="text-link">
+      <html:firefox-label id="tosPP-small-ToS" class="text-link">
         &prefs.tosLink.label;
-      </label>
-      <label id="tosPP-small-PP" class="text-link">
+      </html:firefox-label>
+      <html:firefox-label id="tosPP-small-PP" class="text-link">
         &fxaPrivacyNotice.link.label;
-      </label>
+      </html:firefox-label>
     </vbox>
   </vbox>
 </deck>
diff --git a/browser/themes/shared/customelements/custom-elements.inc.css b/browser/themes/shared/customelements/custom-elements.inc.css
new file mode 100644
--- /dev/null
+++ b/browser/themes/shared/customelements/custom-elements.inc.css
@@ -0,0 +1,21 @@
+%if 0
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+%endif
+
+html|firefox-label {
+  display: -moz-box;
+  position: relative;
+}
+
+/* Not sure why, but doing relative parent > absolute child allows wrapping */
+html|firefox-label > html|label {
+  /*position: absolute;*/
+}
+
+
+/* By default, label text does not wrap. To enable wrapping, use a text node instead of the value attribute. */
+html|firefox-label[value] {
+  display: -moz-box;
+}
\ No newline at end of file
diff --git a/browser/themes/shared/incontentprefs/preferences.inc.css b/browser/themes/shared/incontentprefs/preferences.inc.css
--- a/browser/themes/shared/incontentprefs/preferences.inc.css
+++ b/browser/themes/shared/incontentprefs/preferences.inc.css
@@ -1,15 +1,17 @@
 %if 0
 /* - This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this file,
    - You can obtain one at http://mozilla.org/MPL/2.0/. */
 %endif
 @namespace html "http://www.w3.org/1999/xhtml";
 
+%include ../customelements/custom-elements.inc.css
+
 #mainPrefPane {
   max-width: 800px;
   padding: 0;
   font: message-box;
   font-size: 1.25rem;
 }
 
 * {
diff --git a/browser/themes/shared/jar.inc.mn b/browser/themes/shared/jar.inc.mn
--- a/browser/themes/shared/jar.inc.mn
+++ b/browser/themes/shared/jar.inc.mn
@@ -28,16 +28,17 @@
 * skin/classic/browser/controlcenter/conn-not-secure.svg       (../shared/controlcenter/conn-not-secure.svg)
 * skin/classic/browser/controlcenter/connection.svg            (../shared/controlcenter/connection.svg)
 * skin/classic/browser/controlcenter/mcb-disabled.svg          (../shared/controlcenter/mcb-disabled.svg)
   skin/classic/browser/controlcenter/extension.svg             (../shared/controlcenter/extension.svg)
 * skin/classic/browser/controlcenter/permissions.svg           (../shared/controlcenter/permissions.svg)
 * skin/classic/browser/controlcenter/tracking-protection.svg   (../shared/controlcenter/tracking-protection.svg)
   skin/classic/browser/controlcenter/warning-gray.svg          (../shared/controlcenter/warning-gray.svg)
   skin/classic/browser/controlcenter/warning-yellow.svg        (../shared/controlcenter/warning-yellow.svg)
+* skin/classic/browser/customelements/custom-elements.inc.css  (../shared/customelements/custom-elements.inc.css)
   skin/classic/browser/customizableui/customizeFavicon.ico     (../shared/customizableui/customizeFavicon.ico)
   skin/classic/browser/customizableui/customize-illustration.png  (../shared/customizableui/customize-illustration.png)
   skin/classic/browser/customizableui/customize-illustration@2x.png  (../shared/customizableui/customize-illustration@2x.png)
   skin/classic/browser/customizableui/customize-illustration-rtl.png  (../shared/customizableui/customize-illustration-rtl.png)
   skin/classic/browser/customizableui/customize-illustration-rtl@2x.png  (../shared/customizableui/customize-illustration-rtl@2x.png)
   skin/classic/browser/customizableui/info-icon-customizeTip.png  (../shared/customizableui/info-icon-customizeTip.png)
   skin/classic/browser/customizableui/info-icon-customizeTip@2x.png  (../shared/customizableui/info-icon-customizeTip@2x.png)
   skin/classic/browser/customizableui/menuPanel-customizeFinish.png  (../shared/customizableui/menuPanel-customizeFinish.png)
diff --git a/toolkit/themes/shared/in-content/common.inc.css b/toolkit/themes/shared/in-content/common.inc.css
--- a/toolkit/themes/shared/in-content/common.inc.css
+++ b/toolkit/themes/shared/in-content/common.inc.css
@@ -71,24 +71,24 @@ html|hr {
 
 xul|caption {
   -moz-appearance: none;
   margin: 0;
 }
 
 html|h2,
 xul|caption > xul|checkbox,
-xul|caption > xul|label {
+xul|caption > html|accesskey-label {
   font-size: 1.3rem;
   font-weight: bold;
   line-height: 22px;
 }
 
 xul|caption > xul|checkbox,
-xul|caption > xul|label {
+xul|caption > html|accesskey-label {
   margin: 0 !important;
 }
 
 *|*.main-content {
   padding-top: 40px;
   padding-inline-end: 44px; /* compensate the 4px margin of child elements */
   padding-bottom: 48px;
   padding-inline-start: 48px;
@@ -105,17 +105,17 @@ xul|groupbox {
   -moz-appearance: none;
   border: none;
   margin: 15px 0 0;
   padding-inline-start: 0;
   padding-inline-end: 0;
   font-size: 1.25rem;
 }
 
-xul|groupbox xul|label:not(.menu-accel):not(.menu-text):not(.indent):not(.learnMore),
+xul|groupbox html|accesskey-label:not(.menu-accel):not(.menu-text):not(.indent):not(.learnMore),
 xul|groupbox xul|description {
   /* !important needed to override toolkit !important rule */
   margin-inline-start: 0 !important;
   margin-inline-end: 0 !important;
 }
 
 /* tabpanels and tabs */
 
