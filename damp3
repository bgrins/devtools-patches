# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  f148d84038400a368315d1d0391ed0ea498ca676
damp3

diff --git a/testing/talos/talos/tests/devtools/addon/content/damp.js b/testing/talos/talos/tests/devtools/addon/content/damp.js
--- a/testing/talos/talos/tests/devtools/addon/content/damp.js
+++ b/testing/talos/talos/tests/devtools/addon/content/damp.js
@@ -34,31 +34,34 @@ Damp.prototype = {
     });
   },
 
   closeCurrentTab: function() {
     this._win.BrowserCloseTabOrWindow();
     return this._win.gBrowser.selectedTab;
   },
 
-  reloadPage: function() {
+  reloadPage: Task.async(function*() {
+    yield new Promise(resolve => {
+      setTimeout(resolve, this._config.rest);
+    });
     let startReloadTimestamp = performance.now();
     return new Promise((resolve, reject) => {
       let browser = gBrowser.selectedBrowser;
       let self = this;
       browser.addEventListener("load", function onload() {
         browser.removeEventListener("load", onload, true);
         let stopReloadTimestamp = performance.now();
         resolve({
           time: stopReloadTimestamp - startReloadTimestamp
         });
       }, true);
       browser.reload();
     });
-  },
+  }),
 
   openToolbox: function (tool = "webconsole") {
     let tab = getActiveTab(getMostRecentBrowserWindow());
     let target = devtools.TargetFactory.forTab(tab);
     let startRecordTimestamp = performance.now();
     let showPromise = gDevTools.showToolbox(target, tool);
 
     return showPromise.then(toolbox => {
@@ -347,16 +350,19 @@ Damp.prototype = {
     yield new Promise(resolve => {
       setTimeout(resolve, this._config.rest);
     });
     return tab;
   }),
 
   testTeardown: Task.async(function*(url) {
     this.closeCurrentTab();
+    yield new Promise(resolve => {
+      setTimeout(resolve, this._config.rest);
+    });
     this._nextCommand();
   }),
 
   // Everything below here are common pieces needed for the test runner to function,
   // just copy and pasted from Tart with /s/TART/DAMP
 
   _win: undefined,
   _dampTab: undefined,
