# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1567102271 25200
#      Thu Aug 29 11:11:11 2019 -0700
# Node ID b4de7fb5e0f163e06463e4cfeb6d298298e28081
# Parent  0cbdbc5f1be79c0eb289c4862e819dcd6ffaa182
Bug 1573158 - Work around ::part selector not applying to imported document fragment

In the meantime, reset the [part] attribute to itself after appending into the Shadow Root.

Differential Revision: https://phabricator.services.mozilla.com/D44025

diff --git a/browser/components/places/content/places-menupopup.js b/browser/components/places/content/places-menupopup.js
--- a/browser/components/places/content/places-menupopup.js
+++ b/browser/components/places/content/places-menupopup.js
@@ -29,16 +29,23 @@
       ];
       for (let event_name of event_names) {
         this.addEventListener(event_name, ev => this[`on_${event_name}`](ev));
       }
 
       this.attachShadow({ mode: "open" });
       this.shadowRoot.appendChild(this.fragment);
 
+      // Work around Bug 1577592 (::part not matching on the imported fragment).
+      for (let part of this.shadowRoot.querySelectorAll("[part]")) {
+        let attr = part.getAttribute("part");
+        part.removeAttribute("part");
+        part.setAttribute("part", attr);
+      }
+
       this._indicatorBar = this.shadowRoot.querySelector(
         "[part=drop-indicator-bar]"
       );
       this._scrollBox = this.shadowRoot.querySelector(".popup-internal-box");
     }
 
     get fragment() {
       if (!this.constructor.hasOwnProperty("_fragment")) {
