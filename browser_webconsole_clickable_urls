# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  a97eec37ec2d4ded719ad996d75c431b7043fa5a
Bug 1253510 - Don't use CPOW inside the checkOutputForInputs webconsole helper function;r=pbro

diff --git a/devtools/client/webconsole/test/head.js b/devtools/client/webconsole/test/head.js
--- a/devtools/client/webconsole/test/head.js
+++ b/devtools/client/webconsole/test/head.js
@@ -1562,24 +1562,27 @@ function checkOutputForInputs(hud, input
     ok(entry.inspectable, "variables view was shown");
 
     resolve(null);
   }
 
   function onTabOpen(entry, {resolve, reject}, event) {
     container.removeEventListener("TabOpen", entry._onTabOpen, true);
     entry._onTabOpen = null;
-
     let tab = event.target;
     let browser = gBrowser.getBrowserForTab(tab);
-    loadBrowser(browser).then(() => {
-      let uri = content.location.href;
+
+    Task.spawn(function* () {
+      yield loadBrowser(browser);
+      let uri = yield ContentTask.spawn(gBrowser.selectedBrowser, {}, function* () {
+        return content.location.href;
+      });
       ok(entry.expectedTab && entry.expectedTab == uri,
          "opened tab '" + uri + "', expected tab '" + entry.expectedTab + "'");
-      return closeTab(tab);
+      yield closeTab(tab);
     }).then(resolve, reject);
   }
 
   return Task.spawn(runner);
 }
 
 
 /**
