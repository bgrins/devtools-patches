# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  cc8c3aefbaea06b90331cc0e02f769d1a055ad1e

diff --git a/browser/components/preferences/in-content-new/preferences.js b/browser/components/preferences/in-content-new/preferences.js
--- a/browser/components/preferences/in-content-new/preferences.js
+++ b/browser/components/preferences/in-content-new/preferences.js
@@ -597,17 +597,17 @@ Object.assign(Preference.prototype, {
   },
 
   updateElements() {
     if (!this.id)
       return;
 
     // This "change" event handler tracks changes made to preferences by
     // sources other than the user in this window.
-    var elements = document.getElementsByAttribute("preference", this.id);
+    var elements = document.querySelectorAll(`[preference="${this.id}"]`);
     for (var i = 0; i < elements.length; ++i)
       this.setElementValue(elements[i]);
   },
 
   onchange() {
     this.updateElements();
   },
 
@@ -670,21 +670,21 @@ Object.defineProperties(Preference.proto
       return this._disabled;
     },
     set: function (val) {
       this._disabled = !!val;
 
       if (!this.id)
         return val;
 
-      var elements = document.getElementsByAttribute("preference", this.id);
+      var elements = document.querySelectorAll(`preference=["${this.id}"]`);
       for (var i = 0; i < elements.length; ++i) {
         elements[i].disabled = val;
 
-        var labels = document.getElementsByAttribute("control", elements[i].id);
+        var labels = document.querySelectorAll(`control=["${elements[i].id}"]`);
         for (var j = 0; j < labels.length; ++j)
           labels[j].disabled = val;
       }
 
       return val;
     },
   },
 
diff --git a/browser/components/preferences/in-content-new/preferences.xhtml b/browser/components/preferences/in-content-new/preferences.xhtml
--- a/browser/components/preferences/in-content-new/preferences.xhtml
+++ b/browser/components/preferences/in-content-new/preferences.xhtml
@@ -77,17 +77,18 @@
 %applicationsDTD;
 %advancedDTD;
 ]>
 
 #ifdef XP_WIN
 #define USE_WIN_TITLE_STYLE
 #endif
 
-<html xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+<html xmlns="http://www.w3.org/1999/xhtml"
+      xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
       disablefastfind="true">
   <html:head>
 #ifdef USE_WIN_TITLE_STYLE
   <html:title>&prefWindow.titleWin;</html:title>
 #else
   <html:title>&prefWindow.title;</html:title>
 #endif
@@ -99,29 +100,29 @@
           src="chrome://browser/content/utilityOverlay.js"></html:script>
   <html:script 
           src="chrome://browser/content/preferences/in-content-new/preferences.js"></html:script>
   <html:script src="chrome://browser/content/preferences/in-content-new/findInPage.js"></html:script>
   <html:script src="chrome://browser/content/preferences/in-content-new/subdialogs.js"></html:script>
 
   </html:head>
   <html:body>
-  <stringbundle id="bundleBrand"
+  <xul:stringbundle id="bundleBrand"
                 src="chrome://branding/locale/brand.properties"/>
-  <stringbundle id="bundlePreferences"
+  <xul:stringbundle id="bundlePreferences"
                 src="chrome://browser/locale/preferences/preferences.properties"/>
-  <stringbundle id="pkiBundle"
+  <xul:stringbundle id="pkiBundle"
                 src="chrome://pippki/locale/pippki.properties"/>
-  <stringbundle id="browserBundle"
+  <xul:stringbundle id="browserBundle"
                 src="chrome://browser/locale/browser.properties"/>
 
-  <stringbundleset id="appManagerBundleset">
-    <stringbundle id="appManagerBundle"
+  <xul:stringbundleset id="appManagerBundleset">
+    <xul:stringbundle id="appManagerBundle"
                   src="chrome://browser/locale/preferences/applicationManager.properties"/>
-  </stringbundleset>
+  </xul:stringbundleset>
 
   <stack flex="1">
   <hbox flex="1">
 
     <!-- category list -->
     <richlistbox id="categories">
       <richlistitem id="category-search-results"
                     class="category"
@@ -200,25 +201,25 @@
 
     <html:a class="help-button" target="_blank" aria-label="&helpButton2.label;">&helpButton2.label;</html:a>
 
     <vbox class="main-content" flex="1">
       <hbox pack="end">
         <textbox type="search" id="searchInput" placeholder="&searchInput.label;" hidden="true"
                  clickSelectsAll="true"/>
       </hbox>
-      <vbox id="mainPrefPane">
+      <prefpane id="mainPrefPane">
 #include searchResults.xhtml
 #include main.xhtml
 #include privacy.xhtml
 #include containers.xhtml
 #include advanced.xhtml
 #include applications.xhtml
 #include sync.xhtml
-      </vbox>
+      </prefpane>
     </vbox>
   </hbox>
 
   <stack id="dialogStack" hidden="true"/>
   <vbox id="dialogTemplate" class="dialogOverlay" align="center" pack="center" topmost="true" hidden="true">
     <groupbox class="dialogBox"
               orient="vertical"
               pack="end"
diff --git a/browser/themes/shared/customelements/custom-elements.inc.css b/browser/themes/shared/customelements/custom-elements.inc.css
--- a/browser/themes/shared/customelements/custom-elements.inc.css
+++ b/browser/themes/shared/customelements/custom-elements.inc.css
@@ -13,9 +13,48 @@ html|firefox-label {
 html|firefox-label > html|label {
   /*position: absolute;*/
 }
 
 
 /* By default, label text does not wrap. To enable wrapping, use a text node instead of the value attribute. */
 html|firefox-label[value] {
   display: -moz-box;
+}
+
+
+box, hbox, vbox, spacer {
+  display: flex;
+  flex-basis: 0;
+  white-space: pre;
+}
+
+hbox {
+  flex-flow: row;
+}
+
+vbox {
+  flex-flow: column;
+}
+
+[flex="1"] { flex-grow: 1 }
+[flex="2"] { flex-grow: 2 }
+[flex="3"] { flex-grow: 3 }
+[flex="4"] { flex-grow: 4 }
+[flex="5"] { flex-grow: 5 }
+[flex="6"] { flex-grow: 6 }
+[flex="7"] { flex-grow: 7 }
+[flex="8"] { flex-grow: 8 }
+[flex="9"] { flex-grow: 9 }
+
+[align="start"] { align-items: flex-start }
+[align="center"] { align-items: center }
+[align="end"] { align-items: flex-end }
+[align="baseline"] { align-items: flex-baseline }
+[align="stretch"] { align-items: flex-stretch }
+
+[pack="start"] { justify-content: flex-start }
+[pack="center"] { justify-content: center }
+[pack="end"] { justify-content: flex-end }
+
+stack {
+  display: -moz-stack;
 }
\ No newline at end of file
