# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  03528cc2928fbe2075fdb4c47f1cf2eb6e0d0b3a
Bug 1573158 - Move menupopup-drop-indicator styles back into browser.css using Shadow Parts and out of inline styles

This reverts removals like https://hg.mozilla.org/mozilla-central/rev/bd7cd9d7b6ad#l8.12

diff --git a/browser/components/places/content/places-menupopup.js b/browser/components/places/content/places-menupopup.js
--- a/browser/components/places/content/places-menupopup.js
+++ b/browser/components/places/content/places-menupopup.js
@@ -30,81 +30,31 @@
       for (let event_name of event_names) {
         this.addEventListener(event_name, ev => this[`on_${event_name}`](ev));
       }
 
       this.attachShadow({ mode: "open" });
     }
 
     get commonStyles() {
-      let s = "";
       if (this.closest("#BMB_bookmarksPopup")) {
-        s = `
+        return `
         /* Remove padding on xul:arrowscrollbox to avoid extra padding on footer */
         arrowscrollbox.popup-internal-box {
           padding-bottom: 0px;
         }
         .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-up,
         .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-down {
           -moz-appearance: none;
           margin-top: 0;
           margin-bottom: 0;
         }
       `;
       }
-
-      switch (AppConstants.platform) {
-        case "macosx":
-          return `${s}
-          .menupopup-drop-indicator-bar {
-            position: relative;
-            /* these two margins must together compensate the indicator's height */
-            margin-top: -1px;
-            margin-bottom: -1px;
-          }
-          .menupopup-drop-indicator {
-            list-style-image: none;
-            height: 2px;
-            margin-inline-end: -4em;
-            background-color: Highlight;
-          }
-        `;
-        case "linux":
-          return `${s}
-          .menupopup-drop-indicator-bar {
-            position: relative;
-            /* these two margins must together compensate the indicator's height */
-            margin-top: -1px;
-            margin-bottom: -1px;
-          }
-          .menupopup-drop-indicator {
-            list-style-image: none;
-            height: 2px;
-            margin-inline-end: -4em;
-            background-color: Highlight;
-          }
-        `;
-        case "win":
-          return `${s}
-          .menupopup-drop-indicator-bar {
-            position: relative;
-            /* these two margins must together compensate the indicator's height */
-            margin-top: -1px;
-            margin-bottom: -1px;
-          }
-          .menupopup-drop-indicator {
-            list-style-image: none;
-            height: 2px;
-            margin-inline-end: -4em;
-            background-color: Highlight;
-          }
-        `;
-        default:
-          return s;
-      }
+      return "";
     }
 
     get styles() {
       if (!this.closest("#BMB_bookmarksPopup")) {
         return "";
       }
 
       let s = `
@@ -132,21 +82,21 @@
       }
     }
 
     get markup() {
       return `
       <html:link rel="stylesheet" href="chrome://global/skin/global.css" />
       <html:style>${this.commonStyles}${this.styles}</html:style>
       <hbox flex="1" part="innerbox">
-        <vbox class="menupopup-drop-indicator-bar" hidden="true">
-          <image class="menupopup-drop-indicator" mousethrough="always"></image>
+        <vbox part="drop-indicator-bar" hidden="true">
+          <image part="drop-indicator" mousethrough="always"></image>
         </vbox>
         <arrowscrollbox class="popup-internal-box" flex="1" orient="vertical"
-                        smoothscroll="false">
+                        smoothscroll="false" part="popupbox">
           <html:slot></html:slot>
         </arrowscrollbox>
       </hbox>
     `;
     }
 
     connectedCallback() {
       if (this.delayConnectedCallback()) {
@@ -154,17 +104,17 @@
       }
 
       this.shadowRoot.textContent = "";
       this.shadowRoot.appendChild(
         MozXULElement.parseXULToFragment(this.markup)
       );
 
       this._indicatorBar = this.shadowRoot.querySelector(
-        ".menupopup-drop-indicator-bar"
+        "[part=drop-indicator-bar]"
       );
       this._scrollBox = this.shadowRoot.querySelector(".popup-internal-box");
 
       /**
        * Sub-menus should be opened when the mouse drags over them, and closed
        * when the mouse drags off.  The overFolder object manages opening and
        * closing of folders when the mouse hovers.
        */
@@ -699,18 +649,18 @@
       return `
       <html:link rel="stylesheet" href="chrome://global/skin/global.css" />
       <html:style>${this.commonStyles}</html:style>
       <vbox class="panel-arrowcontainer" flex="1">
         <box class="panel-arrowbox">
           <image class="panel-arrow"></image>
         </box>
         <box class="panel-arrowcontent" part="arrowcontent" flex="1">
-          <vbox class="menupopup-drop-indicator-bar" hidden="true">
-            <image class="menupopup-drop-indicator" mousethrough="always"></image>
+          <vbox part="drop-indicator-bar" hidden="true">
+            <image part="drop-indicator" mousethrough="always"></image>
           </vbox>
           <arrowscrollbox class="popup-internal-box" flex="1"
                           orient="vertical" smoothscroll="false"
                           part="popupbox">
             <html:slot></html:slot>
           </arrowscrollbox>
         </box>
       </vbox>
diff --git a/browser/themes/linux/browser.css b/browser/themes/linux/browser.css
--- a/browser/themes/linux/browser.css
+++ b/browser/themes/linux/browser.css
@@ -99,16 +99,31 @@ menuitem.bookmark-item {
 }
 
 /* Bookmark drag and drop styles */
 .bookmark-item[dragover-into="true"] {
   background: Highlight !important;
   color: HighlightText !important;
 }
 
+/* rules for menupopup drop indicators */
+menupopup::part(drop-indicator-bar) {
+  position: relative;
+  /* these two margins must together compensate the indicator's height */
+  margin-top: -1px;
+  margin-bottom: -1px;
+}
+
+menupopup::part(drop-indicator) {
+  list-style-image: none;
+  height: 2px;
+  margin-inline-end: -4em;
+  background-color: Highlight;
+}
+
 /* Bookmarks toolbar */
 #PlacesToolbarDropIndicator {
   list-style-image: url(chrome://browser/skin/places/toolbarDropMarker.png);
 }
 
 .bookmark-item[cutting] > .toolbarbutton-icon,
 .bookmark-item[cutting] > .menu-iconic-left > .menu-iconic-icon {
   opacity: 0.5;
diff --git a/browser/themes/osx/browser.css b/browser/themes/osx/browser.css
--- a/browser/themes/osx/browser.css
+++ b/browser/themes/osx/browser.css
@@ -621,16 +621,31 @@
 
 /* Bookmark drag and drop styles */
 
 .bookmark-item[dragover-into="true"] {
   background: Highlight !important;
   color: HighlightText !important;
 }
 
+/* rules for menupopup drop indicators */
+menupopup::part(drop-indicator-bar) {
+  position: relative;
+  /* these two margins must together compensate the indicator's height */
+  margin-top: -1px;
+  margin-bottom: -1px;
+}
+
+menupopup::part(drop-indicator) {
+  list-style-image: none;
+  height: 2px;
+  margin-inline-end: -4em;
+  background-color: Highlight;
+}
+
 %include ../shared/notification-icons.inc.css
 
 /* Translation */
 
 %include ../shared/translation/infobar.inc.css
 
 notification[value="translation"] {
   color: #484848;
diff --git a/browser/themes/shared/customizableui/panelUI.inc.css b/browser/themes/shared/customizableui/panelUI.inc.css
--- a/browser/themes/shared/customizableui/panelUI.inc.css
+++ b/browser/themes/shared/customizableui/panelUI.inc.css
@@ -121,16 +121,25 @@
 
 #nav-bar[brighttext] #PanelUI-menu-button[badge-status="addon-alert"] > .toolbarbutton-badge-stack > .toolbarbutton-badge,
 #nav-bar[brighttext] #PanelUI-menu-button[badge-status="fxa-needs-authentication"] > .toolbarbutton-badge-stack > .toolbarbutton-badge {
   -moz-context-properties: fill, stroke;
   fill: #FFE900;
   stroke: transparent;
 }
 
+
+#BMB_bookmarksPopup::part(popupbox) {
+  /* background: green; */
+}
+#BMB_bookmarksPopup::part(popupbox) > .arrowscrollbox-scrollbox {
+  padding-top: 10px;
+  background: red !important;
+}
+
 .cui-widget-panel,
 #widget-overflow {
   font: menu;
 }
 
 panelview {
   -moz-box-orient: vertical;
   -moz-box-flex: 1;
diff --git a/browser/themes/windows/browser.css b/browser/themes/windows/browser.css
--- a/browser/themes/windows/browser.css
+++ b/browser/themes/windows/browser.css
@@ -660,16 +660,31 @@ menuitem.bookmark-item {
 }
 
 toolbarbutton.bookmark-item[dragover="true"][open="true"] {
   -moz-appearance: none;
   background: Highlight !important;
   color: HighlightText !important;
 }
 
+/* rules for menupopup drop indicators */
+menupopup::part(drop-indicator-bar) {
+  position: relative;
+  /* these two margins must together compensate the indicator's height */
+  margin-top: -1px;
+  margin-bottom: -1px;
+}
+
+menupopup::part(drop-indicator) {
+  list-style-image: none;
+  height: 2px;
+  margin-inline-end: -4em;
+  background-color: Highlight;
+}
+
 %include ../shared/notification-icons.inc.css
 %include ../shared/addon-notification.inc.css
 
 /* Translation infobar */
 
 %include ../shared/translation/infobar.inc.css
 
 notification[value="translation"] {
