# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1582260081 28800
#      Thu Feb 20 20:41:21 2020 -0800
# Node ID 0763d7ef0e4a8326fe3390953c28df1ef253f4c2
# Parent  f3da8ae9d1a3e74cd273746da51a035ddc572bee
Bug 1615854 - Listen to keypress events on the document instead of the dialog element to fix keyboard handling for dialogs in osx

The keypress events aren't firing on the dialog in OSX, so closing the dialog via a keyboard
shortcurt isn't currently working.

Differential Revision: https://phabricator.services.mozilla.com/D63607

diff --git a/toolkit/content/widgets/dialog.js b/toolkit/content/widgets/dialog.js
--- a/toolkit/content/widgets/dialog.js
+++ b/toolkit/content/widgets/dialog.js
@@ -15,41 +15,33 @@
   );
 
   class MozDialog extends MozXULElement {
     constructor() {
       super();
 
       this.attachShadow({ mode: "open" });
 
-      this.addEventListener(
+      document.addEventListener(
         "keypress",
         event => {
           if (event.keyCode == KeyEvent.DOM_VK_RETURN) {
             this._hitEnter(event);
-          }
-        },
-        { mozSystemGroup: true }
-      );
-
-      this.addEventListener(
-        "keypress",
-        event => {
-          if (
+          } else if (
             event.keyCode == KeyEvent.DOM_VK_ESCAPE &&
             !event.defaultPrevented
           ) {
             this.cancelDialog();
           }
         },
         { mozSystemGroup: true }
       );
 
       if (AppConstants.platform == "macosx") {
-        this.addEventListener(
+        document.addEventListener(
           "keypress",
           event => {
             if (event.key == "." && event.metaKey) {
               this.cancelDialog();
             }
           },
           true
         );
