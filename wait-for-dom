# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  aa2d1a17d9fdab70712bacf3b1ced98a39a7e4d1

diff --git a/toolkit/content/widgets/radio.js b/toolkit/content/widgets/radio.js
--- a/toolkit/content/widgets/radio.js
+++ b/toolkit/content/widgets/radio.js
@@ -7,16 +7,18 @@
 // This is loaded into all XUL windows. Wrap in a block to prevent
 // leaking to window scope.
 {
 
 class MozRadiogroup extends MozBaseControl {
   constructor() {
     super();
 
+    this.initialize = this.initialize.bind(this);
+
     this.addEventListener("mousedown", (event) => {
       if (this.disabled)
         event.preventDefault();
     });
 
     /**
      * keyboard navigation  Here's how keyboard navigation works in radio groups on Windows:
      * The group takes 'focus'
@@ -107,16 +109,24 @@ class MozRadiogroup extends MozBaseContr
         return;
       }
       this.removeAttribute("focused");
       this.focusedItem = null;
     });
   }
 
   connectedCallback() {
+    if (document.readyState == "uninitialized") {
+      document.addEventListener("DOMContentLoaded", this.initialize, { once: true });
+    } else {
+      this.initialize();
+    }
+  }
+
+  initialize() {
     this._radioChildren = null;
 
     if (this.getAttribute("disabled") == "true")
       this.disabled = true;
 
     var children = this._getRadioChildren();
     var length = children.length;
     for (var i = 0; i < length; i++) {
diff --git a/toolkit/content/widgets/radio.xml b/toolkit/content/widgets/radio.xml
--- a/toolkit/content/widgets/radio.xml
+++ b/toolkit/content/widgets/radio.xml
@@ -52,35 +52,28 @@
             return this.hasAttribute("selected");
           ]]>
         </getter>
       </property>
       <property name="radioGroup" readonly="true" onget="return this.control"/>
       <property name="control" readonly="true">
         <getter>
         <![CDATA[
-          const XUL_NS = "http://www.mozilla.org/keymaster/"
-                       + "gatekeeper/there.is.only.xul";
-          var parent = this.parentNode;
-          while (parent) {
-            if ((parent.namespaceURI == XUL_NS) &&
-                (parent.localName == "radiogroup")) {
-              return parent;
-            }
-            parent = parent.parentNode;
+          var parent = this.closest("radiogroup");
+          if (parent) {
+            return parent;
           }
 
           var group = this.getAttribute("group");
           if (!group) {
             return null;
           }
 
           parent = this.ownerDocument.getElementById(group);
           if (!parent ||
-              (parent.namespaceURI != XUL_NS) ||
               (parent.localName != "radiogroup")) {
             parent = null;
           }
           return parent;
         ]]>
         </getter>
       </property>
     </implementation>
