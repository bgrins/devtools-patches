# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  d3e9eab423e982d46607fe9a396687f2e0423164
Bug XXX - Shim top level HTML windows

diff --git a/browser/components/nsBrowserGlue.js b/browser/components/nsBrowserGlue.js
--- a/browser/components/nsBrowserGlue.js
+++ b/browser/components/nsBrowserGlue.js
@@ -573,16 +573,36 @@ BrowserGlue.prototype = {
         // pdf content handler, and initializes parent side message manager
         // shim for privileged api access.
         PdfJs.init(true);
         break;
       case "shield-init-complete":
         this._shieldInitComplete = true;
         this._sendMainPingCentrePing();
         break;
+      case "chrome-document-global-created":
+        const HTML_NS = "http://www.w3.org/1999/xhtml";
+        subject.addEventListener("DOMContentLoaded", () => {
+          if (!subject.opener && subject.document.documentElement.namespaceURI === HTML_NS) {
+          }
+        }, {once:true});
+        subject.addEventListener("load", () => {
+          if (!subject.opener && subject.document.documentElement.namespaceURI === HTML_NS) {
+            subject.document.body.style.width = "400px";
+            subject.document.body.style.height = "300px";
+            subject.setTimeout(() => {
+              subject.document.body.style.width = "auto";
+              subject.document.body.style.height = "100%";
+            }, 0)
+          }
+        }, {once: true});
+        subject.addEventListener("unload", () => {
+          console.log("Store width/height");
+        }, {once: true});
+        break;
     }
   },
 
   // initialization (called on application startup)
   _init: function BG__init() {
     let os = Services.obs;
     os.addObserver(this, "notifications-open-settings");
     os.addObserver(this, "prefservice:after-app-defaults");
@@ -610,16 +630,17 @@ BrowserGlue.prototype = {
     os.addObserver(this, "keyword-search");
     os.addObserver(this, "browser-search-engine-modified");
     os.addObserver(this, "restart-in-safe-mode");
     os.addObserver(this, "flash-plugin-hang");
     os.addObserver(this, "xpi-signature-changed");
     os.addObserver(this, "sync-ui-state:update");
     os.addObserver(this, "handlersvc-store-initialized");
     os.addObserver(this, "shield-init-complete");
+    os.addObserver(this, "chrome-document-global-created");
 
     this._flashHangCount = 0;
     this._firstWindowReady = new Promise(resolve => this._firstWindowLoaded = resolve);
     if (AppConstants.platform == "win") {
       JawsScreenReaderVersionCheck.init();
     }
   },
 
@@ -663,16 +684,17 @@ BrowserGlue.prototype = {
     os.removeObserver(this, "handle-xul-text-link");
     os.removeObserver(this, "profile-before-change");
     os.removeObserver(this, "keyword-search");
     os.removeObserver(this, "browser-search-engine-modified");
     os.removeObserver(this, "flash-plugin-hang");
     os.removeObserver(this, "xpi-signature-changed");
     os.removeObserver(this, "sync-ui-state:update");
     os.removeObserver(this, "shield-init-complete");
+    os.removeObserver(this, "chrome-document-global-created");
   },
 
   _onAppDefaults: function BG__onAppDefaults() {
     // apply distribution customizations (prefs)
     // other customizations are applied in _beforeUIStartup()
     this._distributionCustomizer.applyPrefDefaults();
   },
 
