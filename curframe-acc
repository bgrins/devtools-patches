# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  3de5d4ecc12e902bff43ccbf900537415fdd0192
Try a different VisibilityState check

diff --git a/accessible/generic/Accessible.cpp b/accessible/generic/Accessible.cpp
--- a/accessible/generic/Accessible.cpp
+++ b/accessible/generic/Accessible.cpp
@@ -332,17 +332,18 @@ uint64_t Accessible::VisibilityState() c
   // Walk the parent frame chain to see if the frame is in background tab or
   // scrolled out.
   nsIFrame* curFrame = frame;
   do {
     nsView* view = curFrame->GetView();
     if (view && view->GetVisibility() == nsViewVisibility_kHide)
       return states::INVISIBLE;
 
-    if (nsLayoutUtils::IsPopup(curFrame)) return 0;
+
+    if (!curFrame || !curFrame->StyleVisibility()->IsVisible()) return 0;
 
     // Offscreen state for background tab content and invisible for not selected
     // deck panel.
     nsIFrame* parentFrame = curFrame->GetParent();
     nsDeckFrame* deckFrame = do_QueryFrame(parentFrame);
     if (deckFrame && deckFrame->GetSelectedBox() != curFrame) {
 #if defined(ANDROID)
       // In Fennec instead of a <tabpanels> container there is a <deck>
