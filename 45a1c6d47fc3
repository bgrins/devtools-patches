
# HG changeset patch
# User Paolo Amadini <paolo.mozmail@amadzone.org>
# Date 1525947153 -3600
# Node ID 45a1c6d47fc33636736c0bbc0cbd4ac80d32c295
# Parent  b52b2eb81d1e52d259d55d948281c7f6ddf1270c
Bug 1450823 - Make ctrlTab-canvas not anonymous.

MozReview-Commit-ID: 8hcxsXQ1JPu

diff --git a/browser/base/content/browser-ctrlTab.js b/browser/base/content/browser-ctrlTab.js
--- a/browser/base/content/browser-ctrlTab.js
+++ b/browser/base/content/browser-ctrlTab.js
@@ -148,17 +148,23 @@ var ctrlTab = {
     return this.panel = document.getElementById("ctrlTab-panel");
   },
   get showAllButton() {
     delete this.showAllButton;
     return this.showAllButton = document.getElementById("ctrlTab-showAll");
   },
   get previews() {
     delete this.previews;
-    return this.previews = this.panel.getElementsByClassName("ctrlTab-preview");
+    this.previews = this.panel.getElementsByClassName("ctrlTab-preview");
+    for (let preview of this.previews) {
+      preview._canvas = document.createElement("hbox");
+      preview._canvas.setAttribute("class", "ctrlTab-canvas");
+      preview.appendChild(preview._canvas);
+    }
+    return this.previews;
   },
   get maxTabPreviews() {
     delete this.maxTabPreviews;
     return this.maxTabPreviews = this.previews.length - 1;
   },
   get canvasWidth() {
     delete this.canvasWidth;
     return this.canvasWidth = Math.ceil(screen.availWidth * .85 / this.maxTabPreviews);
@@ -239,26 +245,26 @@ var ctrlTab = {
   },
 
   updatePreview: function ctrlTab_updatePreview(aPreview, aTab) {
     if (aPreview == this.showAllButton)
       return;
 
     aPreview._tab = aTab;
 
-    if (aPreview.firstChild)
-      aPreview.firstChild.remove();
+    if (aPreview._canvas.firstChild)
+      aPreview._canvas.firstChild.remove();
     if (aTab) {
       let canvasWidth = this.canvasWidth;
       let canvasHeight = this.canvasHeight;
-      aPreview.appendChild(tabPreviews.get(aTab));
+      aPreview._canvas.appendChild(tabPreviews.get(aTab));
       aPreview.setAttribute("label", aTab.label);
       aPreview.setAttribute("tooltiptext", aTab.label);
-      aPreview.setAttribute("canvaswidth", canvasWidth);
-      aPreview.setAttribute("canvasstyle",
+      aPreview._canvas.setAttribute("width", canvasWidth);
+      aPreview._canvas.setAttribute("style",
                             "max-width:" + canvasWidth + "px;" +
                             "min-width:" + canvasWidth + "px;" +
                             "max-height:" + canvasHeight + "px;" +
                             "min-height:" + canvasHeight + "px;");
       if (aTab.image)
         aPreview.setAttribute("image", aTab.image);
       else
         aPreview.removeAttribute("image");
diff --git a/browser/base/content/browser-tabPreviews.xml b/browser/base/content/browser-tabPreviews.xml
--- a/browser/base/content/browser-tabPreviews.xml
+++ b/browser/base/content/browser-tabPreviews.xml
@@ -7,19 +7,17 @@
 
 <bindings id="tabPreviews"
           xmlns="http://www.mozilla.org/xbl"
           xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
           xmlns:xbl="http://www.mozilla.org/xbl">
   <binding id="ctrlTab-preview" extends="chrome://global/content/bindings/button.xml#button-base">
     <content pack="center">
       <xul:vbox class="ctrlTab-preview-inner">
-        <xul:hbox class="ctrlTab-canvas" xbl:inherits="style=canvasstyle,width=canvaswidth">
-          <children/>
-        </xul:hbox>
+        <children/>
         <xul:hbox class="ctrlTab-favicon-container" xbl:inherits="hidden=noicon">
           <xul:image class="ctrlTab-favicon" xbl:inherits="src=image"/>
         </xul:hbox>
         <xul:label class="ctrlTab-label plain" xbl:inherits="value=label" crop="end"/>
       </xul:vbox>
     </content>
 
     <handlers>
diff --git a/browser/themes/shared/ctrlTab.inc.css b/browser/themes/shared/ctrlTab.inc.css
--- a/browser/themes/shared/ctrlTab.inc.css
+++ b/browser/themes/shared/ctrlTab.inc.css
@@ -16,18 +16,18 @@
   border-style: none;
   padding: 20px 10px 10px;
 %ifndef XP_MACOSX
   font-weight: bold;
 %endif
   text-shadow: 0 0 1px hsl(0,0%,12%), 0 0 2px hsl(0,0%,12%);
 }
 
-.ctrlTab-preview > html|img,
-.ctrlTab-preview > html|canvas {
+.ctrlTab-preview > .ctrlTab-canvas > html|img,
+.ctrlTab-preview > .ctrlTab-canvas > html|canvas {
   min-width: inherit;
   max-width: inherit;
   min-height: inherit;
   max-height: inherit;
 }
 
 .ctrlTab-favicon-container {
   position: relative;
