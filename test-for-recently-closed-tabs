# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  ed50266b84e2a489c5e97cf68b98b116d6ce4501
Bug 1546099 - Add a mochitest for "Recently Closed Tabs" and "Recently Closed Windows" menus;r=Gijs

diff --git a/browser/base/content/test/menubar/browser.ini b/browser/base/content/test/menubar/browser.ini
--- a/browser/base/content/test/menubar/browser.ini
+++ b/browser/base/content/test/menubar/browser.ini
@@ -1,3 +1,4 @@
 [DEFAULT]
 
 [browser_file_menu_import_wizard.js]
+[browser_menu_recently_closed.js]
diff --git a/browser/base/content/test/menubar/browser_menu_recently_closed.js b/browser/base/content/test/menubar/browser_menu_recently_closed.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/test/menubar/browser_menu_recently_closed.js
@@ -0,0 +1,53 @@
+/* Any copyright is dedicated to the Public Domain.
+   http://creativecommons.org/publicdomain/zero/1.0/ */
+
+"use strict";
+
+async function addAndRemoveWindow(url) {
+}
+async function addAndRemoveTab(url) {
+  let tab = BrowserTestUtils.addTab(gBrowser, url);
+  gBrowser.selectedTab = tab;
+
+  let browser = gBrowser.getBrowserForTab(tab);
+  await BrowserTestUtils.browserLoaded(browser);
+
+  BrowserTestUtils.removeTab(tab);
+}
+
+add_task(async function() {
+  const historyMenuPopup = document.getElementById("history-menu").menupopup;
+  const recentlyClosedMenu = document.getElementById("historyUndoMenu");
+  const recentlyClosedTabsPopup = recentlyClosedMenu.menupopup;
+  const recentlyClosedWindowMenu= document.getElementById("historyUndoWindowMenu");
+  const recentlyClosedWindowPopup = recentlyClosedWindowMenu.menupopup;
+  await addAndRemoveTab("http://mochi.test:8888");
+  await addAndRemoveTab("https://example.com:443");
+  await addAndRemoveTab("http://example.com");
+
+  ok(true, "XXXX: Check that both menu items are disabled");
+  historyMenuPopup.openPopupAtScreen(0, 0);
+  await BrowserTestUtils.waitForPopupEvent(historyMenuPopup, "shown");
+  recentlyClosedTabsPopup.openPopupAtScreen(0, 0);
+
+
+  is(recentlyClosedTabsPopup.querySelectorAll("menuitem").length, 3, "Correct number of items");
+  // await BrowserTestUtils.waitForPopupEvent(historyMenu.querySelector("menupopup"), "shown");
+  // document.getElementById("historyUndoMenu").click();
+
+  await new Promise(r=>r);
+  // Need to explicitly close the menu (and wait for it), otherwise it fails
+  // verify/later tests
+  // const menuClosed = BrowserTestUtils.waitForPopupEvent(menu, "hidden");
+  // menu.hidePopup();
+  // await menuClosed;
+
+
+
+  // ok(true, "XXXX: Check that both recently closed tabs list matches");
+  // await addAndRemoveWindow("http://mochi.test:8888");
+  // await addAndRemoveWindow("https://example.com:443");
+  // await addAndRemoveWindow("http://example.com");
+  // ok(true, "XXXX: Check that both recently closed tabs list matches");
+
+});
