# HG changeset patch
# Parent b110e6e5e100c3116f71fc70a2e2e43e913c2ba2
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 1030347 - Enable devtools/sourceeditor tests with e10s;r=jwalker

diff --git a/browser/devtools/sourceeditor/test/browser.ini b/browser/devtools/sourceeditor/test/browser.ini
--- a/browser/devtools/sourceeditor/test/browser.ini
+++ b/browser/devtools/sourceeditor/test/browser.ini
@@ -1,10 +1,9 @@
 [DEFAULT]
-skip-if = e10s # Bug ?????? - devtools tests disabled with e10s
 subsuite = devtools
 support-files =
   cm_comment_test.js
   cm_doc_test.js
   cm_driver.js
   cm_emacs_test.js
   cm_mode_test.css
   cm_mode_test.js
diff --git a/browser/devtools/sourceeditor/test/browser_codemirror.js b/browser/devtools/sourceeditor/test/browser_codemirror.js
--- a/browser/devtools/sourceeditor/test/browser_codemirror.js
+++ b/browser/devtools/sourceeditor/test/browser_codemirror.js
@@ -29,10 +29,15 @@ function test() {
 
     ok(!win.failed, "CodeMirror tests all passed");
     win.mozilla_setStatus = null;
 
     while (gBrowser.tabs.length > 1) gBrowser.removeCurrentTab();
     finish();
   }
 
-  setTimeout(check, 100);
+  let mm = browser.messageManager;
+  mm.addMessageListener('check', function listener() {
+    mm.removeMessageListener('check', listener);
+    check();
+  });
+  mm.loadFrameScript('data:,sendAsyncMessage("check")', true);
 }
diff --git a/browser/devtools/sourceeditor/test/browser_vimemacs.js b/browser/devtools/sourceeditor/test/browser_vimemacs.js
--- a/browser/devtools/sourceeditor/test/browser_vimemacs.js
+++ b/browser/devtools/sourceeditor/test/browser_vimemacs.js
@@ -28,10 +28,15 @@ function test() {
 
     ok(!win.failed, "CodeMirror tests all passed");
     win.mozilla_setStatus = null;
 
     while (gBrowser.tabs.length > 1) gBrowser.removeCurrentTab();
     finish();
   }
 
-  setTimeout(check, 100);
+  let mm = browser.messageManager;
+  mm.addMessageListener('check', function listener() {
+    mm.removeMessageListener('check', listener);
+    check();
+  });
+  mm.loadFrameScript('data:,sendAsyncMessage("check")', true);
 }
