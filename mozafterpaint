# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  2ac7779b6f4c27adccc6068f396d7fbb40aa3052

diff --git a/testing/mochitest/browser-test.js b/testing/mochitest/browser-test.js
--- a/testing/mochitest/browser-test.js
+++ b/testing/mochitest/browser-test.js
@@ -354,18 +354,25 @@ Tester.prototype = {
     if (createdFakeTestForLogging) {
       let time = Date.now() - startTime;
       this.dumper.structuredLogger.testEnd("browser-test.js",
                                            "OK",
                                            undefined,
                                            "finished window state check in " + time + "ms");
     }
 
-    // Make sure the window is raised before each test.
-    this.SimpleTest.waitForFocus(aCallback);
+    if (Services.appinfo.browserTabsRemoteAutostart) {
+      let mozAfterPaintCallback = () => {
+        window.removeEventListener("MozAfterPaint", mozAfterPaintCallback);
+        this.SimpleTest.waitForFocus(aCallback);
+      };
+      window.addEventListener("MozAfterPaint", mozAfterPaintCallback);
+    } else {
+      this.SimpleTest.waitForFocus(aCallback);
+    }
   },
 
   finish: function Tester_finish(aSkipSummary) {
     this.Promise.Debugging.flushUncaughtErrors();
 
     var passCount = this.tests.reduce((a, f) => a + f.passCount, 0);
     var failCount = this.tests.reduce((a, f) => a + f.failCount, 0);
     var todoCount = this.tests.reduce((a, f) => a + f.todoCount, 0);
