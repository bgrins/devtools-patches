# HG changeset patch
# User Alexandre Poirot <poirot.alex@gmail.com>

Bug 1235781 - Fix per platform css and browser css rule for eyedropper. r=bgrins

diff --git a/devtools/client/eyedropper/eyedropper.xul b/devtools/client/eyedropper/eyedropper.xul
index b7c70e3..7a5d1fe 100644
--- a/devtools/client/eyedropper/eyedropper.xul
+++ b/devtools/client/eyedropper/eyedropper.xul
@@ -4,17 +4,20 @@
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
 <!DOCTYPE window []>
 
 <?xml-stylesheet href="chrome://devtools/skin/common.css"?>
 <?xml-stylesheet href="chrome://devtools/skin/eyedropper.css" type="text/css"?>
 
-<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+        no-theme="true">
+  <script type="application/javascript;version=1.8"
+          src="chrome://devtools/content/shared/theme-switching.js"/>
   <commandset id="eyedropper-commandset">
     <command id="eyedropper-cmd-close"
              oncommand="void(0);"/>
     <command id="eyedropper-cmd-copy"
              oncommand="void(0);"/>
   </commandset>
 
   <keyset id="eyedropper-keyset">
diff --git a/devtools/client/shared/theme-switching.js b/devtools/client/shared/theme-switching.js
index a0594fe..4dd20e5 100644
--- a/devtools/client/shared/theme-switching.js
+++ b/devtools/client/shared/theme-switching.js
@@ -1,26 +1,35 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 (function() {
   let documentElement = document.documentElement;
-  let devtoolsStyleSheets = new WeakMap();
 
   let os;
   let platform = navigator.platform;
   if (platform.startsWith("Win")) {
     os = "win";
   } else if (platform.startsWith("Mac")) {
     os = "mac";
   } else {
     os = "linux";
   }
 
+  documentElement.setAttribute("platform", os);
+
+  // no-theme attributes allows to just est the platform attribute
+  // to have per-platform CSS working correctly.
+  if (documentElement.getAttribute("no-theme") === "true") {
+    return;
+  }
+
+  let devtoolsStyleSheets = new WeakMap();
+
   // Scrollbar overrides for dark theme
   let SCROLLBARS_URL = "chrome://devtools/skin/floating-scrollbars";
   if (os == "mac") {
     // On mac, we have some different style for scrollbars
     // between toolbox and responsive mode
     SCROLLBARS_URL += "-theme-mac.css";
   } else {
     SCROLLBARS_URL += "-non-mac.css";
@@ -160,18 +169,16 @@
   }
 
   const { classes: Cc, interfaces: Ci, utils: Cu } = Components;
   Cu.import("resource://gre/modules/Services.jsm");
   Cu.import("resource://devtools/client/framework/gDevTools.jsm");
   const {require} = Components.utils.import("resource://devtools/shared/Loader.jsm", {});
   const StylesheetUtils = require("sdk/stylesheet/utils");
 
-  documentElement.setAttribute("platform", os);
-
   if (documentElement.hasAttribute("force-theme")) {
     switchTheme(documentElement.getAttribute("force-theme"));
   } else {
     switchTheme(Services.prefs.getCharPref("devtools.theme"));
 
     gDevTools.on("pref-changed", handlePrefChange);
     window.addEventListener("unload", function() {
       gDevTools.off("pref-changed", handlePrefChange);
diff --git a/devtools/client/themes/common.css b/devtools/client/themes/common.css
index 9759c49..00aa99f 100644
--- a/devtools/client/themes/common.css
+++ b/devtools/client/themes/common.css
@@ -210,27 +210,16 @@
   background-position: 0 0, 10px 10px;
 }
 
 .devtools-tooltip-iframe {
   border: none;
   background: transparent;
 }
 
-/* Eyedropper Widget */
-
-.devtools-eyedropper-panel {
-  pointer-events: none;
-  -moz-appearance: none;
-  width: 156px;
-  height: 120px;
-  background-color: transparent;
-  border: none;
-}
-
 /* links to source code, like displaying `myfile.js:45` */
 
 .devtools-source-link {
   font-family: var(--monospace-font-family);
   color: var(--theme-highlight-blue);
   cursor: pointer;
   white-space: nowrap;
   display: flex;
diff --git a/devtools/client/themes/devtools-browser.css b/devtools/client/themes/devtools-browser.css
index b6f2f04..b95d914 100644
--- a/devtools/client/themes/devtools-browser.css
+++ b/devtools/client/themes/devtools-browser.css
@@ -8,8 +8,20 @@
 .devtools-toolbox-bottom-iframe {
   transition: margin-bottom .1s;
 }
 
 .devtools-toolbox-side-iframe {
   min-width: 465px;
 }
 
+/* Eyedropper Widget */
+/* <panel> added to mainPopupSet */
+
+.devtools-eyedropper-panel {
+  pointer-events: none;
+  -moz-appearance: none;
+  width: 156px;
+  height: 120px;
+  background-color: transparent;
+  border: none;
+}
+

