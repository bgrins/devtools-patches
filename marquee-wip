# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  a84de5668d5dfc7d48b3df17ef144392dd0bd406
Try using CSS for marquee animations

diff --git a/layout/style/res/html.css b/layout/style/res/html.css
--- a/layout/style/res/html.css
+++ b/layout/style/res/html.css
@@ -837,24 +837,38 @@ dialog:not([open]) {
 }
 
 /* emulation of non-standard HTML <marquee> tag */
 marquee {
   inline-size: -moz-available;
   display: inline-block;
   vertical-align: text-bottom;
   text-align: start;
+  overflow: hidden;
+  white-space: nowrap;
   -moz-binding: url('chrome://xbl-marquee/content/xbl-marquee.xml#marquee-horizontal');
 }
 
 marquee[direction="up"], marquee[direction="down"] {
   -moz-binding: url('chrome://xbl-marquee/content/xbl-marquee.xml#marquee-vertical');
   block-size: 200px;
+  white-space: initial;
+  position:relative;
 }
 
+@keyframes marquee {
+  0%   { transform: translateX(100%); }
+  100% { transform: translateX(0); }
+}
+@keyframes marquee_vertical {
+  0%   { top: 0%; }
+  100% { top: 100%; }
+}
+
+
 /* PRINT ONLY rules follow */
 @media print {
 
   marquee { -moz-binding: none; }
 
 }
 
 /* Ruby */
diff --git a/layout/style/xbl-marquee/xbl-marquee.css b/layout/style/xbl-marquee/xbl-marquee.css
--- a/layout/style/xbl-marquee/xbl-marquee.css
+++ b/layout/style/xbl-marquee/xbl-marquee.css
@@ -5,8 +5,29 @@
 /* PRINT ONLY rules */
 @media print {
 
   marquee > * > * { 
     margin: 0 !important; 
     padding: 0 !important;
   } /* This hack is needed until bug 119078 gets fixed */
 }
+
+marquee > div {
+  will-change: transform;
+  animation: marquee 15s linear infinite;
+}
+marquee[direction="up"] > div,
+marquee[direction="down"] > div {
+  position: relative;
+  animation: marquee_vertical 15s linear infinite;
+}
+marquee:hover > div {
+  animation-play-state: paused;
+}
+
+/*
+marquee > * {
+  animation: marquee 15s linear infinite;
+}
+marquee:hover > * {
+  animation-play-state: paused;
+}*/
\ No newline at end of file
diff --git a/layout/style/xbl-marquee/xbl-marquee.xml b/layout/style/xbl-marquee/xbl-marquee.xml
--- a/layout/style/xbl-marquee/xbl-marquee.xml
+++ b/layout/style/xbl-marquee/xbl-marquee.xml
@@ -350,29 +350,31 @@
           this.dispatchEvent(e);
         ]]>
         </body>
       </method>
 
       <method name="start" exposeToUntrustedContent="true">
         <body>
         <![CDATA[
+          this.outerDiv.removeAttribute("paused");
           if (this.runId == 0) {
             var myThis = this;
             var lambda = function myTimeOutFunction(){myThis._doMove(false);}
             this.runId = window.setTimeout(lambda, this._scrollDelay - this._deltaStartStop);
             this._deltaStartStop = 0;
           }
         ]]>
         </body>
       </method>
 
       <method name="stop" exposeToUntrustedContent="true">
         <body>
         <![CDATA[
+          this.outerDiv.setAttribute("paused", "true");
           if (this.runId != 0) {
             this._deltaStartStop = Date.now()- this._lastMoveDate;
             clearTimeout(this.runId);
           }
 
           this.runId = 0;
         ]]>
         </body>
@@ -617,95 +619,62 @@
             }
           }
         ]]>
         </body>
       </method>
 
       <constructor>
         <![CDATA[
-          // Set up state.
-          this._scrollAmount = 6;
-          this._scrollDelay = 85;
-          this._direction = "left";
-          this._behavior = "scroll";
-          this._loop = -1;
-          this.dirsign = 1;
-          this.startAt = 0;
-          this.stopAt = 0;
-          this.newPosition = 0;
-          this.runId = 0;
-          this.originalHeight = 0;
-          this.startNewDirection = true;
 
-          // hack needed to fix js error, see bug 386470
-          var myThis = this;
-          var lambda = function myScopeFunction() { if (myThis.init) myThis.init(); }
+//.marquee {
+//    width: 450px;
+//    margin: 0 auto;
+//    white-space: nowrap;
+//    overflow: hidden;
+//    box-sizing: border-box;
+//}
 
-          this._set_direction(this.getAttribute('direction'));
-          this._set_behavior(this.getAttribute('behavior'));
-          this._set_scrollDelay(this.getAttribute('scrolldelay'));
-          this._set_scrollAmount(this.getAttribute('scrollamount'));
-          this._set_loop(this.getAttribute('loop'));
-          this._setEventListener("start", this.getAttribute("onstart"));
-          this._setEventListener("finish", this.getAttribute("onfinish"));
-          this._setEventListener("bounce", this.getAttribute("onbounce"));
-          this.startNewDirection = true;
+//.marquee span {
+//    display: inline-block;
+//    padding-left: 100%;  /* show the marquee just outside the paragraph */
+//    animation: marquee 15s linear infinite;
+//}
 
-          this._mutationObserver = new MutationObserver(this._mutationActor);
-          this._mutationObserver.observe(this, { attributes: true,
-            attributeOldValue: true,
-            attributeFilter: ['loop', 'scrollamount', 'scrolldelay', '', 'truespeed', 'behavior',
-              'direction', 'width', 'height', 'onstart', 'onfinish', 'onbounce'] });
-
-          // init needs to be run after the page has loaded in order to calculate
-          // the correct height/width
-          if (document.readyState == "complete") {
-            lambda();
-          } else {
-            window.addEventListener("load", lambda);
-          }
+//.marquee span:hover {
+//    animation-play-state: paused
+//}
         ]]>
       </constructor>
     </implementation>
 
   </binding>
 
   <binding id="marquee-horizontal" bindToUntrustedContent="true"
            extends="chrome://xbl-marquee/content/xbl-marquee.xml#marquee"
            inheritstyle="false">
 
     <!-- White-space isn't allowed because a marquee could be 
          inside 'white-space: pre' -->
     <content>
-      <html:div style="display: -moz-box; overflow: hidden; width: -moz-available;"
-        ><html:div style="display: -moz-box;"
-          ><html:div class="innerDiv" style="display: table; border-spacing: 0;"
-            ><html:div
-              ><children
-            /></html:div
-          ></html:div
-        ></html:div
-      ></html:div>
+      <html:div
+        ><children /></html:div>
     </content>
 
   </binding>
 
   <binding id="marquee-vertical" bindToUntrustedContent="true"
            extends="chrome://xbl-marquee/content/xbl-marquee.xml#marquee"
            inheritstyle="false">
 
     <!-- White-space isn't allowed because a marquee could be 
          inside 'white-space: pre' -->
     <content>
-      <html:div style="overflow: hidden; width: -moz-available;"
-        ><html:div class="innerDiv"
-          ><children
-        /></html:div
-      ></html:div>
+      <html:div
+        ><children /></html:div>
     </content>
 
   </binding>
 
   <binding id="marquee-horizontal-editable" bindToUntrustedContent="true"
            inheritstyle="false">
 
     <!-- White-space isn't allowed because a marquee could be 
