# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  f7aeec9f9d0705a90a093f24a99824d402461b5c

diff --git a/browser/base/content/browser.css b/browser/base/content/browser.css
--- a/browser/base/content/browser.css
+++ b/browser/base/content/browser.css
@@ -1,34 +1,34 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
 @namespace html url("http://www.w3.org/1999/xhtml");
 
-:root {
+*|:root {
   --panelui-subview-transition-duration: 150ms;
   --lwt-additional-images: none;
   --lwt-background-alignment: right top;
   --lwt-background-tiling: no-repeat;
 }
 
-:root:-moz-lwtheme {
+*|:root:-moz-lwtheme {
   background-color: var(--lwt-accent-color) !important;
   color: var(--lwt-text-color) !important;
 }
 
-:root:-moz-lwtheme[lwtheme-image] {
+*|:root:-moz-lwtheme[lwtheme-image] {
   background-image: var(--lwt-header-image) !important;
   background-repeat: no-repeat;
   background-position: right top !important;
 }
 
-:root:-moz-lwtheme:-moz-window-inactive {
+*|:root:-moz-lwtheme:-moz-window-inactive {
   background-color: var(--lwt-accent-color-inactive, var(--lwt-accent-color)) !important;
 }
 
 /* Set additional backgrounds alignment relative to toolbox */
 
 #navigator-toolbox:-moz-lwtheme {
   background-image: var(--lwt-additional-images);
   background-position: var(--lwt-background-alignment);
@@ -161,17 +161,17 @@ panelview[mainview] > .panel-header {
   -moz-box-flex: 100;
   max-width: 225px;
   min-width: var(--tab-min-width);
   width: 0;
   transition: min-width 100ms ease-out,
               max-width 100ms ease-out;
 }
 
-:root[uidensity=touch] .tabbrowser-tab:not([pinned]) {
+*|:root[uidensity=touch] .tabbrowser-tab:not([pinned]) {
   /* Touch mode needs additional space for the close button. */
   min-width: calc(var(--tab-min-width) + 10px);
 }
 
 .tabbrowser-tab:not([pinned]):not([fadein]) {
   max-width: 0.1px;
   min-width: 0.1px;
   visibility: hidden;
@@ -374,21 +374,21 @@ toolbarpaletteitem {
   toolbar:not([brighttext]) .webextension-browser-action:-moz-lwtheme {
     list-style-image: var(--webextension-toolbar-image-dark, inherit);
   }
 
   .webextension-browser-action[cui-areatype="menu-panel"] {
     list-style-image: var(--webextension-menupanel-image, inherit);
   }
 
-  :root[lwt-popup-brighttext] .webextension-browser-action[cui-areatype="menu-panel"] {
+  *|:root[lwt-popup-brighttext] .webextension-browser-action[cui-areatype="menu-panel"] {
     list-style-image: var(--webextension-menupanel-image-light, inherit);
   }
 
-  :root:not([lwt-popup-brighttext]) .webextension-browser-action[cui-areatype="menu-panel"]:-moz-lwtheme {
+  *|:root:not([lwt-popup-brighttext]) .webextension-browser-action[cui-areatype="menu-panel"]:-moz-lwtheme {
     list-style-image: var(--webextension-menupanel-image-dark, inherit);
   }
 
   .webextension-menuitem {
     list-style-image: var(--webextension-menuitem-image, inherit) !important;
   }
 }
 
@@ -404,21 +404,21 @@ toolbarpaletteitem {
   toolbar:not([brighttext]) .webextension-browser-action:-moz-lwtheme {
     list-style-image: var(--webextension-toolbar-image-2x-dark, inherit);
   }
 
   .webextension-browser-action[cui-areatype="menu-panel"] {
     list-style-image: var(--webextension-menupanel-image-2x, inherit);
   }
 
-  :root[lwt-popup-brighttext] .webextension-browser-action[cui-areatype="menu-panel"] {
+  *|:root[lwt-popup-brighttext] .webextension-browser-action[cui-areatype="menu-panel"] {
     list-style-image: var(--webextension-menupanel-image-2x-light, inherit);
   }
 
-  :root:not([lwt-popup-brighttext]) .webextension-browser-action[cui-areatype="menu-panel"]:-moz-lwtheme {
+  *|:root:not([lwt-popup-brighttext]) .webextension-browser-action[cui-areatype="menu-panel"]:-moz-lwtheme {
     list-style-image: var(--webextension-menupanel-image-2x-dark, inherit);
   }
 
   .webextension-menuitem {
     list-style-image: var(--webextension-menuitem-image-2x, inherit) !important;
   }
 }
 
diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -22,26 +22,26 @@
 <?xml-stylesheet href="chrome://browser/skin/downloads/downloads.css" type="text/css"?>
 <?xml-stylesheet href="chrome://browser/skin/searchbar.css" type="text/css"?>
 <?xml-stylesheet href="chrome://browser/skin/places/tree-icons.css" type="text/css"?>
 <?xml-stylesheet href="chrome://browser/skin/places/editBookmark.css" type="text/css"?>
 <?xml-stylesheet href="chrome://browser/skin/compacttheme.css" type="text/css" alternate="yes" title="Light/Dark"?>
 
 # All DTD information is stored in a separate file so that it can be shared by
 # hiddenWindow.xul.
-<!DOCTYPE window [
+<!DOCTYPE html [
 #include browser-doctype.inc
 ]>
 
-<window id="main-window"
+<html id="main-window"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
-        xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+        xmlns="http://www.w3.org/1999/xhtml"
         title="&mainWindow.title;"
         title_normal="&mainWindow.title;"
 #ifdef XP_MACOSX
         title_privatebrowsing="&mainWindow.title;&mainWindow.titlemodifiermenuseparator;&mainWindow.titlePrivateBrowsingSuffix;"
         titledefault="&mainWindow.title;"
         titlemodifier=""
         titlemodifier_normal=""
         titlemodifier_privatebrowsing="&mainWindow.titlePrivateBrowsingSuffix;"
@@ -61,16 +61,20 @@
         windowtype="navigator:browser"
         macanimationtype="document"
         screenX="4" screenY="4"
         fullscreenbutton="true"
         sizemode="normal"
         retargetdocumentfocus="urlbar"
         persist="screenX screenY width height sizemode">
 
+<head>
+</head>
+<body>
+<vbox xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
 # All JS files which are needed by browser.xul and other top level windows to
 # support MacOS specific features *must* go into the global-scripts.inc file so
 # that they can be shared with macWindow.inc.xul.
 #include global-scripts.inc
 
 <script type="application/javascript"
 #ifdef BROWSER_XHTML
 xmlns="http://www.w3.org/1999/xhtml"
@@ -1328,10 +1332,11 @@ xmlns="http://www.w3.org/1999/xhtml"
     <html:div class="pointerlockfswarning-generic-text">
       &pointerlockWarning.generic.label;
     </html:div>
   </html:div>
 
   <vbox id="browser-bottombox" layer="true">
     <notificationbox id="global-notificationbox" notificationside="bottom"/>
   </vbox>
-
-</window>
+</vbox>
+</body>
+</html>
diff --git a/browser/base/content/theme-vars.inc.css b/browser/base/content/theme-vars.inc.css
--- a/browser/base/content/theme-vars.inc.css
+++ b/browser/base/content/theme-vars.inc.css
@@ -1,155 +1,155 @@
 %if 0
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 %endif
 
-:root[lwthemeicons~="--back-icon"] #back-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--back-icon"] #back-button:-moz-lwtheme {
   list-style-image: var(--back-icon) !important;
 }
 
-:root[lwthemeicons~="--forward-icon"] #forward-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--forward-icon"] #forward-button:-moz-lwtheme {
   list-style-image: var(--forward-icon) !important;
 }
 
-:root[lwthemeicons~="--reload-icon"] #reload-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--reload-icon"] #reload-button:-moz-lwtheme {
   list-style-image: var(--reload-icon) !important;
 }
 
-:root[lwthemeicons~="--stop-icon"] #stop-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--stop-icon"] #stop-button:-moz-lwtheme {
   list-style-image: var(--stop-icon) !important;
 }
 
-:root[lwthemeicons~="--bookmark_star-icon"] #star-button:-moz-lwtheme,
-:root[lwthemeicons~="--bookmark_star-icon"] #bookmarks-menu-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--bookmark_star-icon"] #star-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--bookmark_star-icon"] #bookmarks-menu-button:-moz-lwtheme {
   list-style-image: var(--bookmark_star-icon) !important;
 }
 
-:root[lwthemeicons~="--bookmark_menu-icon"] #bookmarks-menu-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--bookmark_menu-icon"] #bookmarks-menu-button:-moz-lwtheme {
   list-style-image: var(--bookmark_menu-icon) !important;
 }
 
-:root[lwthemeicons~="--downloads-icon"] #downloads-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--downloads-icon"] #downloads-button:-moz-lwtheme {
   list-style-image: var(--downloads-icon) !important;
 }
 
-:root[lwthemeicons~="--home-icon"] #home-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--home-icon"] #home-button:-moz-lwtheme {
   list-style-image: var(--home-icon) !important;
 }
 
-:root[lwthemeicons~="--app_menu-icon"] #PanelUI-menu-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--app_menu-icon"] #PanelUI-menu-button:-moz-lwtheme {
   list-style-image: var(--app_menu-icon) !important;
 }
 
-:root[lwthemeicons~="--cut-icon"] #cut-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--cut-icon"] #cut-button:-moz-lwtheme {
   list-style-image: var(--cut-icon) !important;
 }
 
-:root[lwthemeicons~="--copy-icon"] #copy-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--copy-icon"] #copy-button:-moz-lwtheme {
   list-style-image: var(--copy-icon) !important;
 }
 
-:root[lwthemeicons~="--paste-icon"] #paste-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--paste-icon"] #paste-button:-moz-lwtheme {
   list-style-image: var(--paste-icon) !important;
 }
 
-:root[lwthemeicons~="--new_window-icon"] #new-window-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--new_window-icon"] #new-window-button:-moz-lwtheme {
   list-style-image: var(--new_window-icon) !important;
 }
 
-:root[lwthemeicons~="--new_private_window-icon"] #privatebrowsing-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--new_private_window-icon"] #privatebrowsing-button:-moz-lwtheme {
   list-style-image: var(--new_private_window-icon) !important;
 }
 
-:root[lwthemeicons~="--save_page-icon"] #save-page-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--save_page-icon"] #save-page-button:-moz-lwtheme {
   list-style-image: var(--save_page-icon) !important;
 }
 
-:root[lwthemeicons~="--print-icon"] #print-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--print-icon"] #print-button:-moz-lwtheme {
   list-style-image: var(--print-icon) !important;
 }
 
-:root[lwthemeicons~="--history-icon"] #history-panelmenu:-moz-lwtheme {
+*|:root[lwthemeicons~="--history-icon"] #history-panelmenu:-moz-lwtheme {
   list-style-image: var(--history-icon) !important;
 }
 
-:root[lwthemeicons~="--full_screen-icon"] #fullscreen-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--full_screen-icon"] #fullscreen-button:-moz-lwtheme {
   list-style-image: var(--full_screen-icon) !important;
 }
 
-:root[lwthemeicons~="--find-icon"] #find-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--find-icon"] #find-button:-moz-lwtheme {
   list-style-image: var(--find-icon) !important;
 }
 
-:root[lwthemeicons~="--options-icon"] #preferences-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--options-icon"] #preferences-button:-moz-lwtheme {
   list-style-image: var(--options-icon) !important;
 }
 
-:root[lwthemeicons~="--addons-icon"] #add-ons-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--addons-icon"] #add-ons-button:-moz-lwtheme {
   list-style-image: var(--addons-icon) !important;
 }
 
-:root[lwthemeicons~="--developer-icon"] #developer-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--developer-icon"] #developer-button:-moz-lwtheme {
   list-style-image: var(--developer-icon) !important;
 }
 
-:root[lwthemeicons~="--synced_tabs-icon"] #sync-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--synced_tabs-icon"] #sync-button:-moz-lwtheme {
   list-style-image: var(--synced_tabs-icon) !important;
 }
 
-:root[lwthemeicons~="--open_file-icon"] #open-file-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--open_file-icon"] #open-file-button:-moz-lwtheme {
   list-style-image: var(--open_file-icon) !important;
 }
 
-:root[lwthemeicons~="--sidebars-icon"] #sidebar-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--sidebars-icon"] #sidebar-button:-moz-lwtheme {
   list-style-image: var(--sidebars-icon) !important;
 }
 
-:root[lwthemeicons~="--subscribe-icon"] #feed-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--subscribe-icon"] #feed-button:-moz-lwtheme {
   list-style-image: var(--subscribe-icon) !important;
 }
 
-:root[lwthemeicons~="--text_encoding-icon"] #characterencoding-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--text_encoding-icon"] #characterencoding-button:-moz-lwtheme {
   list-style-image: var(--text_encoding-icon) !important;
 }
 
-:root[lwthemeicons~="--email_link-icon"] #email-link-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--email_link-icon"] #email-link-button:-moz-lwtheme {
   list-style-image: var(--email_link-icon) !important;
 }
 
-:root[lwthemeicons~="--forget-icon"] #panic-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--forget-icon"] #panic-button:-moz-lwtheme {
   list-style-image: var(--forget-icon) !important;
 }
 
-:root[lwthemeicons~="--bookmark_star-icon"] #star-button:-moz-lwtheme,
-:root[lwthemeicons~="--bookmark_menu-icon"] #bookmarks-menu-button:-moz-lwtheme,
-:root[lwthemeicons~="--back-icon"] #back-button:-moz-lwtheme,
-:root[lwthemeicons~="--forward-icon"] #forward-button:-moz-lwtheme,
-:root[lwthemeicons~="--reload-icon"] #reload-button:-moz-lwtheme,
-:root[lwthemeicons~="--stop-icon"] #stop-button:-moz-lwtheme,
-:root[lwthemeicons~="--bookmark_star-icon"] #bookmarks-menu-button:-moz-lwtheme,
-:root[lwthemeicons~="--downloads-icon"] #downloads-button:-moz-lwtheme,
-:root[lwthemeicons~="--home-icon"] #home-button:-moz-lwtheme,
-:root[lwthemeicons~="--app_menu-icon"] #PanelUI-menu-button:-moz-lwtheme,
-:root[lwthemeicons~="--cut-icon"] #cut-button:-moz-lwtheme,
-:root[lwthemeicons~="--copy-icon"] #copy-button:-moz-lwtheme,
-:root[lwthemeicons~="--paste-icon"] #paste-button:-moz-lwtheme,
-:root[lwthemeicons~="--new_window-icon"] #new-window-button:-moz-lwtheme,
-:root[lwthemeicons~="--new_private_window-icon"] #privatebrowsing-button:-moz-lwtheme,
-:root[lwthemeicons~="--save_page-icon"] #save-page-button:-moz-lwtheme,
-:root[lwthemeicons~="--print-icon"] #print-button:-moz-lwtheme,
-:root[lwthemeicons~="--history-icon"] #history-panelmenu:-moz-lwtheme,
-:root[lwthemeicons~="--full_screen-icon"] #fullscreen-button:-moz-lwtheme,
-:root[lwthemeicons~="--find-icon"] #find-button:-moz-lwtheme,
-:root[lwthemeicons~="--options-icon"] #preferences-button:-moz-lwtheme,
-:root[lwthemeicons~="--addons-icon"] #add-ons-button:-moz-lwtheme,
-:root[lwthemeicons~="--developer-icon"] #developer-button:-moz-lwtheme,
-:root[lwthemeicons~="--synced_tabs-icon"] #sync-button:-moz-lwtheme,
-:root[lwthemeicons~="--open_file-icon"] #open-file-button:-moz-lwtheme,
-:root[lwthemeicons~="--sidebars-icon"] #sidebar-button:-moz-lwtheme,
-:root[lwthemeicons~="--subscribe-icon"] #feed-button:-moz-lwtheme,
-:root[lwthemeicons~="--text_encoding-icon"] #characterencoding-button:-moz-lwtheme,
-:root[lwthemeicons~="--email_link-icon"] #email-link-button:-moz-lwtheme,
-:root[lwthemeicons~="--forget-icon"] #panic-button:-moz-lwtheme {
+*|:root[lwthemeicons~="--bookmark_star-icon"] #star-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--bookmark_menu-icon"] #bookmarks-menu-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--back-icon"] #back-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--forward-icon"] #forward-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--reload-icon"] #reload-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--stop-icon"] #stop-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--bookmark_star-icon"] #bookmarks-menu-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--downloads-icon"] #downloads-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--home-icon"] #home-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--app_menu-icon"] #PanelUI-menu-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--cut-icon"] #cut-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--copy-icon"] #copy-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--paste-icon"] #paste-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--new_window-icon"] #new-window-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--new_private_window-icon"] #privatebrowsing-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--save_page-icon"] #save-page-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--print-icon"] #print-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--history-icon"] #history-panelmenu:-moz-lwtheme,
+*|:root[lwthemeicons~="--full_screen-icon"] #fullscreen-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--find-icon"] #find-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--options-icon"] #preferences-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--addons-icon"] #add-ons-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--developer-icon"] #developer-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--synced_tabs-icon"] #sync-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--open_file-icon"] #open-file-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--sidebars-icon"] #sidebar-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--subscribe-icon"] #feed-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--text_encoding-icon"] #characterencoding-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--email_link-icon"] #email-link-button:-moz-lwtheme,
+*|:root[lwthemeicons~="--forget-icon"] #panic-button:-moz-lwtheme {
   -moz-image-region: rect(0, 16px, 16px, 0) !important;
 }
diff --git a/browser/themes/osx/browser.css b/browser/themes/osx/browser.css
--- a/browser/themes/osx/browser.css
+++ b/browser/themes/osx/browser.css
@@ -4,17 +4,17 @@
 
 %include shared.inc
 %define toolbarButtonPressed :hover:active:not([disabled="true"]):not([cui-areatype="menu-panel"])
 
 @namespace html url("http://www.w3.org/1999/xhtml");
 
 %include ../shared/browser.inc.css
 
-:root {
+*|:root {
   --toolbar-non-lwt-bgcolor: #f9f9fa;
   --toolbar-non-lwt-textcolor: #0c0c0d;
   --toolbar-non-lwt-bgimage: none;
   --toolbar-bgcolor: var(--toolbar-non-lwt-bgcolor);
   --toolbar-bgimage: var(--toolbar-non-lwt-bgimage);
 
   --toolbarbutton-vertical-text-padding: calc(var(--toolbarbutton-inner-padding) + 1px);
   --toolbarbutton-border-radius: 4px;
@@ -25,24 +25,24 @@
   --arrowpanel-dimmed-further: hsla(0,0%,80%,.45);
   --arrowpanel-dimmed-even-further: hsla(0,0%,80%,.8);
 
   --urlbar-separator-color: hsla(0,0%,16%,.2);
 
   --toolbox-border-bottom-color: #e1e1e2;
 }
 
-:root:-moz-lwtheme {
+*|:root:-moz-lwtheme {
   --toolbar-bgcolor: rgba(255,255,255,.4);
   --toolbar-bgimage: none;
 
   --toolbox-border-bottom-color: rgba(0,0,0,.3);
 }
 
-:root[lwt-popup-brighttext] {
+*|:root[lwt-popup-brighttext] {
   --panel-separator-color: rgba(249,249,250,.1);
 
   --arrowpanel-dimmed: rgba(249,249,250,.1);
   --arrowpanel-dimmed-further: rgba(249,249,250,.15);
   --arrowpanel-dimmed-even-further: rgba(249,249,250,.2);
 }
 
 #navigator-toolbox {
@@ -232,17 +232,17 @@
 .findbar-button {
   background: none !important;
   box-shadow: none !important;
   border: none;
 }
 
 /* On Mac, native buttons keep their full opacity when they become disabled
  * and only the glyph or text on top of them becomes less opaque. */
-:root:not([customizing]) #back-button[disabled="true"] {
+*|:root:not([customizing]) #back-button[disabled="true"] {
   opacity: 1 !important;
   /* Disabled toolbar buttons get an opacity of 0.4 which multiplies
    * their fill-opacity of 0.7. calc() doesn't work here - we'd need
    * to multiply two unitless numbers and that's invalid in CSS, so
    * we need to hard code the value for now. */
   fill-opacity: 0.28;
 }
 
@@ -259,17 +259,17 @@
 #fullscreen-button ~ #window-controls > #restore-button {
   display: none;
 }
 
 /* ::::: nav-bar-inner ::::: */
 
 %include ../shared/urlbar-searchbar.inc.css
 
-:root {
+*|:root {
   --toolbar-field-focus-border-color: -moz-mac-focusring;
 }
 
 #urlbar,
 .searchbar-textbox {
   font-size: 1.25em;
 }
 
@@ -348,17 +348,17 @@ html|input.urlbar-input {
 
 %include ../shared/urlbarSearchSuggestionsNotification.inc.css
 
 /* ----- AUTOCOMPLETE ----- */
 
 %include ../shared/autocomplete.inc.css
 %include ../shared/urlbar-autocomplete.inc.css
 
-:root {
+*|:root {
   --urlbar-popup-url-color: hsl(210, 77%, 47%);
   --urlbar-popup-action-color: hsl(178, 100%, 28%);
 }
 
 /* Give an extra margin top to align the top of the awesomebar with the
  * bottom of the nav bar, OSX calculates the panel position with an missing
  * 1px - https://bugzilla.mozilla.org/show_bug.cgi?id=1406353
  */
@@ -667,26 +667,26 @@ html|input.urlbar-input {
   box-shadow: var(--focus-ring-box-shadow);
 }
 
 #TabsToolbar {
   -moz-appearance: none;
   padding-top: var(--space-above-tabbar);
 }
 
-:root:not([customizing]):not([tabsintitlebar]):not([inFullscreen]) #TabsToolbar:not(:-moz-lwtheme) {
+*|:root:not([customizing]):not([tabsintitlebar]):not([inFullscreen]) #TabsToolbar:not(:-moz-lwtheme) {
   -moz-appearance: toolbar;
 }
 
 #TabsToolbar:not(:-moz-lwtheme) {
   color: #333;
   text-shadow: @loweredShadow@;
 }
 
-:root:-moz-any([inFullscreen], [tabsintitlebar]) #TabsToolbar:not(:-moz-lwtheme) {
+*|:root:-moz-any([inFullscreen], [tabsintitlebar]) #TabsToolbar:not(:-moz-lwtheme) {
   -moz-appearance: -moz-mac-vibrant-titlebar-dark;
   -moz-font-smoothing-background-color: -moz-mac-vibrant-titlebar-dark;
   background-color: #232323;
   color: hsl(240, 9%, 98%);
   text-shadow: none;
 }
 
 .tabbrowser-tab[visuallyselected=true]:not(:-moz-lwtheme) {
@@ -977,20 +977,20 @@ html|*.addon-webext-perm-list {
 /* Customization mode */
 
 %include ../shared/customizableui/customizeMode.inc.css
 
 /* End customization mode */
 
 /* Private browsing and accessibility indicators */
 
-:root[accessibilitymode][tabsintitlebar]:not([inFullscreen]) > #navigator-toolbox > #TabsToolbar > .accessibility-indicator,
-:root[privatebrowsingmode=temporary][tabsintitlebar]:not([inFullscreen]) > #navigator-toolbox > #TabsToolbar > .private-browsing-indicator,
-:root[accessibilitymode]:not([tabsintitlebar]) > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > .accessibility-indicator,
-:root[privatebrowsingmode=temporary]:not([tabsintitlebar]) > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > .private-browsing-indicator {
+*|:root[accessibilitymode][tabsintitlebar]:not([inFullscreen]) > #navigator-toolbox > #TabsToolbar > .accessibility-indicator,
+*|:root[privatebrowsingmode=temporary][tabsintitlebar]:not([inFullscreen]) > #navigator-toolbox > #TabsToolbar > .private-browsing-indicator,
+*|:root[accessibilitymode]:not([tabsintitlebar]) > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > .accessibility-indicator,
+*|:root[privatebrowsingmode=temporary]:not([tabsintitlebar]) > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > .private-browsing-indicator {
   display: none;
 }
 
 #TabsToolbar > .private-browsing-indicator:-moz-locale-dir(rtl),
 #TabsToolbar > .accessibility-indicator:-moz-locale-dir(rtl) {
   -moz-box-ordinal-group: 0;
 }
 
diff --git a/toolkit/content/xul.css b/toolkit/content/xul.css
--- a/toolkit/content/xul.css
+++ b/toolkit/content/xul.css
@@ -20,17 +20,17 @@
  */
 
 @import url("chrome://global/skin/tooltip.css");
 
 @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"); /* set default namespace to XUL */
 @namespace html url("http://www.w3.org/1999/xhtml"); /* namespace for HTML elements */
 @namespace xbl url("http://www.mozilla.org/xbl"); /* namespace for XBL elements */
 
-:root {
+*|:root {
   --animation-easing-function: cubic-bezier(.07, .95, 0, 1);
 }
 
 /* ::::::::::
    :: Rules for 'hiding' portions of the chrome for special
    :: kinds of windows (not JUST browser windows) with toolbars
    ::::: */
 
