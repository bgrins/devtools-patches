# HG changeset patch
# Parent 5cc333cb4b9733967473c7b663402ef39841d40e
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 1051136 - Wait for onEditorChange before opening menu in browser_projecteditor_menubar_02.js;r=mratcliffe

diff --git a/browser/devtools/projecteditor/test/browser_projecteditor_menubar_02.js b/browser/devtools/projecteditor/test/browser_projecteditor_menubar_02.js
--- a/browser/devtools/projecteditor/test/browser_projecteditor_menubar_02.js
+++ b/browser/devtools/projecteditor/test/browser_projecteditor_menubar_02.js
@@ -76,19 +76,26 @@ let test = asyncTest(function*() {
   is (cmdCopy.getAttribute("disabled"), "true", "Edit menu item is disabled");
   is (cmdPaste.getAttribute("disabled"), "true", "Edit menu item is disabled");
 
   info ("Checking with resource selected");
   let resource = projecteditor.project.allResources()[2];
   yield selectFile(projecteditor, resource);
   let editor = projecteditor.currentEditor;
 
+  let onChange = promise.defer();
+
+  projecteditor.on("onEditorChange", () => {
+    info ("onEditorChange has been detected");
+    onChange.resolve();
+  });
   editor.editor.focus();
   EventUtils.synthesizeKey("f", { }, projecteditor.window);
 
+  yield onChange;
   yield openAndCloseMenu(fileMenu);
   yield openAndCloseMenu(editMenu);
 
   is (cmdNew.getAttribute("disabled"), "", "File menu item is enabled");
   is (cmdSave.getAttribute("disabled"), "", "File menu item is enabled");
   is (cmdSaveas.getAttribute("disabled"), "", "File menu item is enabled");
 
   is (cmdUndo.getAttribute("disabled"), "", "Edit menu item is enabled");
