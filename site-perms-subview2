# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  cfee9a71ded6f3891c53426be11c087280b2a5cc
Bug 1193158 - Add icons for permissions;r=ttaubert

diff --git a/browser/base/content/browser.js b/browser/base/content/browser.js
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -7270,27 +7270,42 @@ var gIdentityHandler = {
       menupopup.appendChild(menuitem);
     }
     menulist.appendChild(menupopup);
     menulist.setAttribute("value", aState);
     menulist.setAttribute("oncommand", "gIdentityHandler.setPermission('" +
                                        aPermission + "', this.value)");
     menulist.setAttribute("id", "identity-popup-permission:" + aPermission);
 
+    let image = document.createElement("image");
+
+    // XXX: move this into SitePermissions.jsm
+    // Or find/replace the old name with new - https://dxr.mozilla.org/mozilla-central/search?q=webRTC-shareMicrophone&redirect=true&case=false&limit=60&offset=0
+    let remappedClasses = {
+      "microphone": "webRTC-shareMicrophone",
+      "camera": "webRTC-shareDevices",
+    };
+    let iconClass = remappedClasses[aPermission] || aPermission;
+
+    image.id = iconClass + "-notification-icon";
+    image.setAttribute("class", "notification-anchor-icon");
+    image.setAttribute("showing", "true");
+
     let label = document.createElement("label");
     let labelText = SitePermissions.getPermissionLabel(aPermission);
     label.setAttribute("flex", "1");
     label.setAttribute("class", "identity-popup-permission-label");
     label.setAttribute("control", menulist.getAttribute("id"));
     label.setAttribute("crop", "end");
     label.setAttribute("value", labelText);
     label.setAttribute("tooltiptext", labelText);
 
     let container = document.createElement("hbox");
     container.setAttribute("align", "center");
+    container.appendChild(image);
     container.appendChild(label);
     container.appendChild(menulist);
     return container;
   }
 };
 
 function getNotificationBox(aWindow) {
   var foundBrowser = gBrowser.getBrowserForDocument(aWindow.document);
diff --git a/browser/themes/shared/controlcenter/panel.inc.css b/browser/themes/shared/controlcenter/panel.inc.css
--- a/browser/themes/shared/controlcenter/panel.inc.css
+++ b/browser/themes/shared/controlcenter/panel.inc.css
@@ -297,15 +297,18 @@ description#identity-popup-content-verif
   margin-top: 5px;
 }
 
 #identity-popup-permission-list menulist,
 #identity-popup-permission-subview-list menulist {
   max-width: 100px;
 }
 
-
+#identity-popup-permission-list .notification-anchor-icon,
+#identity-popup-permission-subview-list .notification-anchor-icon {
+  -moz-margin-end: 3px;
+}
 
 .identity-popup-permission-label {
   -moz-margin-start: 0;
 }
 
 /* XXX: menu list max-width 90px */
