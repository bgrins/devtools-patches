# HG changeset patch
# Parent 01357a4a5326585921c6c4a6907368a1832a5e4f
# User Pierre de La Morinerie <kemenaran@gmail.com>

Bug 971959 - Fix z-ordering of DevTools toolbar buttons. r=bgrins

---
 browser/devtools/canvasdebugger/canvasdebugger.xul | 4 ++--
 browser/devtools/debugger/debugger.xul             | 4 ++--
 browser/devtools/inspector/inspector.xul           | 4 ++--
 browser/devtools/netmonitor/netmonitor.xul         | 4 ++--
 browser/devtools/styleeditor/styleeditor.xul       | 4 ++--
 browser/devtools/webconsole/webconsole.xul         | 6 ++++--
 browser/themes/shared/devtools/widgets.inc.css     | 8 ++++++++
 7 files changed, 22 insertions(+), 12 deletions(-)

diff --git a/browser/devtools/canvasdebugger/canvasdebugger.xul b/browser/devtools/canvasdebugger/canvasdebugger.xul
--- a/browser/devtools/canvasdebugger/canvasdebugger.xul
+++ b/browser/devtools/canvasdebugger/canvasdebugger.xul
@@ -12,17 +12,17 @@
   %canvasDebuggerDTD;
 ]>
 
 <window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
   <script src="chrome://browser/content/devtools/theme-switching.js"/>
   <script type="application/javascript" src="canvasdebugger.js"/>
 
   <hbox class="theme-body" flex="1">
-    <vbox id="snapshots-pane">
+    <vbox id="snapshots-pane" class="devtools-side-content">
       <toolbar id="snapshots-toolbar"
                class="devtools-toolbar">
         <hbox id="snapshots-controls">
           <toolbarbutton id="record-snapshot"
                          class="devtools-toolbarbutton"
                          oncommand="SnapshotsListView._onRecordButtonClick()"
                          tooltiptext="&canvasDebuggerUI.recordSnapshot.tooltip;"
                          hidden="true"/>
@@ -36,17 +36,17 @@
                            oncommand="SnapshotsListView._onClearButtonClick()"
                            label="&canvasDebuggerUI.clearSnapshots;"/>
            </hbox>
         </hbox>
       </toolbar>
       <vbox id="snapshots-list" flex="1"/>
     </vbox>
 
-    <vbox id="debugging-pane" flex="1">
+    <vbox id="debugging-pane" class="devtools-main-content" flex="1">
       <hbox id="reload-notice"
             class="notice-container"
             align="center"
             pack="center"
             flex="1">
         <button id="reload-notice-button"
                 class="devtools-toolbarbutton"
                 standalone="true"
diff --git a/browser/devtools/debugger/debugger.xul b/browser/devtools/debugger/debugger.xul
--- a/browser/devtools/debugger/debugger.xul
+++ b/browser/devtools/debugger/debugger.xul
@@ -340,17 +340,17 @@
                      tooltiptext="&debuggerUI.optsButton.tooltip;"
                      popup="debuggerPrefsContextMenu"
                      tabindex="0"/>
     </toolbar>
     <vbox id="globalsearch" orient="vertical" hidden="true"/>
     <splitter class="devtools-horizontal-splitter" hidden="true"/>
     <hbox id="debugger-widgets" flex="1">
       <tabbox id="sources-pane"
-              class="devtools-sidebar-tabs">
+              class="devtools-side-content devtools-sidebar-tabs">
         <tabs>
           <tab id="sources-tab" label="&debuggerUI.tabs.sources;"/>
           <tab id="callstack-tab" label="&debuggerUI.tabs.callstack;"/>
           <tab id="tracer-tab" label="&debuggerUI.tabs.traces;" hidden="true"/>
         </tabs>
         <tabpanels flex="1">
           <tabpanel id="sources-tabpanel">
             <vbox id="sources" flex="1"/>
@@ -398,17 +398,17 @@
                        flex="1"
                        type="search"/>
             </toolbar>
           </tabpanel>
         </tabpanels>
       </tabbox>
       <splitter id="sources-and-editor-splitter"
                 class="devtools-side-splitter"/>
-      <deck id="editor-deck" flex="1">
+      <deck id="editor-deck" flex="1" class="devtools-main-content">
         <vbox id="editor"/>
         <vbox id="black-boxed-message"
               align="center"
               pack="center">
           <description id="black-boxed-message-label">
             &debuggerUI.blackBoxMessage.label;
           </description>
           <button id="black-boxed-message-button"
diff --git a/browser/devtools/inspector/inspector.xul b/browser/devtools/inspector/inspector.xul
--- a/browser/devtools/inspector/inspector.xul
+++ b/browser/devtools/inspector/inspector.xul
@@ -74,17 +74,17 @@
         oncommand="inspector.togglePseudoClass(':active')"/>
       <menuitem id="node-menu-pseudo-focus"
         label=":focus" type="checkbox"
         oncommand="inspector.togglePseudoClass(':focus')"/>
     </menupopup>
   </popupset>
 
   <box flex="1" class="devtools-responsive-container theme-body">
-    <vbox flex="1">
+    <vbox flex="1" class="devtools-main-content">
       <toolbar id="inspector-toolbar"
         class="devtools-toolbar"
         nowindowdrag="true">
         <arrowscrollbox id="inspector-breadcrumbs"
           class="breadcrumbs-widget-container"
           flex="1" orient="horizontal"
           clicktoscroll="true"/>
         <textbox id="inspector-searchbox"
@@ -92,14 +92,14 @@
           timeout="50"
           class="devtools-searchinput"
           placeholder="&inspectorSearchHTML.label;"/>
       </toolbar>
       <vbox flex="1" id="markup-box">
       </vbox>
     </vbox>
     <splitter class="devtools-side-splitter"/>
-    <tabbox id="inspector-sidebar" handleCtrlTab="false" class="devtools-sidebar-tabs" hidden="true">
+    <tabbox id="inspector-sidebar" handleCtrlTab="false" class="devtools-side-content devtools-sidebar-tabs" hidden="true">
       <tabs/>
       <tabpanels flex="1"/>
     </tabbox>
   </box>
 </window>
diff --git a/browser/devtools/netmonitor/netmonitor.xul b/browser/devtools/netmonitor/netmonitor.xul
--- a/browser/devtools/netmonitor/netmonitor.xul
+++ b/browser/devtools/netmonitor/netmonitor.xul
@@ -46,17 +46,17 @@
   </popupset>
 
   <deck id="body" class="theme-sidebar" flex="1">
 
     <vbox id="network-inspector-view" flex="1">
       <hbox id="network-table-and-sidebar"
             class="devtools-responsive-container"
             flex="1">
-        <vbox id="network-table" flex="1">
+        <vbox id="network-table" flex="1" class="devtools-main-content">
           <toolbar id="requests-menu-toolbar"
                    class="devtools-toolbar"
                    align="center">
             <hbox id="toolbar-labels" flex="1">
               <hbox id="requests-menu-status-and-method-header-box"
                     class="requests-menu-header requests-menu-status-and-method"
                     align="center">
                 <button id="requests-menu-status-button"
@@ -248,17 +248,17 @@
                        class="tabpanel-summary-input"
                        multiline="true"
                        rows="6"
                        wrap="off"
                        data-key="body"/>
             </vbox>
           </vbox>
           <tabbox id="event-details-pane"
-                  class="devtools-sidebar-tabs"
+                  class="devtools-side-content devtools-sidebar-tabs"
                   handleCtrlTab="false">
             <tabs>
               <tab id="headers-tab"
                    label="&netmonitorUI.tab.headers;"/>
               <tab id="cookies-tab"
                    label="&netmonitorUI.tab.cookies;"/>
               <tab id="params-tab"
                    label="&netmonitorUI.tab.params;"/>
diff --git a/browser/devtools/styleeditor/styleeditor.xul b/browser/devtools/styleeditor/styleeditor.xul
--- a/browser/devtools/styleeditor/styleeditor.xul
+++ b/browser/devtools/styleeditor/styleeditor.xul
@@ -82,17 +82,17 @@
     <xul:command id="cmd_findAgain" oncommand="goDoCommand('cmd_findAgain')"/>
   </xul:commandset>
 
   <xul:keyset id="sourceEditorKeys"/>
 
   <xul:stack id="style-editor-chrome" class="loading theme-body">
 
     <xul:box class="splitview-root" context="sidebar-context">
-      <xul:box class="splitview-controller">
+      <xul:box class="splitview-controller devtools-side-content">
         <xul:box class="splitview-main">
           <xul:toolbar class="devtools-toolbar">
              <xul:hbox class="devtools-toolbarbutton-group">
               <xul:toolbarbutton class="style-editor-newButton devtools-toolbarbutton"
                           accesskey="&newButton.accesskey;"
                           tooltiptext="&newButton.tooltip;"
                           label="&newButton.label;"/>
               <xul:toolbarbutton class="style-editor-importButton devtools-toolbarbutton"
@@ -115,17 +115,17 @@
             <p>&noStyleSheet-tip-start.label;
               <a href="#"
                 class="style-editor-newButton">&noStyleSheet-tip-action.label;</a>
               &noStyleSheet-tip-end.label;</p>
           </div>
         </xul:box> <!-- .splitview-nav-container -->
       </xul:box>   <!-- .splitview-controller -->
       <xul:splitter class="devtools-side-splitter splitview-landscape-splitter devtools-invisible-splitter"/>
-      <xul:box class="splitview-side-details"/>
+      <xul:box class="splitview-side-details devtools-main-content"/>
 
       <div id="splitview-templates" hidden="true">
         <li id="splitview-tpl-summary-stylesheet" tabindex="0">
           <xul:label class="stylesheet-enabled" tabindex="0"
             tooltiptext="&visibilityToggle.tooltip;"
             accesskey="&saveButton.accesskey;"></xul:label>
           <hgroup class="stylesheet-info">
             <h1><a class="stylesheet-name" tabindex="0"><xul:label crop="start"/></a></h1>
diff --git a/browser/devtools/webconsole/webconsole.xul b/browser/devtools/webconsole/webconsole.xul
--- a/browser/devtools/webconsole/webconsole.xul
+++ b/browser/devtools/webconsole/webconsole.xul
@@ -4,16 +4,18 @@
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 <!DOCTYPE window [
 <!ENTITY % webConsoleDTD SYSTEM "chrome://browser/locale/devtools/webConsole.dtd">
 %webConsoleDTD;
 ]>
 <?xml-stylesheet href="chrome://global/skin/" type="text/css"?>
 <?xml-stylesheet href="chrome://browser/skin/devtools/common.css"
                  type="text/css"?>
+<?xml-stylesheet href="chrome://browser/skin/devtools/widgets.css"
+                 type="text/css"?>
 <?xml-stylesheet href="chrome://browser/skin/devtools/webconsole.css"
                  type="text/css"?>
 <?xul-overlay href="chrome://global/content/editMenuOverlay.xul"?>
 <window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
         id="devtools-webconsole"
         macanimationtype="document"
         fullscreenbutton="true"
         title="&window.title;"
@@ -77,17 +79,17 @@ function goUpdateConsoleCommands() {
       <menuitem id="cMenu_copy"/>
       <menuitem id="cMenu_selectAll"/>
     </menupopup>
   </popupset>
 
   <tooltip id="aHTMLTooltip" page="true"/>
 
   <box class="hud-outer-wrapper devtools-responsive-container theme-body" flex="1">
-    <vbox class="hud-console-wrapper" flex="1">
+    <vbox class="hud-console-wrapper devtools-main-content" flex="1">
       <toolbar class="hud-console-filter-toolbar devtools-toolbar" mode="full">
         <hbox class="devtools-toolbarbutton-group">
           <toolbarbutton label="&btnPageNet.label;" type="menu-button"
                          category="net" class="devtools-toolbarbutton webconsole-filter-button"
                          tooltiptext="&btnPageNet.tooltip;"
                          accesskeyMacOSX="&btnPageNet.accesskeyMacOSX;"
                          accesskey="&btnPageNet.accesskey;"
                          tabindex="3">
@@ -183,14 +185,14 @@ function goUpdateConsoleCommands() {
                      multiline="true" rows="1" tabindex="0"/>
           </stack>
         </hbox>
       </notificationbox>
     </vbox>
 
     <splitter class="devtools-side-splitter"/>
 
-    <tabbox id="webconsole-sidebar" class="devtools-sidebar-tabs" hidden="true" width="300">
+    <tabbox id="webconsole-sidebar" class="devtools-side-content devtools-sidebar-tabs" hidden="true" width="300">
       <tabs/>
       <tabpanels flex="1"/>
     </tabbox>
   </box>
 </window>
diff --git a/browser/themes/shared/devtools/toolbars.inc.css b/browser/themes/shared/devtools/toolbars.inc.css
--- a/browser/themes/shared/devtools/toolbars.inc.css
+++ b/browser/themes/shared/devtools/toolbars.inc.css
@@ -457,16 +457,28 @@
 }
 
 .theme-light .devtools-sidebar-tabs > tabs > tab[selected],
 .theme-light .devtools-sidebar-tabs > tabs > tab[selected]:hover:active {
   color: #f5f7fa;
   background-image: linear-gradient(#4c9ed9, #4c9ed9), @solidSeparatorLight@;
 }
 
+
+.devtools-main-content,
+.devtools-sidebar-tabs {
+  /* isolate the stacking contexts of both sides
+     (it prevent non-opaque elements in controller to bleed on details) */
+  position: relative;
+}
+
+.devtools-main-content {
+  min-width: 50px;
+}
+
 /* Toolbox - moved from toolbox.css.
  * Rules that apply to the global toolbox like command buttons,
  * devtools tabs, docking buttons, etc. */
 
 #toolbox-controls > toolbarbutton,
 #toolbox-dock-buttons > toolbarbutton {
   -moz-appearance: none;
   border: none;
diff --git a/browser/themes/shared/devtools/widgets.inc.css b/browser/themes/shared/devtools/widgets.inc.css
--- a/browser/themes/shared/devtools/widgets.inc.css
+++ b/browser/themes/shared/devtools/widgets.inc.css
@@ -29,16 +29,21 @@
 }
 
 /* Responsive container */
 
 .devtools-responsive-container {
   -moz-box-orient: horizontal;
 }
 
+.devtools-main-content,
+.devtools-side-content iframe {
+  /*min-width: 50px;*/
+}
+
 @media (max-width: 700px) {
   .devtools-responsive-container {
     -moz-box-orient: vertical;
   }
 
   .devtools-responsive-container > .devtools-side-splitter {
     border-width: 0;
     border-top-width: 1px;
