# HG changeset patch
# Parent  f621039533e9e1493909f47cf1752bdebb9c6846
Backed out changeset bfc1a9444c76 (bug 1168125)

diff --git a/browser/devtools/performance/performance.xul b/browser/devtools/performance/performance.xul
--- a/browser/devtools/performance/performance.xul
+++ b/browser/devtools/performance/performance.xul
@@ -68,18 +68,16 @@
                 type="checkbox"
                 data-pref="show-jit-optimizations"
                 label="&profilerUI.showJITOptimizations;"
                 tooltiptext="&profilerUI.showJITOptimizations.tooltiptext;"/>
     </menupopup>
   </popupset>
 
   <hbox class="theme-body" flex="1">
-
-    <!-- Sidebar: controls and recording list -->
     <vbox id="recordings-pane">
       <toolbar id="recordings-toolbar"
                class="devtools-toolbar">
         <hbox id="recordings-controls"
               class="devtools-toolbarbutton-group">
           <toolbarbutton id="main-record-button"
                          class="devtools-toolbarbutton record-button"
                          tooltiptext="&profilerUI.recordButton2.tooltip;"/>
@@ -89,31 +87,25 @@
           <toolbarbutton id="clear-button"
                          class="devtools-toolbarbutton"
                          label="&profilerUI.clearButton;"/>
         </hbox>
       </toolbar>
       <vbox id="recordings-list" flex="1"/>
     </vbox>
 
-    <!-- Main panel content -->
     <vbox id="performance-pane" flex="1">
-
-      <!-- Top toolbar controls -->
-      <toolbar id="performance-toolbar"
-               class="devtools-toolbar">
-        <hbox id="performance-toolbar-controls-other"
-              class="devtools-toolbarbutton-group">
+      <toolbar id="performance-toolbar" class="devtools-toolbar">
+        <hbox id="performance-toolbar-control-other" class="devtools-toolbarbutton-group">
           <toolbarbutton id="filter-button"
                          class="devtools-toolbarbutton"
                          popup="performance-filter-menupopup"
                          tooltiptext="&profilerUI.options.filter.tooltiptext;"/>
         </hbox>
-        <hbox id="performance-toolbar-controls-detail-views"
-              class="devtools-toolbarbutton-group">
+        <hbox id="performance-toolbar-controls-detail-views" class="devtools-toolbarbutton-group">
           <toolbarbutton id="select-waterfall-view"
                          class="devtools-toolbarbutton devtools-button"
                          label="Waterfall"
                          hidden="true"
                          data-view="waterfall" />
           <toolbarbutton id="select-js-calltree-view"
                          class="devtools-toolbarbutton devtools-button"
                          label="Call Tree"
@@ -131,130 +123,113 @@
                          data-view="memory-calltree" />
           <toolbarbutton id="select-memory-flamegraph-view"
                          class="devtools-toolbarbutton devtools-button"
                          label="Allocations Chart"
                          hidden="true"
                          data-view="memory-flamegraph" />
         </hbox>
         <spacer flex="1"></spacer>
-        <hbox id="performance-toolbar-controls-options"
-              class="devtools-toolbarbutton-group">
+        <hbox id="performance-toolbar-control-options" class="devtools-toolbarbutton-group">
           <toolbarbutton id="performance-options-button"
                          class="devtools-toolbarbutton devtools-option-toolbarbutton"
                          popup="performance-options-menupopup"
                          tooltiptext="&profilerUI.options.gear.tooltiptext;"/>
         </hbox>
       </toolbar>
 
-      <!-- Recording contents and general notice messages -->
       <deck id="performance-view" flex="1">
-
-        <!-- "Empty" notice, shown when there's no recordings available -->
         <hbox id="empty-notice"
               class="notice-container"
               align="center"
               pack="center"
               flex="1">
           <hbox class="devtools-toolbarbutton-group"
                 pack="center">
             <toolbarbutton class="devtools-toolbarbutton record-button"
                            label="&profilerUI.startRecording;"
                            standalone="true"/>
           </hbox>
         </hbox>
-
-        <!-- Recording contents -->
         <vbox id="performance-view-content" flex="1">
-
-          <!-- Overview graphs -->
           <vbox id="overview-pane">
             <hbox id="markers-overview"/>
             <hbox id="memory-overview"/>
             <hbox id="time-framerate"/>
           </vbox>
-
-          <!-- Detail views and specific notice messages -->
           <deck id="details-pane-container" flex="1">
-
-            <!-- "Loading" notice, shown when a recording is being loaded -->
             <hbox id="loading-notice"
                   class="notice-container devtools-throbber"
                   align="center"
                   pack="center"
                   flex="1">
               <label value="&profilerUI.loadingNotice;"/>
             </hbox>
-
-            <!-- "Recording" notice, shown when a recording is in progress -->
-            <vbox id="recording-notice"
+            <hbox id="recording-notice"
                   class="notice-container"
                   align="center"
                   pack="center"
                   flex="1">
-              <hbox class="devtools-toolbarbutton-group"
-                    pack="center">
-                <toolbarbutton class="devtools-toolbarbutton record-button"
-                               label="&profilerUI.stopRecording;"
-                               standalone="true"/>
-              </hbox>
-              <label class="realtime-disabled-message">
-                Realtime recording data disabled on non-multiprocess Firefox.
-              </label>
-              <label class="realtime-disabled-on-e10s-message">
-                Enable multiprocess Firefox in preferences for rendering recording data in realtime.
-              </label>
-              <label class="buffer-status-message"
-                     tooltiptext="&profilerUI.bufferStatusTooltip;"/>
-              <label class="buffer-status-message-full"
-                     value="&profilerUI.bufferStatusFull;"/>
-            </vbox>
-
-            <!-- "Console" notice, shown when a console recording is in progress -->
-            <vbox id="console-recording-notice"
+              <vbox>
+                <hbox class="devtools-toolbarbutton-group"
+                      pack="center">
+                  <toolbarbutton class="devtools-toolbarbutton record-button"
+                                 label="&profilerUI.stopRecording;"
+                                 standalone="true"/>
+                </hbox>
+                <label class="realtime-disabled-message">
+                  Realtime recording data disabled on non-multiprocess Firefox.
+                </label>
+                <label class="realtime-disabled-on-e10s-message">
+                  Enable multiprocess Firefox in preferences for rendering recording data in realtime.
+                </label>
+                <label class="buffer-status-message"
+                       tooltiptext="&profilerUI.bufferStatusTooltip;"/>
+                <label class="buffer-status-message-full"
+                       value="&profilerUI.bufferStatusFull;"/>
+              </vbox>
+            </hbox>
+            <hbox id="console-recording-notice"
                   class="notice-container"
                   align="center"
                   pack="center"
                   flex="1">
-              <hbox class="console-profile-recording-notice">
-                <label value="&profilerUI.console.recordingNoticeStart;" />
-                <label class="console-profile-command" />
-                <label value="&profilerUI.console.recordingNoticeEnd;" />
-              </hbox>
-              <hbox class="console-profile-stop-notice">
-                <label value="&profilerUI.console.stopCommandStart;" />
-                <label class="console-profile-command" />
-                <label value="&profilerUI.console.stopCommandEnd;" />
-              </hbox>
-              <label class="realtime-disabled-message">
-                Realtime recording data disabled on non-multiprocess Firefox.
-              </label>
-              <label class="realtime-disabled-on-e10s-message">
-                Enable multiprocess Firefox in preferences for rendering recording data in realtime.
-              </label>
-              <label class="buffer-status-message"
-                     tooltiptext="&profilerUI.bufferStatusTooltip;"/>
-              <label class="buffer-status-message-full"
-                     value="&profilerUI.bufferStatusFull;"/>
-            </vbox>
-
-            <!-- Detail views -->
+                  <vbox flex="1" align="center">
+                    <hbox class="console-profile-recording-notice">
+                      <label value="&profilerUI.console.recordingNoticeStart;" />
+                      <label class="console-profile-command" />
+                      <label value="&profilerUI.console.recordingNoticeEnd;" />
+                    </hbox>
+                    <hbox class="console-profile-stop-notice">
+                      <label value="&profilerUI.console.stopCommandStart;" />
+                      <label class="console-profile-command" />
+                      <label value="&profilerUI.console.stopCommandEnd;" />
+                    </hbox>
+                    <label class="realtime-disabled-message">
+                      Realtime recording data disabled on non-multiprocess Firefox.
+                    </label>
+                    <label class="realtime-disabled-on-e10s-message">
+                      Enable multiprocess Firefox in preferences for rendering recording data in realtime.
+                    </label>
+                    <label class="buffer-status-message"
+                           tooltiptext="&profilerUI.bufferStatusTooltip;"/>
+                    <label class="buffer-status-message-full"
+                           value="&profilerUI.bufferStatusFull;"/>
+                  </vbox>
+            </hbox>
             <deck id="details-pane" flex="1">
-
-              <!-- Waterfall -->
               <hbox id="waterfall-view" flex="1">
-                <vbox id="waterfall-breakdown" flex="1" />
+                <vbox id="waterfall-breakdown" flex="1" class="devtools-main-content" />
                 <splitter class="devtools-side-splitter"/>
                 <vbox id="waterfall-details"
                       class="theme-sidebar"
                       width="150"
                       height="150"/>
               </hbox>
 
-              <!-- JS Tree and JIT view -->
               <hbox id="js-profile-view" flex="1">
                 <vbox id="js-calltree-view" flex="1">
                   <hbox class="call-tree-headers-container">
                     <label class="plain call-tree-header"
                            type="duration"
                            crop="end"
                            value="&profilerUI.table.totalDuration2;"
                            tooltiptext="&profilerUI.table.totalDuration.tooltip;"/>
@@ -281,37 +256,33 @@
                     <label class="plain call-tree-header"
                            type="function"
                            crop="end"
                            value="&profilerUI.table.function;"
                            tooltiptext="&profilerUI.table.function.tooltip;"/>
                   </hbox>
                   <vbox class="call-tree-cells-container" flex="1"/>
                 </vbox>
-
                 <splitter id="js-call-tree-splitter" class="devtools-side-splitter"/>
-
                 <vbox id="jit-optimizations-view" hidden="true">
                   <toolbar id="jit-optimizations-toolbar" class="devtools-toolbar">
                     <hbox id="jit-optimizations-header">
                       <span class="jit-optimizations-title">&profilerUI.JITOptimizationsTitle;</span>
                       <span class="header-function-name" />
                       <span class="header-file opt-url debugger-link" />
                       <span class="header-line opt-line" />
                     </hbox>
                   </toolbar>
                   <vbox id="jit-optimizations-raw-view"></vbox>
                 </vbox>
               </hbox>
 
-              <!-- JS FlameChart -->
               <hbox id="js-flamegraph-view" flex="1">
               </hbox>
 
-              <!-- Memory Tree -->
               <vbox id="memory-calltree-view" flex="1">
                 <hbox class="call-tree-headers-container">
                   <label class="plain call-tree-header"
                          type="allocations"
                          crop="end"
                          value="&profilerUI.table.totalAlloc1;"
                          tooltiptext="&profilerUI.table.totalAlloc.tooltip;"/>
                   <label class="plain call-tree-header"
@@ -322,19 +293,17 @@
                   <label class="plain call-tree-header"
                          type="function"
                          crop="end"
                          value="&profilerUI.table.function;"/>
                 </hbox>
                 <vbox class="call-tree-cells-container" flex="1"/>
               </vbox>
 
-              <!-- Memory FlameChart -->
               <hbox id="memory-flamegraph-view" flex="1">
               </hbox>
-
             </deck>
           </deck>
         </vbox>
       </deck>
     </vbox>
   </hbox>
 </window>
diff --git a/browser/themes/shared/devtools/performance.inc.css b/browser/themes/shared/devtools/performance.inc.css
--- a/browser/themes/shared/devtools/performance.inc.css
+++ b/browser/themes/shared/devtools/performance.inc.css
@@ -15,20 +15,29 @@
   --cell-border-color: rgba(0,0,0,0.15);
   --focus-cell-border-color: rgba(0,0,0,0.3);
   --row-alt-background-color: rgba(76,158,217,0.1);
   --row-hover-background-color: rgba(76,158,217,0.2);
 }
 
 /* Toolbar */
 
+#performance-toolbar > tabs,
+#performance-toolbar {
+  -moz-border-end-color: var(--theme-splitter-color);
+}
+
 #performance-toolbar-control-other {
   -moz-padding-end: 5px;
 }
 
+#performance-toolbar-controls-detail-views > toolbarbutton {
+  min-width: 0;
+}
+
 #performance-toolbar-controls-detail-views .toolbarbutton-text {
   -moz-padding-start: 4px;
   -moz-padding-end: 8px;
 }
 
 #filter-button {
   list-style-image: url(timeline-filter.svg#filter);
   min-width: 24px;
@@ -46,33 +55,101 @@
   content: "";
   display: block;
   width: 8px;
   height: 8px;
   margin: 0 8px;
   border-radius: 1px;
 }
 
-/* Details panel buttons */
+/* Recording Notice */
 
-#select-waterfall-view {
-  list-style-image: url(performance-icons.svg#details-waterfall);
+#performance-view .notice-container {
+  font-size: 120%;
+  background-color: var(--theme-toolbar-background);
+  color: var(--theme-body-color);
+  padding-bottom: 20vh;
 }
 
-#select-js-calltree-view,
-#select-memory-calltree-view {
-  list-style-image: url(performance-icons.svg#details-call-tree);
+#performance-view .notice-container button {
+  min-width: 30px;
+  min-height: 28px;
+  margin: 0;
 }
 
-#select-js-flamegraph-view,
-#select-memory-flamegraph-view {
-  list-style-image: url(performance-icons.svg#details-flamegraph);
+#performance-view .notice-container vbox {
+  text-align: center;
 }
 
-/* Recording buttons */
+.console-profile-command {
+  font-family: monospace;
+  margin: 3px 2px;
+}
+
+#performance-view .realtime-message {
+  opacity: 0.5;
+  display: block;
+}
+
+#performance-view toolbarbutton.record-button {
+  padding: 5px;
+}
+
+#performance-view toolbarbutton.record-button[checked],
+#performance-view toolbarbutton.record-button[checked] {
+  color: var(--theme-selection-color);
+  background: var(--theme-selection-background);
+}
+
+.record-button[locked] {
+  pointer-events: none;
+  opacity: 0.5;
+}
+
+#performance-view .realtime-disabled-message,
+#performance-view .realtime-disabled-on-e10s-message {
+  display: none;
+  /* This label does not want to wrap naturally (based on some combination of
+     it's parents and flex).  Quick and dirty way to force it to wrap -> don't
+     let it get bigger than half the screen size */
+  max-width: 60vw;
+}
+
+#performance-view[e10s="disabled"] .realtime-disabled-on-e10s-message {
+  display: block;
+  opacity: 0.5;
+
+}
+#performance-view[e10s="unsupported"] .realtime-disabled-message {
+  display: block;
+  opacity: 0.5;
+}
+
+#details-pane-container .buffer-status-message,
+#details-pane-container .buffer-status-message-full {
+  display: none;
+}
+
+#details-pane-container[buffer-status="in-progress"] .buffer-status-message {
+  display: block;
+  opacity: 0.5;
+}
+
+#details-pane-container[buffer-status="full"] .buffer-status-message {
+  display: block;
+  color: var(--theme-highlight-red);
+  font-weight: bold;
+  opacity: 1;
+}
+
+#details-pane-container[buffer-status="full"] .buffer-status-message-full {
+  display: block;
+}
+
+/* Overview Panel */
 
 #main-record-button {
   list-style-image: url(profiler-stopwatch.svg);
 }
 
 #main-record-button[checked] {
   list-style-image: url(profiler-stopwatch-checked.svg);
 }
@@ -80,113 +157,30 @@
 #main-record-button .button-icon {
   margin: 0;
 }
 
 #main-record-button .button-text {
   display: none;
 }
 
-.notice-container .record-button {
-  padding: 5px !important;
+/* Details Panel */
+
+#select-waterfall-view {
+  list-style-image: url(performance-icons.svg#details-waterfall);
 }
 
-.notice-container .record-button[checked],
-.notice-container .record-button[checked] {
-  color: var(--theme-selection-color) !important;
-  background: var(--theme-selection-background) !important;
+#select-js-calltree-view,
+#select-memory-calltree-view {
+  list-style-image: url(performance-icons.svg#details-call-tree);
 }
 
-.record-button[locked] {
-  pointer-events: none;
-  opacity: 0.5;
-}
-
-/* Sidebar & recording items */
-
-.recording-item {
-  padding: 4px;
-}
-
-.recording-item-title {
-  font-size: 110%;
-}
-
-.recording-item-footer {
-  padding-top: 4px;
-  font-size: 90%;
-}
-
-.recording-item-save {
-  text-decoration: underline;
-  cursor: pointer;
-}
-
-.recording-item-duration,
-.recording-item-save {
-  color: var(--theme-body-color-alt);
-}
-
-#recordings-list .selected label {
-  /* Text inside a selected item should not be custom colored. */
-  color: inherit !important;
-}
-
-/* Recording notices */
-
-.notice-container {
-  font-size: 120%;
-  background-color: var(--theme-toolbar-background);
-  color: var(--theme-body-color);
-  padding-bottom: 20vh;
-}
-
-.console-profile-command {
-  font-family: monospace;
-  margin: 3px 2px;
-}
-
-.realtime-disabled-message,
-.realtime-disabled-on-e10s-message {
-  display: none;
-  /* This label does not want to wrap naturally (based on some combination of
-     it's parents and flex).  Quick and dirty way to force it to wrap -> don't
-     let it get bigger than half the screen size */
-  max-width: 60vw;
-}
-
-#performance-view[e10s="disabled"] .realtime-disabled-on-e10s-message {
-  display: auto;
-  opacity: 0.5;
-
-}
-#performance-view[e10s="unsupported"] .realtime-disabled-message {
-  display: auto;
-  opacity: 0.5;
-}
-
-.buffer-status-message,
-.buffer-status-message-full {
-  display: none;
-}
-
-#details-pane-container[buffer-status="in-progress"] .buffer-status-message {
-  display: auto;
-  opacity: 0.5;
-}
-
-#details-pane-container[buffer-status="full"] .buffer-status-message {
-  display: auto;
-  color: var(--theme-highlight-red);
-  font-weight: bold;
-  opacity: 1;
-}
-
-#details-pane-container[buffer-status="full"] .buffer-status-message-full {
-  display: auto;
+#select-js-flamegraph-view,
+#select-memory-flamegraph-view {
+  list-style-image: url(performance-icons.svg#details-flamegraph);
 }
 
 /* Profile call tree */
 
 .call-tree-cells-container {
   /* Hack: force hardware acceleration */
   transform: translateZ(1px);
   overflow: auto;
@@ -318,29 +312,64 @@
 }
 
 .call-tree-host {
   -moz-margin-start: 8px !important;
   font-size: 90%;
   color: var(--theme-content-color2);
 }
 
+.call-tree-zoom {
+  -moz-appearance: none;
+  background-color: transparent;
+  background-position: center;
+  background-repeat: no-repeat;
+  background-size: 11px;
+  min-width: 11px;
+  -moz-margin-start: 8px !important;
+  cursor: zoom-in;
+  opacity: 0;
+}
+
+.theme-dark .call-tree-zoom {
+  background-image: url(magnifying-glass.png);
+}
+
+.theme-light .call-tree-zoom {
+  background-image: url(magnifying-glass-light.png);
+}
+
+@media (min-resolution: 1.25dppx) {
+  .theme-dark .call-tree-zoom {
+    background-image: url(magnifying-glass@2x.png);
+  }
+
+  .theme-light .call-tree-zoom {
+    background-image: url(magnifying-glass-light@2x.png);
+  }
+}
+
+.call-tree-item:hover .call-tree-zoom {
+  transition: opacity 0.3s ease-in;
+  opacity: 1;
+}
+
+.call-tree-item:hover .call-tree-zoom:hover {
+  opacity: 0;
+}
+
 .call-tree-category {
   transform: scale(0.75);
   transform-origin: center right;
 }
 
 /**
  * Details Waterfall Styles
  */
 
-#waterfall-breakdown {
-  overflow: auto;
-}
-
 .waterfall-list-contents {
   /* Hack: force hardware acceleration */
   transform: translateZ(1px);
   overflow-x: hidden;
   overflow-y: auto;
 }
 
 .waterfall-header-contents {
@@ -479,16 +508,46 @@ menuitem.marker-color-graphs-blue:before
   font-size: 1.2em;
   font-weight: bold;
 }
 
 .marker-details-duration {
   font-weight: bold;
 }
 
+/* Recording items */
+
+.recording-item {
+  padding: 4px;
+}
+
+.recording-item-title {
+  font-size: 110%;
+}
+
+.recording-item-footer {
+  padding-top: 4px;
+  font-size: 90%;
+}
+
+.recording-item-save {
+  text-decoration: underline;
+  cursor: pointer;
+}
+
+.recording-item-duration,
+.recording-item-save {
+  color: var(--theme-body-color-alt);
+}
+
+#recordings-list .selected label {
+  /* Text inside a selected item should not be custom colored. */
+  color: inherit !important;
+}
+
 /**
  * JIT View
  */
 
 #jit-optimizations-view {
   width: 350px;
   overflow-x: hidden;
   overflow-y: auto;
@@ -598,18 +657,18 @@ menuitem.marker-color-graphs-blue:before
   #jit-optimizations-view .opt-icon::before {
     background-image: url(chrome://browser/skin/devtools/webconsole@2x.png);
   }
 }
 
 /**
  * Configurable Options
  *
- * Elements can be tagged with a class and visibility is controlled via a
- * preference being applied or removed.
+ * Elements can be tagged with a class and visibility is controlled via a preference being
+ * applied or removed.
  */
 
 /**
  * devtools.performance.ui.experimental
  */
 menuitem.experimental-option::before {
   content: "";
   background-image: url(chrome://browser/skin/devtools/webconsole.png);
