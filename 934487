# HG changeset patch
# Parent ba95fffe62b944bdf37ffb0d65b7878a558aefd7
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 934487 - Fix "TypeError: this.markup is undefined" in devtools b-c runs


diff --git a/browser/devtools/inspector/inspector-panel.js b/browser/devtools/inspector/inspector-panel.js
--- a/browser/devtools/inspector/inspector-panel.js
+++ b/browser/devtools/inspector/inspector-panel.js
@@ -353,16 +353,19 @@ InspectorPanel.prototype = {
     this._getDefaultNodeForSelection().then(defaultNode => {
       if (this._destroyPromise) {
         return;
       }
       this.selection.setNodeFront(defaultNode, "navigateaway");
 
       this._initMarkup();
       this.once("markuploaded", () => {
+        if (this._destroyPromise) {
+          return;
+        }
         this.markup.expandNode(this.selection.nodeFront);
         this.setupSearchBox();
         this.emit("new-root");
       });
     });
   },
 
   _selectionCssSelector: null,
