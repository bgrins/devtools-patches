# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1567029140 25200
#      Wed Aug 28 14:52:20 2019 -0700
# Node ID 10352760196657e886ddb3fce2fb00c2c8e4db5a
# Parent  457898d79250904ca2b7e28aba95e4544d45ffe7
Bug 1573158 - Move Shadow DOM creation into constructor instead of connectedCallback

Differential Revision: https://phabricator.services.mozilla.com/D43847

diff --git a/browser/components/places/content/places-menupopup.js b/browser/components/places/content/places-menupopup.js
--- a/browser/components/places/content/places-menupopup.js
+++ b/browser/components/places/content/places-menupopup.js
@@ -27,16 +27,22 @@
         "dragexit",
         "dragend",
       ];
       for (let event_name of event_names) {
         this.addEventListener(event_name, ev => this[`on_${event_name}`](ev));
       }
 
       this.attachShadow({ mode: "open" });
+      this.shadowRoot.appendChild(this.fragment);
+
+      this._indicatorBar = this.shadowRoot.querySelector(
+        "[part=drop-indicator-bar]"
+      );
+      this._scrollBox = this.shadowRoot.querySelector(".popup-internal-box");
     }
 
     get fragment() {
       if (!this.constructor.hasOwnProperty("_fragment")) {
         this.constructor._fragment = MozXULElement.parseXULToFragment(
           this.markup
         );
       }
@@ -58,24 +64,16 @@
     `;
     }
 
     connectedCallback() {
       if (this.delayConnectedCallback()) {
         return;
       }
 
-      this.shadowRoot.textContent = "";
-      this.shadowRoot.appendChild(this.fragment);
-
-      this._indicatorBar = this.shadowRoot.querySelector(
-        "[part=drop-indicator-bar]"
-      );
-      this._scrollBox = this.shadowRoot.querySelector(".popup-internal-box");
-
       /**
        * Sub-menus should be opened when the mouse drags over them, and closed
        * when the mouse drags off.  The overFolder object manages opening and
        * closing of folders when the mouse hovers.
        */
       this._overFolder = {
         _self: this,
         _folder: {
