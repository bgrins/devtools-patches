# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  cc65f9233e5b16265ae44b643c7d255556da14fb
Bug 1307936 - Reset filter prefs in between console mochitests;r=Honza

diff --git a/devtools/client/webconsole/new-console-output/test/mochitest/head.js b/devtools/client/webconsole/new-console-output/test/mochitest/head.js
--- a/devtools/client/webconsole/new-console-output/test/mochitest/head.js
+++ b/devtools/client/webconsole/new-console-output/test/mochitest/head.js
@@ -17,16 +17,22 @@ Services.scriptloader.loadSubScript(
 var {Utils: WebConsoleUtils} = require("devtools/client/webconsole/utils");
 const WEBCONSOLE_STRINGS_URI = "devtools/client/locales/webconsole.properties";
 var WCUL10n = new WebConsoleUtils.L10n(WEBCONSOLE_STRINGS_URI);
 
 Services.prefs.setBoolPref("devtools.webconsole.new-frontend-enabled", true);
 registerCleanupFunction(function* () {
   Services.prefs.clearUserPref("devtools.webconsole.new-frontend-enabled");
 
+  // Reset all filter prefs between tests.  First flushPrefEnv in case one of the
+  // filter prefs has been pushed for the test
+  yield SpecialPowers.flushPrefEnv();
+  Services.prefs.getChildList("devtools.webconsole.filter").forEach(pref => {
+    Services.prefs.clearUserPref(pref);
+  });
   let browserConsole = HUDService.getBrowserConsole();
   if (browserConsole) {
     if (browserConsole.jsterm) {
       browserConsole.jsterm.clearOutput(true);
     }
     yield HUDService.toggleBrowserConsole();
   }
 });
