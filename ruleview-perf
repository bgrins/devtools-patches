# HG changeset patch
# Parent 517a797c25339f837d2b1eb5c9100d5b7f878c6d
# User Brian Grinstead <bgrinstead@mozilla.com>
Experimenting with ruleview-perf

diff --git a/browser/devtools/styleinspector/style-inspector.js b/browser/devtools/styleinspector/style-inspector.js
--- a/browser/devtools/styleinspector/style-inspector.js
+++ b/browser/devtools/styleinspector/style-inspector.js
@@ -147,28 +147,32 @@ function ComputedViewTool(aInspector, aW
 
   this._onSelect = this.onSelect.bind(this);
   this.inspector.selection.on("detached", this._onSelect);
   this.inspector.selection.on("new-node-front", this._onSelect);
   this.refresh = this.refresh.bind(this);
   this.inspector.on("layout-change", this.refresh);
   this.inspector.selection.on("pseudoclass", this.refresh);
 
+  this.onSidebarSelect = this.onSidebarSelect.bind(this);
+  this.inspector.sidebar.on("select", this.onSidebarSelect);
+
   this.view.highlight(null);
 
   this.onSelect();
 }
 
 exports.ComputedViewTool = ComputedViewTool;
 
 ComputedViewTool.prototype = {
   onSelect: function CVT_onSelect(aEvent)
   {
-    if (!this.view) {
-      // Skip the event if ComputedViewTool has been destroyed.
+    if (!this.view || !this.isActive()) {
+      // Skip the event if ComputedViewTool has been destroyed
+      // or if it is not visible.
       return;
     }
     this.view.setPageStyle(this.inspector.pageStyle);
 
     if (!this.inspector.selection.isConnected() ||
         !this.inspector.selection.isElementNode()) {
       this.view.highlight(null);
       return;
@@ -178,25 +182,38 @@ ComputedViewTool.prototype = {
       let done = this.inspector.updating("computed-view");
       this.view.highlight(this.inspector.selection.nodeFront).then(() => {
         done();
       });
     }
   },
 
   refresh: function CVT_refresh() {
-    this.view.refreshPanel();
+    if (this.isActive()) {
+      this.view.refreshPanel();
+    }
+  },
+
+  onSidebarSelect: function(e, sidebar) {
+    if (sidebar === "comptedview") {
+      this.onSelect();
+    }
+  },
+
+  isActive: function() {
+    return this.inspector &&
+           this.inspector.sidebar.getCurrentTabID() == "computedview";
   },
 
   destroy: function CVT_destroy(aContext)
   {
     this.inspector.off("layout-change", this.refresh);
-    this.inspector.sidebar.off("computedview-selected", this.refresh);
     this.inspector.selection.off("pseudoclass", this.refresh);
     this.inspector.selection.off("new-node-front", this._onSelect);
+    this.inspector.sidebar.off("select", this.onSidebarSelect);
 
     this.view.destroy();
     delete this.view;
 
     delete this.outerIFrame;
     delete this.cssLogic;
     delete this.cssHtmlTree;
     delete this.window;
