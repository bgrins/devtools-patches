# HG changeset patch
# Parent 193c4c5c7ec215ec086cf866b43c1ffdf7953083
# User Ian Moody <moz-ian@perix.co.uk>
Bug 1124246 - Visually differentiate XHR network logs in the webconsole

diff --git a/browser/devtools/webconsole/webconsole.js b/browser/devtools/webconsole/webconsole.js
--- a/browser/devtools/webconsole/webconsole.js
+++ b/browser/devtools/webconsole/webconsole.js
@@ -1518,16 +1518,23 @@ WebConsoleFrame.prototype = {
       messageNode.setAttribute("private", true);
     }
     messageNode._connectionId = actorId;
     messageNode.url = request.url;
 
     let body = methodNode.parentNode;
     body.setAttribute("aria-haspopup", true);
 
+    if (networkInfo.isXHR) {
+      let xhrNode = this.document.createElementNS(XHTML_NS, "span");
+      xhrNode.className = "xhr";
+      xhrNode.textContent = l10n.getStr("webConsoleXhrIndicator");
+      body.appendChild(xhrNode);
+    }
+
     let displayUrl = request.url;
     let pos = displayUrl.indexOf("?");
     if (pos > -1) {
       displayUrl = displayUrl.substr(0, pos);
     }
 
     let urlNode = this.document.createElementNS(XHTML_NS, "a");
     urlNode.className = "url";
diff --git a/browser/locales/en-US/chrome/browser/devtools/webconsole.properties b/browser/locales/en-US/chrome/browser/devtools/webconsole.properties
--- a/browser/locales/en-US/chrome/browser/devtools/webconsole.properties
+++ b/browser/locales/en-US/chrome/browser/devtools/webconsole.properties
@@ -65,16 +65,21 @@ NetworkPanel.responseBodyUnableToDisplay
 
 ConsoleAPIDisabled=The Web Console logging API (console.log, console.info, console.warn, console.error) has been disabled by a script on this page.
 
 # LOCALIZATION NOTE (webConsoleWindowTitleAndURL): the Web Console floating
 # panel title. For RTL languages you need to set the LRM in the string to give
 # the URL the correct direction. Parameters: %S is the web page URL.
 webConsoleWindowTitleAndURL=Web Console - %S
 
+# LOCALIZATION NOTE (webConsoleXhrIndicator): the indicator displayed before
+# a URL in the Web Console that was requested using an XMLHttpRequest.
+# Should probably be the same as &btnConsoleXhr; in webConsole.dtd
+webConsoleXhrIndicator=XHR
+
 # LOCALIZATION NOTE (webConsoleMixedContentWarning): the message displayed
 # after a URL in the Web Console that has been flagged for Mixed Content (i.e.
 # http content in an https page).
 webConsoleMixedContentWarning=Mixed Content
 
 # LOCALIZATION NOTE (webConsoleMoreInfoLabel): the more info tag displayed
 # after security related web console messages.
 webConsoleMoreInfoLabel=Learn More
diff --git a/browser/themes/shared/devtools/webconsole.inc.css b/browser/themes/shared/devtools/webconsole.inc.css
--- a/browser/themes/shared/devtools/webconsole.inc.css
+++ b/browser/themes/shared/devtools/webconsole.inc.css
@@ -257,16 +257,28 @@ a {
   color: #FF0000;
 }
 
 .message .learn-more-link {
   color: -moz-nativehyperlinktext;
   margin: 0 6px;
 }
 
+.message .xhr {
+  background-color: var(--theme-body-color-alt);
+  color: var(--theme-body-background);
+  border-radius: 3px;
+  font-weight: bold;
+  font-size: .9em;
+  padding: 2px;
+  line-height: 10px;
+  -moz-margin-end: 1ex;
+  -moz-user-select: none;
+}
+
 /* CSS styles */
 .webconsole-filter-button[category="css"] > .toolbarbutton-menubutton-button:before {
   background-image: linear-gradient(#2DC3F3, #00B6F0);
   border-color: #1BA2CC;
 }
 
 .message[category=cssparser] > .indent {
   -moz-border-end: solid #00b6f0 6px;
