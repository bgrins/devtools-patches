# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  9f06d4c4da0fab0ab858421047d2d97bd7908c34
Bug 1184447 - Convert control center main-view to use CSS flexbox;r=ttaubert

This works around the clipped 'more information' button that shows up when there is
wrapping inside one of the labels inside the main view.

diff --git a/browser/components/controlcenter/content/panel.inc.xul b/browser/components/controlcenter/content/panel.inc.xul
--- a/browser/components/controlcenter/content/panel.inc.xul
+++ b/browser/components/controlcenter/content/panel.inc.xul
@@ -1,25 +1,29 @@
 <!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
 <panel id="identity-popup"
        type="arrow"
        hidden="true"
+       noautohide="true"
        onpopupshown="gIdentityHandler.onPopupShown(event);"
        onpopuphidden="gIdentityHandler.onPopupHidden(event);"
        orient="vertical">
 
   <broadcasterset>
     <broadcaster id="identity-popup-content-host" value=""/>
   </broadcasterset>
 
   <panelmultiview id="identity-popup-multiView"
                   mainViewId="identity-popup-mainView">
+    <!-- Main View - note that this uses CSS flexbox for layout (Bug 1184447).
+         If you need to use align / pack / flex attributes on elements, please
+         make sure they are implemented in the CSS file. -->
     <panelview id="identity-popup-mainView" flex="1">
 
       <!-- Security Section -->
       <hbox class="identity-popup-section">
         <vbox id="identity-popup-security-content" flex="1">
           <label class="identity-popup-headline" crop="end">
             <observes element="identity-popup-content-host" attribute="value"/>
           </label>
diff --git a/browser/themes/shared/controlcenter/panel.inc.css b/browser/themes/shared/controlcenter/panel.inc.css
--- a/browser/themes/shared/controlcenter/panel.inc.css
+++ b/browser/themes/shared/controlcenter/panel.inc.css
@@ -87,23 +87,52 @@
 
 #identity-popup-securityView:-moz-locale-dir(rtl),
 #identity-popup-security-content:-moz-locale-dir(rtl),
 #identity-popup-permissions-content:-moz-locale-dir(rtl),
 #tracking-protection-content:-moz-locale-dir(rtl) {
   background-position: calc(100% - 1em) 1em;
 }
 
+/* Use CSS flexbox for the mainview to work around clipped 'more information' button -
+   see Bug 1184447 */
+#identity-popup-mainView,
+#identity-popup-mainView * {
+  display: flex;
+}
+
+#identity-popup-mainView,
+#identity-popup-mainView vbox {
+  flex-flow: column;
+}
+
+#identity-popup-mainView [hidden="true"] {
+  display: none;
+}
+
+#identity-popup-mainView [flex="1"] {
+  flex-grow: 1;
+}
+
+#identity-popup-mainView [align="center"] {
+  align-items: center;
+}
+
+#identity-popup-mainView [pack="center"] {
+  justify-content: center;
+}
+
 /* EXPAND BUTTON */
 
 .identity-popup-expander {
   margin: 0;
   padding: 4px 0;
   min-width: auto;
   width: 38px;
+  flex-shrink: 0;
   border: 0 none;
   -moz-appearance: none;
   background-image: url("chrome://browser/skin/controlcenter/arrow-subview.svg"),
                     linear-gradient(rgba(255,255,255,0.3), transparent);
   background-size: 16px, auto;
   background-position: center;
   background-repeat: no-repeat;
   background-color: transparent;
