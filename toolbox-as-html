# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  ace1b4a3ec042824b363d1bb6dd57c1320d9c87e
Bug ???: try converting inspector frame to html

diff --git a/devtools/client/definitions.js b/devtools/client/definitions.js
--- a/devtools/client/definitions.js
+++ b/devtools/client/definitions.js
@@ -83,17 +83,17 @@ Tools.options = {
 Tools.inspector = {
   id: "inspector",
   accesskey: l10n("inspector.accesskey", inspectorStrings),
   key: l10n("inspector.commandkey", inspectorStrings),
   ordinal: 1,
   modifiers: osString == "Darwin" ? "accel,alt" : "accel,shift",
   icon: "chrome://devtools/skin/images/tool-inspector.svg",
   invertIconForLightTheme: true,
-  url: "chrome://devtools/content/inspector/inspector.xul",
+  url: "chrome://devtools/content/inspector/inspector.xhtml",
   label: l10n("inspector.label", inspectorStrings),
   panelLabel: l10n("inspector.panelLabel", inspectorStrings),
   get tooltip() {
     return l10n("inspector.tooltip2", inspectorStrings,
     ( osString == "Darwin" ? "Cmd+Opt+" : "Ctrl+Shift+" ) + this.key);
   },
   inMenu: true,
   commands: [
diff --git a/devtools/client/framework/sidebar.js b/devtools/client/framework/sidebar.js
--- a/devtools/client/framework/sidebar.js
+++ b/devtools/client/framework/sidebar.js
@@ -5,19 +5,23 @@
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 const {Cu} = require("chrome");
 
 Cu.import("resource://gre/modules/XPCOMUtils.jsm");
 Cu.import("resource://gre/modules/Services.jsm");
 Cu.import("resource://gre/modules/Task.jsm");
 
+
 var EventEmitter = require("devtools/shared/event-emitter");
 var Telemetry = require("devtools/client/shared/telemetry");
 
+// XXX: How to load this widget?
+// const {TabPanel,Tabs} = require("devtools/client/shared/widgets/tabs");
+
 const XULNS = "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";
 
 /**
  * ToolSidebar provides methods to register tabs in the sidebar.
  * It's assumed that the sidebar contains a xul:tabbox.
  * Typically, you'll want the tabbox parameter to be a XUL tabbox like this:
  *
  * <tabbox id="inspector-sidebar" handleCtrlTab="false" class="devtools-sidebar-tabs">
@@ -57,33 +61,35 @@ const XULNS = "http://www.mozilla.org/ke
  * - <tabid>-selected : After tab <tabid> was selected
  * - select : Same as above, but for any tab, the ID is passed with the event
  * - <tabid>-unselected : After tab <tabid> is unselected
  */
 function ToolSidebar(tabbox, panel, uid, options={}) {
   EventEmitter.decorate(this);
 
   this._tabbox = tabbox;
+  this._tabboxTabs = tabbox.querySelector("tabs");
+  this._tabboxTabpanels = tabbox.querySelector("tabpanels");
   this._uid = uid;
   this._panelDoc = this._tabbox.ownerDocument;
   this._toolPanel = panel;
   this._options = options;
 
   this._onTabBoxOverflow = this._onTabBoxOverflow.bind(this);
   this._onTabBoxUnderflow = this._onTabBoxUnderflow.bind(this);
 
   try {
     this._width = Services.prefs.getIntPref("devtools.toolsidebar-width." + this._uid);
   } catch(e) {}
 
   if (!options.disableTelemetry) {
     this._telemetry = new Telemetry();
   }
 
-  this._tabbox.tabpanels.addEventListener("select", this, true);
+  this._tabboxTabpanels.addEventListener("select", this, true);
 
   this._tabs = new Map();
 
   // Check for existing tabs in the DOM and add them.
   this.addExistingTabs();
 
   if (this._options.hideTabstripe) {
     this._tabbox.setAttribute("hidetabs", "true");
@@ -111,17 +117,17 @@ ToolSidebar.prototype = {
    * true, this is already done automatically. If not, you may call this
    * function at any time to add the menu.
    */
   addAllTabsMenu: function() {
     if (this._allTabsBtn) {
       return;
     }
 
-    let tabs = this._tabbox.tabs;
+    let tabs = this._tabboxTabs;
 
     // Create a container and insert it first in the tabbox
     let allTabsContainer = this._panelDoc.createElementNS(XULNS, "stack");
     this._tabbox.insertBefore(allTabsContainer, tabs);
 
     // Move the tabs inside and make them flex
     allTabsContainer.appendChild(tabs);
     tabs.setAttribute("flex", "1");
@@ -151,23 +157,23 @@ ToolSidebar.prototype = {
     }
   },
 
   removeAllTabsMenu: function() {
     if (!this._allTabsBtn) {
       return;
     }
 
-    let tabs = this._tabbox.tabs;
+    let tabs = this._tabboxTabs;
 
     tabs.removeEventListener("overflow", this._onTabBoxOverflow, false);
     tabs.removeEventListener("underflow", this._onTabBoxUnderflow, false);
 
     // Moving back the tabs as a first child of the tabbox
-    this._tabbox.insertBefore(tabs, this._tabbox.tabpanels);
+    this._tabbox.insertBefore(tabs, this._tabboxTabpanels);
     this._tabbox.querySelector("stack").remove();
 
     this._allTabsBtn = null;
   },
 
   _onTabBoxOverflow: function() {
     this._allTabsBtn.removeAttribute("hidden");
   },
@@ -209,25 +215,26 @@ ToolSidebar.prototype = {
   /**
    * Register a tab. A tab is a document.
    * The document must have a title, which will be used as the name of the tab.
    *
    * @param {string} tab uniq id
    * @param {string} url
    */
   addTab: function(id, url, selected=false) {
+    return;
     let iframe = this._panelDoc.createElementNS(XULNS, "iframe");
     iframe.className = "iframe-" + id;
     iframe.setAttribute("flex", "1");
     iframe.setAttribute("src", url);
     iframe.tooltip = "aHTMLTooltip";
 
     // Creating the tab and adding it to the tabbox
     let tab = this._panelDoc.createElementNS(XULNS, "tab");
-    this._tabbox.tabs.appendChild(tab);
+    this._tabboxTabs.appendChild(tab);
     tab.setAttribute("label", ""); // Avoid showing "undefined" while the tab is loading
     tab.setAttribute("id", this.TAB_ID_PREFIX + id);
     tab.setAttribute("crop", "end");
 
     // Add the tab to the allTabs menu if exists
     let allTabsItem = this._addItemToAllTabsMenu(id, tab, selected);
 
     let onIFrameLoaded = (event) => {
@@ -246,17 +253,17 @@ ToolSidebar.prototype = {
       this.emit(id + "-ready");
     };
 
     iframe.addEventListener("load", onIFrameLoaded, true);
 
     let tabpanel = this._panelDoc.createElementNS(XULNS, "tabpanel");
     tabpanel.setAttribute("id", this.TABPANEL_ID_PREFIX + id);
     tabpanel.appendChild(iframe);
-    this._tabbox.tabpanels.appendChild(tabpanel);
+    this._tabboxTabpanels.appendChild(tabpanel);
 
     this._tooltip = this._panelDoc.createElementNS(XULNS, "tooltip");
     this._tooltip.id = "aHTMLTooltip";
     tabpanel.appendChild(this._tooltip);
     this._tooltip.page = true;
 
     tab.linkedPanel = this.TABPANEL_ID_PREFIX + id;
 
@@ -278,17 +285,17 @@ ToolSidebar.prototype = {
   untitledTabsIndex: 0,
 
   /**
    * Search for existing tabs in the markup that aren't know yet and add them.
    */
   addExistingTabs: function() {
     let knownTabs = [...this._tabs.values()];
 
-    for (let tab of this._tabbox.tabs.querySelectorAll("tab")) {
+    for (let tab of this._tabboxTabs.querySelectorAll("tab")) {
       if (knownTabs.indexOf(tab) !== -1) {
         continue;
       }
 
       // Find an ID for this unknown tab
       let id = tab.getAttribute("id") || "untitled-tab-" + (this.untitledTabsIndex++);
 
       // Register the tab
@@ -358,33 +365,33 @@ ToolSidebar.prototype = {
   },
 
   /**
    * Return the id of the selected tab.
    */
   getCurrentTabID: function() {
     let currentID = null;
     for (let [id, tab] of this._tabs) {
-      if (this._tabbox.tabs.selectedItem == tab) {
+      if (this._tabboxTabs.selectedItem == tab) {
         currentID = id;
         break;
       }
     }
     return currentID;
   },
 
   /**
    * Returns the requested tab panel based on the id.
    * @param {String} id
    * @return {DOMNode}
    */
   getTabPanel: function(id) {
     // Search with and without the ID prefix as there might have been existing
     // tabpanels by the time the sidebar got created
-    return this._tabbox.tabpanels.querySelector("#" + this.TABPANEL_ID_PREFIX + id + ", #" + id);
+    return this._tabboxTabpanels.querySelector("#" + this.TABPANEL_ID_PREFIX + id + ", #" + id);
   },
 
   /**
    * Return the tab based on the provided id, if one was registered with this id.
    * @param {String} id
    * @return {DOMNode}
    */
   getTab: function(id) {
@@ -496,32 +503,32 @@ ToolSidebar.prototype = {
     this._destroyed = true;
 
     Services.prefs.setIntPref("devtools.toolsidebar-width." + this._uid, this._tabbox.width);
 
     if (this._allTabsBtn) {
       this.removeAllTabsMenu();
     }
 
-    this._tabbox.tabpanels.removeEventListener("select", this, true);
+    this._tabboxTabpanels.removeEventListener("select", this, true);
 
-    // Note that we check for the existence of this._tabbox.tabpanels at each
+    // Note that we check for the existence of this._tabboxTabpanels at each
     // step as the container window may have been closed by the time one of the
     // panel's destroy promise resolves.
-    while (this._tabbox.tabpanels && this._tabbox.tabpanels.hasChildNodes()) {
-      let panel = this._tabbox.tabpanels.firstChild;
+    while (this._tabboxTabpanels && this._tabboxTabpanels.hasChildNodes()) {
+      let panel = this._tabboxTabpanels.firstChild;
       let win = panel.firstChild.contentWindow;
       if (win && ("destroy" in win)) {
         yield win.destroy();
       }
       panel.remove();
     }
 
-    while (this._tabbox.tabs && this._tabbox.tabs.hasChildNodes()) {
-      this._tabbox.tabs.removeChild(this._tabbox.tabs.firstChild);
+    while (this._tabboxTabs && this._tabboxTabs.hasChildNodes()) {
+      this._tabboxTabs.removeChild(this._tabboxTabs.firstChild);
     }
 
     if (this._currentTool && this._telemetry) {
       this._telemetry.toolClosed(this._currentTool);
     }
 
     this._toolPanel.emit("sidebar-destroyed", this);
 
diff --git a/devtools/client/inspector/inspector-panel.js b/devtools/client/inspector/inspector-panel.js
--- a/devtools/client/inspector/inspector-panel.js
+++ b/devtools/client/inspector/inspector-panel.js
@@ -11,17 +11,17 @@ Cu.import("resource://gre/modules/Servic
 var promise = require("promise");
 var EventEmitter = require("devtools/shared/event-emitter");
 var clipboard = require("sdk/clipboard");
 var {HostType} = require("devtools/client/framework/toolbox").Toolbox;
 
 loader.lazyRequireGetter(this, "CSS", "CSS");
 
 loader.lazyGetter(this, "MarkupView", () => require("devtools/client/markupview/markup-view").MarkupView);
-loader.lazyGetter(this, "HTMLBreadcrumbs", () => require("devtools/client/inspector/breadcrumbs").HTMLBreadcrumbs);
+// loader.lazyGetter(this, "HTMLBreadcrumbs", () => require("devtools/client/inspector/breadcrumbs").HTMLBreadcrumbs);
 loader.lazyGetter(this, "ToolSidebar", () => require("devtools/client/framework/sidebar").ToolSidebar);
 loader.lazyGetter(this, "InspectorSearch", () => require("devtools/client/inspector/inspector-search").InspectorSearch);
 
 loader.lazyGetter(this, "strings", () => {
   return Services.strings.createBundle("chrome://devtools/locale/inspector.properties");
 });
 loader.lazyGetter(this, "toolboxStrings", () => {
   return Services.strings.createBundle("chrome://devtools/locale/toolbox.properties");
@@ -160,17 +160,22 @@ InspectorPanel.prototype = {
     this.lastNodemenuItem = this.nodemenu.lastChild;
     this.nodemenu.addEventListener("popupshowing", this._setupNodeMenu, true);
     this.nodemenu.addEventListener("popuphiding", this._resetNodeMenu, true);
 
     this.selection.on("new-node-front", this.onNewSelection);
     this.selection.on("before-new-node-front", this.onBeforeNewSelection);
     this.selection.on("detached-front", this.onDetached);
 
-    this.breadcrumbs = new HTMLBreadcrumbs(this);
+    // this.breadcrumbs = new HTMLBreadcrumbs(this);
+    this.breadcrumbs = {
+      destroy: () => {},
+      indexOf: () => {},
+      cutAfter: () => {},
+    };
 
     this._toolbox.on("host-changed", this.onToolboxHostChanged);
 
     if (this.target.isLocalTab) {
       this.browser = this.target.tab.linkedBrowser;
       this.browser.addEventListener("resize", this.scheduleLayoutChange, true);
 
       // Show a warning when the debugger is paused.
diff --git a/devtools/client/inspector/inspector.xul b/devtools/client/inspector/inspector.xhtml
rename from devtools/client/inspector/inspector.xul
rename to devtools/client/inspector/inspector.xhtml
--- a/devtools/client/inspector/inspector.xul
+++ b/devtools/client/inspector/inspector.xhtml
@@ -8,18 +8,20 @@
 <?xml-stylesheet href="chrome://devtools/skin/common.css" type="text/css"?>
 <?xml-stylesheet href="chrome://devtools/skin/widgets.css" type="text/css"?>
 <?xml-stylesheet href="chrome://devtools/skin/inspector.css" type="text/css"?>
 <!DOCTYPE window [
   <!ENTITY % inspectorDTD SYSTEM "chrome://devtools/locale/inspector.dtd" >
    %inspectorDTD;
 ]>
 
-<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
-
+<html xmlns="http://www.w3.org/1999/xhtml"
+      xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+      class="theme-body">
+  <head>
   <script type="application/javascript;version=1.8"
           src="chrome://devtools/content/shared/theme-switching.js"/>
 
   <commandset>
     <command id="nodeSearchCommand"
       oncommand="inspector.searchBox.focus()"/>
   </commandset>
 
@@ -139,38 +141,34 @@
       <menuitem id="node-menu-pseudo-active"
         label=":active" type="checkbox"
         oncommand="inspector.togglePseudoClass(':active')"/>
       <menuitem id="node-menu-pseudo-focus"
         label=":focus" type="checkbox"
         oncommand="inspector.togglePseudoClass(':focus')"/>
     </menupopup>
   </popupset>
-
-  <box flex="1" class="devtools-responsive-container theme-body">
+  </head>
+  <body class="devtools-responsive-container theme-body">
+  <box flex="1">
     <vbox flex="1" class="devtools-main-content">
-      <toolbar id="inspector-toolbar"
-        class="devtools-toolbar"
-        nowindowdrag="true">
-        <arrowscrollbox id="inspector-breadcrumbs"
-          class="breadcrumbs-widget-container"
-          flex="1" orient="horizontal"
-          clicktoscroll="true"/>
-        <box id="inspector-searchlabel" />
-        <textbox id="inspector-searchbox"
-          type="search"
-          timeout="50"
-          class="devtools-searchinput"
-          placeholder="&inspectorSearchHTML.label3;"/>
-        <toolbarbutton id="inspector-pane-toggle"
-          class="devtools-toolbarbutton"
-          tabindex="0" />
-      </toolbar>
+      <div id="inspector-toolbar"
+           class="devtools-toolbar">
+        <div flex="1"></div>
+        <div class="label" id="inspector-searchlabel"></div>
+        <input id="inspector-searchbox"
+               class="devtools-searchinput devtools-rule-searchbox"
+               type="search" placeholder="&inspectorSearchHTML.label3;"/>
+        <button id="inspector-pane-toggle"
+          class="devtools-button"
+          tabindex="0"></button>
+      </div>
       <vbox flex="1" id="markup-box">
       </vbox>
     </vbox>
     <splitter class="devtools-side-splitter"/>
-    <tabbox id="inspector-sidebar" handleCtrlTab="false" class="devtools-sidebar-tabs" hidden="true">
+    <div id="inspector-sidebar" handleCtrlTab="false" class="devtools-sidebar-tabs" hidden="true">
       <tabs/>
       <tabpanels flex="1"/>
-    </tabbox>
+    </div>
   </box>
-</window>
+  </body>
+</html>
diff --git a/devtools/client/jar.mn b/devtools/client/jar.mn
--- a/devtools/client/jar.mn
+++ b/devtools/client/jar.mn
@@ -123,17 +123,17 @@ devtools.jar:
     content/framework/toolbox-options.js (framework/toolbox-options.js)
     content/framework/toolbox.xul (framework/toolbox.xul)
     content/framework/options-panel.css (framework/options-panel.css)
     content/framework/toolbox-process-window.xul (framework/toolbox-process-window.xul)
 *   content/framework/toolbox-process-window.js (framework/toolbox-process-window.js)
     content/framework/dev-edition-promo/dev-edition-promo.xul (framework/dev-edition-promo/dev-edition-promo.xul)
 *   content/framework/dev-edition-promo/dev-edition-promo.css (framework/dev-edition-promo/dev-edition-promo.css)
     content/framework/dev-edition-promo/dev-edition-logo.png (framework/dev-edition-promo/dev-edition-logo.png)
-    content/inspector/inspector.xul (inspector/inspector.xul)
+    content/inspector/inspector.xhtml (inspector/inspector.xhtml)
     content/inspector/inspector.css (inspector/inspector.css)
     content/framework/connect/connect.xhtml (framework/connect/connect.xhtml)
     content/framework/connect/connect.css (framework/connect/connect.css)
     content/framework/connect/connect.js (framework/connect/connect.js)
     content/shared/widgets/graphs-frame.xhtml (shared/widgets/graphs-frame.xhtml)
     content/shared/widgets/spectrum-frame.xhtml (shared/widgets/spectrum-frame.xhtml)
     content/shared/widgets/spectrum.css (shared/widgets/spectrum.css)
     content/shared/widgets/cubic-bezier-frame.xhtml (shared/widgets/cubic-bezier-frame.xhtml)
diff --git a/devtools/client/shared/autocomplete-popup.js b/devtools/client/shared/autocomplete-popup.js
--- a/devtools/client/shared/autocomplete-popup.js
+++ b/devtools/client/shared/autocomplete-popup.js
@@ -28,17 +28,17 @@ const events  = require("devtools/shared
  *                     panel to be automatically selected when the popup shows.
  *        - direction {String} The direction of the text in the panel. rtl or ltr
  *        - onSelect {String} The select event handler for the richlistbox
  *        - onClick {String} The click event handler for the richlistbox.
  *        - onKeypress {String} The keypress event handler for the richlistitems.
  */
 function AutocompletePopup(aDocument, aOptions = {})
 {
-  this._document = aDocument;
+  this._document = aDocument.defaultView.top.document;
 
   this.autoSelect = aOptions.autoSelect || false;
   this.position = aOptions.position || "after_start";
   this.direction = aOptions.direction || "ltr";
 
   this.onSelect = aOptions.onSelect;
   this.onClick = aOptions.onClick;
   this.onKeypress = aOptions.onKeypress;
diff --git a/devtools/client/shared/inplace-editor.js b/devtools/client/shared/inplace-editor.js
--- a/devtools/client/shared/inplace-editor.js
+++ b/devtools/client/shared/inplace-editor.js
@@ -29,18 +29,18 @@ const HTML_NS = "http://www.w3.org/1999/
 const CONTENT_TYPES = {
   PLAIN_TEXT: 0,
   CSS_VALUE: 1,
   CSS_MIXED: 2,
   CSS_PROPERTY: 3,
 };
 const MAX_POPUP_ENTRIES = 10;
 
-const FOCUS_FORWARD = Ci.nsIFocusManager.MOVEFOCUS_FORWARD;
-const FOCUS_BACKWARD = Ci.nsIFocusManager.MOVEFOCUS_BACKWARD;
+const FOCUS_FORWARD = 1; // Ci.nsIFocusManager.MOVEFOCUS_FORWARD;
+const FOCUS_BACKWARD = 2; // Ci.nsIFocusManager.MOVEFOCUS_BACKWARD;
 
 Cu.import("resource://gre/modules/Services.jsm");
 Cu.import("resource://gre/modules/XPCOMUtils.jsm");
 Cu.import("resource://devtools/shared/event-emitter.js");
 
 /**
  * Mark a span editable.  |editableField| will listen for the span to
  * be focused and create an InlineEditor to handle text input.
diff --git a/devtools/client/shared/widgets/Tooltip.js b/devtools/client/shared/widgets/Tooltip.js
--- a/devtools/client/shared/widgets/Tooltip.js
+++ b/devtools/client/shared/widgets/Tooltip.js
@@ -98,29 +98,33 @@ var PanelFactory = {
   /**
    * Get a new XUL panel instance.
    * @param {XULDocument} doc
    *        The XUL document to put that panel into
    * @param {OptionsStore} options
    *        An options store to get some configuration from
    */
   get: function(doc, options) {
+    // All the way up to browser.xul
+    doc = doc.defaultView.top.document;
+
     // Create the tooltip
     let panel = doc.createElement("panel");
     panel.setAttribute("hidden", true);
     panel.setAttribute("ignorekeys", true);
     panel.setAttribute("animate", false);
 
     panel.setAttribute("consumeoutsideclicks",
                        options.get("consumeOutsideClick"));
     panel.setAttribute("noautofocus", options.get("noAutoFocus"));
     panel.setAttribute("type", "arrow");
     panel.setAttribute("level", "top");
 
     panel.setAttribute("class", "devtools-tooltip theme-tooltip-panel");
+    console.log("Created a panel", doc, doc.defaultView.top, panel);
     doc.querySelector("window").appendChild(panel);
 
     return panel;
   }
 };
 
 /**
  * Tooltip class.
@@ -174,17 +178,17 @@ var PanelFactory = {
  * - shown : when the tooltip is shown
  * - hiding : just before the tooltip closes
  * - hidden : when the tooltip gets hidden
  * - keypress : when any key gets pressed, with keyCode
  */
 function Tooltip(doc, options) {
   EventEmitter.decorate(this);
 
-  this.doc = doc;
+  this.doc = doc.defaultView.top.document;
   this.options = new OptionsStore({
     consumeOutsideClick: false,
     closeOnKeys: [ESCAPE_KEYCODE],
     noAutoFocus: true,
     closeOnEvents: []
   }, options);
   this.panel = PanelFactory.get(doc, this.options);
 
diff --git a/devtools/client/shared/widgets/moz.build b/devtools/client/shared/widgets/moz.build
--- a/devtools/client/shared/widgets/moz.build
+++ b/devtools/client/shared/widgets/moz.build
@@ -18,14 +18,15 @@ DevToolsModules(
     'GraphsWorker.js',
     'LineGraphWidget.js',
     'MdnDocsWidget.js',
     'MountainGraphWidget.js',
     'SideMenuWidget.jsm',
     'SimpleListWidget.jsm',
     'Spectrum.js',
     'TableWidget.js',
+    'tabs.js',
     'Tooltip.js',
     'TreeWidget.js',
     'VariablesView.jsm',
     'VariablesViewController.jsm',
     'ViewHelpers.jsm',
 )
diff --git a/devtools/client/shared/widgets/tabs.js b/devtools/client/shared/widgets/tabs.js
new file mode 100644
--- /dev/null
+++ b/devtools/client/shared/widgets/tabs.js
@@ -0,0 +1,192 @@
+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */
+/* vim: set ft=javascript ts=2 et sw=2 tw=80: */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+define(function(require, exports, module) {
+
+const React = require("react");
+const DOM = React.DOM;
+
+const XHTML_NS = "http://www.w3.org/1999/xhtml";
+
+/**
+ * Renders simple 'tab' widget.
+ *
+ * Based on ReactSimpleTabs component
+ * https://github.com/pedronauck/react-simpletabs
+ *
+ * Component markup (+CSS) example:
+ *
+ * <div class='tabs'>
+ *  <nav class='tabs-navigation'>
+ *    <ul class='tabs-menu'>
+ *      <li class='tabs-menu-item is-active'>Tab #1</li>
+ *      <li class='tabs-menu-item'>Tab #2</li>
+ *    </ul>
+ *  </nav>
+ *  <article class='tab-panel'>
+ *    The content of active panel here
+ *  </article>
+ * <div>
+ */
+var Tabs = React.createClass({
+  displayName: "Tabs",
+
+  propTypes: {
+    className: React.PropTypes.oneOfType([
+      React.PropTypes.array,
+      React.PropTypes.string,
+      React.PropTypes.object
+    ]),
+    tabActive: React.PropTypes.number,
+    onMount: React.PropTypes.func,
+    onBeforeChange: React.PropTypes.func,
+    onAfterChange: React.PropTypes.func,
+    children: React.PropTypes.oneOfType([
+      React.PropTypes.array,
+      React.PropTypes.element
+    ]).isRequired
+  },
+
+  getDefaultProps: function () {
+    return {
+      tabActive: 1
+    };
+  },
+
+  getInitialState: function () {
+    return {
+      tabActive: this.props.tabActive
+    };
+  },
+
+  componentDidMount: function() {
+    var index = this.state.tabActive;
+    if (this.props.onMount) {
+      this.props.onMount(index);
+    }
+  },
+
+  componentWillReceiveProps: function(newProps){
+    if (newProps.tabActive) {
+      this.setState({tabActive: newProps.tabActive})
+    }
+  },
+
+  render: function () {
+    var classNames = ["tabs", this.props.className].join(" ");
+
+    return (
+      DOM.div({className: classNames},
+        this.getMenuItems(),
+        this.getSelectedPanel()
+      )
+    );
+  },
+
+  setActive: function(index, e) {
+    var onAfterChange = this.props.onAfterChange;
+    var onBeforeChange = this.props.onBeforeChange;
+
+    if (onBeforeChange) {
+      var cancel = onBeforeChange(index);
+      if (cancel) {
+        return;
+      }
+    }
+
+    var newState = {
+      tabActive: index
+    };
+
+    this.setState(newState, () => {
+      if (onAfterChange) {
+        onAfterChange(index);
+      }
+    });
+
+    e.preventDefault();
+  },
+
+  getMenuItems: function () {
+    if (!this.props.children) {
+      throw new Error("Tabs must contain at least one Panel");
+    }
+
+    if (!Array.isArray(this.props.children)) {
+      this.props.children = [this.props.children];
+    }
+
+    var menuItems = this.props.children
+      .map(function(panel) {
+        return typeof panel === "function" ? panel() : panel;
+      }).filter(function(panel) {
+        return panel;
+      }).map(function(panel, index) {
+        var ref = ("tab-menu-" + (index + 1));
+        var title = panel.props.title;
+        var tabClassName = panel.props.className;
+
+        var classes = [
+          "tabs-menu-item",
+          tabClassName,
+          this.state.tabActive === (index + 1) && "is-active"
+        ].join(" ");
+
+        return (
+          DOM.li({ref: ref, key: index, className: classes},
+            DOM.a({href: "#", onClick: this.setActive.bind(this, index + 1)},
+              title
+            )
+          )
+        );
+      }.bind(this));
+
+    return (
+      DOM.nav({className: "tabs-navigation"},
+        DOM.ul({className: "tabs-menu"},
+          menuItems
+        )
+      )
+    );
+  },
+
+  getSelectedPanel: function () {
+    var index = this.state.tabActive - 1;
+    var panel = this.props.children[index];
+
+    return (
+      DOM.article({ref: "tab-panel", className: "tab-panel"},
+        panel
+      )
+    );
+  }
+});
+
+/**
+ * Renders simple tab 'panel'.
+ */
+var Panel = React.createClass({
+  displayName: "Panel",
+
+  propTypes: {
+    title: React.PropTypes.string.isRequired,
+    children: React.PropTypes.oneOfType([
+      React.PropTypes.array,
+      React.PropTypes.element
+    ]).isRequired
+  },
+
+  render: function () {
+    return DOM.div({xmlns: XHTML_NS},
+      this.props.children
+    );
+  }
+});
+
+// Exports from this module
+exports.TabPanel = Panel;
+exports.Tabs = Tabs;
+});
diff --git a/devtools/client/themes/inspector.css b/devtools/client/themes/inspector.css
--- a/devtools/client/themes/inspector.css
+++ b/devtools/client/themes/inspector.css
@@ -15,16 +15,21 @@
 
 %endif
 
 #inspector-searchlabel {
   overflow: hidden;
 }
 
 #inspector-searchbox {
+  -moz-box-flex: 0;
+  width: 150px;
+}
+
+/*#inspector-searchbox {
   transition-property: max-width, -moz-padding-end, -moz-padding-start;
   transition-duration: 250ms;
   transition-timing-function: ease;
 }
 
 #inspector-searchbox:not([focused]):not([filled]) > .textbox-input-box {
   overflow: hidden;
 }
@@ -34,17 +39,17 @@
   -moz-padding-end: 5px;
   -moz-padding-start: 22px;
   background-position: 8px center, top left, top left;
 }
 
 #inspector-searchbox[focused],
 #inspector-searchbox[filled] {
   max-width: 200px !important;
-}
+}*/
 
 /* Expand/collapse panel toolbar button */
 
 #inspector-pane-toggle {
   list-style-image: url(images/debugger-collapse.png);
 }
 
 #inspector-pane-toggle[pane-collapsed] {
diff --git a/devtools/client/themes/toolbars.css b/devtools/client/themes/toolbars.css
--- a/devtools/client/themes/toolbars.css
+++ b/devtools/client/themes/toolbars.css
@@ -13,16 +13,100 @@
 
 .theme-dark {
   --searchbox-background-color: #4d4222;
   --searchbox-border-color: #d99f2b;
   --searcbox-no-match-background-color: #402325;
   --searcbox-no-match-border-color: #cc3d3d;
 }
 
+/* LAYOUT */
+
+iframe {
+  border: none;
+}
+
+html * {
+  -moz-appearance: none;
+  box-sizing: border-box;
+  margin: 0;
+  padding: 0;
+}
+
+html {
+  height: 100%;
+}
+
+html body {
+  height: 100%;
+  display: flex;
+  flex-direction: column;
+}
+
+html box,
+html hbox,
+html vbox,
+html spacer {
+  display: flex;
+  flex-basis: 0;
+  white-space: pre;
+}
+
+html hbox {
+  flex-flow: row;
+}
+
+html vbox {
+  flex-flow: column;
+}
+
+html [flex="1"] { flex-grow: 1 }
+html [flex="2"] { flex-grow: 2 }
+html [flex="3"] { flex-grow: 3 }
+html [flex="4"] { flex-grow: 4 }
+html [flex="5"] { flex-grow: 5 }
+html [flex="6"] { flex-grow: 6 }
+html [flex="7"] { flex-grow: 7 }
+html [flex="8"] { flex-grow: 8 }
+html [flex="9"] { flex-grow: 9 }
+
+html [align="start"] { align-items: flex-start }
+html [align="center"] { align-items: center }
+html [align="end"] { align-items: flex-end }
+html [align="baseline"] { align-items: flex-baseline }
+html [align="stretch"] { align-items: flex-stretch }
+
+html [pack="start"] { justify-content: flex-start }
+html [pack="center"] { justify-content: center }
+html [pack="end"] { justify-content: flex-end }
+
+html .devtools-toolbar {
+  display: flex;
+}
+
+.devtools-html-toolbar {
+  color: var(--theme-body-color-alt);
+  background-color: var(--theme-toolbar-background);
+  border-color: var(--theme-splitter-color);
+  border-bottom: 1px solid var(--theme-splitter-color);
+  display: flex;
+  flex-direction: row;
+  align-items: center;
+  justify-content: flex-end;
+  height: 24px;
+}
+
+.devtools-html-toolbar .label {
+  padding: 1px 4px;
+}
+.devtools-html-toolbar .devtools-button  {
+  border-width: 0 0 0 1px;
+  min-height: 24px;
+}
+
 /* Toolbars */
 .devtools-toolbar,
 .devtools-sidebar-tabs tabs {
   -moz-appearance: none;
   padding: 0;
   border-width: 0;
   border-bottom-width: 1px;
   border-style: solid;
