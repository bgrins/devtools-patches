# HG changeset patch
# Parent 344307c027959e537e5d669f1d85f33a57097135
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 926974 - [markup view] Theme does not immediately apply after switching

diff --git a/browser/devtools/shared/theme-switching.js b/browser/devtools/shared/theme-switching.js
--- a/browser/devtools/shared/theme-switching.js
+++ b/browser/devtools/shared/theme-switching.js
@@ -30,17 +30,20 @@
       } catch(ex) {}
     }
 
     let newThemeUrl = Services.io.newURI(
       DEVTOOLS_SKIN_URL + newTheme + "-theme.css", null, null);
     winUtils.loadSheet(newThemeUrl, winUtils.AUTHOR_SHEET);
 
     // Floating scrollbars Ã  la osx
-    if (!window.matchMedia("(-moz-overlay-scrollbars)").matches) {
+    let hiddenDOMWindow = Cc["@mozilla.org/appshell/appShellService;1"]
+                 .getService(Ci.nsIAppShellService)
+                 .hiddenDOMWindow;
+    if (!hiddenDOMWindow.matchMedia("(-moz-overlay-scrollbars)").matches) {
       let scrollbarsUrl = Services.io.newURI(
         DEVTOOLS_SKIN_URL + "floating-scrollbars-light.css", null, null);
 
       if (newTheme == "dark") {
         winUtils.loadSheet(scrollbarsUrl, winUtils.AGENT_SHEET);
       } else if (oldTheme == "dark") {
         try {
           winUtils.removeSheet(scrollbarsUrl, winUtils.AGENT_SHEET);
