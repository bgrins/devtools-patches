# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  d5a378327e88b886d397a978e5cba2937578c9eb
Bug 1164954 - Notify the LightWeightThemeManager that the Dev Edition theme has been installed if it's active;r=dao

diff --git a/browser/base/content/browser-devedition.js b/browser/base/content/browser-devedition.js
--- a/browser/base/content/browser-devedition.js
+++ b/browser/base/content/browser-devedition.js
@@ -25,16 +25,25 @@ let DevEdition = {
     this.initialized = true;
     Services.prefs.addObserver(this._devtoolsThemePrefName, this, false);
     Services.obs.addObserver(this, "lightweight-theme-styling-update", false);
     this._updateDevtoolsThemeAttribute();
 
     if (this.isThemeCurrentlyApplied) {
       this._toggleStyleSheet(true);
     }
+
+    // If needed, notify the LightWeightThemeManager that this theme has been
+    // 'installed' so that the Default Theme isn't considered active.
+    const DEFAULT_THEME_ID = "{972ce4c6-7e08-4474-a285-3208198ce6fd}";
+    AddonManager.getAddonByID(DEFAULT_THEME_ID, aDefaultTheme => {
+      if (aDefaultTheme.isActive && this.isThemeCurrentlyApplied) {
+        LightweightThemeManager.currentTheme = LightweightThemeManager.currentTheme;
+      }
+    });
   },
 
   createStyleSheet: function() {
     let styleSheetAttr = `href="${this.styleSheetLocation}" type="text/css"`;
     this.styleSheet = document.createProcessingInstruction(
       "xml-stylesheet", styleSheetAttr);
     this.styleSheet.addEventListener("load", this);
     document.insertBefore(this.styleSheet, document.documentElement);
