# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  e965a1a534ecb6635975fae33a929dc6c06bcb50
Debug issue for loading browser toolbox

diff --git a/browser/devtools/framework/toolbox-process-window.js b/browser/devtools/framework/toolbox-process-window.js
--- a/browser/devtools/framework/toolbox-process-window.js
+++ b/browser/devtools/framework/toolbox-process-window.js
@@ -57,17 +57,23 @@ function setPrefDefaults() {
   Services.prefs.setBoolPref("browser.dom.window.dump.enabled", true);
   Services.prefs.setBoolPref("devtools.command-button-frames.enabled", true);
 }
 
 window.addEventListener("load", function() {
   let cmdClose = document.getElementById("toolbox-cmd-close");
   cmdClose.addEventListener("command", onCloseCommand);
   setPrefDefaults();
-  connect().catch(Cu.reportError);
+  connect().catch(e => {
+    let errorMessageContainer = document.getElementById("error-message-container");
+    let errorMessage = document.getElementById("error-message");
+    errorMessage.value = e;
+    errorMessageContainer.hidden = false;
+    Cu.reportError(e);
+  });
 });
 
 function onCloseCommand(event) {
   window.close();
 }
 
 function openToolbox({ form, chrome, isTabActor }) {
   let options = {
diff --git a/browser/devtools/framework/toolbox-process-window.xul b/browser/devtools/framework/toolbox-process-window.xul
--- a/browser/devtools/framework/toolbox-process-window.xul
+++ b/browser/devtools/framework/toolbox-process-window.xul
@@ -32,10 +32,14 @@
          command="toolbox-cmd-close"
          modifiers="accel"/>
   </keyset>
 
   <!-- This will be used by the Web Console to hold any popups it may create,
        for example when viewing network request details. -->
   <popupset id="mainPopupSet"></popupset>
 
+  <vbox id="error-message-container" hidden="true" flex="1">
+    <box>&browserToolboxErrorMessage;</box>
+    <textbox multiline="true" id="error-message" flex="1"></textbox>
+  </vbox>
   <iframe id="toolbox-iframe" flex="1"></iframe>
 </window>
diff --git a/browser/locales/en-US/chrome/browser/devtools/toolbox.dtd b/browser/locales/en-US/chrome/browser/devtools/toolbox.dtd
--- a/browser/locales/en-US/chrome/browser/devtools/toolbox.dtd
+++ b/browser/locales/en-US/chrome/browser/devtools/toolbox.dtd
@@ -18,16 +18,20 @@
 <!ENTITY toolboxZoomReset.key          "0">
 
 <!ENTITY toolboxReload.key             "r">
 <!-- LOCALIZATION NOTE (toolboxFramesButton): This is the label for
   -  the iframes menu list that appears only when the document has some.
   -  It allows you to switch the context of the whole toolbox. -->
 <!ENTITY toolboxFramesTooltip          "Select an iframe as the currently targeted document">
 
+<!-- LOCALIZATION NOTE (browserToolboxErrorMessage): This is the label
+  -  shown next to error details when the Browser Toolbox is unable to open. -->
+<!ENTITY browserToolboxErrorMessage          "Error opening Browser Toolbox:">
+
 <!-- LOCALIZATION NOTE (options.context.advancedSettings): This is the label for
   -  the heading of the advanced settings group in the options panel. -->
 <!ENTITY options.context.advancedSettings "Advanced settings">
 
 <!-- LOCALIZATION NOTE (options.context.inspector): This is the label for
   -  the heading of the Inspector group in the options panel. -->
 <!ENTITY options.context.inspector "Inspector">
 
