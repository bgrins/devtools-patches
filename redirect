# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  f112edf3b592b15c8a0529b84e3f58ec5a24c843
Bug 1105470 - contentLocation in webconsole.js isn't updated after a redirect

diff --git a/devtools/shared/webconsole/utils.js b/devtools/shared/webconsole/utils.js
--- a/devtools/shared/webconsole/utils.js
+++ b/devtools/shared/webconsole/utils.js
@@ -442,16 +442,22 @@ var WebConsoleUtils = {
    * @return boolean
    *         True if the content is mixed, false if not.
    */
   isMixedHTTPSRequest: function WCU_isMixedHTTPSRequest(aRequest, aLocation)
   {
     try {
       let requestURI = Services.io.newURI(aRequest, null, null);
       let contentURI = Services.io.newURI(aLocation, null, null);
+
+      var { NetUtil } = Cu.import("resource://gre/modules/NetUtil.jsm", {});
+      console.log("Checking isMixedHTTPSRequest",
+        netutil.URIChainHasFlags(requestURI, Ci.nsIProtocolHandler.URI_SAFE_TO_LOAD_IN_SECURE_CONTEXT),
+        netutil.URIChainHasFlags(contentURI, Ci.nsIProtocolHandler.URI_SAFE_TO_LOAD_IN_SECURE_CONTEXT)
+        );
       return (contentURI.scheme == "https" && requestURI.scheme != "https");
     }
     catch (ex) {
       return false;
     }
   },
 
   /**
