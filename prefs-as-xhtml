# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  e23f55311ecb5e0cd14c5010d1b40663b3a2e7d0
Turn xul prefs files into xhtml

diff --git a/browser/components/about/AboutRedirector.cpp b/browser/components/about/AboutRedirector.cpp
--- a/browser/components/about/AboutRedirector.cpp
+++ b/browser/components/about/AboutRedirector.cpp
@@ -156,17 +156,17 @@ AboutRedirector::NewChannel(nsIURI* aURI
       if (path.EqualsLiteral("newtab")) {
         // let the aboutNewTabService decide where to redirect
         nsCOMPtr<nsIAboutNewTabService> aboutNewTabService =
           do_GetService("@mozilla.org/browser/aboutnewtab-service;1", &rv);
         NS_ENSURE_SUCCESS(rv, rv);
         rv = aboutNewTabService->GetDefaultURL(url);
         NS_ENSURE_SUCCESS(rv, rv);
       } else if (path.EqualsLiteral("preferences") && !sUseOldPreferences) {
-        url.AssignASCII("chrome://browser/content/preferences/in-content-new/preferences.xul");
+        url.AssignASCII("chrome://browser/content/preferences/in-content-new/preferences.xhtml");
       }
       // fall back to the specified url in the map
       if (url.IsEmpty()) {
         url.AssignASCII(redir.url);
       }
 
       nsCOMPtr<nsIChannel> tempChannel;
       nsCOMPtr<nsIURI> tempURI;
diff --git a/browser/components/preferences/in-content-new/advanced.xul b/browser/components/preferences/in-content-new/advanced.xhtml
rename from browser/components/preferences/in-content-new/advanced.xul
rename to browser/components/preferences/in-content-new/advanced.xhtml
--- a/browser/components/preferences/in-content-new/advanced.xul
+++ b/browser/components/preferences/in-content-new/advanced.xhtml
@@ -1,20 +1,20 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- Advanced panel -->
 
 #ifdef MOZ_UPDATER
-  <script type="application/javascript" src="chrome://browser/content/aboutDialog-appUpdater.js"/>
+  <html:script  src="chrome://browser/content/aboutDialog-appUpdater.js"></html:script>
 #endif
 
-<script type="application/javascript"
-        src="chrome://browser/content/preferences/in-content-new/advanced.js"/>
+<html:script 
+        src="chrome://browser/content/preferences/in-content-new/advanced.js"></html:script>
 
 <preferences id="advancedPreferences" hidden="true" data-category="paneAdvanced">
   <preference id="browser.preferences.advanced.selectedTabIndex"
               name="browser.preferences.advanced.selectedTabIndex"
               type="int"/>
 
 <!-- Update tab -->
 #ifdef MOZ_UPDATER
diff --git a/browser/components/preferences/in-content-new/applications.xul b/browser/components/preferences/in-content-new/applications.xhtml
rename from browser/components/preferences/in-content-new/applications.xul
rename to browser/components/preferences/in-content-new/applications.xhtml
--- a/browser/components/preferences/in-content-new/applications.xul
+++ b/browser/components/preferences/in-content-new/applications.xhtml
@@ -1,16 +1,16 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- Applications panel -->
 
-<script type="application/javascript"
-        src="chrome://browser/content/preferences/in-content-new/applications.js"/>
+<html:script 
+        src="chrome://browser/content/preferences/in-content-new/applications.js"></html:script>
 
 <preferences id="feedsPreferences" hidden="true" data-category="paneApplications">
   <preference id="browser.feeds.handler"
               name="browser.feeds.handler"
               type="string"/>
   <preference id="browser.feeds.handler.default"
               name="browser.feeds.handler.default"
               type="string"/>
diff --git a/browser/components/preferences/in-content-new/containers.xul b/browser/components/preferences/in-content-new/containers.xhtml
rename from browser/components/preferences/in-content-new/containers.xul
rename to browser/components/preferences/in-content-new/containers.xhtml
--- a/browser/components/preferences/in-content-new/containers.xul
+++ b/browser/components/preferences/in-content-new/containers.xhtml
@@ -1,16 +1,16 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- Containers panel -->
 
-<script type="application/javascript"
-        src="chrome://browser/content/preferences/in-content-new/containers.js"/>
+<html:script 
+        src="chrome://browser/content/preferences/in-content-new/containers.js"></html:script>
 
 <preferences id="containerPreferences" hidden="true" data-category="paneContainer">
   <!-- Containers -->
   <preference id="privacy.userContext.enabled"
               name="privacy.userContext.enabled"
               type="bool"/>
 
 </preferences>
diff --git a/browser/components/preferences/in-content-new/jar.mn b/browser/components/preferences/in-content-new/jar.mn
--- a/browser/components/preferences/in-content-new/jar.mn
+++ b/browser/components/preferences/in-content-new/jar.mn
@@ -1,15 +1,15 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 browser.jar:
    content/browser/preferences/in-content-new/preferences.js
-*  content/browser/preferences/in-content-new/preferences.xul
+*  content/browser/preferences/in-content-new/preferences.xhtml
    content/browser/preferences/in-content-new/subdialogs.js
 
    content/browser/preferences/in-content-new/main.js
    content/browser/preferences/in-content-new/privacy.js
    content/browser/preferences/in-content-new/containers.js
    content/browser/preferences/in-content-new/advanced.js
    content/browser/preferences/in-content-new/applications.js
    content/browser/preferences/in-content-new/sync.js
diff --git a/browser/components/preferences/in-content-new/main.js b/browser/components/preferences/in-content-new/main.js
--- a/browser/components/preferences/in-content-new/main.js
+++ b/browser/components/preferences/in-content-new/main.js
@@ -858,16 +858,17 @@ var gMainPane = {
       document.getElementById("limitContentProcess").disabled = true;
       document.getElementById("contentProcessCount").disabled = true;
       document.getElementById("contentProcessCountEnabledDescription").hidden = true;
       document.getElementById("contentProcessCountDisabledDescription").hidden = false;
     }
   },
 
   buildDefaultEngineDropDown() {
+    console.log("BUILDING");
     // This is called each time something affects the list of engines.
     let list = document.getElementById("defaultEngine");
     // Set selection to the current default engine.
     let currentEngine = Services.search.currentEngine.name;
 
     // If the current engine isn't in the list any more, select the first item.
     let engines = gEngineView._engineStore._engines;
     if (!engines.some(e => e.name == currentEngine))
diff --git a/browser/components/preferences/in-content-new/main.xul b/browser/components/preferences/in-content-new/main.xhtml
rename from browser/components/preferences/in-content-new/main.xul
rename to browser/components/preferences/in-content-new/main.xhtml
--- a/browser/components/preferences/in-content-new/main.xul
+++ b/browser/components/preferences/in-content-new/main.xhtml
@@ -1,19 +1,19 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- General panel -->
 
-<script type="application/javascript"
-        src="chrome://browser/content/preferences/in-content-new/main.js"/>
+<html:script 
+        src="chrome://browser/content/preferences/in-content-new/main.js"></html:script>
 
-<script type="application/javascript"
-        src="chrome://mozapps/content/preferences/fontbuilder.js"/>
+<html:script 
+        src="chrome://mozapps/content/preferences/fontbuilder.js"></html:script>
 
 <stringbundle id="engineManagerBundle" src="chrome://browser/locale/engineManager.properties"/>
 
 <stringbundle id="bundlePreferences" src="chrome://browser/locale/preferences.properties"/>
 
 <preferences id="mainPreferences" hidden="true" data-category="paneGeneral">
 
 #ifdef E10S_TESTING_ONLY
diff --git a/browser/components/preferences/in-content-new/preferences.xul b/browser/components/preferences/in-content-new/preferences.xhtml
rename from browser/components/preferences/in-content-new/preferences.xul
rename to browser/components/preferences/in-content-new/preferences.xhtml
--- a/browser/components/preferences/in-content-new/preferences.xul
+++ b/browser/components/preferences/in-content-new/preferences.xhtml
@@ -1,21 +1,18 @@
 <?xml version="1.0"?>
 <!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this file,
    - You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
 <?xml-stylesheet href="chrome://global/skin/global.css"?>
-
 <?xml-stylesheet href="chrome://browser/skin/preferences/preferences.css"?>
 <?xml-stylesheet href="chrome://global/skin/in-content/common.css"?>
-<?xml-stylesheet
-  href="chrome://browser/skin/preferences/in-content-new/preferences.css"?>
-<?xml-stylesheet
-  href="chrome://browser/content/preferences/handlers.css"?>
+<?xml-stylesheet href="chrome://browser/skin/preferences/in-content-new/preferences.css"?>
+<?xml-stylesheet href="chrome://browser/content/preferences/handlers.css"?>
 <?xml-stylesheet href="chrome://browser/skin/preferences/applications.css"?>
 <?xml-stylesheet href="chrome://browser/skin/preferences/in-content-new/search.css"?>
 <?xml-stylesheet href="chrome://browser/skin/preferences/in-content-new/containers.css"?>
 
 <!DOCTYPE page [
 <!ENTITY % brandDTD SYSTEM "chrome://branding/locale/brand.dtd">
 <!ENTITY % globalPreferencesDTD SYSTEM "chrome://global/locale/preferences.dtd">
 <!ENTITY % preferencesDTD SYSTEM
@@ -80,35 +77,38 @@
 %applicationsDTD;
 %advancedDTD;
 ]>
 
 #ifdef XP_WIN
 #define USE_WIN_TITLE_STYLE
 #endif
 
-<page xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+<html xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
-      disablefastfind="true"
+      disablefastfind="true">
+  <html:head>
 #ifdef USE_WIN_TITLE_STYLE
-      title="&prefWindow.titleWin;">
+  <html:title>&prefWindow.titleWin;</html:title>
 #else
-      title="&prefWindow.title;">
+  <html:title>&prefWindow.title;</html:title>
 #endif
 
   <html:link rel="shortcut icon"
               href="chrome://browser/skin/preferences/in-content-new/favicon.ico"/>
 
-  <script type="application/javascript"
-          src="chrome://browser/content/utilityOverlay.js"/>
-  <script type="application/javascript"
-          src="chrome://browser/content/preferences/in-content-new/preferences.js"/>
-  <script src="chrome://browser/content/preferences/in-content-new/findInPage.js"/>
-  <script src="chrome://browser/content/preferences/in-content-new/subdialogs.js"/>
+  <html:script 
+          src="chrome://browser/content/utilityOverlay.js"></html:script>
+  <html:script 
+          src="chrome://browser/content/preferences/in-content-new/preferences.js"></html:script>
+  <html:script src="chrome://browser/content/preferences/in-content-new/findInPage.js"></html:script>
+  <html:script src="chrome://browser/content/preferences/in-content-new/subdialogs.js"></html:script>
 
+  </html:head>
+  <html:body>
   <stringbundle id="bundleBrand"
                 src="chrome://branding/locale/brand.properties"/>
   <stringbundle id="bundlePreferences"
                 src="chrome://browser/locale/preferences/preferences.properties"/>
   <stringbundle id="pkiBundle"
                 src="chrome://pippki/locale/pippki.properties"/>
   <stringbundle id="browserBundle"
                 src="chrome://browser/locale/browser.properties"/>
@@ -201,23 +201,23 @@
     <html:a class="help-button" target="_blank" aria-label="&helpButton2.label;">&helpButton2.label;</html:a>
 
     <vbox class="main-content" flex="1">
       <hbox pack="end">
         <textbox type="search" id="searchInput" placeholder="&searchInput.label;" hidden="true"
                  clickSelectsAll="true"/>
       </hbox>
       <prefpane id="mainPrefPane">
-#include searchResults.xul
-#include main.xul
-#include privacy.xul
-#include containers.xul
-#include advanced.xul
-#include applications.xul
-#include sync.xul
+#include searchResults.xhtml
+#include main.xhtml
+#include privacy.xhtml
+#include containers.xhtml
+#include advanced.xhtml
+#include applications.xhtml
+#include sync.xhtml
       </prefpane>
     </vbox>
   </hbox>
 
   <stack id="dialogStack" hidden="true"/>
   <vbox id="dialogTemplate" class="dialogOverlay" align="center" pack="center" topmost="true" hidden="true">
     <groupbox class="dialogBox"
               orient="vertical"
@@ -230,9 +230,10 @@
                 aria-label="&preferencesCloseButton.label;"/>
       </caption>
       <browser class="dialogFrame"
                autoscroll="false"
                disablehistory="true"/>
     </groupbox>
   </vbox>
   </stack>
-</page>
+</html:body>
+</html>
diff --git a/browser/components/preferences/in-content-new/privacy.xul b/browser/components/preferences/in-content-new/privacy.xhtml
rename from browser/components/preferences/in-content-new/privacy.xul
rename to browser/components/preferences/in-content-new/privacy.xhtml
--- a/browser/components/preferences/in-content-new/privacy.xul
+++ b/browser/components/preferences/in-content-new/privacy.xhtml
@@ -1,16 +1,16 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- Privacy panel -->
 
-<script type="application/javascript"
-        src="chrome://browser/content/preferences/in-content-new/privacy.js"/>
+<html:script 
+        src="chrome://browser/content/preferences/in-content-new/privacy.js"></html:script>
 
 <preferences id="privacyPreferences" hidden="true" data-category="panePrivacy">
 
   <!-- Tracking -->
   <preference id="privacy.trackingprotection.enabled"
               name="privacy.trackingprotection.enabled"
               type="bool"/>
   <preference id="privacy.trackingprotection.pbmode.enabled"
diff --git a/browser/components/preferences/in-content-new/searchResults.xul b/browser/components/preferences/in-content-new/searchResults.xhtml
rename from browser/components/preferences/in-content-new/searchResults.xul
rename to browser/components/preferences/in-content-new/searchResults.xhtml
diff --git a/browser/components/preferences/in-content-new/sync.xul b/browser/components/preferences/in-content-new/sync.xhtml
rename from browser/components/preferences/in-content-new/sync.xul
rename to browser/components/preferences/in-content-new/sync.xhtml
--- a/browser/components/preferences/in-content-new/sync.xul
+++ b/browser/components/preferences/in-content-new/sync.xhtml
@@ -20,18 +20,18 @@
   <preference id="engine.prefs"
               name="services.sync.engine.prefs"
               type="bool"/>
   <preference id="engine.passwords"
               name="services.sync.engine.passwords"
               type="bool"/>
 </preferences>
 
-<script type="application/javascript"
-        src="chrome://browser/content/preferences/in-content-new/sync.js"/>
+<html:script 
+        src="chrome://browser/content/preferences/in-content-new/sync.js"></html:script>
 
 <hbox id="header-sync"
       class="header"
       hidden="true"
       data-category="paneSync">
   <label class="header-name" flex="1">&paneSync1.title;</label>
 </hbox>
 
diff --git a/browser/themes/linux/preferences/in-content-new/preferences.css b/browser/themes/linux/preferences/in-content-new/preferences.css
--- a/browser/themes/linux/preferences/in-content-new/preferences.css
+++ b/browser/themes/linux/preferences/in-content-new/preferences.css
@@ -1,14 +1,19 @@
 /* - This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this file,
    - You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 %include ../../../shared/incontentprefs/preferences.inc.css
 
+html|body {
+  display: -moz-box;
+  width: 100vw;
+}
+
 .treecol-sortdirection {
   /* override the Linux only toolkit rule */
   -moz-appearance: none;
 }
 
 .actionsMenu {
   font-family: "Clear Sans", sans-serif;
   font-size: 1.25rem;
diff --git a/browser/themes/osx/preferences/in-content-new/preferences.css b/browser/themes/osx/preferences/in-content-new/preferences.css
--- a/browser/themes/osx/preferences/in-content-new/preferences.css
+++ b/browser/themes/osx/preferences/in-content-new/preferences.css
@@ -1,14 +1,19 @@
 /* - This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this file,
    - You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 %include ../../../shared/incontentprefs/preferences.inc.css
 
+html|body {
+  display: -moz-box;
+  width: 100vw;
+}
+
 prefpane .groupbox-title {
   background: none;
   margin-bottom: 0;
 }
 
 .actionsMenu > .menulist-label-box > .menulist-icon {
   margin-top: 2px;
   margin-inline-start: 2px;
diff --git a/browser/themes/windows/preferences/in-content-new/preferences.css b/browser/themes/windows/preferences/in-content-new/preferences.css
--- a/browser/themes/windows/preferences/in-content-new/preferences.css
+++ b/browser/themes/windows/preferences/in-content-new/preferences.css
@@ -1,14 +1,19 @@
 /* - This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this file,
    - You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 %include ../../../shared/incontentprefs/preferences.inc.css
 
+html|body {
+  display: -moz-box;
+  width: 100vw;
+}
+
 @media (-moz-windows-default-theme: 0) {
   #category-general > .category-icon {
     list-style-image: url("chrome://browser/skin/preferences/in-content-new/icons.svg#general-native");
   }
 
   #category-application > .category-icon {
     list-style-image: url("chrome://browser/skin/preferences/in-content-new/icons.svg#applications-native");
   }
