# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  3250ab83ac5e862adaa85bcfab40e8c9356b9dd4

diff --git a/browser/components/nsBrowserGlue.js b/browser/components/nsBrowserGlue.js
--- a/browser/components/nsBrowserGlue.js
+++ b/browser/components/nsBrowserGlue.js
@@ -172,24 +172,48 @@ if (AppConstants.MOZ_CRASHREPORTER) {
 XPCOMUtils.defineLazyGetter(this, "gBrandBundle", function() {
   return Services.strings.createBundle("chrome://branding/locale/brand.properties");
 });
 
 XPCOMUtils.defineLazyGetter(this, "gBrowserBundle", function() {
   return Services.strings.createBundle("chrome://browser/locale/browser.properties");
 });
 
+var NewChromeGlobal = {
+
+  observe(win) {
+    // From http://mb.eschew.org/9#listing_9.9:
+    var detective = {
+      supportsCommand  : function (cmd) { console.log("supportsCommand?", cmd); return true; },
+      isCommandEnabled : function (cmd) { console.log("isCommandEnabled?", cmd); return true; },
+      doCommand        : function (cmd) {
+        console.log("doCommand", cmd);
+        return true;
+      },
+      onEvent          : function (cmd) { console.log("onEvent", cmd); }
+    };
+
+    win.addEventListener("DOMContentLoaded", (e) => {
+      e.target.defaultView.setTimeout(() =>{
+
+      e.target.defaultView.controllers.insertControllerAt(0, detective);
+    }, 1000);
+    }, { once: true });
+  }
+}
+
 const global = this;
 
 const listeners = {
   observers: {
     "update-staged": ["UpdateListener"],
     "update-downloaded": ["UpdateListener"],
     "update-available": ["UpdateListener"],
     "update-error": ["UpdateListener"],
+    "chrome-document-global-created": ["NewChromeGlobal"],
   },
 
   ppmm: {
     // PLEASE KEEP THIS LIST IN SYNC WITH THE LISTENERS ADDED IN ContentPrefServiceParent.init
     "ContentPrefs:FunctionCall": ["ContentPrefServiceParent"],
     "ContentPrefs:AddObserverForName": ["ContentPrefServiceParent"],
     "ContentPrefs:RemoveObserverForName": ["ContentPrefServiceParent"],
     // PLEASE KEEP THIS LIST IN SYNC WITH THE LISTENERS ADDED IN ContentPrefServiceParent.init
