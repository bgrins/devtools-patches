# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  239350d419fdc16407cccf858c15fd6c3fb7cd6d
Bug 1573158 - Move Shadow DOM creation into constructor instead of connectedCallback

diff --git a/browser/components/places/content/places-menupopup.js b/browser/components/places/content/places-menupopup.js
--- a/browser/components/places/content/places-menupopup.js
+++ b/browser/components/places/content/places-menupopup.js
@@ -27,16 +27,22 @@
         "dragexit",
         "dragend",
       ];
       for (let event_name of event_names) {
         this.addEventListener(event_name, ev => this[`on_${event_name}`](ev));
       }
 
       this.attachShadow({ mode: "open" });
+      this.shadowRoot.appendChild(this.fragment);
+
+      this._indicatorBar = this.shadowRoot.querySelector(
+        "[part=drop-indicator-bar]"
+      );
+      this._scrollBox = this.shadowRoot.querySelector(".popup-internal-box");
     }
 
     get commonStyles() {
       return `
         /* Remove padding on xul:arrowscrollbox to avoid extra padding on footer */
         :host([bookmarkspopup=true]) arrowscrollbox.popup-internal-box {
           padding-bottom: 0px;
         }
@@ -94,24 +100,16 @@
       return document.importNode(this.constructor._fragment, true);
     }
 
     connectedCallback() {
       if (this.delayConnectedCallback()) {
         return;
       }
 
-      this.shadowRoot.textContent = "";
-      this.shadowRoot.appendChild(this.fragment);
-
-      this._indicatorBar = this.shadowRoot.querySelector(
-        "[part=drop-indicator-bar]"
-      );
-      this._scrollBox = this.shadowRoot.querySelector(".popup-internal-box");
-
       /**
        * Sub-menus should be opened when the mouse drags over them, and closed
        * when the mouse drags off.  The overFolder object manages opening and
        * closing of folders when the mouse hovers.
        */
       this._overFolder = {
         _self: this,
         _folder: {
