# HG changeset patch
# User Joseph Yeh <jyeh@mozilla.com>

Bug 1260225 - Move inspector-related command buttons (eyedropper, rulers, screenshot, measurement) to the Inspector panel and enable them by default

MozReview-Commit-ID: 6cKhUFopKx2
---
 devtools/client/inspector/inspector-panel.js       | 32 ++++++++++++++++++++++
 devtools/client/inspector/inspector.xul            |  2 ++
 devtools/client/locales/en-US/inspector.properties |  4 +++
 devtools/client/themes/inspector.css               |  6 ++++
 devtools/client/themes/variables.css               |  1 +
 devtools/server/actors/highlighters/rulers.js      |  1 +
 6 files changed, 46 insertions(+)

diff --git a/devtools/client/inspector/inspector-panel.js b/devtools/client/inspector/inspector-panel.js
index 672bfec..5578258 100644
--- a/devtools/client/inspector/inspector-panel.js
+++ b/devtools/client/inspector/inspector-panel.js
@@ -95,6 +95,7 @@ function InspectorPanel(iframeWindow, toolbox) {
   this.onNewSelection = this.onNewSelection.bind(this);
   this.onBeforeNewSelection = this.onBeforeNewSelection.bind(this);
   this.onDetached = this.onDetached.bind(this);
+  this.onRulersToggleButtonClicked = this.onRulersToggleButtonClicked.bind(this);
   this.onPaneToggleButtonClicked = this.onPaneToggleButtonClicked.bind(this);
   this._onMarkupFrameLoad = this._onMarkupFrameLoad.bind(this);
 
@@ -214,6 +215,7 @@ InspectorPanel.prototype = {
     });
 
     this.setupSearchBox();
+    this.setupRulerToggle();
     this.setupSidebar();
 
     return deferred.promise;
@@ -356,6 +358,36 @@ InspectorPanel.prototype = {
   },
 
   /**
+   * Hooks the rulers toolbar button to toggle rulers highlighter.
+   */
+  setupRulerToggle: function () {
+    this._rulersToggleButton = this.panelDoc.getElementById("inspector-rulers-toggle");
+    this._rulersToggleButton.setAttribute("tooltiptext",
+      strings.GetStringFromName("inspector.rulers"));
+    this._rulersToggleButton.addEventListener("mousedown",
+      this.onRulersToggleButtonClicked);
+  },
+
+  onRulersToggleButtonClicked: function () {
+    if (this._rulersHighlighter) {
+      this._rulersHighlighter.hide(this.selection.nodeFront);
+      this._rulersHighlighter = null;
+
+      this._rulersToggleButton.removeAttribute("checked");
+
+      return;
+    }
+
+    this.toolbox.highlighterUtils.getHighlighterByType("RulersHighlighter")
+      .then(rulersHighligher => {
+        this._rulersHighlighter = rulersHighligher;
+        this._rulersHighlighter.show(this.selection.nodeFront);
+
+        this._rulersToggleButton.setAttribute("checked", true);
+      });
+  },
+
+  /**
    * Build the sidebar.
    */
   setupSidebar: function () {
diff --git a/devtools/client/inspector/inspector.xul b/devtools/client/inspector/inspector.xul
index 83453aa..bfb1d5d 100644
--- a/devtools/client/inspector/inspector.xul
+++ b/devtools/client/inspector/inspector.xul
@@ -163,6 +163,8 @@
           timeout="50"
           class="devtools-searchinput"
           placeholder="&inspectorSearchHTML.label3;"/>
+        <toolbarbutton id="inspector-rulers-toggle"
+          class="devtools-toolbarbutton" />
         <toolbarbutton id="inspector-pane-toggle"
           class="devtools-toolbarbutton"
           tabindex="0" />
diff --git a/devtools/client/locales/en-US/inspector.properties b/devtools/client/locales/en-US/inspector.properties
index 61db13a..f4a4bb8 100644
--- a/devtools/client/locales/en-US/inspector.properties
+++ b/devtools/client/locales/en-US/inspector.properties
@@ -69,6 +69,10 @@ docsTooltip.visitMDN=Visit MDN page
 # could not be loaded (for example, because of a connectivity problem).
 docsTooltip.loadDocsError=Could not load docs page.
 
+# LOCALIZATION NOTE (inspector.rulers): This is the tooltip for the button
+# that toggle rulers highlighter.
+inspector.rulers=Toggle rulers for the page
+
 # LOCALIZATION NOTE (inspector.collapsePane): This is the tooltip for the button
 # that collapses the right panel (rules, computed, box-model, etc...) in the
 # inspector UI.
diff --git a/devtools/client/themes/inspector.css b/devtools/client/themes/inspector.css
index 9ef1302..84eeeb3 100644
--- a/devtools/client/themes/inspector.css
+++ b/devtools/client/themes/inspector.css
@@ -13,6 +13,12 @@
   border-top-width: 1px;
 }
 
+/* Rulers toolbar button */
+
+#inspector-rulers-toggle {
+  list-style-image: var(--theme-rulers-image);
+}
+
 /* Expand/collapse panel toolbar button */
 
 #inspector-pane-toggle {
diff --git a/devtools/client/themes/variables.css b/devtools/client/themes/variables.css
index f9f32e9..6ee0426 100644
--- a/devtools/client/themes/variables.css
+++ b/devtools/client/themes/variables.css
@@ -61,6 +61,7 @@
   --theme-graphs-full-blue: #00f;
 
   /* Images */
+  --theme-rulers-image: url(chrome://devtools/skin/images/command-rulers.svg);
   --theme-pane-collapse-image: url(chrome://devtools/skin/images/pane-collapse.svg);
   --theme-pane-expand-image: url(chrome://devtools/skin/images/pane-expand.svg);
 
diff --git a/devtools/server/actors/highlighters/rulers.js b/devtools/server/actors/highlighters/rulers.js
index 01e082e..e69ed2b 100644
--- a/devtools/server/actors/highlighters/rulers.js
+++ b/devtools/server/actors/highlighters/rulers.js
@@ -246,6 +246,7 @@ RulersHighlighter.prototype = {
       this._rafID = 0;
     }
   },
+
   updateViewport: function () {
     let { devicePixelRatio } = this.env.window;
 

