# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1539143848 25200
#      Tue Oct 09 20:57:28 2018 -0700
# Node ID dadeefaa73791811a11df2b2152340e7f2db5c4b
# Parent  7e5e4298a03fe4555dee596fff34033ad8a3b694
Bug 1497599 - Only run re-initialize moz-input-box during attributeChangedCallback if the attribute actually changed;r=paolo

Summary:
This is unrelated to the other changesets in the bug, just a cleanup based on
patterns that have emerged in other attributeChangedCallbacks like in progressmeter

Reviewers: paolo

Bug #: 1497599

Differential Revision: https://phabricator.services.mozilla.com/D8174

diff --git a/toolkit/content/widgets/textbox.js b/toolkit/content/widgets/textbox.js
--- a/toolkit/content/widgets/textbox.js
+++ b/toolkit/content/widgets/textbox.js
@@ -56,28 +56,27 @@ const cachedFragments = {
 };
 
 class MozInputBox extends MozXULElement {
   static get observedAttributes() {
     return ["spellcheck"];
   }
 
   attributeChangedCallback(name, oldValue, newValue) {
-    if (name === "spellcheck") {
-      this.spellcheck = newValue;
+    if (name === "spellcheck" && oldValue != newValue) {
       this._initUI();
     }
   }
 
   connectedCallback() {
-    this.spellcheck = this.hasAttribute("spellcheck");
     this._initUI();
   }
 
   _initUI() {
+    this.spellcheck = this.hasAttribute("spellcheck");
     if (this.menupopup) {
       this.menupopup.remove();
     }
 
     this.setAttribute("context", "_child");
     this.appendChild(this.spellcheck ? cachedFragments.spellcheck.cloneNode(true) :
                                        cachedFragments.normal.cloneNode(true));
     this.menupopup = this.querySelector(".textbox-contextmenu");
