# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  2064e7c799d28d7230bde50b58bff4be02a10575
Use script tags instead of subscript loader in browser.xul

diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -77,39 +77,91 @@
 #endif
         >
 
 # All JS files which are needed by browser.xul and other top level windows to
 # support MacOS specific features *must* go into the global-scripts.inc file so
 # that they can be shared with macWindow.inc.xul.
 #include global-scripts.inc
 
+<script type="application/javascript" src="chrome://global/content/contentAreaUtils.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-captivePortal.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-compacttheme.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-contentblocking.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+#ifdef MOZ_DATA_REPORTING
+<script type="application/javascript" src="chrome://browser/content/browser-data-submission-info-bar.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+#endif
+#ifndef MOZILLA_OFFICIAL
+<script type="application/javascript" src="chrome://browser/content/browser-development-helpers.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+#endif
+<script type="application/javascript" src="chrome://browser/content/browser-media.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-pageActions.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-plugins.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-sidebar.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-tabsintitlebar.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/tabbrowser.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/search/searchbar.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+
 <script type="application/javascript"
 #ifdef BROWSER_XHTML
 xmlns="http://www.w3.org/1999/xhtml"
 #endif
 >
-  Services.scriptloader.loadSubScript("chrome://global/content/contentAreaUtils.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-captivePortal.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-compacttheme.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-contentblocking.js", this);
-#ifdef MOZ_DATA_REPORTING
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-data-submission-info-bar.js", this);
-#endif
-#ifndef MOZILLA_OFFICIAL
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-development-helpers.js", this);
-#endif
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-media.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-pageActions.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-plugins.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-sidebar.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/browser-tabsintitlebar.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/tabbrowser.js", this);
-  Services.scriptloader.loadSubScript("chrome://browser/content/search/searchbar.js", this);
-
   window.onload = gBrowserInit.onLoad.bind(gBrowserInit);
   window.onunload = gBrowserInit.onUnload.bind(gBrowserInit);
   window.onclose = WindowIsClosing;
 
 #ifdef BROWSER_XHTML
   window.addEventListener("readystatechange", () => {
     // We initially hide the window to prevent layouts during parse. This lets us
     // avoid accidental XBL construction and better match browser.xul (see Bug 1497975).
diff --git a/browser/base/content/global-scripts.inc b/browser/base/content/global-scripts.inc
--- a/browser/base/content/global-scripts.inc
+++ b/browser/base/content/global-scripts.inc
@@ -6,24 +6,35 @@
 # JS files which are needed by browser.xul but no other top level windows to
 # support MacOS specific features should be loaded directly from browser.xul
 # rather than this file.
 
 # If you update this list, you may need to add a mapping within the following
 # file so that ESLint works correctly:
 # tools/lint/eslint/eslint-plugin-mozilla/lib/environments/browser-window.js
 
-<script type="text/javascript"
+<script type="application/javascript" src="chrome://browser/content/browser.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://browser/content/browser-places.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
+<script type="application/javascript" src="chrome://global/content/globalOverlay.js"
 #ifdef BROWSER_XHTML
 xmlns="http://www.w3.org/1999/xhtml"
 #endif
->
-var {Services} = ChromeUtils.import("resource://gre/modules/Services.jsm");
-
-Services.scriptloader.loadSubScript("chrome://browser/content/browser.js", this);
-Services.scriptloader.loadSubScript("chrome://browser/content/browser-places.js", this);
-Services.scriptloader.loadSubScript("chrome://global/content/globalOverlay.js", this);
-Services.scriptloader.loadSubScript("chrome://browser/content/utilityOverlay.js", this);
+/>
+<script type="application/javascript" src="chrome://browser/content/utilityOverlay.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
+#endif
+/>
 #ifdef XP_MACOSX
-Services.scriptloader.loadSubScript("chrome://global/content/macWindowMenu.js", this);
+<script type="application/javascript" src="chrome://global/content/macWindowMenu.js"
+#ifdef BROWSER_XHTML
+xmlns="http://www.w3.org/1999/xhtml"
 #endif
-
-</script>
+/>
+#endif
