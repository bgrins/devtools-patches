commit 1a3921c0c7e5ebc9d96318ad43530e87d32810c9
Author: Paul Rouget <me@paulrouget.com>
Date:   Wed May 7 15:15:30 2014 +0200

    fxide: itchpad support

diff --git a/browser/devtools/fxide/content/fxide.js b/browser/devtools/fxide/content/fxide.js
index 35ac691..7eabc85 100644
--- a/browser/devtools/fxide/content/fxide.js
+++ b/browser/devtools/fxide/content/fxide.js
@@ -15,6 +15,7 @@ const {Services} = Cu.import("resource://gre/modules/Services.jsm");
 const {AppProjects} = require("devtools/app-manager/app-projects");
 const {Connection} = require("devtools/client/connection-manager");
 const {AppManager} = require("devtools/app-manager");
+const Itchpad = require("itchpad/itchpad");
 
 const Strings = Services.strings.createBundle("chrome://fxide/locale/fxide.properties");
 
@@ -264,12 +265,36 @@ let UI = {
 
   // details.xhtml
 
+  _itchpadPromise: null,
+  getItchpad: function() {
+    if (this._itchpadPromise) {
+      return this._itchpadPromise.promise;
+    }
+
+    this._itchpadPromise = Promise.defer();
+    let itchpadIframe = document.querySelector("#itchpad");
+    let itchpad = Itchpad.Itchpad();
+    itchpad.on("onEditorSave", (editor, resource) => {
+      AppManager.validateProject(AppManager.selectedProject);
+    });
+    itchpad.load(itchpadIframe).then(() => {
+      this._itchpadPromise.resolve(itchpad);
+    }, () => {
+      this._itchpadPromise.reject();
+    });
+    return this._itchpadPromise.promise;
+  },
+
   openProject: function() {
-    let details = document.querySelector("#details");
+    let detailsIframe = document.querySelector("#details");
+    let itchpadIframe = document.querySelector("#itchpad");
+
     let project = AppManager.selectedProject;
 
     if (!project) {
-      details.setAttribute("hidden", "true");
+      detailsIframe.setAttribute("hidden", "true");
+      itchpadIframe.setAttribute("hidden", "true");
+      document.commandDispatcher.focusedElement = document.documentElement;
       return;
     }
 
@@ -277,9 +302,28 @@ let UI = {
       Services.prefs.setCharPref("devtools.fxide.lastprojectlocation", project.location);
     }
 
-    details.removeAttribute("hidden");
+    if (project.type != "packaged") {
+      detailsIframe.removeAttribute("hidden");
+      itchpadIframe.setAttribute("hidden", "true");
+      document.commandDispatcher.focusedElement = document.documentElement;
+      return;
+    }
+
+    detailsIframe.setAttribute("hidden", "true");
+    itchpadIframe.removeAttribute("hidden");
+
+    this.getItchpad().then((itchpad) => {
+      itchpad.setProjectToSinglePath(project.location, {
+        name: project.name,
+        iconUrl: project.icon,
+        projectOverviewURL: "chrome://fxide/content/details.xhtml"
+      }).then(() => {
+        console.log("All resources have been loaded", [...itchpad.project.allResources()]);
+      });
+    }, UI.console.error);
   },
 
+
   /********** COMMANDS **********/
 
   updateCommands: function() {
diff --git a/browser/devtools/fxide/content/fxide.xul b/browser/devtools/fxide/content/fxide.xul
index 2b0649d..3e1209d 100644
--- a/browser/devtools/fxide/content/fxide.xul
+++ b/browser/devtools/fxide/content/fxide.xul
@@ -151,6 +151,7 @@
 
   <vbox flex="1" id="body">
     <iframe id="details" flex="1" hidden="true" src="details.xhtml"/>
+    <iframe id="itchpad" flex="1" hidden="true"/>
   </vbox>
 
   <splitter hidden="true" class="devtools-horizontal-splitter" orient="vertical"/>
