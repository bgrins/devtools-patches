# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1539270028 25200
#      Thu Oct 11 08:00:28 2018 -0700
# Node ID 61f1bcc4aeab27b0b6e7cdf47e7350d65608062c
# Parent  e4220fa7a191903a814e8cf473cf544fe9762625
Bug 1491484 - Skip less of browser_findbar.js on linux opt;r=Gijs

Differential Revision: https://phabricator.services.mozilla.com/D8390

diff --git a/toolkit/content/tests/browser/browser.ini b/toolkit/content/tests/browser/browser.ini
--- a/toolkit/content/tests/browser/browser.ini
+++ b/toolkit/content/tests/browser/browser.ini
@@ -93,17 +93,16 @@ skip-if = !e10s || !crashreporter
 [browser_crash_previous_frameloader.js]
 run-if = e10s && crashreporter
 [browser_datetime_datepicker.js]
 uses-unsafe-cpows = true
 [browser_default_image_filename.js]
 [browser_default_image_filename_redirect.js]
 [browser_f7_caret_browsing.js]
 [browser_findbar.js]
-skip-if = os == "linux" && !debug # Bug 1491484
 [browser_findbar_disabled_manual.js]
 [browser_isSynthetic.js]
 [browser_keyevents_during_autoscrolling.js]
 [browser_label_textlink.js]
 [browser_mediaPlayback.js]
 tags = audiochannel
 [browser_mediaPlayback_mute.js]
 tags = audiochannel
diff --git a/toolkit/content/tests/browser/browser_findbar.js b/toolkit/content/tests/browser/browser_findbar.js
--- a/toolkit/content/tests/browser/browser_findbar.js
+++ b/toolkit/content/tests/browser/browser_findbar.js
@@ -1,16 +1,18 @@
 /* eslint-disable mozilla/no-arbitrary-setTimeout */
 ChromeUtils.import("resource://gre/modules/Timer.jsm", this);
 
 const TEST_PAGE_URI = "data:text/html;charset=utf-8,The letter s.";
 // Using 'javascript' schema to bypass E10SUtils.canLoadURIInProcess, because
 // it does not allow 'data:' URI to be loaded in the parent process.
 const E10S_PARENT_TEST_PAGE_URI = "javascript:document.write('The letter s.');";
 
+SimpleTest.requestCompleteLog();
+
 /**
  * Makes sure that the findbar hotkeys (' and /) event listeners
  * are added to the system event group and do not get blocked
  * by calling stopPropagation on a keypress event on a page.
  */
 add_task(async function test_hotkey_event_propagation() {
   info("Ensure hotkeys are not affected by stopPropagation.");
 
@@ -163,16 +165,21 @@ add_task(async function test_reinitializ
  */
 add_task(async function e10sLostKeys() {
   // This test only makes sence in e10s evironment.
   if (!gMultiProcessBrowser) {
     info("Skipping this test because of non-e10s environment.");
     return;
   }
 
+  if (AppConstants.platform == "linux" && !AppConstants.DEBUG) {
+    info("Skipping this test because of linux opt (Bug 1491484).");
+    // return;
+  }
+
   let tab = await BrowserTestUtils.openNewForegroundTab(gBrowser, TEST_PAGE_URI);
 
   ok(!gFindBarInitialized, "findbar isn't initialized yet");
 
   await gFindBarPromise;
   let findBar = gFindBar;
   let initialValue = findBar._findField.value;
 
