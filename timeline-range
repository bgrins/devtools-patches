# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  9f592f8ed83ad9ed2aa8874404e0b389b0836377
Bug 1066504 - Allow timeline range selection after mouseout

diff --git a/browser/devtools/shared/widgets/Graphs.jsm b/browser/devtools/shared/widgets/Graphs.jsm
--- a/browser/devtools/shared/widgets/Graphs.jsm
+++ b/browser/devtools/shared/widgets/Graphs.jsm
@@ -943,16 +943,21 @@ AbstractCanvasGraph.prototype = {
 
     return { left: x, top: y };
   },
 
   /**
    * Listener for the "mousemove" event on the graph's container.
    */
   _onMouseMove: function(e) {
+    // Mouseup happened outside the toolbox.
+    if (e.buttons == 0 && this.hasSelectionInProgress()) {
+      return this._onMouseUp(e);
+    }
+
     let offset = this._getContainerOffset();
     let mouseX = (e.clientX - offset.left) * this._pixelRatio;
     let mouseY = (e.clientY - offset.top) * this._pixelRatio;
     this._cursor.x = mouseX;
     this._cursor.y = mouseY;
 
     let resizer = this._selectionResizer;
     if (resizer.margin != null) {
@@ -1156,27 +1161,28 @@ AbstractCanvasGraph.prototype = {
     this.emit("selecting");
     this.emit("scroll");
   },
 
   /**
    * Listener for the "mouseout" event on the graph's container.
    */
   _onMouseOut: function() {
-    if (this.hasSelectionInProgress()) {
-      this.dropSelection();
+    // XXX: not sure the intent of this functionality.
+    // Should it still be here even if the selection can still
+    // progress even after a mouse out?
+    if (!this.hasSelectionInProgress()) {
+      this._cursor.x = null;
+      this._cursor.y = null;
+      this._selectionResizer.margin = null;
+      this._selectionDragger.origin = null;
+
+      this._canvas.removeAttribute("input");
+      this._shouldRedraw = true;
     }
-
-    this._cursor.x = null;
-    this._cursor.y = null;
-    this._selectionResizer.margin = null;
-    this._selectionDragger.origin = null;
-
-    this._canvas.removeAttribute("input");
-    this._shouldRedraw = true;
   },
 
   /**
    * Listener for the "resize" event on the graph's parent node.
    */
   _onResize: function() {
     if (this.hasData()) {
       setNamedTimeout(this._uid, GRAPH_RESIZE_EVENTS_DRAIN, this.refresh);
