# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  17db33b6a124422d43a9f518bea1bc62a698126b
Run with: ./mach run --temp-profile --chrome chrome://browser/content/menu-tester.html --jsconsole

MozReview-Commit-ID: BDZZrOONWyy

diff --git a/browser/base/content/menu-tester.html b/browser/base/content/menu-tester.html
new file mode 100644
--- /dev/null
+++ b/browser/base/content/menu-tester.html
@@ -0,0 +1,56 @@
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<!DOCTYPE html>
+<html dir=""
+      width="900" height="350"
+      >
+<head>
+  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
+  <link rel="stylesheet" href="chrome://global/content/xul.css" />
+  <link rel="localization" href="browser/preferences/translation.ftl"/>
+  <script type="application/javascript" src="chrome://global/content/l10n.js"></script>
+</head>
+<body role="application">
+  <div id="content"></div>
+
+  <script>
+  Components.utils.import("resource://gre/modules/Services.jsm");
+
+  function parseXULDOM(str) {
+    const d = new DOMParser();
+    d.forceEnableXULXBL();
+    const doc = d.parseFromString(
+      `<box xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">${str}</box>`,
+      "application/xml");
+    const range = doc.createRange();
+    range.selectNodeContents(doc.firstChild);
+    return range.extractContents();
+  }
+
+  const XUL_NS = "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";
+  const content = document.querySelector("#content");
+
+  // This actually seems to work for a top-level menu!
+  // ./mach run --temp-profile --chrome chrome://browser/content/menu-tester.html --jsconsole
+  content.appendChild(parseXULDOM(`
+    <command id="cmd_newNavigatorTab" oncommand="alert('command worked??');"/>
+    <toolbar type="menubar">
+      <toolbaritem id="menubar-items" align="center">
+       <menubar id="main-menubar">
+        <menu id="file-menu"
+              data-l10n-id="translation-sites-column">
+          <menupopup id="menu_FilePopup">
+            <menuitem id="menu_newNavigatorTab"
+                      data-l10n-id="translation-languages-column"
+                      command="cmd_newNavigatorTab"
+                      key="key_newNavigatorTab"/>
+          </menupopup>
+        </menu>
+       </menubar>
+      </toolbaritem>
+    </toolbar>
+  `));
+  </script>
+</body>
+</html>
\ No newline at end of file
diff --git a/browser/base/jar.mn b/browser/base/jar.mn
--- a/browser/base/jar.mn
+++ b/browser/base/jar.mn
@@ -91,16 +91,17 @@ browser.jar:
         content/browser/defaultthemes/4.header.png    (content/defaultthemes/4.header.png)
         content/browser/defaultthemes/4.icon.png      (content/defaultthemes/4.icon.png)
         content/browser/defaultthemes/4.preview.png   (content/defaultthemes/4.preview.png)
         content/browser/defaultthemes/5.header.png    (content/defaultthemes/5.header.png)
         content/browser/defaultthemes/5.icon.jpg      (content/defaultthemes/5.icon.jpg)
         content/browser/defaultthemes/5.preview.jpg   (content/defaultthemes/5.preview.jpg)
         content/browser/defaultthemes/dark.icon.svg   (content/defaultthemes/dark.icon.svg)
         content/browser/defaultthemes/light.icon.svg  (content/defaultthemes/light.icon.svg)
+        content/browser/menu-tester.html              (content/menu-tester.html)
 *       content/browser/pageinfo/pageInfo.xul         (content/pageinfo/pageInfo.xul)
         content/browser/pageinfo/pageInfo.js          (content/pageinfo/pageInfo.js)
         content/browser/pageinfo/pageInfo.css         (content/pageinfo/pageInfo.css)
         content/browser/pageinfo/feeds.js             (content/pageinfo/feeds.js)
         content/browser/pageinfo/permissions.js       (content/pageinfo/permissions.js)
         content/browser/pageinfo/security.js          (content/pageinfo/security.js)
         content/browser/robot.ico                     (content/robot.ico)
         content/browser/static-robot.png              (content/static-robot.png)
