# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  cad53f061da634a16ea75887558301b77f65745d
Bug 1370294 - Lazily create the iframe for the date time picker;r=mconley

MozReview-Commit-ID: Cn99obd86RB

diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -164,17 +164,16 @@
            type="arrow"
            hidden="true"
            orient="vertical"
            noautofocus="true"
            noautohide="true"
            consumeoutsideclicks="false"
            level="parent"
            tabspecific="true">
-      <iframe id="dateTimePopupFrame"/>
     </panel>
 
     <!-- for select dropdowns. The menupopup is what shows the list of options,
          and the popuponly menulist makes things like the menuactive attributes
          work correctly on the menupopup. ContentSelectDropdown expects the
          popuponly menulist to be its immediate parent. -->
     <menulist popuponly="true" id="ContentSelectDropdown" hidden="true">
       <menupopup rolluponmousewheel="true"
diff --git a/toolkit/content/widgets/datetimepopup.xml b/toolkit/content/widgets/datetimepopup.xml
--- a/toolkit/content/widgets/datetimepopup.xml
+++ b/toolkit/content/widgets/datetimepopup.xml
@@ -10,19 +10,27 @@
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:xbl="http://www.mozilla.org/xbl">
   <binding id="datetime-popup"
            extends="chrome://global/content/bindings/popup.xml#arrowpanel">
     <resources>
       <stylesheet src="chrome://global/skin/datetimepopup.css"/>
     </resources>
     <implementation>
-      <field name="dateTimePopupFrame">
-        this.querySelector("#dateTimePopupFrame");
-      </field>
+      <property name="dateTimePopupFrame">
+        <getter>
+          let frame = this.querySelector("#dateTimePopupFrame");
+          if (!frame) {
+            frame = this.ownerDocument.createElement("iframe");
+            frame.id = "dateTimePopupFrame";
+            this.appendChild(frame);
+          }
+          return frame;
+        </getter>
+      </property>
       <field name="TIME_PICKER_WIDTH" readonly="true">"12em"</field>
       <field name="TIME_PICKER_HEIGHT" readonly="true">"21em"</field>
       <field name="DATE_PICKER_WIDTH" readonly="true">"23.1em"</field>
       <field name="DATE_PICKER_HEIGHT" readonly="true">"20.7em"</field>
       <constructor><![CDATA[
         this.mozIntl = Components.classes["@mozilla.org/mozintl;1"]
                                  .getService(Components.interfaces.mozIMozIntl);
         // Notify DateTimePickerHelper.jsm that binding is ready.
