# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  77348876a243068d3930b3919c27ec78958d1ffb
Bug XXX - Lazily initialize iframe for the date picker

diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -164,17 +164,16 @@
            type="arrow"
            hidden="true"
            orient="vertical"
            noautofocus="true"
            noautohide="true"
            consumeoutsideclicks="false"
            level="parent"
            tabspecific="true">
-      <iframe id="dateTimePopupFrame"/>
     </panel>
 
     <!-- for select dropdowns. The menupopup is what shows the list of options,
          and the popuponly menulist makes things like the menuactive attributes
          work correctly on the menupopup. ContentSelectDropdown expects the
          popuponly menulist to be its immediate parent. -->
     <menulist popuponly="true" id="ContentSelectDropdown" hidden="true">
       <menupopup rolluponmousewheel="true"
diff --git a/toolkit/content/widgets/datetimepopup.xml b/toolkit/content/widgets/datetimepopup.xml
--- a/toolkit/content/widgets/datetimepopup.xml
+++ b/toolkit/content/widgets/datetimepopup.xml
@@ -10,19 +10,27 @@
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:xbl="http://www.mozilla.org/xbl">
   <binding id="datetime-popup"
            extends="chrome://global/content/bindings/popup.xml#arrowpanel">
     <resources>
       <stylesheet src="chrome://global/skin/datetimepopup.css"/>
     </resources>
     <implementation>
-      <field name="dateTimePopupFrame">
-        this.querySelector("#dateTimePopupFrame");
-      </field>
+      <property name="dateTimePopupFrame">
+        <getter>
+          let dtFrame = this.querySelector("#dateTimePopupFrame");
+          if (!dtFrame) {
+            dtFrame = document.createElement("iframe");
+            dtFrame.id = "dateTimePopupFrame";
+            document.querySelector("#DateTimePickerPanel").appendChild(dtFrame);
+          }
+          return dtFrame;
+        </getter>
+      </property>
       <field name="TIME_PICKER_WIDTH" readonly="true">"12em"</field>
       <field name="TIME_PICKER_HEIGHT" readonly="true">"21em"</field>
       <field name="DATE_PICKER_WIDTH" readonly="true">"23.1em"</field>
       <field name="DATE_PICKER_HEIGHT" readonly="true">"20.7em"</field>
       <constructor><![CDATA[
         this.mozIntl = Components.classes["@mozilla.org/mozintl;1"]
                                  .getService(Components.interfaces.mozIMozIntl);
         // Notify DateTimePickerHelper.jsm that binding is ready.
