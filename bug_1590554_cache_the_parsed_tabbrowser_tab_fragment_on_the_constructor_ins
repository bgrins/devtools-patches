# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1571780078 25200
#      Tue Oct 22 14:34:38 2019 -0700
# Node ID a9c0cf143a78809f4cbedf3d5f6c768f29773acc
# Parent  a8089b1fa5c4f678f64ae07102ee3863a63d8c31
Bug 1590554 - Cache the parsed tabbrowser-tab fragment on the constructor instead of on each element;r=Gijs

This means we only need to call parseXULToFragment a max of once per document
instead of a maximum of once per tab (which in practice isn't any better than
not caching since we only run connectedCallback logic once per tab).

Differential Revision: https://phabricator.services.mozilla.com/D50137

diff --git a/browser/base/content/tabbrowser-tab.js b/browser/base/content/tabbrowser-tab.js
--- a/browser/base/content/tabbrowser-tab.js
+++ b/browser/base/content/tabbrowser-tab.js
@@ -65,18 +65,18 @@
           "text=label,accesskey,fadein,pinned,selected=visuallyselected,attention",
         ".tab-icon-sound":
           "soundplaying,soundplaying-scheduledremoval,pinned,muted,blocked,selected=visuallyselected,activemedia-blocked,pictureinpicture",
         ".tab-close-button": "fadein,pinned,selected=visuallyselected",
       };
     }
 
     get fragment() {
-      if (!this._fragment) {
-        this._fragment = MozXULElement.parseXULToFragment(`
+      if (!this.constructor.hasOwnProperty("_fragment")) {
+        this.constructor._fragment = MozXULElement.parseXULToFragment(`
         <stack class="tab-stack" flex="1">
           <vbox class="tab-background">
             <hbox class="tab-line"/>
             <spacer flex="1" class="tab-background-inner"/>
             <hbox class="tab-bottom-line"/>
           </vbox>
           <hbox class="tab-loading-burst"/>
           <hbox class="tab-content" align="center">
@@ -92,17 +92,17 @@
               <label class="tab-text tab-label" role="presentation"/>
             </hbox>
             <image class="tab-icon-sound" role="presentation"/>
             <image class="tab-close-button close-icon" role="presentation"/>
           </hbox>
         </stack>
       `);
       }
-      return this.ownerDocument.importNode(this._fragment, true);
+      return document.importNode(this.constructor._fragment, true);
     }
 
     connectedCallback() {
       if (this._initialized) {
         return;
       }
 
       this.textContent = "";
