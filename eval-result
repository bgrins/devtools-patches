# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  871d92a1b0701ad79780989bf2ae335d4a19f138
Bug 1044365 - wait to append the evalled message until after it finsihes

diff --git a/devtools/client/webconsole/webconsole.js b/devtools/client/webconsole/webconsole.js
--- a/devtools/client/webconsole/webconsole.js
+++ b/devtools/client/webconsole/webconsole.js
@@ -3349,18 +3349,23 @@ JSTerm.prototype = {
    * @param function [aCallback]
    *        Optional function to invoke when the result is displayed.
    *        This is deprecated - please use the promise return value instead.
    * @returns Promise
    *          Resolves with the message once the result is displayed.
    */
   execute: function JST_execute(aExecuteString, aCallback)
   {
+    let message = new Messages.Simple(aExecuteString, {
+      category: "input",
+      severity: "log",
+    });
     let deferred = promise.defer();
     let callback = function(msg) {
+      this.hud.output.addMessage(message);
       deferred.resolve(msg);
       if (aCallback) {
         aCallback(msg);
       }
     }
 
     // attempt to execute the content of the inputNode
     aExecuteString = aExecuteString || this.inputNode.value;
@@ -3369,21 +3374,16 @@ JSTerm.prototype = {
     }
 
     let selectedNodeActor = null;
     let inspectorSelection = this.hud.owner.getInspectorSelection();
     if (inspectorSelection && inspectorSelection.nodeFront) {
       selectedNodeActor = inspectorSelection.nodeFront.actorID;
     }
 
-    let message = new Messages.Simple(aExecuteString, {
-      category: "input",
-      severity: "log",
-    });
-    this.hud.output.addMessage(message);
     let onResult = this._executeResultCallback.bind(this, message, callback);
 
     let options = {
       frame: this.SELECTED_FRAME,
       selectedNodeActor: selectedNodeActor,
     };
 
     this.requestEvaluation(aExecuteString, options).then(onResult, onResult);
