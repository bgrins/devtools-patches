# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1555436320 25200
#      Tue Apr 16 10:38:40 2019 -0700
# Node ID b3c2880934d4dfa16f469a2c079cc59d62f9f016
# Parent  f32e7767d9bdf224c09c4393607650a20eefd713
Bug 1544051 - Part 2 - Remove some references to AddTask.js that aren't caught by the script in part 3

Differential Revision: https://phabricator.services.mozilla.com/D27760

diff --git a/browser/extensions/formautofill/test/mochitest/formautofill_common.js b/browser/extensions/formautofill/test/mochitest/formautofill_common.js
--- a/browser/extensions/formautofill/test/mochitest/formautofill_common.js
+++ b/browser/extensions/formautofill/test/mochitest/formautofill_common.js
@@ -1,11 +1,10 @@
 /* import-globals-from ../../../../../testing/mochitest/tests/SimpleTest/SimpleTest.js */
 /* import-globals-from ../../../../../testing/mochitest/tests/SimpleTest/EventUtils.js */
-/* import-globals-from ../../../../../testing/mochitest/tests/SimpleTest/AddTask.js */
 /* import-globals-from ../../../../../toolkit/components/satchel/test/satchel_common.js */
 /* eslint-disable no-unused-vars */
 
 "use strict";
 
 let formFillChromeScript;
 let defaultTextColor;
 let expectingPopup = null;
diff --git a/dom/animation/test/mozilla/file_restyles.html b/dom/animation/test/mozilla/file_restyles.html
--- a/dom/animation/test/mozilla/file_restyles.html
+++ b/dom/animation/test/mozilla/file_restyles.html
@@ -5,23 +5,23 @@
 <script>
 const ok = opener.ok.bind(opener);
 const is = opener.is.bind(opener);
 const todo = opener.todo.bind(opener);
 const todo_is = opener.todo_is.bind(opener);
 const info = opener.info.bind(opener);
 const original_finish = opener.SimpleTest.finish;
 const SimpleTest = opener.SimpleTest;
+const add_task = opener.add_task;
 SimpleTest.finish = function finish() {
   self.close();
   original_finish();
 }
 </script>
 <script src="/tests/SimpleTest/EventUtils.js"></script>
-<script src="/tests/SimpleTest/AddTask.js"></script>
 <script src="/tests/SimpleTest/paint_listener.js"></script>
 <script src="../testcommon.js"></script>
 <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css">
 <style>
 @keyframes opacity {
   from { opacity: 1; }
   to { opacity: 0; }
 }
diff --git a/dom/base/test/chrome/window_swapFrameLoaders.xul b/dom/base/test/chrome/window_swapFrameLoaders.xul
--- a/dom/base/test/chrome/window_swapFrameLoaders.xul
+++ b/dom/base/test/chrome/window_swapFrameLoaders.xul
@@ -2,20 +2,19 @@
 <?xml-stylesheet type="text/css" href="chrome://global/skin"?>
 <?xml-stylesheet type="text/css" href="chrome://mochikit/content/tests/SimpleTest/test.css"?>
 <!--
 https://bugzilla.mozilla.org/show_bug.cgi?id=1242644
 Test swapFrameLoaders with different frame types and remoteness
 -->
 <window title="Mozilla Bug 1242644"
         xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
-  <script src="chrome://mochikit/content/tests/SimpleTest/AddTask.js"></script>
 
   <script type="application/javascript"><![CDATA[
-  ["SimpleTest", "SpecialPowers", "info", "is", "ok"].forEach(key => {
+  ["SimpleTest", "SpecialPowers", "info", "is", "ok", "add_task"].forEach(key => {
     window[key] = window.opener[key];
   })
 
   const NS = {
     xul: "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul",
     html: "http://www.w3.org/1999/xhtml",
   }
 
diff --git a/dom/indexedDB/test/helpers.js b/dom/indexedDB/test/helpers.js
--- a/dom/indexedDB/test/helpers.js
+++ b/dom/indexedDB/test/helpers.js
@@ -44,22 +44,16 @@ function clearAllDatabases(callback) {
 var testHarnessGenerator = testHarnessSteps();
 testHarnessGenerator.next();
 
 function* testHarnessSteps() {
   function nextTestHarnessStep(val) {
     testHarnessGenerator.next(val);
   }
 
-  let script = document.createElement("script");
-  script.src = "/tests/SimpleTest/AddTask.js";
-  script.onload = nextTestHarnessStep;
-  document.head.appendChild(script);
-  yield undefined;
-
   let testScriptPath;
   let testScriptFilename;
 
   let scripts = document.getElementsByTagName("script");
   for (let i = 0; i < scripts.length; i++) {
     let src = scripts[i].src;
     let match = src.match(/indexedDB\/test\/unit\/(test_[^\/]+\.js)$/);
     if (match && match.length == 2) {
diff --git a/dom/quota/test/helpers.js b/dom/quota/test/helpers.js
--- a/dom/quota/test/helpers.js
+++ b/dom/quota/test/helpers.js
@@ -156,18 +156,16 @@ function* testHarnessSteps()
   yield* loadScript("head-shared.js");
 
   // Now run the test script in the main thread.
   if (testSteps.constructor.name === "AsyncFunction") {
     SimpleTest.registerCleanupFunction(async function() {
       await requestFinished(clearAllDatabases());
     });
 
-    yield* loadScript("/tests/SimpleTest/AddTask.js");
-
     add_task(testSteps);
   } else {
     testGenerator.next();
 
     yield undefined;
   }
 }
 
diff --git a/testing/mochitest/static/chromehtml.template.txt b/testing/mochitest/static/chromehtml.template.txt
--- a/testing/mochitest/static/chromehtml.template.txt
+++ b/testing/mochitest/static/chromehtml.template.txt
@@ -1,15 +1,14 @@
 <!DOCTYPE HTML>
 <html>
 <head>
   <meta charset="utf-8">
   <title><!-- TODO: insert title here --></title>
   <script src="chrome://mochikit/content/tests/SimpleTest/SimpleTest.js"></script>
-  <script src="chrome://mochikit/content/tests/SimpleTest/AddTask.js"></script>
   <link rel="stylesheet" href="chrome://mochikit/content/tests/SimpleTest/test.css"/>
   <script>
     add_task(async function test_TODO() {
       ok(true, "TODO: implement the test");
     });
   </script>
 </head>
 <body>
diff --git a/testing/mochitest/static/chromexhtml.template.txt b/testing/mochitest/static/chromexhtml.template.txt
--- a/testing/mochitest/static/chromexhtml.template.txt
+++ b/testing/mochitest/static/chromexhtml.template.txt
@@ -1,15 +1,14 @@
 <!DOCTYPE HTML>
 <html xmlns="http://www.w3.org/1999/xhtml">
 <head>
   <meta charset="utf-8" />
   <title><!-- TODO: insert title here --></title>
   <script src="chrome://mochikit/content/tests/SimpleTest/SimpleTest.js"></script>
-  <script src="chrome://mochikit/content/tests/SimpleTest/AddTask.js"></script>
   <link rel="stylesheet" href="chrome://mochikit/content/tests/SimpleTest/test.css"/>
   <script><![CDATA[
     add_task(async function test_TODO() {
       ok(true, "TODO: implement the test");
     });
   ]]></script>
 </head>
 <body>
diff --git a/testing/mochitest/static/chromexul.template.txt b/testing/mochitest/static/chromexul.template.txt
--- a/testing/mochitest/static/chromexul.template.txt
+++ b/testing/mochitest/static/chromexul.template.txt
@@ -1,15 +1,14 @@
 <?xml version="1.0"?>
 <?xml-stylesheet href="chrome://global/skin"?>
 <?xml-stylesheet href="chrome://mochikit/content/tests/SimpleTest/test.css"?>
 <window title="TODO: Insert title here"
         xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
   <script src="chrome://mochikit/content/tests/SimpleTest/SimpleTest.js" />
-  <script src="chrome://mochikit/content/tests/SimpleTest/AddTask.js" />
   <script><![CDATA[
     add_task(async function test_TODO() {
       ok(true, "TODO: implement the test");
     });
   ]]></script>
 
   <body xmlns="http://www.w3.org/1999/xhtml">
   </body>
diff --git a/toolkit/components/extensions/test/mochitest/test_ext_all_apis.js b/toolkit/components/extensions/test/mochitest/test_ext_all_apis.js
--- a/toolkit/components/extensions/test/mochitest/test_ext_all_apis.js
+++ b/toolkit/components/extensions/test/mochitest/test_ext_all_apis.js
@@ -2,17 +2,16 @@
 /* vim: set sts=2 sw=2 et tw=80: */
 "use strict";
 
 // Tests whether not too many APIs are visible by default.
 // This file is used by test_ext_all_apis.html in browser/ and mobile/android/,
 // which may modify the following variables to add or remove expected APIs.
 /* globals expectedContentApisTargetSpecific */
 /* globals expectedBackgroundApisTargetSpecific */
-/* import-globals-from ../../../../../testing/mochitest/tests/SimpleTest/AddTask.js */
 
 // Generates a list of expectations.
 function generateExpectations(list) {
   return list.reduce((allApis, path) => {
     return allApis.concat(`browser.${path}`, `chrome.${path}`);
   }, []).sort();
 }
 
