# vim: se ft=diff :
# HG changeset patch
# User Jan Odvarko <odvarko@gmail.com>
# Date 1462272828 -7200
Bug 1264671 - Browser test for NotificationBar; r=bgrins

diff --git a/devtools/client/shared/components/moz.build b/devtools/client/shared/components/moz.build
--- a/devtools/client/shared/components/moz.build
+++ b/devtools/client/shared/components/moz.build
@@ -13,8 +13,9 @@ DevToolsModules(
     'frame.js',
     'h-split-box.js',
     'notification-box.css',
     'notification-box.js',
     'tree.js',
 )
 
 MOCHITEST_CHROME_MANIFESTS += ['test/mochitest/chrome.ini']
+BROWSER_CHROME_MANIFESTS += ['test/browser/browser.ini']
diff --git a/devtools/client/shared/components/test/browser/.eslintrc b/devtools/client/shared/components/test/browser/.eslintrc
new file mode 100644
--- /dev/null
+++ b/devtools/client/shared/components/test/browser/.eslintrc
@@ -0,0 +1,4 @@
+{
+  // Extend from the shared list of defined globals for mochitests.
+  "extends": "../../../../../.eslintrc.mochitests",
+}
diff --git a/devtools/client/shared/components/test/browser/browser.ini b/devtools/client/shared/components/test/browser/browser.ini
new file mode 100644
--- /dev/null
+++ b/devtools/client/shared/components/test/browser/browser.ini
@@ -0,0 +1,9 @@
+[DEFAULT]
+tags = devtools
+subsuite = devtools
+support-files =
+  head.js
+  page_basic.html
+  !/devtools/client/framework/test/shared-head.js
+
+[browser_notification_box_basic.js]
diff --git a/devtools/client/shared/components/test/browser/browser_notification_box_basic.js b/devtools/client/shared/components/test/browser/browser_notification_box_basic.js
new file mode 100644
--- /dev/null
+++ b/devtools/client/shared/components/test/browser/browser_notification_box_basic.js
@@ -0,0 +1,31 @@
+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */
+/* vim: set ts=2 et sw=2 tw=80: */
+/* Any copyright is dedicated to the Public Domain.
+ * http://creativecommons.org/publicdomain/zero/1.0/ */
+
+"use strict";
+
+const TEST_PAGE_URL = URL_ROOT + "page_basic.html";
+
+/**
+ * Basic test that checks existence of the Notification box.
+ */
+add_task(function* () {
+  info("Test Notification box basic started");
+
+  let { toolbox } = yield addTestTab(TEST_PAGE_URL);
+
+  // Append a notification
+  let notificationBox = toolbox.getNotificationBox();
+  notificationBox.appendNotification(
+    "Info message",
+    "id1",
+    null,
+    notificationBox.PRIORITY_INFO_HIGH
+  );
+
+  // Verify existence of one notification.
+  let parentNode = toolbox.doc.getElementById("toolbox-notificationbox");
+  let nodes = parentNode.querySelectorAll(".notification");
+  is(nodes.length, 1, "There must be one notification");
+});
diff --git a/devtools/client/shared/components/test/browser/head.js b/devtools/client/shared/components/test/browser/head.js
new file mode 100644
--- /dev/null
+++ b/devtools/client/shared/components/test/browser/head.js
@@ -0,0 +1,42 @@
+/* vim: set ts=2 et sw=2 tw=80: */
+/* Any copyright is dedicated to the Public Domain.
+ * http://creativecommons.org/publicdomain/zero/1.0/ */
+/* eslint no-unused-vars: [2, {"vars": "local", "args": "none"}] */
+/* import-globals-from ../../../../framework/test/shared-head.js */
+
+"use strict";
+
+// shared-head.js handles imports, constants, and utility functions
+Services.scriptloader.loadSubScript(
+  "chrome://mochitests/content/browser/devtools/client/framework/test/shared-head.js", this);
+
+registerCleanupFunction(() => {
+  info("finish() was called, cleaning up...");
+});
+
+/**
+ * Add a new test tab in the browser and load the given url.
+ * @param {String} url
+ *        The url to be loaded in the new tab
+ * @return a promise that resolves to the tab object when
+ *        the url is loaded
+ */
+function addTestTab(url) {
+  info("Adding a new test tab with URL: '" + url + "'");
+
+  return new Promise(resolve => {
+    addTab(url).then(tab => {
+      // Load devtools/shared/frame-script-utils.js
+      getFrameScript();
+
+      let target = TargetFactory.forTab(tab || gBrowser.selectedTab);
+      gDevTools.showToolbox(target, "webconsole").then(toolbox => {
+        let panel = toolbox.getCurrentPanel();
+        resolve({
+          panel: panel,
+          toolbox: toolbox
+        });
+      });
+    });
+  });
+}
diff --git a/devtools/client/shared/components/test/browser/page_basic.html b/devtools/client/shared/components/test/browser/page_basic.html
new file mode 100644
--- /dev/null
+++ b/devtools/client/shared/components/test/browser/page_basic.html
@@ -0,0 +1,11 @@
+<!-- Any copyright is dedicated to the Public Domain.
+     http://creativecommons.org/publicdomain/zero/1.0/ -->
+<!doctype html>
+<html>
+  <head>
+    <meta charset="utf-8"/>
+    <title>Shared test page</title>
+  </head>
+  <body>
+  </body>
+</html>
