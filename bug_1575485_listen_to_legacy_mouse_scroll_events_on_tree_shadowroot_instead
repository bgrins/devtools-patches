# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1570651464 25200
#      Wed Oct 09 13:04:24 2019 -0700
# Node ID 6059fcdaa801fa5b3fcd16c776c63cb6ee86bb92
# Parent  95b8b411bb9169882ab0a3e8744ca414c15674da
Bug 1575485 - Listen to legacy mouse scroll events on <tree> shadowRoot instead of the host element

This allows scrolling to happen directly on the scrollbar element, which is inside the shadow DOM.

Differential Revision: https://phabricator.services.mozilla.com/D48755

diff --git a/toolkit/content/widgets/tree.js b/toolkit/content/widgets/tree.js
--- a/toolkit/content/widgets/tree.js
+++ b/toolkit/content/widgets/tree.js
@@ -733,28 +733,30 @@
           event.preventDefault();
         }
       });
 
       this.addEventListener("touchend", event => {
         this._touchY = -1;
       });
 
-      this.addEventListener("MozMousePixelScroll", event => {
+      // This event doesn't retarget, so listen on the shadow DOM directly
+      this.shadowRoot.addEventListener("MozMousePixelScroll", event => {
         if (
           !(
             this.getAttribute("allowunderflowscroll") == "true" &&
             this.getAttribute("hidevscroll") == "true"
           )
         ) {
           event.preventDefault();
         }
       });
 
-      this.addEventListener("DOMMouseScroll", event => {
+      // This event doesn't retarget, so listen on the shadow DOM directly
+      this.shadowRoot.addEventListener("DOMMouseScroll", event => {
         if (
           !(
             this.getAttribute("allowunderflowscroll") == "true" &&
             this.getAttribute("hidevscroll") == "true"
           )
         ) {
           event.preventDefault();
         }
