# HG changeset patch
# Parent fe329c0f2d42bf5e67ba877a6f8ab7743a7ccd66
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 1060041 - Don't expand folders in projecteditor tree by default;r=jryans

diff --git a/browser/devtools/projecteditor/lib/stores/resource.js b/browser/devtools/projecteditor/lib/stores/resource.js
--- a/browser/devtools/projecteditor/lib/stores/resource.js
+++ b/browser/devtools/projecteditor/lib/stores/resource.js
@@ -53,16 +53,23 @@ var Resource = Class({
   get basename() { return this.uri.path.replace(/\/+$/, '').replace(/\\/g,'/').replace( /.*\//, '' ); },
 
   /**
    * Is there more than 1 child Resource?
    */
   get hasChildren() { return this.children && this.children.size > 0; },
 
   /**
+   * Is this Resource the root (top level for the store)?
+   */
+  get isRoot() {
+    return !this.parent
+  },
+
+  /**
    * Sorted array of children for display
    */
   get childrenSorted() {
     if (!this.hasChildren) {
       return [];
     }
 
     return [...this.children].sort((a, b)=> {
diff --git a/browser/devtools/projecteditor/lib/tree.js b/browser/devtools/projecteditor/lib/tree.js
--- a/browser/devtools/projecteditor/lib/tree.js
+++ b/browser/devtools/projecteditor/lib/tree.js
@@ -79,16 +79,19 @@ var ResourceContainer = Class({
       }
     }, false);
     this.expander.addEventListener("click", (evt) => {
       this.expanded = !this.expanded;
       this.select();
       evt.stopPropagation();
     }, true);
 
+    if (!this.resource.isRoot) {
+      this.expanded = false;
+    }
     this.update();
   },
 
   destroy: function() {
     this.elt.remove();
     this.expander.remove();
     this.icon.remove();
     this.highlighter.remove();
diff --git a/browser/devtools/projecteditor/test/browser_projecteditor_tree_selection_01.js b/browser/devtools/projecteditor/test/browser_projecteditor_tree_selection_01.js
--- a/browser/devtools/projecteditor/test/browser_projecteditor_tree_selection_01.js
+++ b/browser/devtools/projecteditor/test/browser_projecteditor_tree_selection_01.js
@@ -30,18 +30,24 @@ let test = asyncTest(function*() {
   for (let i = 0; i < resources.length; i++){
     yield selectFileSubsequentLoad(projecteditor, resources[i]);
   }
 });
 
 function selectFileFirstLoad(projecteditor, resource) {
   ok (resource && resource.path, "A valid resource has been passed in for selection " + (resource && resource.path));
   projecteditor.projectTree.selectResource(resource);
+  let container = projecteditor.projectTree.getViewContainer(resource);
 
+  if (resource.isRoot) {
+    ok (container.expanded, "The root directory is expanded by default.");
+    return;
+  }
   if (resource.isDir) {
+    ok (!container.expanded, "A directory is not expanded by default.");
     return;
   }
 
   let [editorCreated, editorLoaded, editorActivated] = yield promise.all([
     onceEditorCreated(projecteditor),
     onceEditorLoad(projecteditor),
     onceEditorActivated(projecteditor)
   ]);
