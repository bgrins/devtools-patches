# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1572388894 25200
#      Tue Oct 29 15:41:34 2019 -0700
# Node ID 646cdef15ed31c1546f02e7768a6a67228eb46ec
# Parent  89aad5574c9c923f529f123f3598f2cadba789d8
imported patch debug-megabar-size

diff --git a/browser/components/urlbar/UrlbarInput.jsm b/browser/components/urlbar/UrlbarInput.jsm
--- a/browser/components/urlbar/UrlbarInput.jsm
+++ b/browser/components/urlbar/UrlbarInput.jsm
@@ -1032,16 +1032,20 @@ class UrlbarInput {
 
     await this.window.promiseDocumentFlushed(() => {});
     await new Promise(resolve => {
       this.window.requestAnimationFrame(() => {
         if (this._layoutBreakoutUpdateKey != updateKey) {
           return;
         }
 
+        if (getBoundsWithoutFlushing(this.textbox.parentNode).height > 40) {
+          debugger;
+        }
+
         this.textbox.parentNode.style.setProperty(
           "--urlbar-container-height",
           px(getBoundsWithoutFlushing(this.textbox.parentNode).height)
         );
         this.textbox.style.setProperty(
           "--urlbar-height",
           px(getBoundsWithoutFlushing(this.textbox).height)
         );
diff --git a/browser/components/urlbar/UrlbarView.jsm b/browser/components/urlbar/UrlbarView.jsm
--- a/browser/components/urlbar/UrlbarView.jsm
+++ b/browser/components/urlbar/UrlbarView.jsm
@@ -606,25 +606,25 @@ class UrlbarView {
 
       // Align the panel with the parent toolbar.
       this.panel.style.top = px(
         getBoundsWithoutFlushing(this.input.textbox.closest("toolbar")).bottom
       );
 
       this._mainContainer.style.maxWidth = px(width);
     }
-    this.panel.removeAttribute("hidden");
     this.input.inputField.setAttribute("aria-expanded", "true");
     this.input.dropmarker.setAttribute("open", "true");
 
     this.input.setAttribute("open", "true");
     this.input.startLayoutExtend();
 
     this.window.addEventListener("resize", this);
     this._windowOuterWidth = this.window.outerWidth;
+    this.panel.removeAttribute("hidden");
 
     this.controller.notify(this.controller.NOTIFICATIONS.VIEW_OPEN);
   }
 
   /**
    * Whether a result is a search suggestion.
    * @param {UrlbarResult} result The result to examine.
    * @returns {boolean} Whether the result is a search suggestion.
