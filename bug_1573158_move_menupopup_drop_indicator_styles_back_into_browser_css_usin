# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1567028406 25200
#      Wed Aug 28 14:40:06 2019 -0700
# Node ID 0715c4c7c3bfeb600c81b6255e7bdedf32b577bf
# Parent  8d251dd4a9bebaa3e72a23d795122d4b12097ffc
Bug 1573158 - Move menupopup-drop-indicator styles back into browser.css using Shadow Parts and out of inline styles

This reverts removals like https://hg.mozilla.org/mozilla-central/rev/bd7cd9d7b6ad#l8.12

Differential Revision: https://phabricator.services.mozilla.com/D43844

diff --git a/browser/components/places/content/places-menupopup.js b/browser/components/places/content/places-menupopup.js
--- a/browser/components/places/content/places-menupopup.js
+++ b/browser/components/places/content/places-menupopup.js
@@ -30,81 +30,31 @@
       for (let event_name of event_names) {
         this.addEventListener(event_name, ev => this[`on_${event_name}`](ev));
       }
 
       this.attachShadow({ mode: "open" });
     }
 
     get commonStyles() {
-      let s = "";
       if (this.closest("#BMB_bookmarksPopup")) {
-        s = `
+        return `
         /* Remove padding on xul:arrowscrollbox to avoid extra padding on footer */
         arrowscrollbox.popup-internal-box {
           padding-bottom: 0px;
         }
         .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-up,
         .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-down {
           -moz-appearance: none;
           margin-top: 0;
           margin-bottom: 0;
         }
       `;
       }
-
-      switch (AppConstants.platform) {
-        case "macosx":
-          return `${s}
-          .menupopup-drop-indicator-bar {
-            position: relative;
-            /* these two margins must together compensate the indicator's height */
-            margin-top: -1px;
-            margin-bottom: -1px;
-          }
-          .menupopup-drop-indicator {
-            list-style-image: none;
-            height: 2px;
-            margin-inline-end: -4em;
-            background-color: Highlight;
-          }
-        `;
-        case "linux":
-          return `${s}
-          .menupopup-drop-indicator-bar {
-            position: relative;
-            /* these two margins must together compensate the indicator's height */
-            margin-top: -1px;
-            margin-bottom: -1px;
-          }
-          .menupopup-drop-indicator {
-            list-style-image: none;
-            height: 2px;
-            margin-inline-end: -4em;
-            background-color: Highlight;
-          }
-        `;
-        case "win":
-          return `${s}
-          .menupopup-drop-indicator-bar {
-            position: relative;
-            /* these two margins must together compensate the indicator's height */
-            margin-top: -1px;
-            margin-bottom: -1px;
-          }
-          .menupopup-drop-indicator {
-            list-style-image: none;
-            height: 2px;
-            margin-inline-end: -4em;
-            background-color: Highlight;
-          }
-        `;
-        default:
-          return s;
-      }
+      return "";
     }
 
     get styles() {
       if (!this.closest("#BMB_bookmarksPopup")) {
         return "";
       }
 
       let s = `
@@ -132,21 +82,21 @@
       }
     }
 
     get markup() {
       return `
       <html:link rel="stylesheet" href="chrome://global/skin/global.css" />
       <html:style>${this.commonStyles}${this.styles}</html:style>
       <hbox flex="1" part="innerbox">
-        <vbox class="menupopup-drop-indicator-bar" hidden="true">
-          <image class="menupopup-drop-indicator" mousethrough="always"></image>
+        <vbox part="drop-indicator-bar" hidden="true">
+          <image part="drop-indicator" mousethrough="always"></image>
         </vbox>
         <arrowscrollbox class="popup-internal-box" flex="1" orient="vertical"
-                        smoothscroll="false">
+                        smoothscroll="false" part="popupbox">
           <html:slot></html:slot>
         </arrowscrollbox>
       </hbox>
     `;
     }
 
     connectedCallback() {
       if (this.delayConnectedCallback()) {
@@ -154,17 +104,17 @@
       }
 
       this.shadowRoot.textContent = "";
       this.shadowRoot.appendChild(
         MozXULElement.parseXULToFragment(this.markup)
       );
 
       this._indicatorBar = this.shadowRoot.querySelector(
-        ".menupopup-drop-indicator-bar"
+        "[part=drop-indicator-bar]"
       );
       this._scrollBox = this.shadowRoot.querySelector(".popup-internal-box");
 
       /**
        * Sub-menus should be opened when the mouse drags over them, and closed
        * when the mouse drags off.  The overFolder object manages opening and
        * closing of folders when the mouse hovers.
        */
@@ -699,18 +649,18 @@
       return `
       <html:link rel="stylesheet" href="chrome://global/skin/global.css" />
       <html:style>${this.commonStyles}</html:style>
       <vbox class="panel-arrowcontainer" flex="1">
         <box class="panel-arrowbox">
           <image class="panel-arrow"></image>
         </box>
         <box class="panel-arrowcontent" part="arrowcontent" flex="1">
-          <vbox class="menupopup-drop-indicator-bar" hidden="true">
-            <image class="menupopup-drop-indicator" mousethrough="always"></image>
+          <vbox part="drop-indicator-bar" hidden="true">
+            <image part="drop-indicator" mousethrough="always"></image>
           </vbox>
           <arrowscrollbox class="popup-internal-box" flex="1"
                           orient="vertical" smoothscroll="false"
                           part="popupbox">
             <html:slot></html:slot>
           </arrowscrollbox>
         </box>
       </vbox>
diff --git a/browser/themes/shared/browser.inc.css b/browser/themes/shared/browser.inc.css
--- a/browser/themes/shared/browser.inc.css
+++ b/browser/themes/shared/browser.inc.css
@@ -82,16 +82,31 @@
   -moz-outline-radius: 2px;
 }
 
 #PersonalToolbar[customizing]:empty {
   /* Avoid the toolbar having no height when there's no items in it */
   min-height: 22px;
 }
 
+/* rules for menupopup drop indicators */
+menupopup::part(drop-indicator-bar) {
+  position: relative;
+  /* these two margins must together compensate the indicator's height */
+  margin-top: -1px;
+  margin-bottom: -1px;
+}
+
+menupopup::part(drop-indicator) {
+  list-style-image: none;
+  height: 2px;
+  margin-inline-end: -4em;
+  background-color: Highlight;
+}
+
 /* Required for Library animation */
 
 #navigator-toolbox {
   position: relative;
 }
 
 #library-animatable-box {
   display: none;
