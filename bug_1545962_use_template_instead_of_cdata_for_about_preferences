# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1555793849 25200
#      Sat Apr 20 13:57:29 2019 -0700
# Node ID ad9243fb4ff00988d9cc5b117e934133eb655383
# Parent  a092972b53f0e566a36770e7b03363036ff820ec
Bug 1545962 - Use <template> instead of CDATA for about:preferences

Differential Revision: https://phabricator.services.mozilla.com/D28280

diff --git a/browser/components/preferences/in-content/home.xul b/browser/components/preferences/in-content/home.xul
--- a/browser/components/preferences/in-content/home.xul
+++ b/browser/components/preferences/in-content/home.xul
@@ -1,17 +1,17 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- Home panel -->
 
 <script type="application/javascript"
         src="chrome://browser/content/preferences/in-content/home.js"/>
-<box id="template-paneHome" hidden="true"><![CDATA[
+<html:template id="template-paneHome">
 <hbox id="firefoxHomeCategory"
       class="subcategory"
       hidden="true"
       data-category="paneHome">
   <html:h1 style="-moz-box-flex: 1;" data-l10n-id="pane-home-title"/>
   <button id="restoreDefaultHomePageBtn"
           class="homepage-button check-home-page-controlled"
           data-preference-related="browser.startup.homepage"
@@ -93,9 +93,9 @@
   <hbox id="browserNewTabExtensionContent"
         align="center" hidden="true" class="extension-controlled">
     <description control="disableNewTabExtension" flex="1" />
     <button id="disableNewTabExtension"
             class="extension-controlled-button accessory-button"
             data-l10n-id="disable-extension" />
   </hbox>
 </groupbox>
-]]></box>
+</html:template>
diff --git a/browser/components/preferences/in-content/main.xul b/browser/components/preferences/in-content/main.xul
--- a/browser/components/preferences/in-content/main.xul
+++ b/browser/components/preferences/in-content/main.xul
@@ -11,17 +11,17 @@
   <script type="application/javascript" src="chrome://browser/content/aboutDialog-appUpdater.js"/>
 #endif
 
 <script type="application/javascript"
         src="chrome://mozapps/content/preferences/fontbuilder.js"/>
 
 <stringbundle id="bundlePreferences" src="chrome://browser/locale/preferences.properties"/>
 
-<box id="template-paneGeneral" hidden="true"><![CDATA[
+<html:template id="template-paneGeneral">
 <hbox id="generalCategory"
       class="subcategory"
       hidden="true"
       data-category="paneGeneral">
   <html:h1 data-l10n-id="pane-general-title"/>
 </hbox>
 
 <!-- Startup -->
@@ -700,9 +700,9 @@
                 connection-proxy-autologin.label,
                 connection-proxy-socks-remote-dns.label,
                 connection-dns-over-https.label,
                 connection-dns-over-https-url-custom.label,
             " />
     </hbox>
   </hbox>
 </groupbox>
-]]></box>
+</html:template>
diff --git a/browser/components/preferences/in-content/preferences.js b/browser/components/preferences/in-content/preferences.js
--- a/browser/components/preferences/in-content/preferences.js
+++ b/browser/components/preferences/in-content/preferences.js
@@ -40,20 +40,18 @@ function init_category_if_required(categ
 }
 
 function register_module(categoryName, categoryObject) {
   gCategoryInits.set(categoryName, {
     inited: false,
     async init() {
       let template = document.getElementById("template-" + categoryName);
       if (template) {
-        // Replace the template element with the nodes from the parsed comment
-        // string.
-        let frag = MozXULElement.parseXULToFragment(template.firstChild.data);
-
+        // Replace the template element with the nodes inside of it.
+        let frag = template.content;
         await document.l10n.translateFragment(frag);
 
         // Actually insert them into the DOM.
         document.l10n.pauseObserving();
         template.replaceWith(frag);
         document.l10n.resumeObserving();
 
         // Asks Preferences to update the attribute value of the entire
diff --git a/browser/components/preferences/in-content/privacy.xul b/browser/components/preferences/in-content/privacy.xul
--- a/browser/components/preferences/in-content/privacy.xul
+++ b/browser/components/preferences/in-content/privacy.xul
@@ -3,17 +3,17 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- Privacy panel -->
 
 <script type="application/javascript"
         src="chrome://browser/content/preferences/in-content/privacy.js"/>
 <stringbundle id="bundlePreferences" src="chrome://browser/locale/preferences/preferences.properties"/>
 <stringbundle id="signonBundle" src="chrome://passwordmgr/locale/passwordmgr.properties"/>
-<box id="template-panePrivacy" hidden="true"><![CDATA[
+<html:template id="template-panePrivacy">
 <hbox id="browserPrivacyCategory"
       class="subcategory"
       hidden="true"
       data-category="panePrivacy">
   <html:h1 data-l10n-id="privacy-header"/>
 </hbox>
 
 <!-- Tracking / Content Blocking -->
@@ -931,9 +931,9 @@
                   devmgr-button-changepw.label,
                   devmgr-button-load.label,
                   devmgr-button-unload.label
                 "/>
       </hbox>
     </vbox>
   </hbox>
 </groupbox>
-]]></box>
+</html:template>
diff --git a/browser/components/preferences/in-content/search.xul b/browser/components/preferences/in-content/search.xul
--- a/browser/components/preferences/in-content/search.xul
+++ b/browser/components/preferences/in-content/search.xul
@@ -1,11 +1,11 @@
     <script type="application/javascript"
             src="chrome://browser/content/preferences/in-content/search.js"/>
-    <box id="template-paneSearch" hidden="true"><![CDATA[
+    <html:template id="template-paneSearch">
     <hbox id="searchCategory"
           class="subcategory"
           hidden="true"
           data-category="paneSearch">
       <html:h1 data-l10n-id="pane-search-title"/>
     </hbox>
 
     <groupbox id="searchbarGroup" data-category="paneSearch" hidden="true">
@@ -76,9 +76,9 @@
                 data-l10n-id="search-remove-engine"
                 disabled="true"
                 />
       </hbox>
       <hbox id="addEnginesBox" pack="start">
         <label id="addEngines" data-l10n-id="search-find-more-link" is="text-link"></label>
       </hbox>
     </groupbox>
-    ]]></box>
+    </html:template>
diff --git a/browser/components/preferences/in-content/sync.xul b/browser/components/preferences/in-content/sync.xul
--- a/browser/components/preferences/in-content/sync.xul
+++ b/browser/components/preferences/in-content/sync.xul
@@ -1,17 +1,17 @@
 # This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 <!-- Sync panel -->
 
 <script type="application/javascript"
         src="chrome://browser/content/preferences/in-content/sync.js"/>
-<box id="template-paneSync" hidden="true"><![CDATA[
+<html:template id="template-paneSync">
 <hbox id="firefoxAccountCategory"
       class="subcategory"
       hidden="true"
       data-category="paneSync">
   <html:h1 data-l10n-id="pane-sync-title2"/>
 </hbox>
 
 <deck id="weavePrefsDeck" data-category="paneSync" hidden="true"
@@ -191,9 +191,9 @@
              class="fxaMobilePromo" data-l10n-id="sync-manage-devices"/>
     </vbox>
     <vbox id="tosPP-small" align="start">
       <label id="tosPP-small-ToS" is="text-link" data-l10n-id="sync-tos-link"/>
       <label id="tosPP-small-PP" is="text-link" data-l10n-id="sync-fxa-privacy-notice"/>
     </vbox>
   </vbox>
 </deck>
-]]></box>
+</html:template>
