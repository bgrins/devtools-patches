# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  cd1d4ba702c706a003b839eb24b6dda6227a9e1d
Bug 1175239 - Replace tracking protection drop-down control with a button;r=MattN

diff --git a/browser/base/content/browser-trackingprotection.js b/browser/base/content/browser-trackingprotection.js
--- a/browser/base/content/browser-trackingprotection.js
+++ b/browser/base/content/browser-trackingprotection.js
@@ -17,17 +17,16 @@ let TrackingProtection = {
 
     let $ = selector => document.querySelector(selector);
     this.container = $("#tracking-protection-container");
     this.unblockButton = $("#tracking-action-unblock");
     this.blockButton = $("#tracking-action-block");
     this.labelTrackingBlocked = $("#tracking-blocked");
     this.labelTrackingLoaded = $("#tracking-loaded");
     this.labelNoTracking = $("#tracking-not-detected");
-    this.actions = $("#tracking-actions");
 
     this.resetUI();
   },
 
   getTelemetryHistogram: function() {
     return Services.telemetry.getHistogramById("TRACKING_PROTECTION_EVENTS");
   },
 
@@ -64,38 +63,35 @@ let TrackingProtection = {
 
   resetUI: function() {
     this.container.hidden = !this.enabled;
     this.container.removeAttribute("block-disabled");
     this.blockButton.hidden = true;
     this.unblockButton.hidden = true;
     this.labelTrackingBlocked.hidden = true;
     this.labelTrackingLoaded.hidden = true;
-    this.actions.hidden = true;
     this.labelNoTracking.hidden = true;
   },
 
   updateUI: function() {
     // Hide everything and then unhide any relevant controls.
     this.resetUI();
     if (!this.enabled) {
       return;
     }
 
     if (this.isTrackingBlocked) {
       this.unblockButton.hidden = false;
       this.labelTrackingBlocked.hidden = false;
-      this.actions.hidden = false;
     }
 
     if (this.isTrackingLoaded) {
       this.container.setAttribute("block-disabled", true);
       this.labelTrackingLoaded.hidden = false;
       this.blockButton.hidden = false;
-      this.actions.hidden = false;
     }
 
     if (this.isNoTracking) {
       this.labelNoTracking.hidden = false;
     }
   },
 
   disableForCurrentPage: function() {
diff --git a/browser/components/controlcenter/content/panel.inc.xul b/browser/components/controlcenter/content/panel.inc.xul
--- a/browser/components/controlcenter/content/panel.inc.xul
+++ b/browser/components/controlcenter/content/panel.inc.xul
@@ -97,32 +97,47 @@
           &trackingProtection.detectedNotBlocked;
         </label>
         <label id="tracking-not-detected"
                class="tracking-protection-label"
                crop="end">
           &trackingProtection.notDetected;
         </label>
 
+        <button
+          label="&trackingProtection.unblock.label;"
+          accesskey="&trackingProtection.unblock.accesskey;"
+          id="tracking-action-unblock"
+          hidden="true"
+          oncommand="TrackingProtection.disableForCurrentPage();"
+        />
+        <button
+          label="&trackingProtection.block.label;"
+          accesskey="&trackingProtection.block.accesskey;"
+          id="tracking-action-block"
+          hidden="true"
+          oncommand="TrackingProtection.enableForCurrentPage();"
+        />
+        <!--
         <button id="tracking-actions"
           type="menu" label="&trackingContentBlocked.options;"
           sizetopopup="none">
           <menupopup>
             <menuitem
               id="tracking-action-unblock"
               label="&trackingProtection.unblock.label;"
               accesskey="&trackingProtection.unblock.accesskey;"
               oncommand="TrackingProtection.disableForCurrentPage();"/>
             <menuitem
               id="tracking-action-block"
               label="&trackingProtection.block.label;"
               accesskey="&trackingProtection.block.accesskey;"
               oncommand="TrackingProtection.enableForCurrentPage();"/>
           </menupopup>
-        </button>
+        </button> -->
       </vbox>
     </hbox>
   </hbox>
 
   <!-- More Information Button -->
   <hbox id="identity-popup-button-container" flex="1" align="center">
     <button id="identity-popup-more-info-button" flex="1"
             label="&identity.moreInfoLinkText2;"
diff --git a/browser/locales/en-US/chrome/browser/browser.dtd b/browser/locales/en-US/chrome/browser/browser.dtd
--- a/browser/locales/en-US/chrome/browser/browser.dtd
+++ b/browser/locales/en-US/chrome/browser/browser.dtd
@@ -769,27 +769,27 @@ you can use these alternative items. Oth
 <!ENTITY mixedContentBlocked2.disabled.message "Protection is disabled">
 
 <!ENTITY trackingProtection.title "Tracking Protection">
 <!ENTITY trackingProtection.detectedBlocked "Attempts to track your online behavior have been blocked.">
 <!ENTITY trackingProtection.detectedNotBlocked "Tracking elements detected.  You have disabled protection on this site.">
 <!ENTITY trackingProtection.notDetected "No tracking elements detected on this website.">
 <!ENTITY trackingProtection.unblock.label "Disable protection for this site">
 <!ENTITY trackingProtection.unblock.accesskey "D">
-<!ENTITY trackingProtection.block.label "Enable protection">
+<!ENTITY trackingProtection.block.label "Enable protection for this site">
 <!ENTITY trackingProtection.block.accesskey "E">
 
 <!ENTITY trackingContentBlocked.message "Tracking">
 <!ENTITY trackingContentBlocked.moreinfo "Parts of the page that track your online activity have been blocked.">
 <!ENTITY trackingContentBlocked.learnMore "Learn More">
 <!ENTITY trackingContentBlocked.options "Options">
 
 <!ENTITY trackingContentBlocked.unblock2.label "Disable protection for this site">
 <!ENTITY trackingContentBlocked.unblock2.accesskey "D">
-<!ENTITY trackingContentBlocked.block.label "Enable protection">
+<!ENTITY trackingContentBlocked.block.label "Enable protection for this site">
 <!ENTITY trackingContentBlocked.block.accesskey "E">
 <!ENTITY trackingContentBlocked.disabled.message "Tracking protection is disabled">
 
 
 <!ENTITY pointerLock.notification.message "Press ESC at any time to show it again.">
 
 <!ENTITY pluginNotification.showAll.label "Show All">
 <!ENTITY pluginNotification.showAll.accesskey "S">
diff --git a/browser/themes/shared/controlcenter/panel.inc.css b/browser/themes/shared/controlcenter/panel.inc.css
--- a/browser/themes/shared/controlcenter/panel.inc.css
+++ b/browser/themes/shared/controlcenter/panel.inc.css
@@ -270,8 +270,32 @@
   width: 64px;
   padding: 0;
   list-style-image: url("chrome://browser/skin/controlcenter/tracking-protection.svg");
 }
 
 #tracking-protection-container[block-disabled] #tracking-protection-image  {
   list-style-image: url("chrome://browser/skin/controlcenter/tracking-protection-disabled.svg");
 }
+
+/* Tracking protection buttons */
+/* XXX: This is copy/pasted from in-content prefs.. there's probably
+   a better button template to use */
+#tracking-protection-content-box {
+  --button-text-color: #333;
+  --button-background: #fbfbfb;
+  --button-border-color: #c1c1c1;
+}
+
+#tracking-protection-content-box > button {
+  -moz-appearance: none;
+  margin: 5px 0;
+  height: 30px;
+  color: var(--button-text-color);
+  line-height: 20px;
+  border: 1px solid var(--button-border-color);
+  -moz-border-top-colors: none !important;
+  -moz-border-right-colors: none !important;
+  -moz-border-bottom-colors: none !important;
+  -moz-border-left-colors: none !important;
+  border-radius: 2px;
+  background-color: var(--button-background);
+}
