# HG changeset patch
# Parent ba950fd70899e5a6beec51e47ae2b4d8e5d47756
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 1044258 - Increase devtools floating scrollbar size;r=paul

diff --git a/browser/devtools/main.js b/browser/devtools/main.js
--- a/browser/devtools/main.js
+++ b/browser/devtools/main.js
@@ -409,17 +409,18 @@ exports.defaultTools = defaultTools;
 for (let definition of defaultTools) {
   gDevTools.registerTool(definition);
 }
 
 Tools.darkTheme = {
   id: "dark",
   label: l10n("options.darkTheme.label", toolboxStrings),
   ordinal: 1,
-  stylesheets: ["chrome://browser/skin/devtools/dark-theme.css"],
+  stylesheets: ["chrome://browser/skin/devtools/dark-theme.css",
+                "chrome://browser/skin/devtools/floating-scrollbars-light.css"],
   classList: ["theme-dark"],
 };
 
 Tools.lightTheme = {
   id: "light",
   label: l10n("options.lightTheme.label", toolboxStrings),
   ordinal: 2,
   stylesheets: ["chrome://browser/skin/devtools/light-theme.css"],
diff --git a/browser/devtools/markupview/markup-view.css b/browser/devtools/markupview/markup-view.css
--- a/browser/devtools/markupview/markup-view.css
+++ b/browser/devtools/markupview/markup-view.css
@@ -33,17 +33,17 @@
   padding-left: 1000em;
 }
 
 .html-editor-inner {
   border: solid .1px;
   flex: 1 1 main-size;
 
   /* Keep the editor away from the markup view floating scrollbars */
-  -moz-margin-end: 12px;
+  -moz-margin-end: 14px;
 }
 
 .html-editor iframe {
   height: 100%;
   width: 100%;
   border: none;
   margin: 0;
   padding: 0;
diff --git a/browser/devtools/shared/theme-switching.js b/browser/devtools/shared/theme-switching.js
--- a/browser/devtools/shared/theme-switching.js
+++ b/browser/devtools/shared/theme-switching.js
@@ -1,81 +1,66 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 (function() {
-  const DEVTOOLS_SKIN_URL = "chrome://browser/skin/devtools/";
+  const FLOATING_SCROLLBARS_URL = "chrome://browser/skin/devtools/floating-scrollbars-light.css";
   let documentElement = document.documentElement;
 
+
   function forceStyle() {
-    let computedStyle = window.getComputedStyle(documentElement);
-    if (!computedStyle) {
-      // Null when documentElement is not ready. This method is anyways not
-      // required then as scrollbars would be in their state without flushing.
-      return;
-    }
-    let display = computedStyle.display; // Save display value
-    documentElement.style.display = "none";
-    window.getComputedStyle(documentElement).display; // Flush
-    documentElement.style.display = display; // Restore
-  }
+     let computedStyle = window.getComputedStyle(documentElement);
+     if (!computedStyle) {
+       // Null when documentElement is not ready. This method is anyways not
+       // required then as scrollbars would be in their state without flushing.
+       return;
+     }
+     let display = computedStyle.display; // Save display value
+     documentElement.style.display = "none";
+     window.getComputedStyle(documentElement).display; // Flush
+     documentElement.style.display = display; // Restore
+   }
 
   function switchTheme(newTheme, oldTheme) {
     if (newTheme === oldTheme) {
       return;
     }
 
     let oldThemeDef = gDevTools.getThemeDefinition(oldTheme);
     let newThemeDef = gDevTools.getThemeDefinition(newTheme);
 
     // Unload all theme stylesheets related to the old theme.
     if (oldThemeDef) {
       for (let url of oldThemeDef.stylesheets) {
-        StylesheetUtils.removeSheet(window, url, "author");
+        if (url === FLOATING_SCROLLBARS_URL) {
+          StylesheetUtils.removeSheet(window, url, "agent");
+          forceStyle();
+        } else {
+          StylesheetUtils.removeSheet(window, url, "author");
+        }
       }
     }
 
     // Load all stylesheets associated with the new theme.
     let newThemeDef = gDevTools.getThemeDefinition(newTheme);
 
     // The theme might not be available anymore (e.g. uninstalled)
     // Use the default one.
     if (!newThemeDef) {
       newThemeDef = gDevTools.getThemeDefinition("light");
     }
 
     for (let url of newThemeDef.stylesheets) {
-      StylesheetUtils.loadSheet(window, url, "author");
-    }
-
-    // Floating scroll-bars like in OSX
-    let hiddenDOMWindow = Cc["@mozilla.org/appshell/appShellService;1"]
-                 .getService(Ci.nsIAppShellService)
-                 .hiddenDOMWindow;
-
-    // TODO: extensions might want to customize scrollbar styles too.
-    if (!hiddenDOMWindow.matchMedia("(-moz-overlay-scrollbars)").matches) {
-      let scrollbarsUrl = Services.io.newURI(
-        DEVTOOLS_SKIN_URL + "floating-scrollbars-light.css", null, null);
-
-      if (newTheme == "dark") {
-        StylesheetUtils.loadSheet(
-          window,
-          scrollbarsUrl,
-          "agent"
-        );
-      } else if (oldTheme == "dark") {
-        StylesheetUtils.removeSheet(
-          window,
-          scrollbarsUrl,
-          "agent"
-        );
+      if (url === FLOATING_SCROLLBARS_URL) {
+        StylesheetUtils.loadSheet(window, url, "agent");
+        forceStyle();
+      } else {
+        StylesheetUtils.loadSheet(window, url, "author");
       }
-      forceStyle();
     }
 
     if (oldThemeDef) {
       for (let name of oldThemeDef.classList) {
         documentElement.classList.remove(name);
       }
 
       if (oldThemeDef.onUnapply) {
diff --git a/browser/themes/linux/devtools/floating-scrollbars-light.css b/browser/themes/linux/devtools/floating-scrollbars-light.css
--- a/browser/themes/linux/devtools/floating-scrollbars-light.css
+++ b/browser/themes/linux/devtools/floating-scrollbars-light.css
@@ -1,10 +1,12 @@
 /* vim:set ts=2 sw=2 sts=2 et: */
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 @import url("floating-scrollbars.css");
 
-scrollbar thumb {
-  background-color: rgba(170,170,170,0.2) !important;
+@media all and (-moz-overlay-scrollbars) {
+  scrollbar thumb {
+    background-color: rgba(170,170,170,0.2) !important;
+  }
 }
diff --git a/browser/themes/linux/devtools/floating-scrollbars.css b/browser/themes/linux/devtools/floating-scrollbars.css
--- a/browser/themes/linux/devtools/floating-scrollbars.css
+++ b/browser/themes/linux/devtools/floating-scrollbars.css
@@ -1,33 +1,35 @@
 @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
 
+@media all and (-moz-overlay-scrollbars) {
 scrollbar {
   -moz-appearance: none !important;
   position: relative;
   background-color: transparent;
   background-image: none;
   z-index: 2147483647;
   padding: 2px;
 }
 
 scrollbar[orient="vertical"] {
-  -moz-margin-start: -10px;
-  min-width: 10px;
-  max-width: 10px;
+  -moz-margin-start: -12px;
+  min-width: 12px;
+  max-width: 12px;
 }
 
 scrollbar[orient="horizontal"] {
-  margin-top: -10px;
-  min-height: 10px;
-  max-height: 10px;
+  margin-top: -12px;
+  min-height: 12px;
+  max-height: 12px;
 }
 
 scrollbar thumb {
   -moz-appearance: none !important;
   border-width: 0px !important;
   background-color: rgba(170,170,170,0.2) !important;
   border-radius: 3px !important;
 }
 
 scrollbar scrollbarbutton, scrollbar gripper {
   display: none;
 }
+}
diff --git a/browser/themes/osx/devtools/floating-scrollbars-light.css b/browser/themes/osx/devtools/floating-scrollbars-light.css
--- a/browser/themes/osx/devtools/floating-scrollbars-light.css
+++ b/browser/themes/osx/devtools/floating-scrollbars-light.css
@@ -1,10 +1,12 @@
 /* vim:set ts=2 sw=2 sts=2 et: */
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 @import url("floating-scrollbars.css");
 
-scrollbar thumb {
-  background-color: rgba(170,170,170,0.2) !important;
+@media all and (-moz-overlay-scrollbars) {
+  scrollbar thumb {
+    background-color: rgba(170,170,170,0.2) !important;
+  }
 }
diff --git a/browser/themes/osx/devtools/floating-scrollbars.css b/browser/themes/osx/devtools/floating-scrollbars.css
--- a/browser/themes/osx/devtools/floating-scrollbars.css
+++ b/browser/themes/osx/devtools/floating-scrollbars.css
@@ -1,33 +1,44 @@
 @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
+@namespace html url("http://www.w3.org/1999/xhtml");
 
+@media all and (-moz-overlay-scrollbars) {
 scrollbar {
   -moz-appearance: none;
   position: relative;
   background-color: transparent;
   background-image: none;
   border: 0px solid transparent;
   z-index: 2147483647;
   padding: 2px;
+  background: red; /* XXX */
 }
 
 scrollbar[orient="vertical"] {
-  -moz-margin-start: -8px;
-  min-width: 8px;
-  max-width: 8px;
+  -moz-margin-start: -10px;
+  min-width: 10px;
+  max-width: 10px;
+
+  /* XXX: These sizes are not respected on HTML pages like markup view and style inspector,
+     but are on xul pages like the sources list in the debugger: */
+  -moz-margin-start: -5px;
+  min-width: 5px;
+  max-width: 5px;
 }
 
 scrollbar[orient="horizontal"] {
-  margin-top: -8px;
-  min-height: 8px;
-  max-height: 8px;
+  margin-top: -10px;
+  min-height: 10px;
+  max-height: 10px;
 }
 
 slider {
   -moz-appearance: none !important;
+  background-color: green; /* XXX */
 }
 
 thumb {
   -moz-appearance: none !important;
   background-color: rgba(0,0,0,0.2);
   border-radius: 3px;
 }
+}
\ No newline at end of file
diff --git a/browser/themes/windows/devtools/floating-scrollbars-light.css b/browser/themes/windows/devtools/floating-scrollbars-light.css
--- a/browser/themes/windows/devtools/floating-scrollbars-light.css
+++ b/browser/themes/windows/devtools/floating-scrollbars-light.css
@@ -1,10 +1,12 @@
 /* vim:set ts=2 sw=2 sts=2 et: */
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 @import url("floating-scrollbars.css");
 
-scrollbar thumb {
-  background-color: rgba(170,170,170,0.2) !important;
+@media all and (-moz-overlay-scrollbars) {
+  scrollbar thumb {
+    background-color: rgba(170,170,170,0.2) !important;
+  }
 }
diff --git a/browser/themes/windows/devtools/floating-scrollbars.css b/browser/themes/windows/devtools/floating-scrollbars.css
--- a/browser/themes/windows/devtools/floating-scrollbars.css
+++ b/browser/themes/windows/devtools/floating-scrollbars.css
@@ -1,33 +1,35 @@
 @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
 
+@media all and (-moz-overlay-scrollbars) {
 scrollbar {
   -moz-appearance: none !important;
   position: relative;
   background-color: transparent;
   background-image: none;
   z-index: 2147483647;
   padding: 2px;
 }
 
 scrollbar[orient="vertical"] {
-  -moz-margin-start: -10px;
-  min-width: 10px;
-  max-width: 10px;
+  -moz-margin-start: -12px;
+  min-width: 12px;
+  max-width: 12px;
 }
 
 scrollbar[orient="horizontal"] {
-  margin-top: -10px;
-  min-height: 10px;
-  max-height: 10px;
+  margin-top: -12px;
+  min-height: 12px;
+  max-height: 12px;
 }
 
 scrollbar thumb {
   -moz-appearance: none !important;
   border-width: 0px !important;
   background-color: rgba(170,170,170,0.2) !important;
   border-radius: 3px !important;
 }
 
 scrollbar scrollbarbutton, scrollbar gripper {
   display: none;
 }
+}
\ No newline at end of file
