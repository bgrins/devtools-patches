# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  e995e42082ee5432935c3db1d5e1bc502d8c20ec

diff --git a/devtools/client/netmonitor/moz.build b/devtools/client/netmonitor/moz.build
--- a/devtools/client/netmonitor/moz.build
+++ b/devtools/client/netmonitor/moz.build
@@ -13,9 +13,8 @@ DevToolsModules(
 
 XPCSHELL_TESTS_MANIFESTS += ['test/xpcshell/xpcshell.ini']
 
 BROWSER_CHROME_MANIFESTS += ['test/browser.ini']
 
 with Files('**'):
     BUG_COMPONENT = ('DevTools', 'Netmonitor')
 
-SPHINX_TREES['/devtools/netmonitor'] = 'docs'
diff --git a/docs/code-quality/index.rst b/docs/code-quality/index.rst
--- a/docs/code-quality/index.rst
+++ b/docs/code-quality/index.rst
@@ -6,16 +6,17 @@ executed to identify issues at developme
 In this document, we try to list these all tools.
 
 
 .. toctree::
   :maxdepth: 1
   :glob:
 
   static-analysis.rst
+  testing-policy.rst
   lint/index.rst
   coding-style/index.rst
 
 .. list-table:: C/C++
    :header-rows: 1
    :widths: 20 20 20 20 20
 
    * - Tools
diff --git a/docs/config.yml b/docs/config.yml
--- a/docs/config.yml
+++ b/docs/config.yml
@@ -27,24 +27,26 @@ categories:
         - writing-rust-code
     build_doc:
         - mach
         - tools/try
         - build/buildsystem
         - taskcluster
         - tools/moztreedocs
     testing_doc:
+        - testing/testing-policy
         - testing/marionette
         - testing/geckodriver
+        - testing/
         - web-platform
         - tools/fuzzing
+        - testing-rust-code
         - tools/sanitizer
         - testing/perfdocs
         - tools/code-coverage
-        - testing-rust-code
     l10n_doc:
         - intl
         - l10n
     python_doc:
         - mozbase
         - python
     fennec_doc:
         - mobile/android
diff --git a/moz.build b/moz.build
--- a/moz.build
+++ b/moz.build
@@ -187,16 +187,18 @@ else:
 OBJDIR_PP_FILES['.cargo'] += ['.cargo/config.in']
 
 DEFINES['top_srcdir'] = TOPSRCDIR
 
 SPHINX_TREES['contributing'] = 'docs/contributing'
 
 SPHINX_TREES['code-quality'] = 'docs/code-quality'
 
+#SPHINX_TREES['testing-policy'] = 'docs/testing-policy'
+
 SPHINX_TREES['testing-rust-code'] = 'docs/testing-rust-code'
 
 SPHINX_TREES['writing-rust-code'] = 'docs/writing-rust-code'
 
 SPHINX_TREES['bug-mgmt'] = 'docs/bug-mgmt'
 
 SPHINX_TREES['setup'] = 'docs/setup'
 
diff --git a/testing/docs/testing-policy/index.md b/testing/docs/testing-policy/index.md
new file mode 100644
--- /dev/null
+++ b/testing/docs/testing-policy/index.md
@@ -0,0 +1,21 @@
+# Firefox Testing Policy
+
+**Everything that lands in mozilla-central includes automated tests by default**. Every commit has tests that cover every major piece of functionality and expected input conditions. One of the following Project Tags must be applied in Phabricator before landing, at the discretion of the reviewer:
+
+* `testing-approved` if it has sufficient automated test coverage.
+* One of `testing-exception-*` if not. After speaking with many teams across the project we’ve identified the most common exceptions, which are detailed below.
+
+## Exceptions
+
+* **testing-exception-unchanged**: Commits that don’t change behavior for end users. For example:
+  * Refactors, mechanical changes, and deleting dead code as long as they aren’t meaningfully changing or removing any existing tests. Authors should consider checking for and adding missing test coverage in a separate commit before a refactor.
+  * Code that doesn’t ship to users (for example: documentation, build scripts and manifest files, mach commands). Effort should be made to test these when regressions are likely to cause bustage or confusion for developers, but it’s left to the discretion of the reviewer.
+* **testing-exception-ui**: Commits that change UI styling, images, or localized strings. While we have end-to-end automated tests that ensure the frontend isn’t totally broken, and screenshot-based tracking of changes over time, we currently rely only on manual testing and bug reports to surface style regressions.
+* **testing-exception-elsewhere**: Commits where tests exist but are somewhere else. This **requires a comment** from the reviewer explaining where the tests are. For example:
+  * In another commit in the Stack.
+  * In a followup bug.
+  * In an external repository for third party code.
+  * When following the [Security Bug Approval Process](https://firefox-source-docs.mozilla.org/bug-mgmt/processes/security-approval.html) tests are usually landed later, but should be written and reviewed at the same time as the commit.
+* **testing-exception-other**: Commits where none of the defined exceptions above apply but it should still be landed. This should be scrutinized by the reviewer before using it - consider whether an exception is actually required or if a test could be reasonably added before using it. This **requires a comment** from the reviewer explaining why it’s appropriate to land without tests. Some examples that have been identified include:
+  * Interacting with external hardware or software and our code is missing abstractions to mock the interaction out.
+  * Inability to reproduce a reported problem, so landing something to test a fix in Nightly.
diff --git a/testing/moz.build b/testing/moz.build
--- a/testing/moz.build
+++ b/testing/moz.build
@@ -2,8 +2,10 @@ with Files("**"):
     BUG_COMPONENT = ("Testing", "General")
 
 with Files("*cppunittest*"):
     BUG_COMPONENT = ("Testing", "CPPUnitTest")
     SCHEDULES.exclusive = ['cppunittest']
 
 with Files("remote*"):
     BUG_COMPONENT = ("GeckoView", "General")
+
+SPHINX_TREES['/testing/testing-policy'] = 'docs/testing-policy'
