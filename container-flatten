# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  c44f60c43432d468639b5fe078420e60c13fd3de
Bug 1420990 - Build the DOM for container items directly in containers.js instead of with XBL

diff --git a/browser/components/preferences/handlers.css b/browser/components/preferences/handlers.css
--- a/browser/components/preferences/handlers.css
+++ b/browser/components/preferences/handlers.css
@@ -1,20 +1,16 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 #handlersView > richlistitem {
   -moz-binding: url("chrome://browser/content/preferences/handlers.xml#handler");
 }
 
-#containersView > richlistitem {
-  -moz-binding: url("chrome://browser/content/preferences/handlers.xml#container");
-}
-
 /**
  * Make the icons appear.
  * Note: we display the icon box for every item whether or not it has an icon
  * so the labels of all the items align vertically.
  */
 .actionsMenu > menupopup > menuitem > .menu-iconic-left {
   display: -moz-box;
   min-width: 16px;
diff --git a/browser/components/preferences/handlers.xml b/browser/components/preferences/handlers.xml
--- a/browser/components/preferences/handlers.xml
+++ b/browser/components/preferences/handlers.xml
@@ -51,30 +51,16 @@
                         oncommand="gMainPane.onSelectAction(event.originalTarget)">
             <xul:menupopup/>
           </xul:menulist>
         </xul:hbox>
       </xul:hbox>
     </content>
   </binding>
 
-  <binding id="container">
-    <content>
-      <xul:hbox flex="1" equalsize="always">
-        <xul:hbox flex="1" align="center">
-          <xul:hbox xbl:inherits="data-identity-icon=containerIcon,data-identity-color=containerColor" height="24" width="24" class="userContext-icon"/>
-          <xul:label flex="1" crop="end" xbl:inherits="xbl:text=containerName,highlightable"/>
-        </xul:hbox>
-        <xul:hbox flex="1" align="right">
-          <children />
-        </xul:hbox>
-      </xul:hbox>
-    </content>
-  </binding>
-
   <binding id="offlineapp"
 	   extends="chrome://global/content/bindings/listbox.xml#listitem">
     <content>
       <children>
 	<xul:listcell xbl:inherits="label=origin"/>
 	<xul:listcell xbl:inherits="label=usage"/>
       </children>
     </content>
diff --git a/browser/components/preferences/in-content/containers.js b/browser/components/preferences/in-content/containers.js
--- a/browser/components/preferences/in-content/containers.js
+++ b/browser/components/preferences/in-content/containers.js
@@ -26,20 +26,44 @@ let gContainersPane = {
 
   _rebuildView() {
     const containers = ContextualIdentityService.getPublicIdentities();
     while (this._list.firstChild) {
       this._list.firstChild.remove();
     }
     for (let container of containers) {
       let item = document.createElement("richlistitem");
-      item.setAttribute("containerName", ContextualIdentityService.getUserContextLabel(container.userContextId));
-      item.setAttribute("containerIcon", container.icon);
-      item.setAttribute("containerColor", container.color);
-      item.setAttribute("userContextId", container.userContextId);
+      let userContextId = container.userContextId;
+
+      item.innerHTML = `
+      <hbox flex="1" equalsize="always">
+        <hbox flex="1" align="center">
+          <hbox height="24" width="24" class="userContext-icon"/>
+          <label flex="1" crop="end" class="userContext-label"/>
+        </hbox>
+        <hbox flex="1" align="right" class="container-buttons"></hbox>
+      </hbox>`;
+
+      item.querySelector(".userContext-icon").setAttribute("data-identity-icon", container.icon);
+      item.querySelector(".userContext-icon").setAttribute("data-identity-color", container.color);
+      item.querySelector(".userContext-label").setAttribute("value", ContextualIdentityService.getUserContextLabel(userContextId));
+
+      let preferencesButton = document.createElement("button");
+      preferencesButton.setAttribute("label", "&preferencesButton.label;"); // Change this string
+      preferencesButton.setAttribute("value", userContextId);
+      preferencesButton.setAttribute("oncommand",
+        "gContainersPane.onPreferenceCommand(event.originalTarget)");
+      item.querySelector(".container-buttons").appendChild(preferencesButton);
+
+      let removeButton = document.createElement("button");
+      removeButton.setAttribute("label", "&removeButton.label;"); // Change this string
+      removeButton.setAttribute("value", userContextId);
+      removeButton.setAttribute("oncommand",
+        "gContainersPane.onRemoveCommand(event.originalTarget)");
+      item.querySelector(".container-buttons").appendChild(removeButton);
 
       let prefsButton = document.createElement("button");
       prefsButton.setAttribute("oncommand", "gContainersPane.onPreferenceCommand(event.originalTarget)");
       prefsButton.setAttribute("value", container.userContextId);
       document.l10n.setAttributes(prefsButton, "containers-preferences-button");
       item.appendChild(prefsButton);
 
       let removeButton = document.createElement("button");
