# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  eba503d31cb127957aaba09c9f1b8a7006e816c5
Bug 1307881 - Part 2 - Provide a UI within the Web Console for managing persistence

MozReview-Commit-ID: GVkOms1o74c

diff --git a/devtools/client/locales/en-US/webconsole.properties b/devtools/client/locales/en-US/webconsole.properties
--- a/devtools/client/locales/en-US/webconsole.properties
+++ b/devtools/client/locales/en-US/webconsole.properties
@@ -304,8 +304,13 @@ webconsole.requestsFilterButton.label=Re
 # This is a semi-colon list of plural forms.
 # See: http://developer.mozilla.org/en/docs/Localization_and_Plurals
 # example: 345 items hidden by filters.
 webconsole.filteredMessages.label=#1 item hidden by filters;#1 items hidden by filters
 
 # Label used as the text of the "Reset filters" button in the "filtered messages" bar.
 # It resets the default filters of the console to their original values.
 webconsole.resetFiltersButton.label=Reset filters
+
+# LOCALIZATION NOTE (webconsole.enablePersistentLogs.label)
+webconsole.enablePersistentLogs.label=Persist Logs
+# LOCALIZATION NOTE (webconsole.enablePersistentLogs.tooltip)
+webconsole.enablePersistentLogs.tooltip=If you enable this option the output will not be cleared each time you navigate to a new page
diff --git a/devtools/client/webconsole/new-console-output/components/filter-bar.js b/devtools/client/webconsole/new-console-output/components/filter-bar.js
--- a/devtools/client/webconsole/new-console-output/components/filter-bar.js
+++ b/devtools/client/webconsole/new-console-output/components/filter-bar.js
@@ -21,16 +21,17 @@ const {
 const { l10n } = require("devtools/client/webconsole/new-console-output/utils/messages");
 const { PluralForm } = require("devtools/shared/plural-form");
 const {
   DEFAULT_FILTERS,
   FILTERS,
 } = require("../constants");
 
 const FilterButton = require("devtools/client/webconsole/new-console-output/components/filter-button");
+const FilterCheckbox = require("devtools/client/webconsole/new-console-output/components/filter-checkbox");
 
 const FilterBar = createClass({
 
   displayName: "FilterBar",
 
   propTypes: {
     dispatch: PropTypes.func.isRequired,
     filter: PropTypes.object.isRequired,
@@ -155,16 +156,25 @@ const FilterBar = createClass({
         filterKey: FILTERS.NETXHR,
         dispatch
       }),
       FilterButton({
         active: filter[FILTERS.NET],
         label: l10n.getStr("webconsole.requestsFilterButton.label"),
         filterKey: FILTERS.NET,
         dispatch
+      }),
+      dom.span({
+        className: "devtools-separator",
+      }),
+      FilterCheckbox({
+        label: l10n.getStr("webconsole.enablePersistentLogs.label"),
+        title: l10n.getStr("webconsole.enablePersistentLogs.tooltip"),
+        pref: "devtools.webconsole.persistlog",
+        checked: true,
       })
     );
   },
 
   renderFilteredMessagesBar() {
     const {
       filteredMessagesCount
     } = this.props;
diff --git a/devtools/client/webconsole/new-console-output/components/filter-checkbox.js b/devtools/client/webconsole/new-console-output/components/filter-checkbox.js
new file mode 100644
--- /dev/null
+++ b/devtools/client/webconsole/new-console-output/components/filter-checkbox.js
@@ -0,0 +1,32 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+"use strict";
+
+const {
+  DOM: dom,
+  PropTypes
+} = require("devtools/client/shared/vendor/react");
+const actions = require("devtools/client/webconsole/new-console-output/actions/index");
+
+FilterCheckbox.displayName = "FilterCheckbox";
+
+FilterCheckbox.propTypes = {
+  label: PropTypes.string.isRequired,
+  title: PropTypes.string,
+  checked: PropTypes.bool.isRequired,
+  dispatch: PropTypes.func.isRequired,
+};
+
+function FilterCheckbox(props) {
+  const {checked, label, title, dispatch} = props;
+  return dom.label({ title }, dom.input({
+    type: "checkbox",
+    checked,
+    onClick: () => {
+      dispatch(actions.filterToggle(filterKey));
+    },
+  }), label);
+}
+
+module.exports = FilterCheckbox;
diff --git a/devtools/client/webconsole/new-console-output/components/moz.build b/devtools/client/webconsole/new-console-output/components/moz.build
--- a/devtools/client/webconsole/new-console-output/components/moz.build
+++ b/devtools/client/webconsole/new-console-output/components/moz.build
@@ -8,15 +8,16 @@ DIRS += [
 ]
 
 DevToolsModules(
     'collapse-button.js',
     'console-output.js',
     'console-table.js',
     'filter-bar.js',
     'filter-button.js',
+    'filter-checkbox.js',
     'grip-message-body.js',
     'message-container.js',
     'message-icon.js',
     'message-indent.js',
     'message-repeat.js',
     'message.js'
 )
