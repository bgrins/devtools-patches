# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  9f55d547e196a6945636405c2b33afc87dd501ee
Bug 1608278 - Declare clearTimeout and clearInterval as locally scoped variables in Timer.jsm

We need to stop relying on the global `this` in order to support ES Modules.
This instance was harder to fix by a script than others since it exposed two methods,
so this patch is a manual change.

diff --git a/toolkit/modules/Timer.jsm b/toolkit/modules/Timer.jsm
--- a/toolkit/modules/Timer.jsm
+++ b/toolkit/modules/Timer.jsm
@@ -101,22 +101,24 @@ function setIntervalWithTarget(aCallback
     aCallback,
     aMilliseconds,
     true,
     aTarget,
     aArgs
   );
 }
 
-var clearInterval = (this.clearTimeout = function clearTimeout(aId) {
+function clear(aId) {
   if (gTimerTable.has(aId)) {
     gTimerTable.get(aId).cancel();
     gTimerTable.delete(aId);
   }
-});
+}
+var clearInterval = clear;
+var clearTimeout = clear;
 
 function requestIdleCallback(aCallback, aOptions) {
   if (typeof aCallback !== "function") {
     throw new Error("callback is not a function in requestIdleCallback");
   }
   let id = gNextId++;
 
   let callback = (...aArgs) => {
