# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  5499649aa3a850d5aa5017de6586bd601819a025
Bug 1128747 - debug: wait for source editor to load before removing

diff --git a/browser/devtools/styleeditor/StyleEditorUI.jsm b/browser/devtools/styleeditor/StyleEditorUI.jsm
--- a/browser/devtools/styleeditor/StyleEditorUI.jsm
+++ b/browser/devtools/styleeditor/StyleEditorUI.jsm
@@ -272,24 +272,27 @@ StyleEditorUI.prototype = {
     let editor = this._addStyleSheetEditor(styleSheet);
 
     if (!Services.prefs.getBoolPref(PREF_ORIG_SOURCES)) {
       return;
     }
 
     styleSheet.getOriginalSources().then((sources) => {
       if (sources && sources.length) {
+      // Wait to make sure the editor is fully loaded before removing it.
+      editor.getSourceEditor().then(() => {
         this._removeStyleSheetEditor(editor);
         sources.forEach((source) => {
           // set so the first sheet will be selected, even if it's a source
           source.styleSheetIndex = styleSheet.styleSheetIndex;
           source.relatedStyleSheet = styleSheet;
 
           this._addStyleSheetEditor(source);
         });
+      });
       }
     }, Cu.reportError);
   },
 
   /**
    * Add a new editor to the UI for a source.
    *
    * @param {StyleSheet}  styleSheet
