# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  ad6eb073213ec8f94fd774b7957fb27e1d394187
Bug 1387125 - Allow for try push with benchmark

MozReview-Commit-ID: B8P0XEfnF5y

diff --git a/dom/base/test/chrome/chrome.ini b/dom/base/test/chrome/chrome.ini
--- a/dom/base/test/chrome/chrome.ini
+++ b/dom/base/test/chrome/chrome.ini
@@ -71,15 +71,14 @@ support-files = ../file_bug357450.js
 [test_range_getClientRectsAndTexts.html]
 [test_title.xul]
 support-files = file_title.xul
 [test_windowroot.xul]
 [test_swapFrameLoaders.xul]
 [test_groupedSHistory.xul]
 [test_bug1339722.html]
 [test_perf_xbl_vs_customelement.xul]
-skip-if = true # only run this when manually invoked
 support-files =
   file_perf_customelement.xul
   file_perf_customelement_definition.js
   file_perf_customelement_polyfill.js
   file_perf_xbl.xul
   file_perf_xbl_bindings.xml
diff --git a/dom/base/test/chrome/test_perf_xbl_vs_customelement.xul b/dom/base/test/chrome/test_perf_xbl_vs_customelement.xul
--- a/dom/base/test/chrome/test_perf_xbl_vs_customelement.xul
+++ b/dom/base/test/chrome/test_perf_xbl_vs_customelement.xul
@@ -25,16 +25,17 @@ https://bugzilla.mozilla.org/show_bug.cg
   window.NUM_ITERATIONS = 5;
 
   let xblWindow;
   let customElementWindow;
   let xblTimes;
   let customElementTimes;
 
   SimpleTest.waitForExplicitFinish();
+  SimpleTest.requestCompleteLog();  // so that "PERFHERDER_DATA" can be scraped from the log
 
   function startMeasure(label) {
     const startLabel = label + "start";
     performance.mark(startLabel);
     return {
       stop: (clear = true) => {
         performance.measure(label, startLabel);
         const entries = performance.getEntriesByName(label);
@@ -115,16 +116,30 @@ https://bugzilla.mozilla.org/show_bug.cg
   });
 
   async function done() {
     ok(true, "done");
 
     printTimes("XBL", xblTimes);
     printTimes("CUSTOM ELEMENTS", customElementTimes);
 
+// info(`PERFHERDER_DATA: {"framework": {"name": "xbl_vs_customelements"}, "suites": [
+//     {
+//     "name": "XBL",
+//     "value": ${xblTimes.median},
+//     "subtests": []
+//     },
+//     {
+//     "name": "Custom Elements",
+//     "value": ${customElementTimes.median},
+//     "subtests": []
+//     },
+//   ]
+// }`);
+
     let file = FileUtils.getFile("TmpD", [`test_perf_xbl_vs_customelement_${Date.now()}.json`]);
     // Use dumpProfileToFileAsync once https://bugzilla.mozilla.org/show_bug.cgi?id=1387155 is done
     await Services.profiler.dumpProfileToFileAsync(file.path);
     Services.profiler.StopProfiler();
 
 info(`
 
 SAVING PROFILE: ${file.path}
