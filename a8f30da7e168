
# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1524197340 25200
# Node ID a8f30da7e16818489669b2a02e727f87b7eff011
# Parent  9fa0ddcde999181e365131686145dadccede87fb
Bug 1411707 - Simplify WebIDE appManagerUpdate event handling

The WebIDE's appManagerUpdate function does some redundant work for
project, project-started, and project-stopped. There's no reason to
call updateCommands and autoOpenToolbox in project, since project-started
is about to be called after that and it will do the same thing.

When migrating iframe away from XBL and to Custom Elements, the order of
execution with the async function in the 'project' listener along with the
event handling on appManager changes slightly. This causes us to enter past
the `this.toolboxPromise` guard in createToolbox twice (once on 'project' and
once on 'project-started').

This patch cleans up the redundant code which means we only ever enter createToolbox once

MozReview-Commit-ID: EIQevdTkYET

diff --git a/devtools/client/webide/content/webide.js b/devtools/client/webide/content/webide.js
--- a/devtools/client/webide/content/webide.js
+++ b/devtools/client/webide/content/webide.js
@@ -135,20 +135,18 @@
         this.updateRuntimeButton();
         this.updateCommands();
         this.updateConnectionTelemetry();
         break;
       case "project":
         this._updatePromise = (async function() {
           UI.updateTitle();
           await UI.destroyToolbox();
-          UI.updateCommands();
           UI.openProject();
           await UI.autoStartProject();
-          UI.autoOpenToolbox();
           UI.saveLastSelectedProject();
           UI.updateRemoveProjectButton();
         })();
         return;
       case "project-started":
         this.updateCommands();
         UI.autoOpenToolbox();
         break;

