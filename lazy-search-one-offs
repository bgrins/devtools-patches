# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  1b1850c00529abe58fd6928a99155eca38eb9139

diff --git a/browser/base/content/global-scripts.inc b/browser/base/content/global-scripts.inc
--- a/browser/base/content/global-scripts.inc
+++ b/browser/base/content/global-scripts.inc
@@ -12,18 +12,16 @@
 xmlns="http://www.w3.org/1999/xhtml"
 #endif
 >
 Components.utils.import("resource://gre/modules/Services.jsm");
 
 for (let script of [
   "chrome://browser/content/browser.js",
   "chrome://browser/content/search/searchbar.js",
-  "chrome://browser/content/search/search-one-offs.js",
-
   "chrome://browser/content/browser-captivePortal.js",
   "chrome://browser/content/browser-compacttheme.js",
   "chrome://browser/content/browser-contentblocking.js",
   "chrome://browser/content/browser-media.js",
   "chrome://browser/content/browser-pageActions.js",
   "chrome://browser/content/browser-places.js",
   "chrome://browser/content/browser-plugins.js",
   "chrome://browser/content/browser-sidebar.js",
@@ -39,9 +37,14 @@ for (let script of [
   "chrome://browser/content/browser-data-submission-info-bar.js",
 #endif
 #ifndef MOZILLA_OFFICIAL
   "chrome://browser/content/browser-development-helpers.js",
 #endif
 ]) {
   Services.scriptloader.loadSubScript(script, this);
 }
+
+customElements.setElementCreationCallback("search-one-offs", () => {
+  Services.scriptloader.loadSubScript("chrome://browser/content/search/search-one-offs.js", window);
+});
+
 </script>
diff --git a/browser/base/content/urlbarBindings.xml b/browser/base/content/urlbarBindings.xml
--- a/browser/base/content/urlbarBindings.xml
+++ b/browser/base/content/urlbarBindings.xml
@@ -1881,16 +1881,21 @@ file, You can obtain one at http://mozil
                              compact="true"
                              includecurrentengine="true"
                              disabletab="true"
                              flex="1"/>
       </xul:hbox>
     </content>
 
     <implementation>
+
+      <constructor><![CDATA[
+      customElements.upgrade(this.oneOffSearchButtons);
+      ]]></constructor>
+
       <!--
         For performance reasons we want to limit the size of the text runs we
         build and show to the user.
       -->
       <field name="textRunsMaxLen">255</field>
 
       <field name="_maxResults">0</field>
 
diff --git a/browser/components/search/content/search.xml b/browser/components/search/content/search.xml
--- a/browser/components/search/content/search.xml
+++ b/browser/components/search/content/search.xml
@@ -375,16 +375,21 @@
         <xul:image class="searchbar-engine-image" xbl:inherits="src"/>
         <xul:label anonid="searchbar-engine-name" flex="1" crop="end"
                    role="presentation"/>
       </xul:hbox>
       <xul:richlistbox anonid="richlistbox" class="autocomplete-richlistbox search-panel-tree" flex="1"/>
       <xul:search-one-offs anonid="search-one-off-buttons" class="search-one-offs"/>
     </content>
     <implementation>
+
+      <constructor><![CDATA[
+      customElements.upgrade(this.oneOffButtons);
+      ]]></constructor>
+
       <method name="openAutocompletePopup">
         <parameter name="aInput"/>
         <parameter name="aElement"/>
         <body><![CDATA[
           // initially the panel is hidden
           // to avoid impacting startup / new window performance
           aInput.popup.hidden = false;
 
