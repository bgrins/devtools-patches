# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  55d4e4c2fe054c8ce448c8cfe77dfaf9766f14e2
Bug 1243963 - browser_console_error_source_click.js

diff --git a/devtools/client/webconsole/test/browser_console_error_source_click.js b/devtools/client/webconsole/test/browser_console_error_source_click.js
--- a/devtools/client/webconsole/test/browser_console_error_source_click.js
+++ b/devtools/client/webconsole/test/browser_console_error_source_click.js
@@ -17,22 +17,25 @@ function test() {
   loadTab(TEST_URI).then(() => {
     HUDService.toggleBrowserConsole().then(browserConsoleOpened);
   });
 
   function browserConsoleOpened(hudConsole) {
     hud = hudConsole;
     ok(hud, "browser console opened");
 
-    let button = content.document.querySelector("button");
-    ok(button, "button element found");
+    // On e10s, the exception is triggered in child process
+    // and is ignored by test harness
+    if (!Services.appinfo.browserTabsRemoteAutostart) {
+      expectUncaughtException();
+    }
 
     info("generate exception and wait for the message");
-    executeSoon(() => {
-      expectUncaughtException();
+    ContentTask.spawn(gBrowser.selectedBrowser, {}, function*() {
+      let button = content.document.querySelector("button");
       button.click();
     });
 
     waitForMessages({
       webconsole: hud,
       messages: [
         {
           text: "ReferenceError: foobar is not defined",
