# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  fd60d653b5945c0b2c0ef829034d85500c30457d
try: -b do -p linux,linux64,linux64-asan,linux64-st-an,linux64-valgrind,linux64-br-haz,macosx64,win32,win64,android-api-9,android-api-11,android-x86 -u all[Ubuntu,10.6,10.10,Windows XP,Windows 7,Windows 8,Android] -t all[Ubuntu,10.6,10.10,Windows XP,Windows 7,Windows 8,Android]

diff --git a/browser/base/content/test/general/browser_bug592338.js b/browser/base/content/test/general/browser_bug592338.js
--- a/browser/base/content/test/general/browser_bug592338.js
+++ b/browser/base/content/test/general/browser_bug592338.js
@@ -76,44 +76,49 @@ function test_install_lwtheme() {
 function test_lwtheme_switch_theme() {
   is(LightweightThemeManager.currentTheme, null, "Should be no lightweight theme selected");
 
   AddonManager.getAddonByID("theme-xpi@tests.mozilla.org", function(aAddon) {
     aAddon.userDisabled = false;
     ok(aAddon.isActive, "Theme should have immediately enabled");
     Services.prefs.setBoolPref("extensions.dss.enabled", false);
 
+    is (JSON.stringify(LightweightThemeManager.usedThemes), "foo2");
+    is (Services.prefs.prefHasUserValue("lightweightThemes.selectedThemeID"), "foo4", "Has user pref????");
+    is (Services.prefs.getCharPref("lightweightThemes.selectedThemeID"), "foo3");
+
     var pm = Services.perms;
     pm.add(makeURI("https://example.com/"), "install", pm.ALLOW_ACTION);
 
     gBrowser.selectedTab = gBrowser.addTab("https://example.com/browser/browser/base/content/test/general/bug592338.html");
     gBrowser.selectedBrowser.addEventListener("pageshow", function() {
       if (gBrowser.contentDocument.location.href == "about:blank")
         return;
 
       gBrowser.selectedBrowser.removeEventListener("pageshow", arguments.callee, false);
 
       executeSoon(function() {
         var link = gBrowser.contentDocument.getElementById("theme-install");
         wait_for_notification(function(aPanel) {
+          // is(LightweightThemeManager.currentTheme.id, "foo");
           is(LightweightThemeManager.currentTheme, null, "Should not have installed the test lwtheme");
           ok(aAddon.isActive, "Test theme should still be active");
 
           let notification = aPanel.childNodes[0];
           is(notification.button.label, "Restart Now", "Should have seen the right button");
 
           ok(aAddon.userDisabled, "Should be waiting to disable the test theme");
           aAddon.userDisabled = false;
           Services.prefs.setBoolPref("extensions.dss.enabled", true);
 
           gBrowser.removeTab(gBrowser.selectedTab);
 
           Services.perms.remove("example.com", "install");
 
-          runNextTest();
+          // runNextTest();
         });
         EventUtils.synthesizeMouse(link, 2, 2, {}, gBrowser.contentWindow);
       });
     }, false);
   });
 }
 ];
 
diff --git a/testing/profiles/prefs_general.js b/testing/profiles/prefs_general.js
--- a/testing/profiles/prefs_general.js
+++ b/testing/profiles/prefs_general.js
@@ -22,16 +22,21 @@ user_pref("dom.successive_dialog_time_li
 user_pref("signed.applets.codebase_principal_support", true);
 user_pref("browser.shell.checkDefaultBrowser", false);
 user_pref("shell.checkDefaultClient", false);
 user_pref("browser.warnOnQuit", false);
 user_pref("accessibility.typeaheadfind.autostart", false);
 user_pref("javascript.options.showInConsole", true);
 user_pref("devtools.browsertoolbox.panel", "jsdebugger");
 user_pref("devtools.errorconsole.enabled", true);
+
+user_pref("lightweightThemes.foobar", "BRIAN");
+user_pref("lightweightThemes.selectedThemeID", "BRIAN");
+user_pref("browser.devedition.theme.enabled", false);
+
 user_pref("devtools.debugger.remote-port", 6023);
 user_pref("layout.debug.enable_data_xbl", true);
 user_pref("browser.EULA.override", true);
 user_pref("gfx.color_management.force_srgb", true);
 user_pref("network.manage-offline-status", false);
 // Disable speculative connections so they aren't reported as leaking when they're hanging around.
 user_pref("network.http.speculative-parallel-limit", 0);
 user_pref("dom.min_background_timeout_value", 1000);
