# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  bc08f3773fb4fbe6e19e137111afb1f2b4f9c422
Bug 999299 - Style Editor interferes with next / prev tool bindings

diff --git a/browser/devtools/sourceeditor/editor.js b/browser/devtools/sourceeditor/editor.js
--- a/browser/devtools/sourceeditor/editor.js
+++ b/browser/devtools/sourceeditor/editor.js
@@ -164,21 +164,16 @@ function Editor(config) {
   };
 
   // Additional shortcuts.
   this.config.extraKeys[Editor.keyFor("jumpToLine")] = () => this.jumpToLine();
   this.config.extraKeys[Editor.keyFor("moveLineUp", { noaccel: true })] = () => this.moveLineUp();
   this.config.extraKeys[Editor.keyFor("moveLineDown", { noaccel: true })] = () => this.moveLineDown();
   this.config.extraKeys[Editor.keyFor("toggleComment")] = "toggleComment";
 
-  // Disable ctrl-[ and ctrl-] because toolbox uses those shortcuts.
-  this.config.extraKeys[Editor.keyFor("indentLess")] = false;
-  this.config.extraKeys[Editor.keyFor("indentMore")] = false;
-
-
   // Overwrite default config with user-provided, if needed.
   Object.keys(config).forEach((k) => {
     if (k != "extraKeys") {
       this.config[k] = config[k];
       return;
     }
 
     if (!config.extraKeys)
@@ -275,16 +270,18 @@ Editor.prototype = {
       scssSpec.valueKeywords = cssValues;
       win.CodeMirror.defineMIME("text/x-scss", scssSpec);
 
       win.CodeMirror.commands.save = () => this.emit("save");
 
       // Create a CodeMirror instance add support for context menus,
       // overwrite the default controller (otherwise items in the top and
       // context menus won't work).
+      win.CodeMirror.keyMap.pcDefault["Ctrl-["] = win.CodeMirror.keyMap.pcDefault["Ctrl-]"] = null;
+      win.CodeMirror.keyMap.macDefault["Cmd-["] = win.CodeMirror.keyMap.macDefault["Cmd-]"] = null;
 
       cm = win.CodeMirror(win.document.body, this.config);
       cm.getWrapperElement().addEventListener("contextmenu", (ev) => {
         ev.preventDefault();
         if (!this.config.contextMenu) return;
         let popup = this.config.contextMenu;
         if (typeof popup == "string")
           popup = el.ownerDocument.getElementById(this.config.contextMenu);
@@ -310,16 +307,25 @@ Editor.prototype = {
         if (ev.shiftKey) {
           cm.setSelection(head, tail);
           return;
         }
 
         this.emit("gutterClick", line, ev.button);
       });
 
+      // Add a keyMap on top of all others (including plugins).
+      // Anything here will always be called, regardless of it a plugin
+      // wants to handle it.
+      // let topKeyMap = {}
+      // // // ctrl-[ and ctrl-] should switch tools
+      // topKeyMap[Editor.keyFor("indentLess")] = cm=> {console.log("Stuff");};
+      // topKeyMap[Editor.keyFor("indentMore")] = false;
+      // cm.addKeyMap(topKeyMap);
+
       win.CodeMirror.defineExtension("l10n", (name) => {
         return L10N.GetStringFromName(name);
       });
 
       cm.getInputField().controllers.insertControllerAt(0, controller(this));
 
       this.container = env;
       editors.set(this, cm);
