# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1539715784 25200
#      Tue Oct 16 11:49:44 2018 -0700
# Node ID f8a8c733e1664ae3b80785e3bf57bbc53655c1a7
# Parent  31724aea10cae55f30b825ade226c4d25e11a899
Bug 1499428 - Remove display="xul:menu" on menulist and menulist-popuponly;r=emilio

Instead, set the NS_NewMenuFrame directly on menulist elements.

Differential Revision: https://phabricator.services.mozilla.com/D8897

diff --git a/layout/base/nsCSSFrameConstructor.cpp b/layout/base/nsCSSFrameConstructor.cpp
--- a/layout/base/nsCSSFrameConstructor.cpp
+++ b/layout/base/nsCSSFrameConstructor.cpp
@@ -4176,16 +4176,17 @@ nsCSSFrameConstructor::FindXULTagData(co
     SIMPLE_XUL_CREATE(spacer, NS_NewLeafBoxFrame),
     SIMPLE_XUL_CREATE(treechildren, NS_NewTreeBodyFrame),
     SIMPLE_XUL_CREATE(treecol, NS_NewTreeColFrame),
     SIMPLE_XUL_CREATE(text, NS_NewTextBoxFrame),
     SIMPLE_TAG_CHAIN(label, nsCSSFrameConstructor::FindXULLabelData),
     SIMPLE_TAG_CHAIN(description, nsCSSFrameConstructor::FindXULDescriptionData),
     SIMPLE_XUL_CREATE(menu, NS_NewMenuFrame),
     SIMPLE_XUL_CREATE(menubutton, NS_NewMenuFrame),
+    SIMPLE_XUL_CREATE(menulist, NS_NewMenuFrame),
     SIMPLE_XUL_CREATE(menuitem, NS_NewMenuItemFrame),
 #ifdef XP_MACOSX
     SIMPLE_TAG_CHAIN(menubar, nsCSSFrameConstructor::FindXULMenubarData),
 #else
     SIMPLE_XUL_CREATE(menubar, NS_NewMenuBarFrame),
 #endif /* XP_MACOSX */
     SIMPLE_TAG_CHAIN(popupgroup, nsCSSFrameConstructor::FindPopupGroupData),
     SIMPLE_XUL_CREATE(iframe, NS_NewSubDocumentFrame),
diff --git a/toolkit/content/widgets/menulist.xml b/toolkit/content/widgets/menulist.xml
--- a/toolkit/content/widgets/menulist.xml
+++ b/toolkit/content/widgets/menulist.xml
@@ -5,17 +5,17 @@
 
 
 <bindings id="menulistBindings"
    xmlns="http://www.mozilla.org/xbl"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:xbl="http://www.mozilla.org/xbl">
 
-  <binding id="menulist" display="xul:menu"
+  <binding id="menulist"
            extends="chrome://global/content/bindings/general.xml#basecontrol">
     <content sizetopopup="pref">
       <xul:hbox class="menulist-label-box" flex="1">
         <xul:image class="menulist-icon" xbl:inherits="src=image"/>
         <xul:label class="menulist-label" xbl:inherits="value=label,crop,accesskey,highlightable" crop="right" flex="1"/>
         <xul:label class="menulist-highlightable-label" xbl:inherits="xbl:text=label,crop,accesskey,highlightable" crop="right" flex="1"/>
       </xul:hbox>
       <xul:dropmarker class="menulist-dropmarker" type="menu" xbl:inherits="disabled,open"/>
@@ -327,15 +327,15 @@
           if (this.mAttributeObserver) {
             this.mAttributeObserver.disconnect();
           }
         ]]>
       </destructor>
     </implementation>
   </binding>
 
-  <binding id="menulist-popuponly" display="xul:menu"
+  <binding id="menulist-popuponly"
            extends="chrome://global/content/bindings/menulist.xml#menulist">
     <content sizetopopup="pref">
       <children includes="menupopup"/>
     </content>
   </binding>
 </bindings>
