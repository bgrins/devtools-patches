# HG changeset patch
# Parent b073a21b0c5a6ae17f02a4555f3c2af9efa86f8c
# User Patrick Brosset <pbrosset@mozilla.com>
Bug 1017115 - Fixes rule-view's highlight race condition to avoid duplicate headers


diff --git a/browser/devtools/styleinspector/rule-view.js b/browser/devtools/styleinspector/rule-view.js
--- a/browser/devtools/styleinspector/rule-view.js
+++ b/browser/devtools/styleinspector/rule-view.js
@@ -1449,21 +1449,23 @@ CssRuleView.prototype = {
       this._showEmpty();
       return promise.resolve(undefined);
     }
 
     this._elementStyle = new ElementStyle(aElement, this.store,
       this.pageStyle, this.showUserAgentStyles);
 
     return this._elementStyle.init().then(() => {
-      return this._populate();
+      if (this._viewedElement === aElement) {
+        return this._populate();
+      }
     }).then(() => {
       // A new node may already be selected, in which this._elementStyle will
       // be null.
-      if (this._elementStyle) {
+      if (this._elementStyle && this._viewedElement === aElement) {
         this._elementStyle.onChanged = () => {
           this._changed();
         };
       }
     }).then(null, console.error);
   },
 
   /**
