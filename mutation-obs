# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  f903cbfa3c01a5808c77538e47cb7a8758fa8676

diff --git a/toolkit/content/customElements.js b/toolkit/content/customElements.js
--- a/toolkit/content/customElements.js
+++ b/toolkit/content/customElements.js
@@ -11,17 +11,45 @@
 {
 
 ChromeUtils.import("resource://gre/modules/Services.jsm");
 ChromeUtils.import("resource://gre/modules/AppConstants.jsm");
 
 const gXULDOMParser = new DOMParser();
 gXULDOMParser.forceEnableXULXBL();
 
+const KnownElements = new Set();
+let observer = new MutationObserver(function(mutationsList) {
+  let hidden = 0;
+  let visible = 0;
+  KnownElements.forEach(function(val) {
+    // console.log(val);
+    if (window.windowUtils.getBoundsWithoutFlushing(val).width > 0) {
+      visible++;
+    } else {
+      hidden++;
+    }
+  });
+});
+
+observer.observe(document.documentElement, { attributes: true, childList: true, subtree: true });
+
 class MozXULElement extends XULElement {
+
+  constructor() {
+    super();
+
+    KnownElements.add(this);
+
+  }
+
+  disconnectedCallback() {
+    KnownElements.delete(this);
+
+  }
   /**
    * Allows eager deterministic construction of XUL elements with XBL attached, by
    * parsing an element tree and returning a DOM fragment to be inserted in the
    * document before any of the inner elements is referenced by JavaScript.
    *
    * This process is required instead of calling the createElement method directly
    * because bindings get attached when:
    *
