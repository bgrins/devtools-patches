# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  cf997da83953056d14aaf8d429bff2249dd635f5

diff --git a/toolkit/actors/PageSaveChild.jsm b/toolkit/actors/PageSaveChild.jsm
new file mode 100644
--- /dev/null
+++ b/toolkit/actors/PageSaveChild.jsm
@@ -0,0 +1,17 @@
+/* vim: set ts=2 sw=2 sts=2 et tw=80: */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+"use strict";
+
+var EXPORTED_SYMBOLS = ["PageSaveChild"];
+
+class PageSaveChild extends JSWindowActorChild {
+  handleEvent(event) {
+    console.trace();
+    switch (event.type) {
+      case "DOMContentLoaded": {
+      }
+    }
+  }
+}
diff --git a/toolkit/actors/PageSaveParent.jsm b/toolkit/actors/PageSaveParent.jsm
new file mode 100644
--- /dev/null
+++ b/toolkit/actors/PageSaveParent.jsm
@@ -0,0 +1,13 @@
+/* vim: set ts=2 sw=2 sts=2 et tw=80: */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+"use strict";
+
+var EXPORTED_SYMBOLS = ["PageSaveParent"];
+
+class PageSaveParent extends JSWindowActorParent {
+  receiveMessage(aMessage) {
+    console.trace(aMessage);
+  }
+}
diff --git a/toolkit/actors/moz.build b/toolkit/actors/moz.build
--- a/toolkit/actors/moz.build
+++ b/toolkit/actors/moz.build
@@ -42,16 +42,18 @@ FINAL_TARGET_FILES.actors += [
     'DateTimePickerParent.jsm',
     'ExtFindChild.jsm',
     'FindBarChild.jsm',
     'FindBarParent.jsm',
     'FinderChild.jsm',
     'InlineSpellCheckerChild.jsm',
     'InlineSpellCheckerParent.jsm',
     'KeyPressEventModelCheckerChild.jsm',
+    'PageSaveChild.jsm',
+    'PageSaveParent.jsm',
     'PictureInPictureChild.jsm',
     'PopupBlockingChild.jsm',
     'PopupBlockingParent.jsm',
     'PrintingChild.jsm',
     'PurgeSessionHistoryChild.jsm',
     'RemotePageChild.jsm',
     'SelectChild.jsm',
     'SelectParent.jsm',
diff --git a/toolkit/content/contentAreaUtils.js b/toolkit/content/contentAreaUtils.js
--- a/toolkit/content/contentAreaUtils.js
+++ b/toolkit/content/contentAreaUtils.js
@@ -15,16 +15,17 @@ XPCOMUtils.defineLazyModuleGetters(this,
   Downloads: "resource://gre/modules/Downloads.jsm",
   DownloadPaths: "resource://gre/modules/DownloadPaths.jsm",
   DownloadLastDir: "resource://gre/modules/DownloadLastDir.jsm",
   FileUtils: "resource://gre/modules/FileUtils.jsm",
   OS: "resource://gre/modules/osfile.jsm",
   PrivateBrowsingUtils: "resource://gre/modules/PrivateBrowsingUtils.jsm",
   Deprecated: "resource://gre/modules/Deprecated.jsm",
   NetUtil: "resource://gre/modules/NetUtil.jsm",
+  PageSaveParent: "resource://gre/modules/PageSave.jsm",
 });
 
 var ContentAreaUtils = {
   get stringBundle() {
     delete this.stringBundle;
     return (this.stringBundle = Services.strings.createBundle(
       "chrome://global/locale/contentAreaCommands.properties"
     ));
@@ -266,16 +267,18 @@ function internalSave(
   aChosenData,
   aReferrerInfo,
   aInitiatingDocument,
   aSkipPrompt,
   aCacheKey,
   aIsContentWindowPrivate,
   aPrincipal
 ) {
+  console.trace(arguments, PageSaveParent);
+
   if (aSkipPrompt == undefined) {
     aSkipPrompt = false;
   }
 
   if (aCacheKey == undefined) {
     aCacheKey = 0;
   }
 
diff --git a/toolkit/modules/ActorManagerParent.jsm b/toolkit/modules/ActorManagerParent.jsm
--- a/toolkit/modules/ActorManagerParent.jsm
+++ b/toolkit/modules/ActorManagerParent.jsm
@@ -265,16 +265,32 @@ let JSWINDOWACTORS = {
         DOMFormHasPassword: {},
         DOMInputPasswordAdded: {},
       },
     },
 
     allFrames: true,
     messageManagerGroups: ["browsers", ""],
   },
+
+  PageSave: {
+    parent: {
+      moduleURI: "resource://gre/actors/PageSaveParent.jsm",
+    },
+
+    child: {
+      moduleURI: "resource://gre/actors/PageSaveChild.jsm",
+      events: {
+        DOMContentLoaded: {},
+      },
+    },
+
+    allFrames: true,
+  },
+
   PictureInPicture: {
     parent: {
       moduleURI: "resource://gre/modules/PictureInPicture.jsm",
     },
     child: {
       moduleURI: "resource://gre/actors/PictureInPictureChild.jsm",
       events: {
         MozTogglePictureInPicture: { capture: true },
diff --git a/toolkit/modules/PageSave.jsm b/toolkit/modules/PageSave.jsm
new file mode 100644
--- /dev/null
+++ b/toolkit/modules/PageSave.jsm
@@ -0,0 +1,23 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+var EXPORTED_SYMBOLS = ["PageSaveParent", "PageMenuChild"];
+
+function PageSave() {}
+
+PageSave.prototype = {};
+
+// This object is expected to be used from a parent process.
+function PageSaveParent() {}
+
+PageSaveParent.prototype = {
+  __proto__: PageSave.prototype,
+};
+
+// This object is expected to be used from a child process.
+function PageSaveChild() {}
+
+PageSaveChild.prototype = {
+  __proto__: PageSave.prototype,
+};
diff --git a/toolkit/modules/moz.build b/toolkit/modules/moz.build
--- a/toolkit/modules/moz.build
+++ b/toolkit/modules/moz.build
@@ -100,16 +100,19 @@ with Files('ObjectUtils.jsm'):
     BUG_COMPONENT = ('Toolkit', 'Telemetry')
 
 with Files("offlineAppCache.jsm"):
     BUG_COMPONENT = ("Toolkit", "Preferences")
 
 with Files('PageMenu.jsm'):
     BUG_COMPONENT = ('Firefox', 'Menus')
 
+with Files('PageSave.jsm'):
+    BUG_COMPONENT = ('Toolkit', 'Storage')
+
 with Files('PermissionsUtils.jsm'):
     BUG_COMPONENT = ('Toolkit', 'Add-ons Manager')
 
 with Files('PopupNotifications.jsm'):
     BUG_COMPONENT = ('Toolkit', 'Notifications and Alerts')
 
 with Files('PrivateBrowsingUtils.jsm'):
     BUG_COMPONENT = ('Firefox', 'Private Browsing')
@@ -193,16 +196,17 @@ EXTRA_JS_MODULES += [
     'JSONFile.jsm',
     'Log.jsm',
     'NewTabUtils.jsm',
     'NLP.jsm',
     'ObjectUtils.jsm',
     'offlineAppCache.jsm',
     'OSKeyStore.jsm',
     'PageMenu.jsm',
+    'PageSave.jsm',
     'PermissionsUtils.jsm',
     'PopupNotifications.jsm',
     'Preferences.jsm',
     'PrivateBrowsingUtils.jsm',
     'ProfileAge.jsm',
     'Promise-backend.js',
     'Promise.jsm',
     'PromiseMessage.jsm',
