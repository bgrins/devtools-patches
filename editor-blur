# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  56707eeec6e53453878731864eaac19ef1a0c5ab
Bug 1211038 - Explicitly blur the CodeMirror editor on debugger search so it doesn't take focus back;r=jryans

diff --git a/devtools/client/debugger/views/filter-view.js b/devtools/client/debugger/views/filter-view.js
--- a/devtools/client/debugger/views/filter-view.js
+++ b/devtools/client/debugger/views/filter-view.js
@@ -449,16 +449,20 @@ FilterView.prototype = {
       if (identifier && identifier.name) {
         this._searchbox.value = aOperator + identifier.name;
         this._searchbox.select();
         this._searchbox.selectionStart += aOperator.length;
         return;
       }
     }
     this._searchbox.value = aOperator;
+
+    // Work around Bug 1211038 so the editor doesn't steal focus back after
+    // the key handler is processed
+    this.DebuggerView.editor.blur();
   },
 
   /**
    * Called when the source location filter key sequence was pressed.
    */
   _doFileSearch: function() {
     this._doSearch();
     this._searchboxHelpPanel.openPopup(this._searchbox);
diff --git a/devtools/client/sourceeditor/editor.js b/devtools/client/sourceeditor/editor.js
--- a/devtools/client/sourceeditor/editor.js
+++ b/devtools/client/sourceeditor/editor.js
@@ -89,16 +89,17 @@ const CM_IFRAME   =
   "    </style>" +
   CM_STYLES.map(style => "<link rel='stylesheet' href='" + style + "'>").join("\n") +
   "  </head>" +
   "  <body class='theme-body devtools-monospace'></body>" +
   "</html>";
 
 const CM_MAPPING = [
   "focus",
+  "blur",
   "hasFocus",
   "lineCount",
   "somethingSelected",
   "getCursor",
   "setSelection",
   "getSelection",
   "replaceSelection",
   "extendSelection",
