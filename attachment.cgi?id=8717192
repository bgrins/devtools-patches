# HG changeset patch
# User Jennifer Fong <jfong@mozilla.com>
Bug 1245921 - Change toolbox tabs to HTML. r=bgrins


diff --git a/devtools/client/framework/toolbox.js b/devtools/client/framework/toolbox.js
index cc50512..8ba8e48 100644
--- a/devtools/client/framework/toolbox.js
+++ b/devtools/client/framework/toolbox.js
@@ -17,16 +17,18 @@ const SCREENSIZE_HISTOGRAM = "DEVTOOLS_SCREEN_RESOLUTION_ENUMERATED_PER_USER";
 var {Cc, Ci, Cu} = require("chrome");
 var promise = require("promise");
 var EventEmitter = require("devtools/shared/event-emitter");
 var Telemetry = require("devtools/client/shared/telemetry");
 var HUDService = require("devtools/client/webconsole/hudservice");
 var viewSource = require("devtools/client/shared/view-source");
 var { attachThread, detachThread } = require("./attach-thread");
 
+const HTML_NS = "http://www.w3.org/1999/xhtml";
+
 Cu.import("resource://gre/modules/Services.jsm");
 Cu.import("resource://devtools/client/framework/gDevTools.jsm");
 Cu.import("resource://devtools/client/scratchpad/scratchpad-manager.jsm");
 Cu.import("resource://devtools/client/shared/DOMHelpers.jsm");
 Cu.import("resource://gre/modules/Task.jsm");
 
 loader.lazyImporter(this, "CommandUtils",
   "resource://devtools/client/shared/DeveloperToolbar.jsm");
@@ -1082,92 +1084,82 @@ Toolbox.prototype = {
     let deck = this.doc.getElementById("toolbox-deck");
 
     let id = toolDefinition.id;
 
     if (toolDefinition.ordinal == undefined || toolDefinition.ordinal < 0) {
       toolDefinition.ordinal = MAX_ORDINAL;
     }
 
-    let radio = this.doc.createElement("radio");
-    // The radio element is not being used in the conventional way, thus
-    // the devtools-tab class replaces the radio XBL binding with its base
-    // binding (the control-item binding).
-    radio.className = "devtools-tab";
-    radio.id = "toolbox-tab-" + id;
-    radio.setAttribute("toolid", id);
-    radio.setAttribute("ordinal", toolDefinition.ordinal);
-    radio.setAttribute("tooltiptext", toolDefinition.tooltip);
+    let tabContainer = this.doc.createElementNS(HTML_NS, "div");
+    tabContainer.className = "devtools-tab";
+    tabContainer.id = "toolbox-tab-" + id;
+    tabContainer.setAttribute("toolid", id);
+    tabContainer.setAttribute("ordinal", toolDefinition.ordinal);
+    tabContainer.setAttribute("tooltiptext", toolDefinition.tooltip);
     if (toolDefinition.invertIconForLightTheme) {
-      radio.setAttribute("icon-invertable", "true");
+      tabContainer.setAttribute("icon-invertable", "true");
     }
 
-    radio.addEventListener("command", () => {
+    tabContainer.addEventListener("click", () => {
       this.selectTool(id);
     });
 
     // spacer lets us center the image and label, while allowing cropping
-    let spacer = this.doc.createElement("spacer");
-    spacer.setAttribute("flex", "1");
-    radio.appendChild(spacer);
+    let spacer = this.doc.createElementNS(HTML_NS, "div");
+    spacer.className = "spacer";
+    tabContainer.appendChild(spacer);
 
     if (toolDefinition.icon) {
-      let image = this.doc.createElement("image");
+      let image = this.doc.createElementNS(HTML_NS, "img");
       image.className = "default-icon";
-      image.setAttribute("src",
-                         toolDefinition.icon || toolDefinition.highlightedicon);
-      radio.appendChild(image);
+      image.src = toolDefinition.icon || toolDefinition.highlightedicon;
+      tabContainer.appendChild(image);
       // Adding the highlighted icon image
-      image = this.doc.createElement("image");
+      image = this.doc.createElementNS(HTML_NS, "img");
       image.className = "highlighted-icon";
-      image.setAttribute("src",
-                         toolDefinition.highlightedicon || toolDefinition.icon);
-      radio.appendChild(image);
+      image.src = toolDefinition.highlightedicon || toolDefinition.icon;
+      tabContainer.appendChild(image);
     }
 
     if (toolDefinition.label && !toolDefinition.iconOnly) {
-      let label = this.doc.createElement("label");
-      label.setAttribute("value", toolDefinition.label);
-      label.setAttribute("crop", "end");
-      label.setAttribute("flex", "1");
-      radio.appendChild(label);
-      radio.setAttribute("flex", "1");
+      let label = this.doc.createElementNS(HTML_NS, "label");
+      label.textContent = toolDefinition.label;
+      tabContainer.appendChild(label);
     }
 
     if (!toolDefinition.bgTheme) {
       toolDefinition.bgTheme = "theme-toolbar";
     }
     let vbox = this.doc.createElement("vbox");
     vbox.className = "toolbox-panel " + toolDefinition.bgTheme;
 
     // There is already a container for the webconsole frame.
     if (!this.doc.getElementById("toolbox-panel-" + id)) {
       vbox.id = "toolbox-panel-" + id;
     }
 
     if (id === "options") {
       // Options panel is special.  It doesn't belong in the same container as
       // the other tabs.
-      radio.setAttribute("role", "button");
+      tabContainer.setAttribute("role", "button");
       let optionTabContainer = this.doc.getElementById("toolbox-option-container");
-      optionTabContainer.appendChild(radio);
+      optionTabContainer.appendChild(tabContainer);
       deck.appendChild(vbox);
     } else {
-      radio.setAttribute("role", "tab");
-
       // If there is no tab yet, or the ordinal to be added is the largest one.
       if (tabs.childNodes.length == 0 ||
           tabs.lastChild.getAttribute("ordinal") <= toolDefinition.ordinal) {
-        tabs.appendChild(radio);
+        tabs.appendChild(tabContainer);
         deck.appendChild(vbox);
       } else {
         // else, iterate over all the tabs to get the correct location.
         Array.some(tabs.childNodes, (node, i) => {
           if (+node.getAttribute("ordinal") > toolDefinition.ordinal) {
-            tabs.insertBefore(radio, node);
+            tabs.insertBefore(tabContainer, node);
             deck.insertBefore(vbox, deck.childNodes[i]);
             return true;
           }
           return false;
         });
       }
     }
 
diff --git a/devtools/client/themes/toolbars.css b/devtools/client/themes/toolbars.css
index 3176cb8..0db4041 100644
--- a/devtools/client/themes/toolbars.css
+++ b/devtools/client/themes/toolbars.css
@@ -823,31 +823,41 @@
 }
 
 .theme-dark .devtools-tabbar {
   box-shadow: 0 -2px 0 rgba(0,0,0,.1) inset;
 }
 
 #toolbox-tabs {
   margin: 0;
+  display: flex;
 }
 
 .devtools-tab {
+  position: relative;
+  display: flex;
   -moz-appearance: none;
   -moz-binding: url("chrome://global/content/bindings/general.xml#control-item");
-  -moz-box-align: center;
+  box-align: center;
   min-width: 32px;
   min-height: 24px;
   max-width: 110px;
   margin: 0;
   padding: 0;
-  border-style: solid;
-  border-width: 0;
-  -moz-border-start-width: 1px;
-  -moz-box-align: center;
+  border: 0;
+  border-right: 1px solid;
+  white-space: nowrap;
+  overflow: hidden;
+  align-items: center;
+  justify-content: center;
+  flex: 1;
+}
+
+.devtools-tab:first-child {
+  border-left: 1px solid;
 }
 
 .theme-dark .devtools-tab {
   color: var(--theme-body-color-alt);
   border-color: #42484f;
 }
 
 .theme-light .devtools-tab {
@@ -880,35 +890,40 @@
 .theme-dark .devtools-tab:not([selected])[highlighted] {
   background-color: hsla(99,100%,14%,.2);
 }
 
 .theme-light .devtools-tab:not([selected])[highlighted] {
   background-color: rgba(44, 187, 15, .2);
 }
 
-.devtools-tab > image {
-  border: none;
-  -moz-margin-end: 0;
-  -moz-margin-start: 4px;
+.devtools-tab .spacer {
+  max-width: 4px;
+  min-width: 1px;
+  width: 10%;
+}
+
+.devtools-tab > img {
+  margin-right: 4px;
   opacity: 0.6;
   max-height: 16px;
   width: 16px; /* Prevents collapse during theme switching */
 }
 
 .devtools-tab > label {
-  white-space: nowrap;
+  overflow: hidden;
+  text-overflow: ellipsis;
 }
 
-.devtools-tab:hover > image {
+.devtools-tab:hover > img {
   opacity: 0.8;
 }
 
-.devtools-tab:active > image,
-.devtools-tab[selected] > image {
+.devtools-tab:active > img,
+.devtools-tab[selected] > img {
   opacity: 1;
 }
 
 .devtools-tabbar .devtools-tab[selected],
 .devtools-tabbar .devtools-tab[selected]:hover:active {
   color: var(--theme-selection-color);
   background-color: var(--theme-selection-background);
 }
@@ -968,17 +983,17 @@
 }
 #toolbox-tab-options > image {
   margin: 0 8px;
 }
 
 /* Invert the colors of certain dark theme images for displaying
  * inside of the light theme.
  */
-.theme-light .devtools-tab[icon-invertable] > image,
+.theme-light .devtools-tab[icon-invertable] > img,
 .theme-light #toolbox-dock-buttons > toolbarbutton > image,
 .theme-light .command-button-invertable > image,
 .theme-light .devtools-closebutton > image,
 .theme-light .devtools-toolbarbutton > image,
 .theme-light .devtools-button::before,
 .theme-light #breadcrumb-separator-normal,
 .theme-light .scrollbutton-up > .toolbarbutton-icon,
 .theme-light .scrollbutton-down > .toolbarbutton-icon,
@@ -987,18 +1002,18 @@
 .theme-light #requests-menu-network-summary-button .button-icon,
 .theme-light #toggle-breakpoints[checked] > image,
 .theme-light .event-tooltip-debugger-icon {
   filter: invert(1);
 }
 
 /* Since selected backgrounds are blue, we want to use the normal
  * (light) icons. */
-.theme-light .devtools-tab[icon-invertable][selected] > image,
-.theme-light .devtools-tab[icon-invertable][highlighted] > image {
+.theme-light .devtools-tab[icon-invertable][selected] > img,
+.theme-light .devtools-tab[icon-invertable][highlighted] > img {
   filter: none !important;
 }
 
 .theme-light .command-button:hover {
   background-color: inherit;
 }
 
 .theme-light .command-button:hover:active,
