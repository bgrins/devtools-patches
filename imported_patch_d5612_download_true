# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1536856215 25200
#      Thu Sep 13 09:30:15 2018 -0700
# Node ID 9b8f2288887b67fb1973f0a4ab2ad1bedf18aedb
# Parent  2603d8004c78b79c8c8c6f789d752a11700cf841
imported patch D5612?download=true

diff --git a/dom/base/nsDocument.cpp b/dom/base/nsDocument.cpp
--- a/dom/base/nsDocument.cpp
+++ b/dom/base/nsDocument.cpp
@@ -3356,16 +3356,23 @@ nsIDocument::LocalizationLinkAdded(Eleme
   nsAutoString href;
   aLinkElement->GetAttr(kNameSpaceID_None, nsGkAtoms::href, href);
   // If the link is added after the DocumentL10n instance
   // has been initialized, just pass the resource ID to it.
   if (mDocumentL10n) {
     AutoTArray<nsString, 1> resourceIds;
     resourceIds.AppendElement(href);
     mDocumentL10n->AddResourceIds(resourceIds);
+  } else if (mReadyState == READYSTATE_COMPLETE) {
+    // Otherwise, if the document has already been parsed
+    // we need to lazily initialize the localization.
+    AutoTArray<nsString, 1> resourceIds;
+    resourceIds.AppendElement(href);
+    InitializeLocalization(resourceIds);
+    mDocumentL10n->TriggerInitialDocumentTranslation();
   } else {
     // Otherwise, we're still parsing the document.
     // In that case, add it to the pending list. This list
     // will be resolved once the end of l10n resource
     // container is reached.
     mL10nResources.AppendElement(href);
   }
 }
