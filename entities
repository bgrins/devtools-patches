# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  a675c5d7eb76887a3e4b24548d621c9cc05a1545
Bug 1473130 - Change parseXULToFragment to take an array of URLs for entities

diff --git a/toolkit/content/customElements.js b/toolkit/content/customElements.js
--- a/toolkit/content/customElements.js
+++ b/toolkit/content/customElements.js
@@ -32,19 +32,29 @@ class MozXULElement extends XULElement {
    * the reflector is garbage collected and the element is touched again.
    *
    * @param str
    *        String with the XML representation of XUL elements.
    *
    * @return DocumentFragment containing the corresponding element tree, including
    *         element nodes but excluding any text node.
    */
-  static parseXULToFragment(str, entities = "") {
+  static parseXULToFragment(str, entities = []) {
+
+
+    let entitiesStr = "";
+    if (entities.length) {
+      entitiesStr =
+        "<!DOCTYPE bindings [" +
+        entities.map((e, i) =>
+          `<!ENTITY % entity${i} SYSTEM "${e}">`).join("\n") +
+        "]>";
+    }
     let doc = gXULDOMParser.parseFromString(`
-      ${entities}
+      ${entitiesStr}
       <box xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
         ${str}
       </box>
     `, "application/xml");
     // The XUL/XBL parser is set to ignore all-whitespace nodes, whereas (X)HTML
     // does not do this. Most XUL code assumes that the whitespace has been
     // stripped out, so we simply remove all text nodes after using the parser.
     let nodeIterator = doc.createNodeIterator(doc, NodeFilter.SHOW_TEXT);
