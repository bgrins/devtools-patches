# HG changeset patch
# Parent ef31cddbfb46b5a7b7c0e88dcd0749745e874710
# User Brian Grinstead <bgrinstead@mozilla.com>
Bug 1018955: Pause/resume button flickers when setting breakpoint;r=fitzgen

diff --git a/browser/devtools/debugger/debugger-controller.js b/browser/devtools/debugger/debugger-controller.js
--- a/browser/devtools/debugger/debugger-controller.js
+++ b/browser/devtools/debugger/debugger-controller.js
@@ -425,16 +425,17 @@ let DebuggerController = {
 };
 
 /**
  * ThreadState keeps the UI up to date with the state of the
  * thread (paused/attached/etc.).
  */
 function ThreadState() {
   this._update = this._update.bind(this);
+  this.interruptedByResumeButton = false;
 }
 
 ThreadState.prototype = {
   get activeThread() DebuggerController.activeThread,
 
   /**
    * Connect to the current thread client.
    */
@@ -467,24 +468,26 @@ ThreadState.prototype = {
     }
     dumpn("Handling tab navigation in the ThreadState");
     this._update();
   },
 
   /**
    * Update the UI after a thread state change.
    */
-  _update: function(aEvent) {
-    // Ignore "interrupted" events, which are generated by the slow script
-    // dialog and internal events such as setting breakpoints, to avoid UI
-    // flicker.
-    if (aEvent == "interrupted") {
+  _update: function(aEvent, aPacket) {
+    // Ignore "interrupted" events, to avoid UI flicker. These are generated
+    // by the slow script dialog and internal events such as setting
+    // breakpoints. Pressing the resume button does need to be shown, though.
+    if (aEvent == "paused" && aPacket.why.type == "interrupted" &&
+        !this.interruptedByResumeButton) {
       return;
     }
 
+    this.interruptedByResumeButton = false;
     DebuggerView.Toolbar.toggleResumeButtonState(this.activeThread.state);
 
     if (gTarget && (aEvent == "paused" || aEvent == "resumed")) {
       gTarget.emit("thread-" + aEvent);
     }
   }
 };
 
diff --git a/browser/devtools/debugger/debugger-toolbar.js b/browser/devtools/debugger/debugger-toolbar.js
--- a/browser/devtools/debugger/debugger-toolbar.js
+++ b/browser/devtools/debugger/debugger-toolbar.js
@@ -124,16 +124,17 @@ ToolbarView.prototype = {
       return;
     }
 
     if (DebuggerController.activeThread.paused) {
       let warn = DebuggerController._ensureResumptionOrder;
       DebuggerController.StackFrames.currentFrameDepth = -1;
       DebuggerController.activeThread.resume(warn);
     } else {
+      DebuggerController.ThreadState.interruptedByResumeButton = true;
       DebuggerController.activeThread.interrupt();
     }
   },
 
   /**
    * Listener handling the step over button click event.
    */
   _onStepOverPressed: function() {
