# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  782f9280b062964d24c92cf8c1d1b48d3df62786
Bug 1148996 - Remove selected lightweight theme for mochitest and xpcshell tests;r=jmaher

This is for aurora (dev edition) compatibility.  In this channel, there is a
selected lightweight theme by default.  Tests don't expect this to be the case
so this simply resets the relevant prefs for mochitests and xpcshell tests.

diff --git a/testing/profiles/prefs_general.js b/testing/profiles/prefs_general.js
--- a/testing/profiles/prefs_general.js
+++ b/testing/profiles/prefs_general.js
@@ -305,8 +305,13 @@ user_pref("browser.tabs.remote.autostart
 user_pref("dom.ipc.tabs.shutdownTimeoutSecs", 0);
 
 // Avoid performing Readinglist Intro during tests.
 user_pref("browser.readinglist.introShown", true);
 
 // Don't let PAC generator to set PAC, as mochitest framework has its own PAC
 // rules during testing.
 user_pref("network.proxy.pac_generator", false);
+
+// Make tests run consistently on DevEdition (which has a lightweight theme
+// selected by default).
+user_pref("lightweightThemes.selectedThemeID", "");
+user_pref("browser.devedition.theme.enabled", false);
diff --git a/testing/xpcshell/head.js b/testing/xpcshell/head.js
--- a/testing/xpcshell/head.js
+++ b/testing/xpcshell/head.js
@@ -1417,8 +1417,20 @@ try {
   if (runningInParent) {
     let prefs = Components.classes["@mozilla.org/preferences-service;1"]
       .getService(Components.interfaces.nsIPrefBranch);
 
     prefs.setCharPref("media.gmp-manager.url.override", "http://%(server)s/dummy-gmp-manager.xml");
     prefs.setCharPref("browser.selfsupport.url", "https://%(server)s/selfsupport-dummy/");
   }
 } catch (e) { }
+
+// Make tests run consistently on DevEdition (which has a lightweight theme
+// selected by default).
+try {
+  if (runningInParent) {
+    let prefs = Components.classes["@mozilla.org/preferences-service;1"]
+      .getService(Components.interfaces.nsIPrefBranch);
+
+    prefs.deleteBranch("lightweightThemes.selectedThemeID");
+    prefs.deleteBranch("browser.devedition.theme.enabled");
+  }
+} catch (e) { }
