# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  4e96a3f76086427e1725b359e865ea5f96128b39

diff --git a/toolkit/content/customElements.js b/toolkit/content/customElements.js
--- a/toolkit/content/customElements.js
+++ b/toolkit/content/customElements.js
@@ -115,19 +115,23 @@ function getInterfaceProxy(obj) {
 }
 
 // Attach the base class to the window so other scripts can use it:
 window.MozXULElement = MozXULElement;
 
 for (let script of [
   "chrome://global/content/elements/stringbundle.js",
   "chrome://global/content/elements/general.js",
-  "chrome://global/content/elements/textbox.js",
 ]) {
   Services.scriptloader.loadSubScript(script, window);
 }
 
+customElements.setElementCreationCallback("moz-input-box", type => {
+  Services.scriptloader.loadSubScript(
+    "chrome://global/content/elements/textbox.js", window);
+});
+
 customElements.setElementCreationCallback("printpreview-toolbar", type => {
   Services.scriptloader.loadSubScript(
     "chrome://global/content/printPreviewToolbar.js", window);
 });
 
 }
diff --git a/toolkit/content/widgets/autocomplete.xml b/toolkit/content/widgets/autocomplete.xml
--- a/toolkit/content/widgets/autocomplete.xml
+++ b/toolkit/content/widgets/autocomplete.xml
@@ -43,16 +43,20 @@
 
         this._searchBeginHandler = this.initEventHandler("searchbegin");
         this._searchCompleteHandler = this.initEventHandler("searchcomplete");
         this._textEnteredHandler = this.initEventHandler("textentered");
         this._textRevertedHandler = this.initEventHandler("textreverted");
 
         // For security reasons delay searches on pasted values.
         this.inputField.controllers.insertControllerAt(0, this._pasteController);
+
+        // Force upgrade the Custom Element (Bug 1470242)
+        customElements.upgrade(document.getAnonymousElementByAttribute(this,
+                                                "anonid", "moz-input-box"));
       ]]></constructor>
 
       <destructor><![CDATA[
         this.inputField.controllers.removeController(this._pasteController);
       ]]></destructor>
 
       <!-- =================== nsIAutoCompleteInput =================== -->
 
diff --git a/toolkit/content/widgets/textbox.xml b/toolkit/content/widgets/textbox.xml
--- a/toolkit/content/widgets/textbox.xml
+++ b/toolkit/content/widgets/textbox.xml
@@ -168,16 +168,20 @@
           this.inputField.value = str;
           this.boxObject.removeProperty("value");
         }
 
         this._setNewlineHandling();
 
         if (this.hasAttribute("emptytext"))
           this.placeholder = this.getAttribute("emptytext");
+
+        // Force upgrade the Custom Element (Bug 1470242)
+        customElements.upgrade(document.getAnonymousElementByAttribute(this,
+                                                "anonid", "moz-input-box"));
       ]]></constructor>
 
       <destructor>
         <![CDATA[
           var field = this.inputField;
           if (field && field.value)
             this.boxObject.setProperty("value", field.value);
           this.mInputField = null;
