# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  375a22f7bc4ee360e90849d33061c86b1b56fe8b
Bug 1220208 - Clear Button

diff --git a/browser/locales/en-US/chrome/browser/devtools/netmonitor.dtd b/browser/locales/en-US/chrome/browser/devtools/netmonitor.dtd
--- a/browser/locales/en-US/chrome/browser/devtools/netmonitor.dtd
+++ b/browser/locales/en-US/chrome/browser/devtools/netmonitor.dtd
@@ -124,19 +124,19 @@
   -  in the network details footer for the "Other" filtering button. -->
 <!ENTITY netmonitorUI.footer.filterOther  "Other">
 
 <!-- LOCALIZATION NOTE (netmonitorUI.footer.filterFreetext): This is the label displayed
   -  in the network details footer for the url filtering textbox. -->
 <!ENTITY netmonitorUI.footer.filterFreetext.label  "Filter URLs">
 <!ENTITY netmonitorUI.footer.filterFreetext.key  "F">
 
-<!-- LOCALIZATION NOTE (netmonitorUI.footer.clear): This is the label displayed
-  -  in the network details footer for the "Clear" button. -->
-<!ENTITY netmonitorUI.footer.clear  "Clear">
+<!-- LOCALIZATION NOTE (netmonitorUI.clear.tooltiptext): This is the tooltip displayed
+  -  in the network panel for the "Clear" button. -->
+<!ENTITY netmonitorUI.clear.tooltiptext  "Clear">
 
 <!-- LOCALIZATION NOTE (netmonitorUI.footer.clear): This is the label displayed
   -  in the network details footer for the performance analysis button. -->
 <!ENTITY netmonitorUI.footer.perf   "Toggle performance analysisâ€¦">
 
 <!-- LOCALIZATION NOTE (netmonitorUI.panesButton.tooltip): This is the tooltip for
   -  the button that toggles the panes visible or hidden in the netmonitor UI. -->
 <!ENTITY netmonitorUI.panesButton.tooltip "Toggle network info">
diff --git a/browser/locales/en-US/chrome/browser/devtools/webConsole.dtd b/browser/locales/en-US/chrome/browser/devtools/webConsole.dtd
--- a/browser/locales/en-US/chrome/browser/devtools/webConsole.dtd
+++ b/browser/locales/en-US/chrome/browser/devtools/webConsole.dtd
@@ -75,17 +75,16 @@
 <!-- LOCALIZATION NODE (btnConsoleServiceWorkers) the term "Service Workers"
   -  should not be translated. -->
 <!ENTITY btnConsoleServiceWorkers "Service Workers">
 <!-- LOCALIZATION NODE (btnConsoleWindowlessWorkers) the term "Workers"
   -  should not be translated. -->
 <!ENTITY btnConsoleWindowlessWorkers "Add-on or Chrome Workers">
 
 <!ENTITY filterOutput.placeholder "Filter output">
-<!ENTITY btnClear.label        "Clear">
 <!ENTITY btnClear.tooltip      "Clear the Web Console output">
 <!ENTITY btnClear.accesskey    "r">
 
 <!ENTITY fullZoomEnlargeCmd.commandkey  "+">
 <!ENTITY fullZoomEnlargeCmd.commandkey2 "="> <!-- + is above this key on many keyboards -->
 <!ENTITY fullZoomEnlargeCmd.commandkey3 "">
 
 <!ENTITY fullZoomReduceCmd.commandkey   "-">
diff --git a/devtools/client/jar.mn b/devtools/client/jar.mn
--- a/devtools/client/jar.mn
+++ b/devtools/client/jar.mn
@@ -149,16 +149,17 @@ devtools.jar:
     content/aboutdebugging/aboutdebugging.css (aboutdebugging/aboutdebugging.css)
     content/aboutdebugging/aboutdebugging.js (aboutdebugging/aboutdebugging.js)
 %   skin devtools classic/1.0 %skin/
 *   skin/themes/common.css (themes/common.css)
 *   skin/themes/dark-theme.css (themes/dark-theme.css)
 *   skin/themes/light-theme.css (themes/light-theme.css)
     skin/themes/variables.css (themes/variables.css)
     skin/themes/images/add.svg (themes/images/add.svg)
+    skin/themes/images/clear.svg (themes/images/clear.svg)
     skin/themes/images/filters.svg (themes/images/filters.svg)
     skin/themes/images/filter-swatch.svg (themes/images/filter-swatch.svg)
     skin/themes/images/pseudo-class.svg (themes/images/pseudo-class.svg)
     skin/themes/images/controls.png (themes/images/controls.png)
     skin/themes/images/controls@2x.png (themes/images/controls@2x.png)
     skin/themes/images/animation-fast-track.svg (themes/images/animation-fast-track.svg)
     skin/themes/images/performance-icons.svg (themes/images/performance-icons.svg)
     skin/themes/images/newtab.png (themes/images/newtab.png)
diff --git a/devtools/client/netmonitor/netmonitor-view.js b/devtools/client/netmonitor/netmonitor-view.js
--- a/devtools/client/netmonitor/netmonitor-view.js
+++ b/devtools/client/netmonitor/netmonitor-view.js
@@ -395,31 +395,35 @@ RequestsMenuView.prototype = Heritage.ex
     this.sendCustomRequestEvent = this.sendCustomRequest.bind(this);
     this.closeCustomRequestEvent = this.closeCustomRequest.bind(this);
     this.cloneSelectedRequestEvent = this.cloneSelectedRequest.bind(this);
     this.toggleRawHeadersEvent = this.toggleRawHeaders.bind(this);
 
     this.requestsFreetextFilterEvent = this.requestsFreetextFilterEvent.bind(this);
     this.reFilterRequests = this.reFilterRequests.bind(this);
 
+    this.clearButton = $("#requests-menu-clear-button");
+    this.clearButton.addEventListener("click", this.reqeustsMenuClearEvent, false);
+
     this.freetextFilterBox = $("#requests-menu-filter-freetext-text");
     this.freetextFilterBox.addEventListener("input", this.requestsFreetextFilterEvent, false);
     this.freetextFilterBox.addEventListener("command", this.requestsFreetextFilterEvent, false);
 
     $("#toolbar-labels").addEventListener("click", this.requestsMenuSortEvent, false);
     $("#requests-menu-footer").addEventListener("click", this.requestsMenuFilterEvent, false);
-    $("#requests-menu-clear-button").addEventListener("click", this.reqeustsMenuClearEvent, false);
     $("#network-request-popup").addEventListener("popupshowing", this._onContextShowing, false);
     $("#request-menu-context-newtab").addEventListener("command", this._onContextNewTabCommand, false);
     $("#request-menu-context-copy-url").addEventListener("command", this._onContextCopyUrlCommand, false);
     $("#request-menu-context-copy-response").addEventListener("command", this._onContextCopyResponseCommand, false);
     $("#request-menu-context-copy-image-as-data-uri").addEventListener("command", this._onContextCopyImageAsDataUriCommand, false);
     $("#toggle-raw-headers").addEventListener("click", this.toggleRawHeadersEvent, false);
 
     window.once("connected", this._onConnect.bind(this));
+
+    this.refreshSummary();
   },
 
   _onConnect: function() {
     $("#requests-menu-reload-notice-button").addEventListener("command", this._onReloadCommand, false);
 
     if (NetMonitorController.supportsCustomRequest) {
       $("#request-menu-context-resend").addEventListener("command", this._onContextResendCommand, false);
       $("#custom-request-send-button").addEventListener("click", this.sendCustomRequestEvent, false);
@@ -459,17 +463,17 @@ RequestsMenuView.prototype = Heritage.ex
 
     this.widget.removeEventListener("select", this._onSelect, false);
     this.widget.removeEventListener("swap", this._onSwap, false);
     this._splitter.removeEventListener("mousemove", this._onResize, false);
     window.removeEventListener("resize", this._onResize, false);
 
     $("#toolbar-labels").removeEventListener("click", this.requestsMenuSortEvent, false);
     $("#requests-menu-footer").removeEventListener("click", this.requestsMenuFilterEvent, false);
-    $("#requests-menu-clear-button").removeEventListener("click", this.reqeustsMenuClearEvent, false);
+    this.clearButton.removeEventListener("click", this.reqeustsMenuClearEvent, false);
     this.freetextFilterBox.removeEventListener("input", this.requestsFreetextFilterEvent, false);
     this.freetextFilterBox.removeEventListener("command", this.requestsFreetextFilterEvent, false);
 
     this.userInputTimer.cancel();
     this._flushRequestsTask.disarm();
 
     $("#network-request-popup").removeEventListener("popupshowing", this._onContextShowing, false);
     $("#request-menu-context-newtab").removeEventListener("command", this._onContextNewTabCommand, false);
@@ -1082,17 +1086,16 @@ RequestsMenuView.prototype = Heritage.ex
     this.refreshZebra();
   },
 
   /**
    * Removes all network requests and closes the sidebar if open.
    */
   clear: function() {
     NetMonitorView.Sidebar.toggle(false);
-    $("#details-pane-toggle").disabled = true;
 
     this.empty();
     this.refreshSummary();
   },
 
   /**
    * Predicates used when filtering items.
    *
@@ -1232,16 +1235,20 @@ RequestsMenuView.prototype = Heritage.ex
 
   /**
    * Refreshes the status displayed in this container's footer, providing
    * concise information about all requests.
    */
   refreshSummary: function() {
     let visibleItems = this.visibleItems;
     let visibleRequestsCount = visibleItems.length;
+
+    console.log("HERE!!", visibleRequestsCount)
+    this.clearButton.disabled = !visibleRequestsCount;
+
     if (!visibleRequestsCount) {
       this._summary.setAttribute("value", L10N.getStr("networkMenu.empty"));
       return;
     }
 
     let totalBytes = this._getTotalBytesOfRequests(visibleItems);
     let totalMillis =
       this._getNewestRequest(visibleItems).attachment.endedMillis -
@@ -1535,17 +1542,16 @@ RequestsMenuView.prototype = Heritage.ex
         NetMonitorView.NetworkDetails.populate(selectedItem.attachment);
       }
     }
 
     // We're done flushing all the requests, clear the update queue.
     this._updateQueue = [];
     this._addQueue = [];
 
-    $("#details-pane-toggle").disabled = !this.itemCount;
     $("#requests-menu-empty-notice").hidden = !!this.itemCount;
 
     // Make sure all the requests are sorted and filtered.
     // Freshly added requests may not yet contain all the information required
     // for sorting and filtering predicates, so this is done each time the
     // network requests table is flushed (don't worry, events are drained first
     // so this doesn't happen once per network event update).
     this.sortContents();
diff --git a/devtools/client/netmonitor/netmonitor.css b/devtools/client/netmonitor/netmonitor.css
--- a/devtools/client/netmonitor/netmonitor.css
+++ b/devtools/client/netmonitor/netmonitor.css
@@ -2,19 +2,24 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 #toolbar-labels {
   overflow: hidden;
 }
 
+#body:not([pane-collapsed]) #requests-menu-clear-button {
+  display: none;
+}
+#body[pane-collapsed] #details-pane-toggle,
 #details-pane-toggle[disabled] {
   /* Don't use display: none; to avoid collapsing #requests-menu-toolbar */
-  visibility: hidden;
+  /*visibility: hidden;*/
+  display: none;
 }
 
 #custom-pane {
   overflow: auto;
 }
 
 #response-content-image-box {
   overflow: auto;
diff --git a/devtools/client/netmonitor/netmonitor.xul b/devtools/client/netmonitor/netmonitor.xul
--- a/devtools/client/netmonitor/netmonitor.xul
+++ b/devtools/client/netmonitor/netmonitor.xul
@@ -176,21 +176,24 @@
                         pack="start"
                         flex="1">
                   <label id="requests-menu-waterfall-label"
                          class="plain requests-menu-waterfall"
                          value="&netmonitorUI.toolbar.waterfall;"/>
                 </button>
               </hbox>
             </hbox>
+            <!-- Yuck - Bug 248862 -->
+            <box style="width:32px;" flex="0" tooltiptext="&netmonitorUI.clear.tooltiptext;">
+            <html:button id="requests-menu-clear-button"
+                    class="devtools-button devtools-clear-icon" />
+            </box>
             <toolbarbutton id="details-pane-toggle"
                            class="devtools-toolbarbutton"
-                           tooltiptext="&netmonitorUI.panesButton.tooltip;"
-                           disabled="true"
-                           tabindex="0"/>
+                           tooltiptext="&netmonitorUI.panesButton.tooltip;"/>
           </toolbar>
 
           <vbox id="requests-menu-empty-notice"
                 class="side-menu-widget-empty-text">
             <hbox id="notice-reload-message" align="center">
               <label value="&netmonitorUI.reloadNotice1;"/>
               <button id="requests-menu-reload-notice-button"
                       class="devtools-toolbarbutton"
@@ -815,19 +818,16 @@
                 flex="100"/>
         <button id="requests-menu-network-summary-button"
                 class="requests-menu-footer-button"
                 tooltiptext="&netmonitorUI.footer.perf;"/>
         <label id="requests-menu-network-summary-label"
                class="plain requests-menu-footer-label"
                crop="end"
                tooltiptext="&netmonitorUI.footer.perf;"/>
-        <button id="requests-menu-clear-button"
-                class="requests-menu-footer-button"
-                label="&netmonitorUI.footer.clear;"/>
       </hbox>
 
     </vbox>
 
     <box id="network-statistics-view">
       <toolbar id="network-statistics-toolbar"
                class="devtools-toolbar">
         <button id="network-statistics-back-button"
diff --git a/devtools/client/performance/performance.xul b/devtools/client/performance/performance.xul
--- a/devtools/client/performance/performance.xul
+++ b/devtools/client/performance/performance.xul
@@ -7,17 +7,18 @@
 <?xml-stylesheet href="chrome://devtools/skin/themes/common.css" type="text/css"?>
 <?xml-stylesheet href="chrome://devtools/skin/themes/widgets.css" type="text/css"?>
 <?xml-stylesheet href="chrome://devtools/skin/themes/performance.css" type="text/css"?>
 <!DOCTYPE window [
   <!ENTITY % performanceDTD SYSTEM "chrome://browser/locale/devtools/performance.dtd">
   %performanceDTD;
 ]>
 
-<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+        xmlns:html="http://www.w3.org/1999/xhtml">
   <script src="chrome://devtools/content/shared/theme-switching.js"/>
   <script type="application/javascript" src="performance-controller.js"/>
   <script type="application/javascript" src="performance-view.js"/>
   <script type="application/javascript" src="views/overview.js"/>
   <script type="application/javascript" src="views/toolbar.js"/>
   <script type="application/javascript" src="views/details-abstract-subview.js"/>
   <script type="application/javascript" src="views/details-waterfall.js"/>
   <script type="application/javascript" src="views/details-js-call-tree.js"/>
@@ -86,19 +87,16 @@
         <hbox id="recordings-controls"
               class="devtools-toolbarbutton-group">
           <toolbarbutton id="main-record-button"
                          class="devtools-toolbarbutton record-button"
                          tooltiptext="&performanceUI.recordButton.tooltip;"/>
           <toolbarbutton id="import-button"
                          class="devtools-toolbarbutton"
                          label="&performanceUI.importButton;"/>
-          <toolbarbutton id="clear-button"
-                         class="devtools-toolbarbutton"
-                         label="&performanceUI.clearButton;"/>
         </hbox>
       </toolbar>
       <vbox id="recordings-list" flex="1"/>
     </vbox>
 
     <!-- Main panel content -->
     <vbox id="performance-pane" flex="1">
 
@@ -146,16 +144,21 @@
         </hbox>
         <spacer flex="1"></spacer>
         <hbox id="performance-toolbar-controls-options"
               class="devtools-toolbarbutton-group">
           <toolbarbutton id="performance-options-button"
                          class="devtools-toolbarbutton devtools-option-toolbarbutton"
                          popup="performance-options-menupopup"
                          tooltiptext="&performanceUI.options.gear.tooltiptext;"/>
+          <!-- Yuck - title attribute doesn't work for html elements - Bug 248862 -->
+          <box style="width:32px;" flex="0" tooltiptext="&performanceUI.clearButton;">
+            <html:button id="clear-button"
+                         class="devtools-button devtools-clear-icon" />
+          </box>
         </hbox>
       </toolbar>
 
       <!-- Recording contents and general notice messages -->
       <deck id="performance-view" flex="1">
 
         <!-- A default notice, shown while initially opening the tool.
              Keep this element the first child of #performance-view. -->
diff --git a/devtools/client/shared/test/browser_toolbar_webconsole_errors_count.js b/devtools/client/shared/test/browser_toolbar_webconsole_errors_count.js
--- a/devtools/client/shared/test/browser_toolbar_webconsole_errors_count.js
+++ b/devtools/client/shared/test/browser_toolbar_webconsole_errors_count.js
@@ -138,17 +138,17 @@ function test() {
       },
       success: doClearConsoleButton.bind(null, hud),
       failure: finish,
     };
   }
 
   function doClearConsoleButton(hud) {
     let clearButton = hud.ui.rootElement
-                      .querySelector(".webconsole-clear-console-button");
+                      .querySelector("#webconsole-clear-console-button");
     EventUtils.synthesizeMouse(clearButton, 2, 2, {}, hud.iframeWindow);
 
     is(hud.outputNode.textContent.indexOf("foobarBug762996click"), -1,
        "clear console button worked");
     is(getErrorsCount(), 0, "page errors counter has been reset");
     let tooltip = getTooltipValues();
     is(tooltip[1], 0, "page warnings counter has been reset");
 
diff --git a/devtools/client/themes/images/clear.svg b/devtools/client/themes/images/clear.svg
new file mode 100644
--- /dev/null
+++ b/devtools/client/themes/images/clear.svg
@@ -0,0 +1,6 @@
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<svg height="16" width="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="whitesmoke">
+<path d="M8,1.1c-3.8,0-6.9,3-6.9,6.9s3,6.9,6.9,6.9s6.9-3,6.9-6.9S11.8,1.1,8,1.1z M13.1,7.9c0,1.1-0.4,2.1-1,3L5,3.8  c0.8-0.6,1.9-1,3-1C10.8,2.8,13.1,5.1,13.1,7.9z M2.9,7.9c0-1.1,0.3-2.1,0.9-2.9l7.1,7.1C10.1,12.7,9.1,13,8,13  C5.2,13,2.9,10.7,2.9,7.9z"/>
+</svg>
\ No newline at end of file
diff --git a/devtools/client/themes/netmonitor.css b/devtools/client/themes/netmonitor.css
--- a/devtools/client/themes/netmonitor.css
+++ b/devtools/client/themes/netmonitor.css
@@ -392,17 +392,16 @@ box.requests-menu-status[code^="5"] {
   background-color: var(--table-zebra-background);
 }
 
 .side-menu-widget-item:not(.selected):hover {
   background-color: var(--theme-selection-background-semitransparent);
 }
 
 /* Network request details */
-
 #details-pane-toggle {
   background: none;
   box-shadow: none;
   border-color: transparent;
   list-style-image: url("chrome://devtools/skin/themes/images/debugger-collapse.png");
   -moz-image-region: rect(0px,16px,16px,0px);
 }
 
diff --git a/devtools/client/themes/toolbars.inc.css b/devtools/client/themes/toolbars.inc.css
--- a/devtools/client/themes/toolbars.inc.css
+++ b/devtools/client/themes/toolbars.inc.css
@@ -272,16 +272,32 @@
   position: relative;
 }
 
 .devtools-button[standalone], .devtools-button[data-standalone] {
   min-height: 32px;
   border-width: 1px;
 }
 
+/* This button type uses an opacity change to indicate hover/active
+   states, instead of a background color */
+.devtools-button.devtools-clear-icon::before {
+  background-image: url("chrome://devtools/skin/themes/images/clear.svg");
+}
+.devtools-button.devtools-clear-icon {
+  opacity: 0.6;
+  background: none !important;
+}
+.devtools-button.devtools-clear-icon:not([disabled]):hover {
+  opacity: 0.8;
+}
+.devtools-button.devtools-clear-icon:not([disabled]):hover:active {
+  opacity: 1;
+}
+
 /* Button States */
 .theme-dark .devtools-button:not([disabled]):hover {
   background: rgba(0, 0, 0, .3); /* Splitters */
 }
 .theme-light .devtools-button:not([disabled]):hover {
   background: rgba(170, 170, 170, .3); /* Splitters */
 }
 
@@ -307,29 +323,24 @@
   display: block;
   width: 16px;
   height: 16px;
   position: absolute;
   left: 50%;
   top: 50%;
   margin: -8px 0 0 -8px;
   background-repeat: no-repeat;
+  background-size: cover;
 }
 
 .devtools-button[disabled]::before,
 .devtools-button:disabled::before {
   opacity: 0.5;
 }
 
-@media (min-resolution: 1.1dppx) {
-  .devtools-button::before {
-    background-size: 32px;
-  }
-}
-
 /* Text input */
 
 .devtools-textinput,
 .devtools-searchinput {
   -moz-appearance: none;
   margin: 1px 3px;
   border: 1px solid;
 %ifdef XP_MACOSX
diff --git a/devtools/client/themes/webconsole.css b/devtools/client/themes/webconsole.css
--- a/devtools/client/themes/webconsole.css
+++ b/devtools/client/themes/webconsole.css
@@ -539,19 +539,16 @@ a {
     display: none;
   }
   .hud-console-filter-toolbar .webconsole-filter-button .toolbarbutton-text {
     display: none;
   }
   .hud-console-filter-toolbar .webconsole-filter-button {
     min-width: 40px;
   }
-  .hud-console-filter-toolbar .webconsole-clear-console-button {
-    min-width: 25px;
-  }
   .webconsole-filter-button > .toolbarbutton-menubutton-button:before {
     width: 12px;
     height: 12px;
     margin-left: 1px;
   }
   .toolbarbutton-menubutton-dropmarker {
     margin: 0px;
   }
diff --git a/devtools/client/webconsole/webconsole.js b/devtools/client/webconsole/webconsole.js
--- a/devtools/client/webconsole/webconsole.js
+++ b/devtools/client/webconsole/webconsole.js
@@ -529,16 +529,17 @@ WebConsoleFrame.prototype = {
     } else {
       doc.querySelector("#key_clear").removeAttribute("disabled");
     }
 
     this.filterBox = doc.querySelector(".hud-filter-box");
     this.outputNode = doc.getElementById("output-container");
     this.completeNode = doc.querySelector(".jsterm-complete-node");
     this.inputNode = doc.querySelector(".jsterm-input-node");
+    this.clearButton = doc.querySelector("#webconsole-clear-console-button");
 
     this._setFilterTextBoxEvents();
     this._initFilterButtons();
 
     let fontSize = this.owner._browserConsole ?
                    Services.prefs.getIntPref("devtools.webconsole.fontSize") : 0;
 
     if (fontSize != 0) {
@@ -596,18 +597,17 @@ WebConsoleFrame.prototype = {
 
     saveBodiesContextMenu.parentNode.addEventListener("popupshowing", () => {
       updateSaveBodiesPrefUI(saveBodiesContextMenu);
       saveBodiesContextMenu.disabled = !this.getFilterState("networkinfo") &&
                                        !this.getFilterState("netxhr") &&
                                        !this.getFilterState("network");
     });
 
-    let clearButton = doc.getElementsByClassName("webconsole-clear-console-button")[0];
-    clearButton.addEventListener("command", () => {
+    this.clearButton.addEventListener("click", () => {
       this.owner._onClearButton();
       this.jsterm.clearOutput(true);
     });
 
     this.jsterm = new JSTerm(this);
     this.jsterm.init();
 
     let toolbox = gDevTools.getToolbox(this.owner.target);
@@ -3877,17 +3877,17 @@ JSTerm.prototype = {
    *
    * @param boolean aClearStorage
    *        True if you want to clear the console messages storage associated to
    *        this Web Console.
    */
   clearOutput: function JST_clearOutput(aClearStorage)
   {
     let hud = this.hud;
-    let outputNode = hud.outputNode;
+    let outputNode = this.outputNode;
     let node;
     while ((node = outputNode.firstChild)) {
       hud.removeOutputMessage(node);
     }
 
     hud.groupDepth = 0;
     hud._outputQueue.forEach(hud._destroyItem, hud);
     hud._outputQueue = [];
diff --git a/devtools/client/webconsole/webconsole.xul b/devtools/client/webconsole/webconsole.xul
--- a/devtools/client/webconsole/webconsole.xul
+++ b/devtools/client/webconsole/webconsole.xul
@@ -10,16 +10,17 @@
 <?xml-stylesheet href="chrome://devtools/skin/themes/common.css"
                  type="text/css"?>
 <?xml-stylesheet href="chrome://devtools/skin/themes/widgets.css"
                  type="text/css"?>
 <?xml-stylesheet href="chrome://devtools/skin/themes/webconsole.css"
                  type="text/css"?>
 <?xul-overlay href="chrome://global/content/editMenuOverlay.xul"?>
 <window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+        xmlns:html="http://www.w3.org/1999/xhtml"
         id="devtools-webconsole"
         macanimationtype="document"
         fullscreenbutton="true"
         title="&window.title;"
         browserConsoleTitle="&browserConsole.title;"
         windowtype="devtools:webconsole"
         width="900" height="350"
         persist="screenX screenY width height sizemode">
@@ -190,25 +191,27 @@ function goUpdateConsoleCommands() {
                         autocheck="false" prefKey="serverwarn"/>
               <menuitem label="&btnServerInfo;" type="checkbox" autocheck="false"
                         prefKey="serverinfo"/>
               <menuitem label="&btnServerLog;" type="checkbox" autocheck="false"
                         prefKey="serverlog"/>
             </menupopup>
           </toolbarbutton>
         </hbox>
-        <toolbarbutton class="webconsole-clear-console-button devtools-toolbarbutton"
-                       label="&btnClear.label;" tooltiptext="&btnClear.tooltip;"
-                       accesskey="&btnClear.accesskey;"
-                       tabindex="9"/>
-
         <spacer flex="1"/>
-
         <textbox class="compact hud-filter-box devtools-searchinput" type="search"
                  placeholder="&filterOutput.placeholder;" tabindex="2"/>
+         <!-- Yuck - title attribute doesn't work for html elements - Bug 248862 -->
+        <box style="width:32px;" flex="0" tooltiptext="&btnClear.tooltip;">
+        <html:button id="webconsole-clear-console-button"
+                     class="devtools-button devtools-clear-icon"
+                     title=""
+                     accesskey="&btnClear.accesskey;"
+                     tabindex="9"></html:button>
+        </box>
       </toolbar>
 
       <hbox id="output-wrapper" flex="1" context="output-contextmenu" tooltip="aHTMLTooltip">
         <div xmlns="http://www.w3.org/1999/xhtml" id="output-container"
              tabindex="0" role="document" aria-live="polite" />
       </hbox>
       <notificationbox id="webconsole-notificationbox">
         <hbox class="jsterm-input-container" style="direction:ltr">
