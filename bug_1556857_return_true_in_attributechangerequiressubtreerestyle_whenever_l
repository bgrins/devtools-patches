# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1559679440 25200
#      Tue Jun 04 13:17:20 2019 -0700
# Node ID 07a1a80957d8a322ea1ff222b08a13e307707655
# Parent  c909c105f914f69054b9a7c6b189ee39fa1cad44
Bug 1556857 - Return true in AttributeChangeRequiresSubtreeRestyle whenever lwtheme attrs change in any chrome doc, not just those with XUL document elements

In preparation for an <html> root node in browser.xhtml, we need to react to lwtheme changes correctly.

Differential Revision: https://phabricator.services.mozilla.com/D33693

diff --git a/layout/base/RestyleManager.cpp b/layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp
+++ b/layout/base/RestyleManager.cpp
@@ -3358,18 +3358,18 @@ void RestyleManager::TakeSnapshotForAttr
 // * lang="" and xml:lang="" can affect all descendants due to :lang()
 //
 static inline bool AttributeChangeRequiresSubtreeRestyle(
     const Element& aElement, nsAtom* aAttr) {
   if (aAttr == nsGkAtoms::cellpadding) {
     return aElement.IsHTMLElement(nsGkAtoms::table);
   }
   if (aAttr == nsGkAtoms::lwtheme || aAttr == nsGkAtoms::lwthemetextcolor) {
-    return aElement.GetNameSpaceID() == kNameSpaceID_XUL &&
-           &aElement == aElement.OwnerDoc()->GetRootElement();
+    Document* doc = aElement.OwnerDoc();
+    return doc->IsInChromeDocShell() && &aElement == doc->GetRootElement();
   }
 
   return aAttr == nsGkAtoms::lang;
 }
 
 void RestyleManager::AttributeChanged(Element* aElement, int32_t aNameSpaceID,
                                       nsAtom* aAttribute, int32_t aModType,
                                       const nsAttrValue* aOldValue) {
