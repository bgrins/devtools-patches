
# HG changeset patch
# User Brendan Dahl <bdahl@mozilla.com>
# Date 1539724667 25200
# Node ID 658c9908278f14d0f75a0e660d2e1fafa713efad
# Parent  bdab37a92b421ad27fd9de2e1fcc0af1bd424011
Delay XML layout.


diff --git a/dom/xml/nsXMLContentSink.cpp b/dom/xml/nsXMLContentSink.cpp
--- a/dom/xml/nsXMLContentSink.cpp
+++ b/dom/xml/nsXMLContentSink.cpp
@@ -1089,17 +1089,17 @@ nsXMLContentSink::HandleStartElement(con
           new nsDocElementCreatedNotificationRunner(mDocument));
 
       if (aInterruptable && NS_SUCCEEDED(result) && mParser && !mParser->IsParserEnabled()) {
         return NS_ERROR_HTMLPARSER_BLOCK;
       }
     } else if (!mCurrentHead) {
       // This isn't the root and we're not inside an XHTML <head>.
       // Might need to start layout
-      MaybeStartLayout(false);
+      // MaybeStartLayout(false);
     }
   }
 
   return aInterruptable && NS_SUCCEEDED(result) ? DidProcessATokenImpl() :
                                                   result;
 }
 
 NS_IMETHODIMP
@@ -1172,17 +1172,17 @@ nsXMLContentSink::HandleEndElement(const
   }
 
   if (mDocElement == content) {
     // XXXbz for roots that don't want to be appended on open, we
     // probably need to deal here.... (and stop appending them on open).
     mState = eXMLContentSinkState_InEpilog;
 
     // We might have had no occasion to start layout yet.  Do so now.
-    MaybeStartLayout(false);
+    // MaybeStartLayout(false);
   }
 
   DidAddContent();
 
   if (content->IsSVGElement(nsGkAtoms::svg)) {
     FlushTags();
     nsCOMPtr<nsIRunnable> event = new nsHtml5SVGLoadDispatcher(content);
     if (NS_FAILED(content->OwnerDoc()->Dispatch(TaskCategory::Other,

