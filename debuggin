# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  d885f3e6cf5ac6241ee85569456687d4de86c451
Force checkboxchecked to sync

diff --git a/toolkit/modules/PopupNotifications.jsm b/toolkit/modules/PopupNotifications.jsm
--- a/toolkit/modules/PopupNotifications.jsm
+++ b/toolkit/modules/PopupNotifications.jsm
@@ -921,20 +921,26 @@ PopupNotifications.prototype = {
         popupnotification.setAttribute("secondarybuttonhidden", "true");
         popupnotification.setAttribute("dropmarkerhidden", "true");
       }
 
       let checkbox = n.options.checkbox;
       if (checkbox && checkbox.label) {
         let checked = n._checkboxChecked != null ? n._checkboxChecked : !!checkbox.checked;
 
-        popupnotification.setAttribute("checkboxhidden", "false");
+        // If we don't have _checkboxChecked state, then we want to reset the attribute first, to make
+        // sure it gets synced back down to the checkbox (even if the value is unchanged). The element
+        // won't sync down unchanged attributes by default, to prevent resetting the checked attribute
+        // if the user clicked on the checkbox.
+        if (n._checkboxChecked == null) {
+          popupnotification.removeAttribute("checkboxchecked");
+        }
         popupnotification.setAttribute("checkboxchecked", checked);
+        popupnotification.setAttribute("checkboxhidden", "false");
         popupnotification.setAttribute("checkboxlabel", checkbox.label);
-
         popupnotification.setAttribute("checkboxcommand", "PopupNotifications._onCheckboxCommand(event);");
 
         if (checked) {
           this._setNotificationUIState(popupnotification, checkbox.checkedState);
         } else {
           this._setNotificationUIState(popupnotification, checkbox.uncheckedState);
         }
       } else {
