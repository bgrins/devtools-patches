# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  536865ff074b6fb33805a4694cd4a26022f39fb9
Bug XXX: Variables view 'delete' function doesn't work in worker console

diff --git a/devtools/server/actors/webconsole.js b/devtools/server/actors/webconsole.js
--- a/devtools/server/actors/webconsole.js
+++ b/devtools/server/actors/webconsole.js
@@ -1155,19 +1155,24 @@ WebConsoleActor.prototype =
     if (aOptions.bindObjectActor) {
       let objActor = this.getActorByID(aOptions.bindObjectActor);
       if (objActor) {
         let jsObj = objActor.obj.unsafeDereference();
         // If we use the makeDebuggeeValue method of jsObj's own global, then
         // we'll get a D.O that sees jsObj as viewed from its own compartment -
         // that is, without wrappers. The evalWithBindings call will then wrap
         // jsObj appropriately for the evaluation compartment.
-        let global = Cu.getGlobalForObject(jsObj);
-        dbgWindow = dbg.makeGlobalObjectReference(global);
-        bindSelf = dbgWindow.makeDebuggeeValue(jsObj);
+        if (isWorker) {
+          dbgWindow = objActor.obj.global;
+          bindSelf = objActor.obj;
+        } else {
+          let global = Cu.getGlobalForObject(jsObj);
+          dbgWindow = dbg.makeGlobalObjectReference(global);
+          bindSelf = dbgWindow.makeDebuggeeValue(jsObj);
+        }
       }
     }
 
     // Get the Web Console commands for the given debugger window.
     let helpers = this._getWebConsoleCommands(dbgWindow);
     let bindings = helpers.sandbox;
     if (bindSelf) {
       bindings._self = bindSelf;
