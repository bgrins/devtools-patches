# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  47ea4e2d91edfd5a556333bba18c9007c9a013b4
Bug 1160345 - Set toolbox button visibility before consulting with the GCLI actor (which may not be available on old servers);r=jryans

diff --git a/browser/devtools/framework/toolbox.js b/browser/devtools/framework/toolbox.js
--- a/browser/devtools/framework/toolbox.js
+++ b/browser/devtools/framework/toolbox.js
@@ -712,16 +712,20 @@ Toolbox.prototype = {
   /**
    * Add buttons to the UI as specified in the devtools.toolbox.toolbarSpec pref
    */
   _buildButtons: function() {
     if (!this.target.isAddon) {
       this._buildPickerButton();
     }
 
+    // Set the visibility of the built in buttons before adding more buttons
+    // so they are shown before calling into the GCLI actor.
+    this.setToolboxButtonsVisibility();
+
     const options = {
       environment: CommandUtils.createEnvironment(this, '_target')
     };
     return CommandUtils.createRequisition(this.target, options).then(requisition => {
       this._requisition = requisition;
 
       const spec = CommandUtils.getCommandbarSpec("devtools.toolbox.toolbarSpec");
       return CommandUtils.createButtons(spec, this.target, this.doc,
