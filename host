# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  b4beed65a87a280f1d4e1231ffbe43dce341278a
Bug 1573158 - Target all menupopups within BMB_bookmarksPopup more directly instead of requiring runtime check in JS

diff --git a/browser/base/content/browser.xhtml b/browser/base/content/browser.xhtml
--- a/browser/base/content/browser.xhtml
+++ b/browser/base/content/browser.xhtml
@@ -1283,16 +1283,17 @@
                      ondragover="PlacesMenuDNDHandler.onDragOver(event);"
                      ondragleave="PlacesMenuDNDHandler.onDragLeave(event);"
                      ondrop="PlacesMenuDNDHandler.onDrop(event);"
                      oncommand="BookmarkingUI.onCommand(event);">
         <menupopup id="BMB_bookmarksPopup"
                    is="places-popup-arrow"
                    class="cui-widget-panel cui-widget-panelview cui-widget-panelWithFooter PanelUI-subView"
                    placespopup="true"
+                   bookmarkspopup="true"
                    context="placesContext"
                    openInTabs="children"
                    side="top"
                    onmouseup="BookmarksEventHandler.onMouseUp(event);"
                    oncommand="BookmarksEventHandler.onCommand(event);"
                    onclick="BookmarksEventHandler.onClick(event, this.parentNode._placesView);"
                    onpopupshowing="BookmarkingUI.onPopupShowing(event);
                                    BookmarkingUI.attachPlacesView(event, this);"
@@ -1311,16 +1312,17 @@
           <menuseparator/>
           <menu id="BMB_bookmarksToolbar"
                 class="menu-iconic bookmark-item subviewbutton"
                 label="&personalbarCmd.label;"
                 container="true">
             <menupopup id="BMB_bookmarksToolbarPopup"
                        is="places-popup"
                        placespopup="true"
+                       bookmarkspopup="true"
                        context="placesContext"
                        onpopupshowing="if (!this.parentNode._placesView)
                                          new PlacesMenu(event, `place:parent=${PlacesUtils.bookmarks.toolbarGuid}`,
                                                         PlacesUIUtils.getViewForNode(this.parentNode.parentNode).options);">
               <menuitem id="BMB_viewBookmarksToolbar"
                         class="menuitem-iconic subviewbutton"
                         label-show="&viewBookmarksToolbar.label;"
                         label-hide="&hideBookmarksToolbar.label;"
@@ -1331,29 +1333,31 @@
           </menu>
           <menu id="BMB_unsortedBookmarks"
                 class="menu-iconic bookmark-item subviewbutton"
                 label="&bookmarksMenuButton.other.label;"
                 container="true">
             <menupopup id="BMB_unsortedBookmarksPopup"
                        is="places-popup"
                        placespopup="true"
+                       bookmarkspopup="true"
                        context="placesContext"
                        onpopupshowing="if (!this.parentNode._placesView)
                                          new PlacesMenu(event, `place:parent=${PlacesUtils.bookmarks.unfiledGuid}`,
                                                         PlacesUIUtils.getViewForNode(this.parentNode.parentNode).options);"/>
           </menu>
           <menu id="BMB_mobileBookmarks"
                 class="menu-iconic bookmark-item subviewbutton"
                 label="&bookmarksMenuButton.mobile.label;"
                 hidden="true"
                 container="true">
             <menupopup id="BMB_mobileBookmarksPopup"
                        is="places-popup"
                        placespopup="true"
+                       bookmarkspopup="true"
                        context="placesContext"
                        onpopupshowing="if (!this.parentNode._placesView)
                                          new PlacesMenu(event, `place:parent=${PlacesUtils.bookmarks.mobileGuid}`,
                                                         PlacesUIUtils.getViewForNode(this.parentNode.parentNode).options);"/>
           </menu>
 
           <menuseparator/>
           <!-- Bookmarks menu items will go here -->
diff --git a/browser/components/places/content/places-menupopup.js b/browser/components/places/content/places-menupopup.js
--- a/browser/components/places/content/places-menupopup.js
+++ b/browser/components/places/content/places-menupopup.js
@@ -30,55 +30,48 @@
       for (let event_name of event_names) {
         this.addEventListener(event_name, ev => this[`on_${event_name}`](ev));
       }
 
       this.attachShadow({ mode: "open" });
     }
 
     get commonStyles() {
-      if (this.closest("#BMB_bookmarksPopup")) {
-        return `
+      return `
         /* Remove padding on xul:arrowscrollbox to avoid extra padding on footer */
-        arrowscrollbox.popup-internal-box {
+        :host([bookmarkspopup=true]) arrowscrollbox.popup-internal-box {
           padding-bottom: 0px;
         }
-        .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-up,
-        .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-down {
+        :host([bookmarkspopup=true]) .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-up,
+        :host([bookmarkspopup=true]) .panel-arrowcontainer > .panel-arrowcontent > .popup-internal-box > .scrollbutton-down {
           -moz-appearance: none;
           margin-top: 0;
           margin-bottom: 0;
         }
       `;
-      }
-      return "";
     }
 
     get styles() {
-      if (!this.closest("#BMB_bookmarksPopup")) {
-        return "";
-      }
-
       let s = `
       /* Popups with only one item don't have a footer */
       :host([singleitempopup=true]) > hbox > .popup-internal-box > .arrowscrollbox-scrollbox,
       /* These popups never have a footer */
       :host(#BMB_bookmarksToolbarPopup) > hbox > .popup-internal-box > .arrowscrollbox-scrollbox,
       :host(#BMB_unsortedBookmarksPopup) > hbox > .popup-internal-box > .arrowscrollbox-scrollbox,
       :host(#BMB_mobileBookmarksPopup) > hbox > .popup-internal-box > .arrowscrollbox-scrollbox {
         /* And so they need some bottom padding: */
         padding-bottom: 4px;
       }
     `;
       switch (AppConstants.platform) {
         case "linux":
         case "win":
           return `${s}
           /* Add some space at the top because there are no headers: */
-          :host > hbox > .popup-internal-box > .arrowscrollbox-scrollbox  {
+          :host([bookmarkspopup=true]) > hbox > .popup-internal-box > .arrowscrollbox-scrollbox  {
             padding-top: 4px;
           }
         `;
         default:
           return s;
       }
     }
 
