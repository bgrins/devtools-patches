# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  48314f305f726c8e6253442167ca44f09a4c667d
Bug XXX: Right click

diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -1120,18 +1120,21 @@
     </svg:clipPath>
 #ifdef XP_WIN
     <svg:clipPath id="urlbar-back-button-clip-path-win10">
       <svg:path d="M -6,-2 l 0,1 a 15 15 0 0,1 0,30 l 0,1 l 10000,0 l 0,-32 l -10000,0 z" />
     </svg:clipPath>
 #endif
   </svg:svg>
 
+
 </vbox>
 # <iframe id="tab-view"> is dynamically appended as the 2nd child of #tab-view-deck.
 #     Introducing the iframe dynamically, as needed, was found to be better than
 #     starting with an empty iframe here in browser.xul from a Ts standpoint.
 </deck>
 
+
+
 # Put it at the very end to make sure it is not covered by anything.
 <hbox id="fullscr-toggler" hidden="true"/>
 
 </window>
diff --git a/devtools/client/framework/toolbox.js b/devtools/client/framework/toolbox.js
--- a/devtools/client/framework/toolbox.js
+++ b/devtools/client/framework/toolbox.js
@@ -190,16 +190,27 @@ Toolbox.prototype = {
     LAST_TOOL: "devtools.toolbox.selectedTool",
     SIDE_ENABLED: "devtools.toolbox.sideEnabled",
     PREVIOUS_HOST: "devtools.toolbox.previousHost"
   },
 
   currentToolId: null,
   lastUsedToolId: null,
 
+  /* Create a context menu and open it */
+  openContextMenuAtPoint: function(e, items) {
+    console.log("Creating a context menu");
+
+    console.log("Opening a context menu");
+    this.textboxContextMenuPopup.openPopupAtScreen(e.screenX, e.screenY, true);
+
+    // this.textboxContextMenuPopup.addEventListener("popupshowing",
+    //   this._updateTextboxMenuItems, true);
+  },
+
   /**
    * Returns a *copy* of the _toolPanels collection.
    *
    * @return {Map} panels
    *         All the running panels in the toolbox
    */
   getToolPanels: function() {
     return new Map(this._toolPanels);
@@ -370,16 +381,28 @@ Toolbox.prototype = {
 
       // Attach the thread
       this._threadClient = yield attachThread(this);
       yield domReady.promise;
 
       this.isReady = true;
       let framesPromise = this._listFrames();
 
+      this.doc.addEventListener("contextmenu", (e) => {
+        console.log(e, e.defaultPrevented);
+        if (!e.defaultPrevented) {
+          this.openContextMenuAtPoint(e, [
+            { label: "hi", onClick: () => {
+              console.log("click");
+            }}
+          ]);
+          e.stopPropagation();
+        }
+      });
+
       this.closeButton = this.doc.getElementById("toolbox-close");
       this.closeButton.addEventListener("command", this.destroy, true);
 
       gDevTools.on("pref-changed", this._prefChanged);
 
       let framesMenu = this.doc.getElementById("command-button-frames");
       framesMenu.addEventListener("command", this.selectFrame, true);
 
diff --git a/devtools/client/jar.mn b/devtools/client/jar.mn
--- a/devtools/client/jar.mn
+++ b/devtools/client/jar.mn
@@ -16,16 +16,17 @@ devtools.jar:
     content/netmonitor/netmonitor.xul (netmonitor/netmonitor.xul)
     content/netmonitor/netmonitor.css (netmonitor/netmonitor.css)
     content/netmonitor/netmonitor-controller.js (netmonitor/netmonitor-controller.js)
     content/netmonitor/netmonitor-view.js (netmonitor/netmonitor-view.js)
     content/webconsole/webconsole.xul (webconsole/webconsole.xul)
 *   content/scratchpad/scratchpad.xul (scratchpad/scratchpad.xul)
     content/scratchpad/scratchpad.js (scratchpad/scratchpad.js)
     content/shared/splitview.css (shared/splitview.css)
+    content/test-page.html (test-page.html)
     content/shared/theme-switching.js (shared/theme-switching.js)
     content/shared/frame-script-utils.js (shared/frame-script-utils.js)
     content/styleeditor/styleeditor.xul (styleeditor/styleeditor.xul)
     content/styleeditor/styleeditor.css (styleeditor/styleeditor.css)
     content/storage/storage.xul (storage/storage.xul)
     content/inspector/fonts/fonts.js (inspector/fonts/fonts.js)
     content/inspector/layout/layout.js (inspector/layout/layout.js)
     content/inspector/markup/markup.xhtml (inspector/markup/markup.xhtml)
diff --git a/devtools/client/test-page.html b/devtools/client/test-page.html
new file mode 100644
--- /dev/null
+++ b/devtools/client/test-page.html
@@ -0,0 +1,15 @@
+<body>
+
+  <menu type="context" id="mymenu">
+    <menuitem label="Refresh Post" onclick="window.location.reload();" icon="/images/refresh-icon.png"></menuitem>
+    <menuitem label="Skip to Comments" onclick="window.location='#comments';" icon="/images/comment_icon.gif"></menuitem>
+    <menu label="Share on..." icon="/images/share_icon.gif">
+      <menuitem label="Twitter" icon="/images/twitter_icon.gif" onclick="goTo('//twitter.com/intent/tweet?text=' + document.title + ':  ' + window.location.href);"></menuitem>
+      <menuitem label="Facebook" icon="/images/facebook_icon16x16.gif" onclick="goTo('//facebook.com/sharer/sharer.php?u=' + window.location.href);"></menuitem>
+    </menu>
+  </menu>
+
+  <div contextmenu="mymenu">
+  Right click me!
+  </div>
+</body>
\ No newline at end of file
