# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  64a06fbc559d953d09d2681114b5e5ec6495416a
Bug 1258154 - Open functions in variables view if they were returned from console evaluation;r=jlongster

diff --git a/devtools/client/webconsole/console-output.js b/devtools/client/webconsole/console-output.js
--- a/devtools/client/webconsole/console-output.js
+++ b/devtools/client/webconsole/console-output.js
@@ -2774,17 +2774,17 @@ Widgets.ObjectRenderers.add({
       shown++;
     }
 
     this._text(")");
   },
 
   _onClick: function () {
     let location = this.objectActor.location;
-    if (location) {
+    if (location && location.source && location.source.url) {
       this.output.openLocationInDebugger(location);
     }
     else {
       this.openObjectInVariablesView();
     }
   }
 }); // Widgets.ObjectRenderers.byClass.Function
 
diff --git a/devtools/client/webconsole/test/browser_console_variables_view.js b/devtools/client/webconsole/test/browser_console_variables_view.js
--- a/devtools/client/webconsole/test/browser_console_variables_view.js
+++ b/devtools/client/webconsole/test/browser_console_variables_view.js
@@ -16,16 +16,37 @@ var hud;
 
 add_task(function* () {
   yield loadTab(TEST_URI);
 
   hud = yield openConsole();
 
   gWebConsole = hud;
   gJSTerm = hud.jsterm;
+
+  let msg = yield gJSTerm.execute("(function foo(){})");
+
+  ok(msg, "output message found");
+  ok(msg.textContent.includes("function foo()"),
+                              "message text check");
+
+  executeSoon(() => {
+    EventUtils.synthesizeMouse(msg.querySelector("a"), 2, 2, {}, hud.iframeWindow);
+  });
+
+  let varView = yield hud.jsterm.once("variablesview-fetched");
+  ok(varView, "object inspector opened on click");
+
+  yield findVariableViewProperties(varView, [{
+    name: "name",
+    value: "foo",
+  }], { webconsole: hud });
+});
+
+add_task(function* () {
   let msg = yield gJSTerm.execute("fooObj");
 
   ok(msg, "output message found");
   ok(msg.textContent.includes('{ testProp: "testValue" }'),
                               "message text check");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object link found");
