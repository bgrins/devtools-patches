# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1559852185 25200
#      Thu Jun 06 13:16:25 2019 -0700
# Node ID 96ea5b97c180fb85b2c177b561c1867c1de4aa97
# Parent  1dcd859a48f268553f5a12b572685e07cdb0c903
Bug 1492582 - Workaround issue where anonymous popupgroup is created after the popupset layout

This would be better solved with a layout fix

Differential Revision: https://phabricator.services.mozilla.com/D34023

diff --git a/browser/base/content/browser.js b/browser/base/content/browser.js
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -1447,16 +1447,17 @@ var gBrowserInit = {
     }
 
     // Call this after we set attributes that might change toolbars' computed
     // text color.
     ToolbarIconColor.init();
   },
 
   onDOMContentLoaded() {
+    document.getElementById("mainPopupSet").hidden = false;
     // This needs setting up before we create the first remote browser.
     window.docShell.treeOwner
           .QueryInterface(Ci.nsIInterfaceRequestor)
           .getInterface(Ci.nsIXULWindow)
           .XULBrowserWindow = window.XULBrowserWindow;
     window.browserDOMWindow = new nsBrowserAccess();
 
     gBrowser = window._gBrowser;
diff --git a/browser/base/content/browser.xhtml b/browser/base/content/browser.xhtml
--- a/browser/base/content/browser.xhtml
+++ b/browser/base/content/browser.xhtml
@@ -122,17 +122,17 @@
 # top level windows in macWindow.inc.xul.
 #include browser-sets.inc
 
 </head>
 <body>
 
 <vbox id="browser-ui-wrapper"
       xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
-  <popupset id="mainPopupSet">
+  <popupset id="mainPopupSet" hidden="true">
     <menupopup id="tabContextMenu"
                onpopupshowing="if (event.target == this) TabContextMenu.updateContextMenu(this);"
                onpopuphidden="if (event.target == this) TabContextMenu.contextTab = null;">
       <menuitem id="context_reloadTab" data-lazy-l10n-id="reload-tab"
                 oncommand="gBrowser.reloadTab(TabContextMenu.contextTab);"/>
       <menuitem id="context_reloadSelectedTabs" data-lazy-l10n-id="reload-tabs" hidden="true"
                 oncommand="gBrowser.reloadMultiSelectedTabs();"/>
       <menuitem id="context_toggleMuteTab" oncommand="TabContextMenu.contextTab.toggleMuteAudio();"/>
