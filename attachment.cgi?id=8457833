# HG changeset patch
# Parent 4118687bbaeb0ba14a7375b83058aca82be8c017
# User Heather Arthur <fayearthur@gmail.com>
Bug 1033082 - Display exact line numbers for rules in @media sidebar; r=bgrins

diff --git a/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar.js b/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar.js
--- a/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar.js
+++ b/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar.js
@@ -3,17 +3,17 @@
    http://creativecommons.org/publicdomain/zero/1.0/ */
 
 // https rather than chrome to improve coverage
 const TESTCASE_URI = TEST_BASE_HTTPS + "media-rules.html";
 const MEDIA_PREF = "devtools.styleeditor.showMediaSidebar";
 
 const RESIZE = 300;
 const LABELS = ["not all", "all", "(max-width: 400px)", "(max-width: 600px)"];
-const LINE_NOS = [2, 8, 20, 25];
+const LINE_NOS = [1, 7, 19, 25];
 const NEW_RULE = "\n@media (max-width: 600px) { div { color: blue; } }";
 
 waitForExplicitFinish();
 
 let test = asyncTest(function*() {
   let {UI} = yield addTabAndOpenStyleEditors(2, null, TESTCASE_URI);
 
   is(UI.editors.length, 2, "correct number of editors");
diff --git a/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar_sourcemaps.js b/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar_sourcemaps.js
--- a/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar_sourcemaps.js
+++ b/browser/devtools/styleeditor/test/browser_styleeditor_media_sidebar_sourcemaps.js
@@ -3,17 +3,17 @@
    http://creativecommons.org/publicdomain/zero/1.0/ */
 
 // https rather than chrome to improve coverage
 const TESTCASE_URI = TEST_BASE_HTTPS + "media-rules-sourcemaps.html";
 const MAP_PREF = "devtools.styleeditor.source-maps-enabled";
 
 const LABELS = ["screen and (max-width: 320px)",
                 "screen and (min-width: 1200px)"];
-const LINE_NOS = [4, 4];
+const LINE_NOS = [5, 8];
 
 waitForExplicitFinish();
 
 let test = asyncTest(function*() {
   Services.prefs.setBoolPref(MAP_PREF, true);
 
   let {UI} = yield addTabAndOpenStyleEditors(2, null, TESTCASE_URI);
 
diff --git a/toolkit/devtools/server/actors/stylesheets.js b/toolkit/devtools/server/actors/stylesheets.js
--- a/toolkit/devtools/server/actors/stylesheets.js
+++ b/toolkit/devtools/server/actors/stylesheets.js
@@ -299,26 +299,18 @@ let MediaRuleActor = protocol.ActorClass
     protocol.Actor.prototype.initialize.call(this, null);
 
     this.rawRule = aMediaRule;
     this.parentActor = aParentActor;
     this.conn = this.parentActor.conn;
 
     this._matchesChange = this._matchesChange.bind(this);
 
-    this.line = 0;
-    this.column = 0;
-
-    // We can't get the line of the @media rule itself, so get the line of
-    // the first rule in the media block. See bug 591303.
-    let firstRule = this.rawRule.cssRules[0];
-    if (firstRule && firstRule instanceof Ci.nsIDOMCSSStyleRule) {
-      this.line = DOMUtils.getRuleLine(firstRule);
-      this.column = DOMUtils.getRuleColumn(firstRule);
-    }
+    this.line = DOMUtils.getRuleLine(aMediaRule);
+    this.column = DOMUtils.getRuleColumn(aMediaRule);
 
     try {
       this.mql = this.window.matchMedia(aMediaRule.media.mediaText);
     } catch(e) {
     }
 
     if (this.mql) {
       this.mql.addListener(this._matchesChange);
