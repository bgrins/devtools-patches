# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  b3ceae83e290925f754544cff4d30ef4de9ab399
Bug 1448213 - Log when accesskey attribute copying would happen

diff --git a/toolkit/content/widgets/general.xml b/toolkit/content/widgets/general.xml
--- a/toolkit/content/widgets/general.xml
+++ b/toolkit/content/widgets/general.xml
@@ -41,16 +41,19 @@
         </getter>
         <setter>
           <![CDATA[
             // Always store on the control
             this.setAttribute("accesskey", val);
             // If there is a label, change the accesskey on the labelElement
             // if it's also set there
             if (this.labelElement) {
+              if (this.getAttribute("accesskey") != this.labelElement.getAttribute("accesskey")) {
+                throw new Error("Would have changed the access key from control setter", this.id, this.labelElement.id);
+              }
               this.labelElement.accessKey = val;
             }
             return val;
           ]]>
         </setter>
       </property>
 
       <field name="labelElement"/>
diff --git a/toolkit/content/widgets/text.xml b/toolkit/content/widgets/text.xml
--- a/toolkit/content/widgets/text.xml
+++ b/toolkit/content/widgets/text.xml
@@ -24,22 +24,30 @@
         <parameter name="firstTime"/>
         <body>
           <![CDATA[
             var control = this.labeledControlElement;
             if (!control) {
               var bindingParent = document.getBindingParent(this);
               if ("accessKey" in bindingParent) {
                 control = bindingParent; // For controls that make the <label> an anon child
+
+                if (bindingParent.getAttribute("accesskey") != this.getAttribute("accesskey")) {
+                  throw new Error("Would have changed the access key from label formatter", this.id, bindingParent.id);
+                }
               }
             }
             if (control) {
               control.labelElement = this;
               var controlAccessKey = control.getAttribute("accesskey");
               if (controlAccessKey) {
+
+                if (controlAccessKey != this.getAttribute("accesskey")) {
+                  throw new Error("Would have changed the access key from label formatter 2", this.id, control.id);
+                }
                 this.setAttribute("accesskey", controlAccessKey);
               }
             }
 
             var accessKey = this.accessKey;
             // No need to remove existing formatting the first time.
             if (firstTime && !accessKey)
               return;
