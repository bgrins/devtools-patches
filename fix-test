# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  52285ea5e54c73d3ed824544cef2ee3f195f05e6
Bug 1386724 - Force devtools-browser to be loaded in shared-head.js;r=jdescottes

If a devtools entry point isn't hit in a test (toolbox open, keyboard shortcut,
opening the web dev menu, etc), then things like the menu items aren't installed.
This is for performance reasons (Bug 1359855), but it means that some tests
may fail when run alone. Prevent that from happening by forcing devtools to start
up in shared-head.js.

This causes certain tests to fail when run alone if they don't open the tools

MozReview-Commit-ID: ANuUhYXIbSF

diff --git a/devtools/client/framework/test/shared-head.js b/devtools/client/framework/test/shared-head.js
--- a/devtools/client/framework/test/shared-head.js
+++ b/devtools/client/framework/test/shared-head.js
@@ -53,16 +53,19 @@ const KeyShortcuts = require("devtools/c
 
 const TEST_DIR = gTestPath.substr(0, gTestPath.lastIndexOf("/"));
 const CHROME_URL_ROOT = TEST_DIR + "/";
 const URL_ROOT = CHROME_URL_ROOT.replace("chrome://mochitests/content/",
                                          "http://example.com/");
 const URL_ROOT_SSL = CHROME_URL_ROOT.replace("chrome://mochitests/content/",
                                              "https://example.com/");
 
+// Force devtools to be initialized so menu items and keyboard shortcuts get installed
+require("devtools/client/framework/devtools-browser");
+
 // All test are asynchronous
 waitForExplicitFinish();
 
 var EXPECTED_DTU_ASSERT_FAILURE_COUNT = 0;
 
 registerCleanupFunction(function () {
   if (DevToolsUtils.assertionFailureCount !==
       EXPECTED_DTU_ASSERT_FAILURE_COUNT) {
