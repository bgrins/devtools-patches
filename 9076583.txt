# HG changeset patch
# Parent  77fe50ce34f1cd605f9a06c1290f19bc48aed97f

diff --git a/layout/generic/nsFrame.cpp b/layout/generic/nsFrame.cpp
--- a/layout/generic/nsFrame.cpp
+++ b/layout/generic/nsFrame.cpp
@@ -10537,17 +10537,20 @@ nsFrame::BoxReflow(nsBoxLayoutState&    
       reflowInput.SetComputedWidth(computedWidth);
     }
 
     // Most child frames of box frames (e.g. subdocument or scroll frames)
     // need to be constrained to the provided size and overflow as necessary.
     // The one exception are block frames, because we need to know their
     // natural height excluding any overflow area which may be caused by
     // various CSS effects such as shadow or outline.
-    if (!IsFrameOfType(eBlockFrame)) {
+// XXXdholbert Add a boolean pref-mirror and check that before testing for flex here.
+// And rather than testing for 480 padding-top, instead test for -moz-appearance:maximized-titlebar stuff
+    if (!IsFrameOfType(eBlockFrame) &&
+        (!IsFlexContainerFrame() || reflowInput.ComputedPhysicalPadding().top != 480)) {
       if (aHeight != NS_INTRINSICSIZE) {
         nscoord computedHeight =
           aHeight - reflowInput.ComputedPhysicalBorderPadding().TopBottom();
         computedHeight = std::max(computedHeight, 0);
         reflowInput.SetComputedHeight(computedHeight);
       } else {
         reflowInput.SetComputedHeight(
           ComputeSize(aRenderingContext, wm,
