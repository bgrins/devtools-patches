# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1555361850 25200
#      Mon Apr 15 13:57:30 2019 -0700
# Node ID b9651a1bee01afdc9a30a840762c282d844430db
# Parent  adc32d869e58d0c052094f718bc9e4cff8390be4
Bug 1543828 - WIP - Explicitly set [dir] on strings inside of the video controls UA Widget

This seems to fix it, but setting [dir] only on a container element doesn't
for some reason. Maybe something's not being propagated through the UA widget.

Build / testing instructions for OSX (full build only) based on https://firefox-source-docs.mozilla.org/build/buildsystem/locales.html#instructions-for-single-locale-repacks-for-developers:

./mach build && ./mach package && ./mach build installers-fa && ./objdir-full-opt.noindex/dist/l10n-stage/firefox/Nightly.app/Contents/MacOS/firefox --profile $(mktemp -d) http://dl3.webmfiles.org/elephants-dream.webm

Differential Revision: https://phabricator.services.mozilla.com/D27589

diff --git a/toolkit/content/widgets/videocontrols.js b/toolkit/content/widgets/videocontrols.js
--- a/toolkit/content/widgets/videocontrols.js
+++ b/toolkit/content/widgets/videocontrols.js
@@ -2223,33 +2223,35 @@ this.VideoControlsImplWidget = class {
     /*
      * Pass the markup through XML parser purely for the reason of loading the localization DTD.
      * Remove it when migrate to Fluent.
      */
     const parser = new this.window.DOMParser();
     let parserDoc = parser.parseFromString(`<!DOCTYPE bindings [
       <!ENTITY % videocontrolsDTD SYSTEM "chrome://global/locale/videocontrols.dtd">
       %videocontrolsDTD;
+      <!ENTITY % globalDTD SYSTEM "chrome://global/locale/global.dtd">
+      %globalDTD;
       ]>
       <div class="videocontrols" xmlns="http://www.w3.org/1999/xhtml" role="none">
         <link rel="stylesheet" type="text/css" href="chrome://global/skin/media/videocontrols.css" />
         <div id="controlsContainer" class="controlsContainer" role="none">
           <div id="statusOverlay" class="statusOverlay stackItem" hidden="true">
             <div id="statusIcon" class="statusIcon"></div>
-            <span class="statusLabel" id="errorAborted">&error.aborted;</span>
-            <span class="statusLabel" id="errorNetwork">&error.network;</span>
-            <span class="statusLabel" id="errorDecode">&error.decode;</span>
-            <span class="statusLabel" id="errorSrcNotSupported">&error.srcNotSupported;</span>
-            <span class="statusLabel" id="errorNoSource">&error.noSource2;</span>
-            <span class="statusLabel" id="errorGeneric">&error.generic;</span>
+            <span class="statusLabel" id="errorAborted" dir="&locale.dir;">&error.aborted;</span>
+            <span class="statusLabel" id="errorNetwork" dir="&locale.dir;">&error.network;</span>
+            <span class="statusLabel" id="errorDecode" dir="&locale.dir;">&error.decode;</span>
+            <span class="statusLabel" id="errorSrcNotSupported" dir="&locale.dir;">&error.srcNotSupported;</span>
+            <span class="statusLabel" id="errorNoSource" dir="&locale.dir;">&error.noSource2;</span>
+            <span class="statusLabel" id="errorGeneric" dir="&locale.dir;">&error.generic;</span>
           </div>
 
           <div id="pictureInPictureOverlay" class="pictureInPictureOverlay stackItem" status="pictureInPicture" hidden="true">
             <div class="statusIcon" type="pictureInPicture"></div>
-            <span class="statusLabel" id="pictureInPicture">&status.pictureInPicture;</span>
+            <span class="statusLabel" id="pictureInPicture" dir="&locale.dir;">&status.pictureInPicture;</span>
           </div>
 
           <div id="controlsOverlay" class="controlsOverlay stackItem" role="none">
             <div class="controlsSpacerStack">
               <div id="controlsSpacer" class="controlsSpacer stackItem" role="none"></div>
               <div id="clickToPlay" class="clickToPlay" hidden="true"></div>
             </div>
 
@@ -2265,17 +2267,17 @@ this.VideoControlsImplWidget = class {
                     <progress id="bufferBar" class="bufferBar" value="0" max="100" tabindex="-1"></progress>
                     <progress id="progressBar" class="progressBar" value="0" max="100" tabindex="-1"></progress>
                   </div>
                 </div>
                 <input type="range" id="scrubber" class="scrubber" tabindex="-1"/>
               </div>
               <span id="positionLabel" class="positionLabel" role="presentation"></span>
               <span id="durationLabel" class="durationLabel" role="presentation"></span>
-              <span id="positionDurationBox" class="positionDurationBox" aria-hidden="true">
+              <span id="positionDurationBox" class="positionDurationBox" aria-hidden="true" dir="&locale.dir;">
                 &positionAndDuration.nameFormat;
               </span>
               <div id="controlBarSpacer" class="controlBarSpacer" hidden="true" role="none"></div>
               <button id="muteButton"
                       class="button muteButton"
                       mutelabel="&muteButton.muteLabel;"
                       unmutelabel="&muteButton.unmuteLabel;"
                       tabindex="-1"/>
