# HG changeset patch
# Parent 1fe3eed021cbaaaa0964ab3b3d2660b629736da6
# User Jayesh Choudhari <jayesh.choudhari17@gmail.com>
BUG#993445: Highlighting the nodes on hovering of the buttons on the breadcrumb in the inspecto
* * *
Adding Test File For breadCrumb Highlight

diff --git a/browser/devtools/inspector/breadcrumbs.js b/browser/devtools/inspector/breadcrumbs.js
--- a/browser/devtools/inspector/breadcrumbs.js
+++ b/browser/devtools/inspector/breadcrumbs.js
@@ -83,16 +83,18 @@ HTMLBreadcrumbs.prototype = {
     this.separators.innerHTML =
                       "<box id='breadcrumb-separator-before'></box>" +
                       "<box id='breadcrumb-separator-after'></box>" +
                       "<box id='breadcrumb-separator-normal'></box>";
     this.container.parentNode.appendChild(this.separators);
 
     this.container.addEventListener("mousedown", this, true);
     this.container.addEventListener("keypress", this, true);
+    this.container.addEventListener("mouseover", this, true);
+    this.container.addEventListener("mouseleave", this, true);
 
     // We will save a list of already displayed nodes in this array.
     this.nodeHierarchy = [];
 
     // Last selected node in nodeHierarchy.
     this.currentIndex = -1;
 
     // By default, hide the arrows. We let the <scrollbox> show them
@@ -368,16 +370,27 @@ HTMLBreadcrumbs.prototype = {
           if (node) {
             this.selection.setNodeFront(node, "breadcrumbs");
           }
         });
       });
       event.preventDefault();
       event.stopPropagation();
     }
+
+    if (event.type == "mouseover") {
+      let target = event.originalTarget;
+      if (target.tagName == "button") {
+        target.onBreadcrumbsHover();
+      }
+    }
+    
+    if (event.type == "mouseleave") {
+      this.inspector.toolbox.highlighterUtils.unhighlight();
+    }
   },
 
   /**
    * Remove nodes and delete properties.
    */
   destroy: function BC_destroy()
   {
     this.selection.off("new-node-front", this.update);
@@ -387,16 +400,18 @@ HTMLBreadcrumbs.prototype = {
 
     this.container.removeEventListener("underflow", this.onscrollboxreflow, false);
     this.container.removeEventListener("overflow", this.onscrollboxreflow, false);
     this.onscrollboxreflow = null;
 
     this.empty();
     this.container.removeEventListener("mousedown", this, true);
     this.container.removeEventListener("keypress", this, true);
+    this.container.removeEventListener("mouseover", this, true);
+    this.container.removeEventListener("mouseleave", this, true);
     this.container = null;
 
     this.separators.remove();
     this.separators = null;
 
     this.nodeHierarchy = null;
 
     this.isDestroyed = true;
@@ -481,16 +496,20 @@ HTMLBreadcrumbs.prototype = {
           e.keyCode == Ci.nsIDOMKeyEvent.DOM_VK_RETURN)
         button.click();
     }
 
     button.onBreadcrumbsClick = () => {
       this.selection.setNodeFront(aNode, "breadcrumbs");
     };
 
+    button.onBreadcrumbsHover = () => {
+      this.inspector.toolbox.highlighterUtils.highlightNodeFront(aNode);
+    };
+
     button.onclick = (function _onBreadcrumbsRightClick(event) {
       button.focus();
       if (event.button == 2) {
         this.openSiblingMenu(button, aNode);
       }
     }).bind(this);
 
     button.onBreadcrumbsHold = (function _onBreadcrumbsHold() {
diff --git a/browser/devtools/inspector/test/browser.ini b/browser/devtools/inspector/test/browser.ini
--- a/browser/devtools/inspector/test/browser.ini
+++ b/browser/devtools/inspector/test/browser.ini
@@ -15,16 +15,17 @@ support-files =
   doc_inspector_search.html
   doc_inspector_search-suggestions.html
   doc_inspector_select-last-selected-01.html
   doc_inspector_select-last-selected-02.html
   browser_inspector_highlight_after_transition.html
   head.js
 
 [browser_inspector_breadcrumbs.js]
+[browser_inspector_breadcrumbs_highlight_hover.js]
 [browser_inspector_delete-selected-node-01.js]
 [browser_inspector_delete-selected-node-02.js]
 [browser_inspector_delete-selected-node-03.js]
 [browser_inspector_destroy-after-navigation.js]
 [browser_inspector_gcli-inspect-command.js]
 [browser_inspector_highlighter-01.js]
 [browser_inspector_highlighter-02.js]
 [browser_inspector_highlighter-03.js]
@@ -50,8 +51,10 @@ support-files =
 [browser_inspector_search-01.js]
 [browser_inspector_search-02.js]
 [browser_inspector_search-03.js]
 [browser_inspector_select-last-selected.js]
 [browser_inspector_search-navigation.js]
 [browser_inspector_sidebarstate.js]
 [browser_inspector_switch-to-inspector-on-pick.js]
 [browser_inspector_update-on-navigation.js]
+[browser_inspector_bug_961771_picker_stops_on_tool_select.js]
+[browser_inspector_bug_962478_picker_stops_on_destroy.js]
diff --git a/browser/devtools/inspector/test/browser_inspector_breadcrumbs_highlight_hover.js b/browser/devtools/inspector/test/browser_inspector_breadcrumbs_highlight_hover.js
new file mode 100644
--- /dev/null
+++ b/browser/devtools/inspector/test/browser_inspector_breadcrumbs_highlight_hover.js
@@ -0,0 +1,29 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+"use strict";
+
+// Test that hovering over nodes on the breadcrumb buttons in the inspector shows the highlighter over
+// those nodes
+let test = asyncTest(function*() {
+  info("Loading the test document and opening the inspector");
+  yield addTab("data:text/html;charset=utf-8,<h1>foo</h1><span>bar</span>");
+  let {toolbox, inspector} = yield openInspector();
+
+  info("Selecting the test node");
+  yield selectNode("span", inspector);
+  
+  let bcButtons = inspector.breadcrumbs["container"];
+  
+  let onNodeHighlighted = toolbox.once("node-highlight");
+  let button = bcButtons.childNodes[2];
+
+  EventUtils.synthesizeMouseAtCenter(button, {type: "mousemove"}, button.ownerDocument.defaultView);
+  yield onNodeHighlighted;
+
+  ok(isHighlighting(), "The highlighter is shown on a markup container hover");
+  is(getHighlitNode(), getNode("span"), "The highlighter highlights the right node");
+
+  gBrowser.removeCurrentTab();
+});
