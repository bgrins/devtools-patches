# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  c8e058951cd8855bb563713b76cc79198bcf7961
Bug 1254025 - Don't attempt to append a controller if the input's controllers property is undefined;r=jlongster

MozReview-Commit-ID: Cm5IW1AmrSn

diff --git a/devtools/client/sourceeditor/editor.js b/devtools/client/sourceeditor/editor.js
--- a/devtools/client/sourceeditor/editor.js
+++ b/devtools/client/sourceeditor/editor.js
@@ -426,17 +426,24 @@ Editor.prototype = {
 
         this.emit("gutterClick", line, ev.button);
       });
 
       win.CodeMirror.defineExtension("l10n", (name) => {
         return L10N.GetStringFromName(name);
       });
 
-      cm.getInputField().controllers.insertControllerAt(0, controller(this));
+      // Bug 1254025 - controllers can be undefined when a custom UA is chosen.
+      // If this is the case then the context menu controller won't get set up
+      // correctly, but it will at least load.
+      if (cm.getInputField().controllers) {
+        cm.getInputField().controllers.insertControllerAt(0, controller(this));
+      } else {
+        console.warn("Controller wasn't added for editor, do you have a custom UA? (bug 1254025)");
+      }
 
       this.container = env;
       editors.set(this, cm);
 
       this.reloadPreferences = this.reloadPreferences.bind(this);
       this._prefObserver = new PrefObserver("devtools.editor.");
       this._prefObserver.on(TAB_SIZE, this.reloadPreferences);
       this._prefObserver.on(EXPAND_TAB, this.reloadPreferences);
