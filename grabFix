# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Parent  d6b2e070b5d0eb986c12e35d7fde2baa48c3170c
Bug 1210375 - Use correct GRAB_DELAY in the markup view;r=pbrosset

diff --git a/devtools/client/markupview/markup-view.js b/devtools/client/markupview/markup-view.js
--- a/devtools/client/markupview/markup-view.js
+++ b/devtools/client/markupview/markup-view.js
@@ -1924,17 +1924,17 @@ MarkupContainer.prototype = {
       this.isDragging = true;
 
       this._dragStartY = event.pageY;
       this.markup.indicateDropTarget(this.elt);
 
       // If this is the last child, use the closing <div.tag-line> of parent as indicator
       this.markup.indicateDragTarget(this.elt.nextElementSibling ||
                                      this.markup.getContainer(this.node.parentNode()).closeTagLine);
-    }, this.GRAB_DELAY);
+    }, this.markup.GRAB_DELAY);
   },
 
   /**
    * On mouse up, stop dragging.
    */
   _onMouseUp: Task.async(function*() {
     this._isMouseDown = false;
 
diff --git a/devtools/client/markupview/test/browser_markupview_dragdrop_isDragging.js b/devtools/client/markupview/test/browser_markupview_dragdrop_isDragging.js
--- a/devtools/client/markupview/test/browser_markupview_dragdrop_isDragging.js
+++ b/devtools/client/markupview/test/browser_markupview_dragdrop_isDragging.js
@@ -22,16 +22,20 @@ add_task(function*() {
     pageX: rect.x,
     pageY: rect.y,
     stopPropagation: function() {},
     preventDefault: function() {}
   });
 
   ok(!el.isDragging, "isDragging should not be set to true immediately");
 
+  info("Waiting for 10ms");
+  yield wait(10);
+  ok(!el.isDragging, "isDragging should not be set to true after a brief wait");
+
   info("Waiting " + (GRAB_DELAY + 1) + "ms");
   yield wait(GRAB_DELAY + 1);
   ok(el.isDragging, "isDragging true after GRAB_DELAY has passed");
 
   let dropCompleted = once(inspector.markup, "drop-completed");
 
   info("Simulating mouseUp on #test");
   el._onMouseUp({
