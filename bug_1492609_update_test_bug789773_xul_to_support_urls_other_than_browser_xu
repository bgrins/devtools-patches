# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1537395512 25200
#      Wed Sep 19 15:18:32 2018 -0700
# Node ID 53cc2231832f60350476842447627e835e891680
# Parent  59a6a14bdf0581f375d7b85eed59b9d8e4e8fb6f
Bug 1492609 - Update test_bug789773.xul to support URLs other than browser.xul as the browser chrome;r=bholley

This is an extra reference to browser.xul that slipped through Bug 1484759.

Differential Revision: https://phabricator.services.mozilla.com/D6334

diff --git a/docshell/test/chrome/test_bug789773.xul b/docshell/test/chrome/test_bug789773.xul
--- a/docshell/test/chrome/test_bug789773.xul
+++ b/docshell/test/chrome/test_bug789773.xul
@@ -21,25 +21,26 @@ https://bugzilla.mozilla.org/show_bug.cg
    *
    * See comment 50 for the situation we're testing against here.
    *
    * Note that the failure mode of this test is to hang, and hang the browser on quit.
    * This is an unfortunate occurance, but that's why we're testing it.
    */
   SimpleTest.waitForExplicitFinish();
 
-  var calledListenerForBrowserXUL = false;
+  var calledListenerForBrowserChromeURL = false;
   var testProgressListener = {
     START_DOC: Ci.nsIWebProgressListener.STATE_START | Ci.nsIWebProgressListener.STATE_IS_DOCUMENT,
     onStateChange: function(wp, req, stateFlags, status) {
-      if (/browser.xul/.test(req.name)) {
+      let browserChromeFileName = AppConstants.BROWSER_CHROME_URL.split("/").reverse()[0];
+      if (req.name.includes(browserChromeFileName)) {
         wp.DOMWindow; // Force the lazy creation of a DOM window.
-        calledListenerForBrowserXUL = true;
+        calledListenerForBrowserChromeURL = true;
       }
-      if (/mozilla.xhtml/.test(req.name) && (stateFlags & Ci.nsIWebProgressListener.STATE_STOP))
+      if (req.name.includes("mozilla.xhtml") && (stateFlags & Ci.nsIWebProgressListener.STATE_STOP))
         finishTest();
     },
     QueryInterface: function(iid) {
       if (iid.equals(Ci.nsISupportsWeakReference) ||
           iid.equals(Ci.nsIWebProgressListener))
         return this;
       throw Cr.NS_ERROR_NO_INTERFACE;
     }
@@ -51,16 +52,16 @@ https://bugzilla.mozilla.org/show_bug.cg
 
    // Open the window.
    var popup = window.open("about:mozilla", "_blank", "width=640,height=400");
 
    // Wait for the window to load.
    function finishTest() {
      webProgress.removeProgressListener(testProgressListener);
      ok(true, "Loaded the popup window without spinning forever in the event loop!");
-     ok(calledListenerForBrowserXUL, "Should have called the progress listener for browser.xul");
+     ok(calledListenerForBrowserChromeURL, "Should have called the progress listener for browser.xul");
      popup.close();
      SimpleTest.finish();
    }
 
   ]]>
   </script>
 </window>
