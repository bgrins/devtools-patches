# HG changeset patch
# Parent 611fa34ae0863337fae33b00ad4b83949b288fb9
# User Brian Grinstead <bgrinstead@mozilla.com>
devbrowser.css

diff --git a/browser/app/profile/firefox.js b/browser/app/profile/firefox.js
--- a/browser/app/profile/firefox.js
+++ b/browser/app/profile/firefox.js
@@ -1287,16 +1287,18 @@ pref("services.sync.prefs.sync.security.
 pref("services.sync.prefs.sync.security.default_personal_cert", true);
 pref("services.sync.prefs.sync.security.tls.version.min", true);
 pref("services.sync.prefs.sync.security.tls.version.max", true);
 pref("services.sync.prefs.sync.signon.rememberSignons", true);
 pref("services.sync.prefs.sync.spellchecker.dictionary", true);
 pref("services.sync.prefs.sync.xpinstall.whitelist.required", true);
 #endif
 
+pref("devbrowser.theme.enabled", true);
+
 // Disable the error console
 pref("devtools.errorconsole.enabled", false);
 
 // Developer toolbar and GCLI preferences
 pref("devtools.toolbar.enabled", true);
 pref("devtools.toolbar.visible", false);
 pref("devtools.commands.dir", "");
 
diff --git a/browser/base/content/browser-devbrowser.js b/browser/base/content/browser-devbrowser.js
new file mode 100644
--- /dev/null
+++ b/browser/base/content/browser-devbrowser.js
@@ -0,0 +1,86 @@
+/*
+#ifdef 0
+ * This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.
+#endif
+ */
+
+/**
+ * Listeners for the DevBrowser theme.
+ * Adds an extra stylesheet if a pref is set.
+ * This only happens in a MOZ_DEVELOPER_EDITION build, where no other themes
+ * are applied and a user pref is set.
+ */
+let DevBrowser = {
+  _prefName: "devbrowser.theme.enabled",
+  _themePrefName: "general.skins.selectedSkin",
+  _lwThemePrefName: "lightweightThemes.isThemeSelected",
+  _devtoolsThemePrefName: "devtools.theme",
+
+  styleSheet: null,
+
+  init: function () {
+//# ifdef MOZ_DEVELOPER_EDITION
+    this._readPref();
+    Services.prefs.addObserver(this._prefName, this, false);
+    Services.prefs.addObserver(this._lwThemePrefName, this, false);
+    Services.prefs.addObserver(this._themePrefName, this, false);
+    Services.prefs.addObserver(this._devtoolsThemePrefName, this, false);
+//# endif MOZ_DEVELOPER_EDITION
+  },
+
+  observe: function (subject, topic, data) {
+    if (topic == "nsPref:changed")
+      this._readPref();
+  },
+
+  _readPref: function() {
+    let devbrowserThemeEnabled = false;
+
+    // Only try to apply the devBrowser theme if:
+    //  1) It is preffed on.
+    //  2) There are no lightweight themes applied.
+    //  3) There are no complete themes applied.
+    try {
+      devbrowserThemeEnabled =
+        Services.prefs.getBoolPref(this._prefName, true) &&
+        !Services.prefs.getBoolPref(this._lwThemePrefName, true) &&
+        Services.prefs.getCharPref(this._themePrefName, true) == "classic/1.0"
+    } catch(e) { }
+
+    let devtoolsIsDark = false;
+    try {
+      devtoolsIsDark = Services.prefs.getCharPref(this._devtoolsThemePrefName, true) === "dark";
+    } catch(e) { }
+
+    if (devbrowserThemeEnabled && !this.styleSheet) {
+      let styleSheet = this.styleSheet = document.createProcessingInstruction('xml-stylesheet',
+        'href="chrome://browser/skin/devbrowser.css" type="text/css"');
+      this.styleSheet.addEventListener("load", function onLoad() {
+        styleSheet.removeEventListener("load", onLoad);
+        ToolbarIconColor.inferFromText();
+      });
+      document.insertBefore(this.styleSheet, document.lastChild);
+    } else if (!devbrowserThemeEnabled && this.styleSheet) {
+      this.styleSheet.remove();
+      this.styleSheet = null;
+      document.documentElement.classList.remove("devtools-light");
+      document.documentElement.classList.remove("devtools-dark");
+      ToolbarIconColor.inferFromText();
+    }
+
+    if (devbrowserThemeEnabled) {
+      document.documentElement.classList.toggle("devtools-light", !devtoolsIsDark);
+      document.documentElement.classList.toggle("devtools-dark", devtoolsIsDark);
+      ToolbarIconColor.inferFromText();
+    }
+  },
+
+  uninit: function () {
+    Services.prefs.removeObserver(this._prefName, this);
+    Services.prefs.removeObserver(this._lwThemePrefName, this);
+    Services.prefs.removeObserver(this._themePrefName, this);
+    this.styleSheet = null;
+  }
+};
diff --git a/browser/base/content/browser.js b/browser/base/content/browser.js
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -194,16 +194,17 @@ let gInitialPages = [
   "about:home",
   "about:privatebrowsing",
   "about:welcomeback",
   "about:sessionrestore"
 ];
 
 #include browser-addons.js
 #include browser-customization.js
+#include browser-devbrowser.js
 #include browser-feeds.js
 #include browser-fullScreen.js
 #include browser-fullZoom.js
 #include browser-loop.js
 #include browser-places.js
 #include browser-plugins.js
 #include browser-safebrowsing.js
 #include browser-social.js
@@ -829,16 +830,17 @@ var gBrowserInit = {
     // These routines add message listeners. They must run before
     // loading the frame script to ensure that we don't miss any
     // message sent between when the frame script is loaded and when
     // the listener is registered.
     DOMLinkHandler.init();
     gPageStyleMenu.init();
     LanguageDetectionListener.init();
     BrowserOnClick.init();
+    DevBrowser.init();
 
     let mm = window.getGroupMessageManager("browsers");
     mm.loadFrameScript("chrome://browser/content/content.js", true);
 
     // initialize observers and listeners
     // and give C++ access to gBrowser
     XULBrowserWindow.init();
     window.QueryInterface(Ci.nsIInterfaceRequestor)
@@ -1386,16 +1388,18 @@ var gBrowserInit = {
     BookmarkingUI.uninit();
 
     TabsInTitlebar.uninit();
 
     ToolbarIconColor.uninit();
 
     BrowserOnClick.uninit();
 
+    DevBrowser.uninit();
+
     var enumerator = Services.wm.getEnumerator(null);
     enumerator.getNext();
     if (!enumerator.hasMoreElements()) {
       document.persist("sidebar-box", "sidebarcommand");
       document.persist("sidebar-box", "width");
       document.persist("sidebar-box", "src");
       document.persist("sidebar-title", "value");
     }
diff --git a/browser/components/preferences/in-content/main.xul b/browser/components/preferences/in-content/main.xul
--- a/browser/components/preferences/in-content/main.xul
+++ b/browser/components/preferences/in-content/main.xul
@@ -13,16 +13,22 @@
     <preference id="browser.tabs.remote.autostart"
                 name="browser.tabs.remote.autostart"
                 type="bool"/>
     <preference id="e10sTempPref"
                 name="browser.tabs.remote.autostart.1"
                 type="bool"/>
 #endif
 
+#if defined(MOZ_UPDATE_CHANNEL) && MOZ_UPDATE_CHANNEL == aurora
+    <preference id="devbrowser.theme.enabled"
+                name="devbrowser.theme.enabled"
+                type="bool"/>
+#endif
+
     <!-- Startup -->
     <preference id="browser.startup.page"
                 name="browser.startup.page"
                 type="int"/>
     <preference id="browser.startup.homepage"
                 name="browser.startup.homepage"
                 type="wstring"/>
 
@@ -117,16 +123,22 @@
           hidden="true">
   <caption><label>&startup.label;</label></caption>
 
 #ifdef E10S_TESTING_ONLY
   <checkbox id="e10sAutoStart"
             label="Enable E10S (multi-process)"/>
 #endif
 
+#if defined(MOZ_UPDATE_CHANNEL) && MOZ_UPDATE_CHANNEL == aurora
+  <checkbox id="devbrowserTheme"
+            label="Use devbrowser theme (if no other themes are applied)"
+            preference="devbrowser.theme.enabled"/>
+#endif
+
 #ifdef HAVE_SHELL_SERVICE
   <vbox id="defaultBrowserBox">
     <hbox align="center">
       <checkbox id="alwaysCheckDefault" preference="browser.shell.checkDefaultBrowser"
                 label="&alwaysCheckDefault.label;" accesskey="&alwaysCheckDefault2.accesskey;"/>
     </hbox>
     <deck id="setDefaultPane">
       <hbox align="center" class="indent">
diff --git a/browser/themes/linux/devbrowser.css b/browser/themes/linux/devbrowser.css
new file mode 100644
--- /dev/null
+++ b/browser/themes/linux/devbrowser.css
@@ -0,0 +1,7 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+ /* TODO: Copy over changes from osx */
+
+%include ../shared/devbrowser.inc.css
diff --git a/browser/themes/linux/jar.mn b/browser/themes/linux/jar.mn
--- a/browser/themes/linux/jar.mn
+++ b/browser/themes/linux/jar.mn
@@ -17,16 +17,17 @@ browser.jar:
   skin/classic/browser/aboutNetError_info.svg                   (../shared/aboutNetError_info.svg)
   skin/classic/browser/aboutSocialError.css
 #ifdef MOZ_SERVICES_SYNC
   skin/classic/browser/aboutSyncTabs.css
 #endif
   skin/classic/browser/aboutTabCrashed.css
   skin/classic/browser/actionicon-tab.png
 * skin/classic/browser/browser.css
+* skin/classic/browser/devbrowser.css
 * skin/classic/browser/browser-lightweightTheme.css
   skin/classic/browser/click-to-play-warning-stripes.png
 * skin/classic/browser/content-contextmenu.svg
 * skin/classic/browser/engineManager.css
   skin/classic/browser/fullscreen-darknoise.png
   skin/classic/browser/Geolocation-16.png
   skin/classic/browser/Geolocation-64.png
   skin/classic/browser/identity.png
diff --git a/browser/themes/osx/browser.css b/browser/themes/osx/browser.css
--- a/browser/themes/osx/browser.css
+++ b/browser/themes/osx/browser.css
@@ -4,24 +4,43 @@
 
 @import url("chrome://global/skin/");
 
 %include shared.inc
 %filter substitution
 %define forwardTransitionLength 150ms
 %define conditionalForwardWithUrlbar window:not([chromehidden~="toolbar"]) #urlbar-wrapper
 %define conditionalForwardWithUrlbarWidth 32
-%define spaceAboveTabbar 9px
 %define toolbarButtonPressed :hover:active:not([disabled="true"]):not([cui-areatype="menu-panel"])
 %define windowButtonMarginTop 11px
 
 @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
 @namespace html url("http://www.w3.org/1999/xhtml");
 @namespace svg url("http://www.w3.org/2000/svg");
 
+:root {
+  --space-above-tabbar: 9px;
+  --toolbarbutton-hover-background: hsla(0,0%,100%,.1) linear-gradient(hsla(0,0%,100%,.3), hsla(0,0%,100%,.1)) padding-box;
+  --toolbarbutton-active-background: hsla(0,0%,0%,.02) linear-gradient(hsla(0,0%,0%,.12), hsla(0,0%,0%,0)) border-box;
+  --toolbarbutton-active-boxshadow: 0 1px 0 hsla(0,0%,100%,.5),
+                                    0 1px 0 hsla(0,0%,0%,.05) inset,
+                                    0 1px 1px hsla(0,0%,0%,.2) inset;
+  --toolbarbutton-checkedhover-color: hsla(0,0%,0%,.09);
+  --toolbarbutton-hover-bordercolor: hsla(0,0%,0%,.2);
+  --toolbarbutton-hover-boxshadow: 0 1px 0 hsla(0,0%,100%,.5),
+                                   0 1px 0 hsla(0,0%,100%,.5) inset;
+  --toolbarbutton-combined-boxshadow: 0 0 0 1px hsla(0,0%,100%,.15);
+  --toolbarbutton-combined-backgroundimage: linear-gradient(hsla(0,0%,0%,.15) 0, hsla(0,0%,0%,.15) 18px);
+
+  --urlbar-dropmarker-url: url("chrome://browser/skin/urlbar-history-dropmarker.png");
+  --urlbar-dropmarker-region: rect(0px, 11px, 14px, 0px);
+  --urlbar-dropmarker-2x-url: url("chrome://browser/skin/urlbar-history-dropmarker@2x.png");
+  --urlbar-dropmarker-2x-region: rect(0px, 22px, 28px, 0px);
+}
+
 #urlbar:-moz-lwtheme:not([focused="true"]),
 .searchbar-textbox:-moz-lwtheme:not([focused="true"]) {
   opacity: .9;
 }
 
 #navigator-toolbox::after {
   -moz-box-ordinal-group: 101; /* tabs toolbar is 100 */
   background-image: linear-gradient(to top, hsla(0,0%,0%,.15), hsla(0,0%,0%,.15) 1px, hsla(0,0%,100%,.15) 1px, hsla(0,0%,100%,.15) 2px, transparent 3px);
@@ -76,17 +95,17 @@
   height: 22px; /* The native titlebar on OS X is 22px tall. */
 }
 
 /**
  * For tabs in titlebar on OS X, we stretch the titlebar down so that the
  * tabstrip can overlap it.
  */
 #main-window[tabsintitlebar] > #titlebar {
-  min-height: calc(@tabMinHeight@ + @spaceAboveTabbar@ - @tabToolbarNavbarOverlap@);
+  min-height: calc(@tabMinHeight@ + var(--space-above-tabbar) - @tabToolbarNavbarOverlap@);
 }
 
 /**
  * We also vertically center the window buttons.
  */
 #main-window[tabsintitlebar] > #titlebar > #titlebar-content > #titlebar-buttonbox-container,
 #main-window[tabsintitlebar] > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > #titlebar-fullscreen-button {
   margin-top: @windowButtonMarginTop@;
@@ -548,42 +567,39 @@ toolbar .toolbarbutton-1:not(:-moz-any([
   padding: 0 4px;
 }
 
 toolbar .toolbarbutton-1:not(:-moz-any([type="menu-button"],[disabled],[open],#back-button,#forward-button)):hover,
 toolbar .toolbarbutton-1[type="menu-button"]:not([disabled]) > .toolbarbutton-menubutton-button[open] + .toolbarbutton-menubutton-dropmarker,
 toolbar .toolbarbutton-1[type="menu-button"]:not([disabled]):-moz-any(:hover,[open]) > .toolbarbutton-menubutton-button,
 toolbar .toolbarbutton-1[type="menu-button"]:not([disabled]):-moz-any(:hover,[open]) > .toolbarbutton-menubutton-dropmarker,
 toolbar .toolbaritem-combined-buttons:hover > .toolbarbutton-combined {
-  border-color: hsla(0,0%,0%,.2);
-  box-shadow: 0 1px 0 hsla(0,0%,100%,.5),
-              0 1px 0 hsla(0,0%,100%,.5) inset;
+  border-color: var(--toolbarbutton-hover-bordercolor);
+  box-shadow: var(--toolbarbutton-hover-boxshadow);
 }
 
 toolbar .toolbarbutton-1:not(:-moz-any([type="menu-button"],[disabled],[open],#back-button,#forward-button)):hover,
 toolbar .toolbarbutton-1[type="menu-button"]:not(:-moz-any([disabled],[open]))[buttonover] > .toolbarbutton-menubutton-button,
 toolbar .toolbarbutton-1[type="menu-button"]:not(:-moz-any([disabled],[open],[buttonover])):hover > .toolbarbutton-menubutton-dropmarker {
-  background: hsla(0,0%,100%,.1) linear-gradient(hsla(0,0%,100%,.3), hsla(0,0%,100%,.1)) padding-box;
+  background: var(--toolbarbutton-hover-background);
 }
 
 toolbar .toolbarbutton-1:not(:-moz-any([type="menu-button"],[disabled],#back-button,#forward-button)):-moz-any(:hover:active,[open],[checked]),
 toolbar .toolbarbutton-1[type="menu-button"]:not([disabled]) > .toolbarbutton-menubutton-button[open],
 toolbar .toolbarbutton-1[type="menu-button"]:not(:-moz-any([disabled],[open]))[buttonover]:active > .toolbarbutton-menubutton-button,
 toolbar .toolbarbutton-1[type="menu-button"]:not(:-moz-any([disabled],[open],[buttonover])):hover:active > .toolbarbutton-menubutton-dropmarker,
 toolbar .toolbarbutton-1[type="menu-button"][open]:not([disabled]) > .toolbarbutton-menubutton-dropmarker {
-  background: hsla(0,0%,0%,.02) linear-gradient(hsla(0,0%,0%,.12), hsla(0,0%,0%,0)) border-box;
+  background: var(--toolbarbutton-activebackground);
   border-color: hsla(0,0%,0%,.3);
-  box-shadow: 0 1px 0 hsla(0,0%,100%,.5),
-              0 1px 0 hsla(0,0%,0%,.05) inset,
-              0 1px 1px hsla(0,0%,0%,.2) inset;
+  box-shadow: var(--toolbarbutton-activeboxshadow);
   transition-duration: 10ms;
 }
 
 toolbar .toolbarbutton-1[checked]:not(:active):hover {
-  background-color: hsla(0,0%,0%,.09);
+  background-color: var(--toolbarbutton-checkedhover-color);
   transition: background-color 250ms;
 }
 
 .toolbarbutton-1[type="menu-button"]:not([overflowedItem=true]) {
   padding: 0;
 }
 
 toolbar .toolbarbutton-1[type="menu-button"] {
@@ -611,22 +627,22 @@ toolbar .toolbaritem-combined-buttons > 
 toolbar .toolbarbutton-1:not(:-moz-any([open],:hover)) > .toolbarbutton-menubutton-dropmarker::before {
   content: "";
   display: -moz-box;
   position: relative;
   top: calc(50% - 9px);
   width: 1px;
   height: 18px;
   -moz-margin-start: -1px;
-  background-image: linear-gradient(hsla(0,0%,0%,.15) 0, hsla(0,0%,0%,.15) 18px);
+  background-image: var(--toolbarbutton-combined-backgroundimage);
   background-clip: padding-box;
   background-position: center;
   background-repeat: no-repeat;
   background-size: 1px 18px;
-  box-shadow: 0 0 0 1px hsla(0,0%,100%,.15);
+  box-shadow: var(--toolbarbutton-combined-boxshadow);
 }
 
 toolbar .toolbaritem-combined-buttons:hover > separator {
   display: none;
 }
 
 toolbar .toolbarbutton-1 > .toolbarbutton-menubutton-dropmarker {
   -moz-box-orient: horizontal;
@@ -2073,30 +2089,30 @@ toolbarbutton[sdk-button="true"][cui-are
 
 .urlbar-input-box {
   -moz-margin-start: 0;
   padding: 3px 0 2px;
 }
 
 .urlbar-history-dropmarker {
   padding: 0 3px;
-  list-style-image: url("chrome://browser/skin/urlbar-history-dropmarker.png");
-  -moz-image-region: rect(0px, 11px, 14px, 0px);
+  list-style-image: var(--urlbar-dropmarker-url);
+  -moz-image-region: --urlbar-dropmarker-region;
 }
 
 .urlbar-history-dropmarker[open="true"],
 .urlbar-history-dropmarker:hover:active {
   -moz-image-region: rect(0px, 22px, 14px, 11px);
   background-image: radial-gradient(circle closest-side, hsla(205,100%,70%,.3), hsla(205,100%,70%,0));
 }
 
 @media (min-resolution: 2dppx) {
   .urlbar-history-dropmarker {
-    list-style-image: url("chrome://browser/skin/urlbar-history-dropmarker@2x.png");
-    -moz-image-region: rect(0px, 22px, 28px, 0px);
+    list-style-image: var(--urlbar-dropmarker-2x-url);
+    -moz-image-region: var(--urlbar-dropmarker-2x-region);
   }
 
   .urlbar-history-dropmarker[open="true"],
   .urlbar-history-dropmarker:hover:active {
     -moz-image-region: rect(0px, 44px, 28px, 22px);
   }
 
   .urlbar-history-dropmarker > .dropmarker-icon {
@@ -3026,17 +3042,17 @@ toolbarbutton.chevron > .toolbarbutton-m
 
 #TabsToolbar:not(:-moz-lwtheme) {
   color: #333;
   text-shadow: @loweredShadow@;
 }
 
 @media (-moz-mac-lion-theme) {
   #navigator-toolbox[inFullscreen] > #TabsToolbar {
-    padding-top: @spaceAboveTabbar@;
+    padding-top: var(--space-above-tabbar);
   }
 }
 
 #tabbrowser-tabs {
   -moz-box-align: stretch;
 }
 
 .tabs-newtab-button > .toolbarbutton-icon {
@@ -3122,21 +3138,25 @@ toolbarbutton.chevron > .toolbarbutton-m
   list-style-image: url("chrome://browser/skin/tabbrowser/tab-arrow-left.png");
 }
 
 .tabbrowser-arrowscrollbox > .scrollbutton-down:-moz-locale-dir(ltr),
 .tabbrowser-arrowscrollbox > .scrollbutton-up:-moz-locale-dir(rtl) {
   list-style-image: url("chrome://browser/skin/tabbrowser/tab-arrow-right.png");
 }
 
+#TabsToolbar[brighttext] > #tabbrowser-tabs > .tabbrowser-arrowscrollbox > .scrollbutton-up:-moz-locale-dir(ltr),
+#TabsToolbar[brighttext] > #tabbrowser-tabs > .tabbrowser-arrowscrollbox > .scrollbutton-down:-moz-locale-dir(rtl),
 .tabbrowser-arrowscrollbox > .scrollbutton-up:-moz-locale-dir(ltr):-moz-lwtheme-brighttext,
 .tabbrowser-arrowscrollbox > .scrollbutton-down:-moz-locale-dir(rtl):-moz-lwtheme-brighttext {
   list-style-image: url("chrome://browser/skin/tabbrowser/tab-arrow-left-inverted.png");
 }
 
+#TabsToolbar[brighttext] > #tabbrowser-tabs > .tabbrowser-arrowscrollbox > .scrollbutton-down:-moz-locale-dir(ltr),
+#TabsToolbar[brighttext] > #tabbrowser-tabs > .tabbrowser-arrowscrollbox > .scrollbutton-up:-moz-locale-dir(rtl),
 .tabbrowser-arrowscrollbox > .scrollbutton-down:-moz-locale-dir(ltr):-moz-lwtheme-brighttext,
 .tabbrowser-arrowscrollbox > .scrollbutton-up:-moz-locale-dir(rtl):-moz-lwtheme-brighttext {
   list-style-image: url("chrome://browser/skin/tabbrowser/tab-arrow-right-inverted.png");
 }
 
 .tabbrowser-arrowscrollbox > .scrollbutton-up:hover,
 .tabbrowser-arrowscrollbox > .scrollbutton-down:hover {
   -moz-image-region: rect(0, 26px, 20px, 13px);
@@ -4752,17 +4772,17 @@ window > chatbox {
   }
   #main-window[privatebrowsingmode=temporary]:not([tabsintitlebar]) > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > .private-browsing-indicator {
     background-image: url("chrome://browser/skin/privatebrowsing-mask-short@2x.png");
   }
 }
 
 @media (-moz-mac-lion-theme) {
   #TabsToolbar > .private-browsing-indicator {
-    transform: translateY(-@spaceAboveTabbar@);
+    transform: translateY(-var(--space-above-tabbar));
     /* We offset by 38px for mask graphic, plus 4px to account for the
      * margin-left, which sums to 42px.
      */
     margin-right: -42px;
   }
 
   #main-window[privatebrowsingmode=temporary] .titlebar-placeholder[type="fullscreen-button"],
   #main-window[privatebrowsingmode=temporary] > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > #titlebar-fullscreen-button {
diff --git a/browser/themes/osx/devbrowser.css b/browser/themes/osx/devbrowser.css
new file mode 100644
--- /dev/null
+++ b/browser/themes/osx/devbrowser.css
@@ -0,0 +1,57 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+ /* XXX TODO:
+- Style autocomplete popup for awesomebar
+- Bug 1075415 - Chevron for more bookmarks is not inverted (chrome://global/skin/icons/chevron.png)
+- Bookmarks sidebar is still light blue, check with UX
+- Bug 1018845 - Styling fullscreen button isn't so easy
+- For searchbar-dropmarker-image we wither need an inverted version of chrome://browser/skin/searchbar-dropmarker.png,
+  or is it OK to just use the devtools icon?
+- Move as many of the variables in the OS specific locations into devbrowser.inc
+- Resize chrome://browser/skin/devtools/tooltip/arrow-vertical-dark.png to fit chrome://global/skin/arrow/panelarrow-vertical.png
+- Need to have a discussion about existing Aurora users and dark theme by default
+- If we keep a pref in the main preference panel, then it needs to also be in the normal pref dialog
+
+*/
+
+.devtools-dark {
+  --back-button-background-color: #262C33;
+}
+
+.devtools-light {
+  --back-button-background-color: rgba(170, 170, 170, .2);
+}
+/* navbar */
+#nav-bar .toolbarbutton-1:not(#back-button):not(#forward-button) {
+  transition: background 0.1s, filter 0.1s !important;
+  border: 1px solid transparent !important;
+}
+
+/* Resize things so that the native titlebar is in line with the tabs */
+#main-window[tabsintitlebar] > #titlebar > #titlebar-content > #titlebar-buttonbox-container,
+#main-window[tabsintitlebar] > #titlebar > #titlebar-content > #titlebar-secondary-buttonbox > #titlebar-fullscreen-button {
+  margin-top: 6px;
+}
+
+/* XXX: this is overriding more stuff than probably necessary */
+#back-button:not(:-moz-lwtheme),
+#forward-button:not(:-moz-lwtheme)  {
+  width: auto;
+  height: auto;
+  padding: 0;
+  margin: 2px 0;
+  border: none;
+  border-radius: 0;
+  background-color: var(--back-button-background-color) !important;
+  background-image: none !important;
+  box-shadow: none !important;
+}
+
+#back-button > .toolbarbutton-icon,
+#forward-button > .toolbarbutton-icon {
+  padding: 3px 6px !important;
+}
+
+%include ../shared/devbrowser.inc.css
diff --git a/browser/themes/osx/jar.mn b/browser/themes/osx/jar.mn
--- a/browser/themes/osx/jar.mn
+++ b/browser/themes/osx/jar.mn
@@ -17,16 +17,17 @@ browser.jar:
   skin/classic/browser/aboutSocialError.css
 #ifdef MOZ_SERVICES_SYNC
   skin/classic/browser/aboutSyncTabs.css
 #endif
   skin/classic/browser/aboutTabCrashed.css
   skin/classic/browser/actionicon-tab.png
   skin/classic/browser/actionicon-tab@2x.png
 * skin/classic/browser/browser.css                          (browser.css)
+* skin/classic/browser/devbrowser.css                       (devbrowser.css)
 * skin/classic/browser/browser-lightweightTheme.css
   skin/classic/browser/click-to-play-warning-stripes.png
 * skin/classic/browser/content-contextmenu.svg
 * skin/classic/browser/engineManager.css                    (engineManager.css)
   skin/classic/browser/fullscreen-darknoise.png
   skin/classic/browser/Geolocation-16.png
   skin/classic/browser/Geolocation-16@2x.png
   skin/classic/browser/Geolocation-64.png
diff --git a/browser/themes/osx/searchbar.css b/browser/themes/osx/searchbar.css
--- a/browser/themes/osx/searchbar.css
+++ b/browser/themes/osx/searchbar.css
@@ -1,12 +1,17 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
+:root {
+  --searchbar-dropmarker-url: url("chrome://browser/skin/searchbar-dropmarker.png");
+  --searchbar-dropmarker-2x-url: url("chrome://browser/skin/searchbar-dropmarker@2x.png");
+}
+
 .searchbar-textbox {
   border-radius: 10000px;
 }
 
 .searchbar-engine-button {
   -moz-padding-start: 6px;
   -moz-padding-end: 2px;
   margin: 0;
@@ -28,17 +33,17 @@
 
 .searchbar-engine-image {
   width: 16px;
   height: 16px;
   list-style-image: url("chrome://mozapps/skin/places/defaultFavicon.png");
 }
 
 .searchbar-dropmarker-image {
-  list-style-image: url("chrome://browser/skin/searchbar-dropmarker.png");
+  list-style-image: var(--searchbar-dropmarker-url);
   -moz-margin-start: 2px;
 }
 
 .search-go-container {
   -moz-box-align: center;
   -moz-padding-end: 6px;
 }
 
@@ -47,17 +52,17 @@
 }
 
 @media (min-resolution: 2dppx) {
   .searchbar-engine-image {
     list-style-image: url("chrome://mozapps/skin/places/defaultFavicon@2x.png");
   }
 
   .searchbar-dropmarker-image {
-    list-style-image: url("chrome://browser/skin/searchbar-dropmarker@2x.png");
+    list-style-image: var(--searchbar-dropmarker-2x-url);
     width: 7px;
   }
 
   .search-go-button {
     list-style-image: url("chrome://browser/skin/Search@2x.png");
     width: 14px;
   }
 }
diff --git a/browser/themes/shared/customizableui/panelUIOverlay.inc.css b/browser/themes/shared/customizableui/panelUIOverlay.inc.css
--- a/browser/themes/shared/customizableui/panelUIOverlay.inc.css
+++ b/browser/themes/shared/customizableui/panelUIOverlay.inc.css
@@ -13,16 +13,23 @@
 % we don't support nested calc(): https://bugzilla.mozilla.org/show_bug.cgi?id=968761
 %define menuPanelButtonWidth (@menuPanelWidth@ / 3 - 0.1px)
 %define exitSubviewGutterWidth 38px
 %define buttonStateHover :not(:-moz-any([disabled],[open],:active)):hover
 %define menuStateHover :not(:-moz-any([disabled],:active))[_moz-menuactive]
 %define buttonStateActive :not([disabled]):-moz-any([open],:hover:active)
 %define menuStateActive :not([disabled])[_moz-menuactive]:active
 
+:root {
+  --panel-toolbarbutton-hover-background-color: hsla(210,4%,10%,.08);
+  --panel-toolbarbutton-hover-border-color: hsla(210,4%,10%,.11);
+  --panel-toolbarbutton-active-background-color: hsla(210,4%,10%,.12);
+  --panel-toolbarbutton-active-border-color: hsla(210,4%,10%,.14);
+}
+
 %include ../browser.inc
 
 #PanelUI-popup #PanelUI-contents:empty {
   height: 128px;
 }
 
 #PanelUI-popup #PanelUI-contents:empty::before {
   content: "";
@@ -736,32 +743,32 @@ panelview .toolbarbutton-1,
 }
 
 panelview .toolbarbutton-1@buttonStateHover@,
 toolbarbutton.subviewbutton@buttonStateHover@,
 menu.subviewbutton@menuStateHover@,
 menuitem.subviewbutton@menuStateHover@,
 .widget-overflow-list .toolbarbutton-1@buttonStateHover@,
 .toolbaritem-combined-buttons@inAnyPanel@ > toolbarbutton@buttonStateHover@ {
-  background-color: hsla(210,4%,10%,.08);
-  border-color: hsla(210,4%,10%,.11);
+  background-color: var(--panel-toolbarbutton-hover-background-color);
+  border-color: var(--panel-toolbarbutton-hover-border-color);
 }
 
 .toolbaritem-combined-buttons@inAnyPanel@@buttonStateHover@ {
   border-color: hsla(210,4%,10%,.11);
 }
 
 panelview .toolbarbutton-1:-moz-any(@buttonStateActive@,[checked=true]),
 toolbarbutton.subviewbutton@buttonStateActive@,
 menu.subviewbutton@menuStateActive@,
 menuitem.subviewbutton@menuStateActive@,
 .widget-overflow-list .toolbarbutton-1@buttonStateActive@,
 .toolbaritem-combined-buttons@inAnyPanel@ > toolbarbutton@buttonStateActive@ {
-  background-color: hsla(210,4%,10%,.12);
-  border-color: hsla(210,4%,10%,.14);
+  background-color: var(--panel-toolbarbutton-active-background-color);
+  border-color: var(--panel-toolbarbutton-active-border-color);
   box-shadow: 0 1px 0 hsla(210,4%,10%,.03) inset;
 }
 
 .subviewbutton.panel-subview-footer {
   margin: 4px -4px -4px;
   background-color: hsla(210,4%,10%,.07);
   border-top: 1px solid hsla(210,4%,10%,.12);
   border-radius: 0;
diff --git a/browser/themes/shared/devbrowser.inc.css b/browser/themes/shared/devbrowser.inc.css
new file mode 100644
--- /dev/null
+++ b/browser/themes/shared/devbrowser.inc.css
@@ -0,0 +1,409 @@
+
+:root {
+  /* Chrome stuff */
+  --space-above-tabbar: 1px;
+  --chrome-background-color: #1C2126;
+  --chrome-color: #F5F7FA;
+  --chrome-secondary-background-color: #39424D;
+
+  --chrome-tab-color: #f5f7fa;
+  --chrome-tab-background-color: #1C2126;
+  --chrome-tab-color: #ced3d9;
+  --chrome-tab-hover-background-color: hsla(206,37%,4%,.5);
+  --chrome-tab-selection-color: #f5f7fa;
+  --chrome-tab-selection-background-color: #1a4666;
+  --chrome-tab-selection-box-shadow: 0 2px 0 #d7f1ff inset,
+                                     0 8px 3px -5px #2b82bf inset,
+                                     0 -2px 0 rgba(0,0,0,.2) inset;
+  --url-and-searchbar-background-color: #181B1F;
+
+  /* Toolbar buttons */
+  --toolbarbutton-hover-background: rgba(29, 79, 115, .8);
+  --toolbarbutton-activebackground: rgba(29, 79, 115, 1);
+  --toolbarbutton-active-boxshadow: none;
+  --toolbarbutton-checkedhover-color: rgba(29, 79, 115, .5);
+  --toolbarbutton-hover-boxshadow: none;
+  --toolbarbutton-hover-bordercolor: #5F6670;
+  --toolbarbutton-combined-boxshadow: none;
+  --toolbarbutton-combined-backgroundimage: linear-gradient(#5F6670 0, #5F6670 18px);
+
+  /* Identity Box */
+  --identity-box-chrome-color: #46afe3;
+  --identity-box-chrome-background-image: linear-gradient(#5F6670 0, #5F6670 100%);
+  --identity-box-verified-background-image: linear-gradient(#5F6670 0, #5F6670 100%);
+
+  /* Toolbarbuttons */
+  --panel-toolbarbutton-hover-background-color: hsla(210,4%,56%,.08);
+  --panel-toolbarbutton-hover-border-color: hsla(210,4%,56%,.11);
+  --panel-toolbarbutton-active-background-color: hsla(210,4%,56%,.12);
+  --panel-toolbarbutton-active-border-color: hsla(210,4%,56%,.14);
+}
+
+.devtools-dark {
+  --searchbar-dropmarker-url: url("chrome://browser/skin/devtools/dropmarker.svg");
+  --searchbar-dropmarker-2x-url: url("chrome://browser/skin/devtools/dropmarker.svg");
+
+  /* XXX: do we really want this control, or should we just use the same dropmarker for both light and dark? */
+  --urlbar-dropmarker-url: url("chrome://browser/skin/devtools/dropmarker.svg");
+  --urlbar-dropmarker-region: auto;
+  --urlbar-dropmarker-2x-url: url("chrome://browser/skin/devtools/dropmarker.svg");
+  --urlbar-dropmarker-2x-region: auto;
+}
+
+.devtools-light {
+  --url-and-searchbar-background-color: #fff;
+
+  --chrome-background-color: #f0f1f2;
+  --chrome-color: #18191a;
+  --chrome-secondary-background-color: #ebeced;
+
+  --chrome-tab-color: #18191a;
+  --chrome-tab-background-color: #f0f1f2;
+  --chrome-tab-hover-background-color: rgba(170,170,170,.2);
+  --chrome-tab-color: #18191a;
+  --chrome-tab-selection-color: #f5f7fa;
+  --chrome-tab-selection-background-color: #4c9ed9;
+  --chrome-tab-selection-box-shadow: 0 2px 0 #d7f1ff inset,
+                                     0 8px 3px -5px #2b82bf inset,
+                                     0 -2px 0 rgba(0,0,0,.06) inset;
+}
+
+.urlbar-history-dropmarker {
+ /* XXX: get a properly colored version of chrome://browser/skin/urlbar-history-dropmarker.png) and use
+ that instead so it is the right size */
+ -moz-image-region: auto !important;
+ list-style-image: url("chrome://browser/skin/devtools/dropmarker.svg");
+}
+
+/* XXX: why can't we just use :root in popup.css? */
+.panel-arrowcontent {
+  --panel-arrowcontent-background: rgba(19, 28, 38, 1);
+  --panel-arrowcontent-color: #F5F7FA;
+  --panel-arrowcontent-border: 3px solid #434850;
+}
+
+/* Toolbars and Tabs */
+#browser-panel, #titlebar-content {
+  /* Shows a 1px border (--space-above-tabbar)
+     of this color at the top of the browser */
+  background-color: var(--chrome-background-color);
+}
+
+.tab-close-button {
+  -moz-image-region: rect(0, 64px, 16px, 48px) !important;
+}
+.devtools-light .tab-close-button {
+  -moz-image-region: rect(0, 64px, 16px, 48px) !important;
+}
+
+::-moz-selection {
+  /* XXX: devtools dark theme selection color: #1d4f73;*/
+  background-color: #B4D5FF;
+  color: #000;
+}
+
+/* Change the color of the navigator toolbox border */
+#navigator-toolbox::after,
+#tabbrowser-tabs,
+#TabsToolbar,
+.tab-background-middle[selected],
+#tab-background-fill {
+  background: var(--chrome-background-color);
+  color: var(--chrome-color);
+}
+
+#navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar),
+#browser-bottombox,
+.browserContainer > findbar {
+  background: var(--chrome-secondary-background-color) !important;
+  color: var(--chrome-color);
+}
+
+#navigator-toolbox > toolbar .toolbarbutton-text,
+#browser-bottombox .toolbarbutton-text,
+.browserContainer > findbar .toolbarbutton-text {
+  color: var(--chrome-color);
+}
+.subviewbutton > .toolbarbutton-text {
+  color: -moz-fieldText !important;
+}
+.tab-background-middle[selected] {
+  background-position: 0 0, 0 0px !important;
+  background-image: url(chrome://browser/skin/tabbrowser/tab-active-middle.png),
+            linear-gradient(transparent 0px, transparent 2px, #9FDFFF 2px, rgba(159,223,255,1) 4px, transparent 9px, transparent),
+            none !important;
+}
+
+#nav-bar {
+  background-image: none !important;
+}
+#tab-background-fill {
+  background-position: 0 2px !important;
+  background-image: linear-gradient(#9FDFFF 0px, rgba(159,223,255,1) 2px, transparent 7px, transparent) !important
+}
+/* URL bar and search bar*/
+.searchbar-textbox, #urlbar {
+  background-color: var(--url-and-searchbar-background-color) !important;
+  background-image: none !important;
+  color: inherit;
+  border: none !important;
+  box-shadow: none !important;
+}
+
+/**** End Toolbars and Tabs */
+
+/* Nav bar specific stuff */
+#PanelUI-button {
+  background-image: none !important;
+  border-left: 1px solid #5F6670 !important;
+  /* XXX: use css variables with panelUIOverlay.css to keep other bg props */
+}
+#nav-bar {
+  margin-top:0 !important;
+  border: none !important;
+  border-radius: 0 !important;
+  box-shadow: 0 -1px rgba(0,0,0,0.2) !important;
+}
+
+/* Don't want to use default colors when tabs aren't in titlebar */
+#main-window:not(:-moz-any([customizing],[tabsintitlebar])) #navigator-toolbox > #TabsToolbar {
+  -moz-appearance: none !important;
+}
+
+#TabsToolbar:not(:-moz-lwtheme) {
+  /*color: #F5F7FA;*/
+  text-shadow: none;
+}
+
+#TabsToolbar::after {
+  display: none !important;
+}
+
+#notification-popup-box {
+  background-color: transparent !important;
+}
+#notification-popup-box {
+  border-right-width: 1px;
+  padding-right: 8px;
+  margin-right: 0px;
+  border-image: linear-gradient(transparent 15%, #5a6169 15%, #5a6169 85%, transparent 85%) 1 1 !important;
+}
+#notification-popup-box > image:not([id*="sharing"]):not([id*="translated"]):not(.indexedDB-notification-icon):not(#indexedDB-notification-icon):not(.default-notification-icon):not(#default-notification-icon) {
+  filter: brightness(10) opacity(0.8);
+}
+
+#urlbar[pageproxystate] #identity-icon-labels {
+  filter: brightness(2.8) !important;
+}
+
+/***** End Nav bar specific stuff */
+
+
+/* Window Frame */
+#nav-bar-customization-target {
+  padding-top: 0 !important;
+  padding-bottom: 0 !important;
+}
+
+#urlbar {
+  margin-top: 2px;
+  margin-bottom: 2px;
+  padding-top: 1px;
+  padding-bottom: 1px;
+}
+
+#forward-button[disabled] {
+  visibility: hidden !important;
+}
+
+window:not([chromehidden~="toolbar"]) #urlbar-wrapper {
+  clip-path: none !important;
+  -moz-margin-start: -2px !important;
+}
+
+.search-go-button {
+  transition: all 0.05s !important;
+  -moz-image-region: rect(0px,16px, 16px, 0);
+  margin-top: 2px !important;
+  /* XXX: convert this base64 into an image */
+  list-style-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAOCAYAAADaOrdAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEOTY2REY3N0JDNjYxMUUwOEUyMUI0MTVGNjg0MUFDOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEOTY2REY3OEJDNjYxMUUwOEUyMUI0MTVGNjg0MUFDOCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjUzQzIxNzE2QkM1NTExRTA4RTIxQjQxNUY2ODQxQUM4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQ5NjZERjc2QkM2NjExRTA4RTIxQjQxNUY2ODQxQUM4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ED/1FAAAAYxJREFUeNpi/P//PwM20Nw/yx5IFQGxMVToLBD31RamHWQgETBis6Spd2Y1kGrBoaeyrji9gyJLGnqmg3xwAIh/gewD4gVQqQQgrgNiZiB2aCjJPEKsJSzoAv/+/YP5oL6pLBvZxa11XVP/Aul2qC8diLWECcOSv/90gRhEz8UiNxcqZ0BKcGH45O+/fzgVI8kxIyUQA2jw8mPR8hSIzTF88vfv38tADKKTscglQOXOwsSAqe3Cr1+/3YD4OxAzIOHXQOwMlH+KEfElDT1pQGomNOIrgXgZVCoKGh/giO9pKEGJ+NLGXicgtQWIOYH4I0hNd33xBYzUVVjbBfL6XiAWwhPElf3NZViTcG5lmzeQWgrEPpPbq45gJOG86nZkC15DfeEHxGZQtadAmXFSayXezJhe0ig0s6f+HUY+yalsBVmwC4hFgRikwHlKe/UFBioB5lffmbWAFu0FYlEgfgfEzlM7aqhmATgJ//v3PwrJB24zuuuoagHYEqDLJ4JSJxCvAYblZQYaAIAAAwBzxsou4caKVwAAAABJRU5ErkJggg==") !important
+}
+
+#TabsToolbar .tabs-newtab-button,
+#TabsToolbar > #new-tab-button,
+#TabsToolbar > toolbarpaletteitem > #new-tab-button {
+  -moz-image-region: auto !important;
+  list-style-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJlJREFUeNpi/P//PwMlgHHwGMDIyIguFw/EVlD2MSBeiCwJtxjEwOGKmf+hAMRGl4TpY2KgEFBsAAsOP2P1EhIbESZIYQD3MyEAVUudMED2win0qATakAaN4llo+k5hRAcQMAMxFxDzQjF6NMLEQWqYYfqQXfAXiL/hce1nmkcjOkAOk1Pk5AVQmLBD2T+hXsTICwOfnQECDABOw4tARrbTmQAAAABJRU5ErkJggg==") !important;
+}
+
+/***** End Window Frame */
+
+/* Square Tabs - https://userstyles.org/styles/104736/devfox-square-tabs */
+#TabsToolbar {
+  margin-top: 0 !important;
+}
+.tab-background {visibility: hidden !important}
+.tabs-newtab-button {
+  background-image: none !important;
+  margin: 0 !important;
+  width: 35px !important;
+}
+.tabs-newtab-button > .toolbarbutton-icon {
+  padding: 0 !important;
+}
+/*
+#tabbrowser-tabs[movingtab] > .tabbrowser-tab[beforeselected]:not([last-visible-tab])::after,
+.tabbrowser-tab:not([selected]):not([afterselected-visible]):not([first-visible-tab])::before,
+#tabbrowser-tabs:not([overflow]) > .tabbrowser-tab[last-visible-tab]:not([selected])::after {
+  content: none;
+  background-image: none;
+  border-left: solid 1px #333;
+}
+*/
+
+#tabbrowser-tabs[movingtab] > .tabbrowser-tab[beforeselected]:not([last-visible-tab])::after,
+.tabbrowser-tab:not([selected]):not([afterselected-visible]):not([first-visible-tab])::before,
+#tabbrowser-tabs:not([overflow]) > .tabbrowser-tab[last-visible-tab]:not([selected])::after {
+  content:"";
+  background-image: none !important;
+  background-color: #5F6670 !important;
+  width: 1px !important;
+  -moz-margin-start: 0px !important;
+  -moz-margin-end: 0px !important;
+  display: -moz-box;
+}
+.tabbrowser-tab {
+  pointer-events: auto !important;
+}
+.tabbrowser-tab:hover, .tabs-newtab-button:hover {
+  background-color: var(--chrome-tab-hover-background-color);
+  color: var(--chrome-tab-hover-color);
+}
+/* XXX: move this to variables */
+.tabbrowser-tab {
+   color: var(--chrome-tab-color);
+   background-color: var(--chrome-tab-background-color);
+}
+.tabbrowser-tab[selected]:not(:-moz-lwtheme) {
+   color: var(--chrome-tab-selection-color);
+   background-color: var(--chrome-tab-selection-background-color);
+   box-shadow: var(--chrome-tab-selection-box-shadow);
+}
+
+/***** End Square Tabs */
+
+/* Panels */
+
+/*
+.panel-arrowcontent {
+  padding: 5px;
+  background: rgba(19, 28, 38, 1);
+  border-radius: 5px;
+  box-shadow: none;
+  border: 3px solid #434850;
+  color: #F5F7FA;
+}
+
+*/
+.panel-arrow[side="top"] {
+  list-style-image: url("chrome://browser/skin/devtools/tooltip/arrow-vertical-dark.png");
+  margin-bottom: -4px;
+  /* XXX: just resize this arrow to fit with the other one (chrome://global/skin/arrow/panelarrow-vertical.png) */
+  margin-left: 6px;
+  margin-right: 6px;
+}
+
+.panel-arrow[side="bottom"] {
+  list-style-image: url("chrome://browser/skin/devtools/tooltip/arrow-vertical-dark.png");
+  margin-top: -4px;
+  margin-left: 6px;
+  margin-right: 6px;
+}
+
+.panel-arrow[side="left"] {
+  list-style-image: url("chrome://browser/skin/devtools/tooltip/arrow-horizontal-dark.png");
+  margin-right: -4px;
+}
+
+.panel-arrow[side="right"] {
+  list-style-image: url("chrome://browser/skin/devtools/tooltip/arrow-horizontal-dark.png");
+  margin-left: -4px;
+}
+
+@media (min-resolution: 2dppx) {
+  .panel-arrow[side="top"],
+  .panel-arrow[side="bottom"] {
+    list-style-image: url("chrome://browser/skin/devtools/tooltip/arrow-vertical-dark@2x.png");
+  }
+
+  .panel-arrow[side="left"],
+  .panel-arrow[side="right"] {
+    list-style-image: url("chrome://browser/skin/devtools/tooltip/arrow-horizontal-dark@2x.png");
+  }
+}
+
+/* Autocomplete.  XXX: switch to CSS vars with browser.css and autocomplete.css if we want to keep this */
+.autocomplete-richlistbox {
+  background: #39424D;
+  color: HighlightText;
+}
+
+.ac-url-text,
+.ac-action-text {
+  color: #46afe3;
+}
+
+.autocomplete-richlistitem[selected="true"]:not([disabled="true"]) {
+  background-color: rgba(29, 79, 115, .8);
+  background-color: #46afe3;
+  background-color: red;
+}
+
+
+/***** End Panels */
+
+/* Panorama */
+/*@-moz-document url(chrome://browser/content/tabview.html) {
+  .groupItem, #actions {
+    background-color: #343C45 !important;
+    border: none !important;
+    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8) !important;
+    border-radius: 2px !important;
+  }
+  #exit-button {
+    background-color: transparent !important;
+  }
+  #exit-button, #searchbutton {
+    filter: brightness(0.2) invert(1)
+  }
+  #searchbox {
+    background-color: #171B1E !important;
+    box-shadow: none !important;
+    border: 1px solid rgba(255,255,255,0.25);
+    border-radius: 2px !important;
+  }
+  .tab {
+    color: white !important;
+    text-shadow: none !important;
+    border-radius: 2px !important;
+    border-top: 4px solid transparent !important;
+  }
+  .tab.focus {
+    border-top: 4px solid #9FDFFF !important;
+    background-color: #1A4666 !important;
+    box-shadow: 0 0 2px rgba(0,0,0,0.2) !important
+  }
+  .tab-title {
+    text-shadow: none !important;
+  }
+  .appTabTrayContainer {
+    -moz-border-start-color: transparent !important;
+  }
+  .favicon, .tab {
+    background-color: #242C33 !important;
+  }
+  .tab.focus .favicon {
+    background-color: #1A4666 !important;
+  }
+}*/
+/***** End Panorama */
diff --git a/browser/themes/shared/identity-block.inc.css b/browser/themes/shared/identity-block.inc.css
--- a/browser/themes/shared/identity-block.inc.css
+++ b/browser/themes/shared/identity-block.inc.css
@@ -1,56 +1,63 @@
 %if 0
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 %endif
 
+:root {
+  --identity-box-verified-color: hsl(92,100%,30%);
+  --identity-box-verified-background-image: linear-gradient(hsla(92,81%,16%,0),
+                                            hsla(92,81%,16%,.2) 35%,
+                                            hsla(92,81%,16%,.2) 65%,
+                                            hsla(92,81%,16%,0));
+%ifdef MOZ_OFFICIAL_BRANDING
+  --identity-box-chrome-color: rgb(229,115,0);
+  --identity-box-chrome-background-image: linear-gradient(rgba(229,114,0,0),
+                                    rgba(229,114,0,.5) 35%,
+                                    rgba(229,114,0,.5) 65%,
+                                    rgba(229,114,0,0));
+%else
+%if MOZ_UPDATE_CHANNEL == aurora
+  --identity-box-chrome-color: rgb(51,30,84);
+  --identity-box-chrome-background-image: linear-gradient(rgba(51,30,84,0),
+                                    rgba(51,30,84,.5) 35%,
+                                    rgba(51,30,84,.5) 65%,
+                                    rgba(51,30,84,0));
+%else
+  --identity-box-chrome-color: rgb(0,33,71);
+  --identity-box-chrome-background-image: linear-gradient(rgba(0,33,71,0),
+                                    rgba(0,33,71,.5) 35%,
+                                    rgba(0,33,71,.5) 65%,
+                                    rgba(0,33,71,0));
+%endif
+%endif
+}
+
 #urlbar[pageproxystate="valid"] > #identity-box.chromeUI,
 #urlbar[pageproxystate="valid"] > #identity-box.verifiedIdentity {
   background-position: right;
   background-size: 1px;
   background-repeat: no-repeat;
 }
 
 #urlbar[pageproxystate="valid"] > #identity-box.chromeUI:-moz-locale-dir(rtl),
 #urlbar[pageproxystate="valid"] > #identity-box.verifiedIdentity:-moz-locale-dir(rtl) {
   background-position: left;
 }
 
 #urlbar[pageproxystate="valid"] > #identity-box.verifiedIdentity {
-  color: hsl(92,100%,30%);
-  background-image: linear-gradient(hsla(92,81%,16%,0),
-                                    hsla(92,81%,16%,.2) 35%,
-                                    hsla(92,81%,16%,.2) 65%,
-                                    hsla(92,81%,16%,0));
+  color: var(--identity-box-verified-color);
+  background-image: var(--identity-box-verified-background-image);
 }
 
 #urlbar[pageproxystate="valid"] > #identity-box.chromeUI {
-%ifdef MOZ_OFFICIAL_BRANDING
-  color: rgb(229,115,0);
-  background-image: linear-gradient(rgba(229,114,0,0),
-                                    rgba(229,114,0,.5) 35%,
-                                    rgba(229,114,0,.5) 65%,
-                                    rgba(229,114,0,0));
-%else
-%if MOZ_UPDATE_CHANNEL == aurora
-  color: rgb(51,30,84);
-  background-image: linear-gradient(rgba(51,30,84,0),
-                                    rgba(51,30,84,.5) 35%,
-                                    rgba(51,30,84,.5) 65%,
-                                    rgba(51,30,84,0));
-%else
-  color: rgb(0,33,71);
-  background-image: linear-gradient(rgba(0,33,71,0),
-                                    rgba(0,33,71,.5) 35%,
-                                    rgba(0,33,71,.5) 65%,
-                                    rgba(0,33,71,0));
-%endif
-%endif
+  color: var(--identity-box-chrome-color);
+  background-image: var(--identity-box-chrome-background-image);
 }
 
 /* page proxy icon */
 
 #page-proxy-favicon {
   width: 16px;
   height: 16px;
   list-style-image: url(chrome://browser/skin/identity-icons-generic.png);
diff --git a/browser/themes/windows/devbrowser-aero.css b/browser/themes/windows/devbrowser-aero.css
new file mode 100644
--- /dev/null
+++ b/browser/themes/windows/devbrowser-aero.css
@@ -0,0 +1,7 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+ /* TODO: Copy over changes from osx */
+
+%include ../shared/devbrowser.inc.css
diff --git a/browser/themes/windows/devbrowser.css b/browser/themes/windows/devbrowser.css
new file mode 100644
--- /dev/null
+++ b/browser/themes/windows/devbrowser.css
@@ -0,0 +1,7 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+ /* TODO: Copy over changes from osx */
+
+%include ../shared/devbrowser.inc.css
diff --git a/browser/themes/windows/jar.mn b/browser/themes/windows/jar.mn
--- a/browser/themes/windows/jar.mn
+++ b/browser/themes/windows/jar.mn
@@ -19,16 +19,17 @@ browser.jar:
         skin/classic/browser/aboutNetError_info.svg                  (../shared/aboutNetError_info.svg)
         skin/classic/browser/aboutSocialError.css
 #ifdef MOZ_SERVICES_SYNC
         skin/classic/browser/aboutSyncTabs.css
 #endif
         skin/classic/browser/aboutTabCrashed.css
         skin/classic/browser/actionicon-tab.png
 *       skin/classic/browser/browser.css
+*       skin/classic/browser/devbrowser.css
 *       skin/classic/browser/browser-lightweightTheme.css
         skin/classic/browser/click-to-play-warning-stripes.png
 *       skin/classic/browser/content-contextmenu.svg
 *       skin/classic/browser/engineManager.css
         skin/classic/browser/fullscreen-darknoise.png
         skin/classic/browser/Geolocation-16.png
         skin/classic/browser/Geolocation-64.png
         skin/classic/browser/Info.png
@@ -441,16 +442,17 @@ browser.jar:
         skin/classic/aero/browser/aboutSocialError.css
 #ifdef MOZ_SERVICES_SYNC
         skin/classic/aero/browser/aboutSyncTabs.css
 #endif
         skin/classic/aero/browser/aboutTabCrashed.css
         skin/classic/aero/browser/aboutWelcomeBack.css               (../shared/aboutWelcomeBack.css)
         skin/classic/aero/browser/actionicon-tab.png
 *       skin/classic/aero/browser/browser.css                        (browser-aero.css)
+*       skin/classic/aero/browser/devbrowser.css                     (devbrowser-aero.css)
 *       skin/classic/aero/browser/browser-lightweightTheme.css
         skin/classic/aero/browser/click-to-play-warning-stripes.png
 *       skin/classic/aero/browser/content-contextmenu.svg
 *       skin/classic/aero/browser/engineManager.css
         skin/classic/aero/browser/fullscreen-darknoise.png
         skin/classic/aero/browser/Geolocation-16.png
         skin/classic/aero/browser/Geolocation-64.png
         skin/classic/aero/browser/Info.png                           (Info-aero.png)
diff --git a/toolkit/themes/osx/global/popup.css b/toolkit/themes/osx/global/popup.css
--- a/toolkit/themes/osx/global/popup.css
+++ b/toolkit/themes/osx/global/popup.css
@@ -1,14 +1,20 @@
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
 
+.panel-arrowcontent {
+  --panel-arrowcontent-background: linear-gradient(hsla(0,0%,99%,1), hsla(0,0%,99%,.975) 10%, hsla(0,0%,98%,.975));
+  --panel-arrowcontent-color: hsl(0,0%,10%);
+  --panel-arrowcontent-border: none;
+}
+
 menupopup,
 panel {
   -moz-appearance: menupopup;
   background-color: Menu;
 }
 
 menupopup > menu > menupopup {
   margin-top: -4px;
@@ -36,20 +42,21 @@ panel[type="arrow"][side="bottom"] {
 panel[type="arrow"][side="left"],
 panel[type="arrow"][side="right"] {
   margin-top: -25px;
   margin-bottom: -25px;
 }
 
 .panel-arrowcontent {
   -moz-appearance: none;
-  background-image: linear-gradient(hsla(0,0%,99%,1), hsla(0,0%,99%,.975) 10%, hsla(0,0%,98%,.975));
+  background: var(--panel-arrowcontent-background);
   border-radius: 3.5px;
   box-shadow: 0 0 0 1px hsla(210,4%,10%,.05);
-  color: hsl(0,0%,10%);
+  color: var(--panel-arrowcontent-color);
+  border: var(--panel-arrowcontent-border);
   padding: 16px;
   margin: 1px;
 }
 
 .panel-arrow[side="top"] {
   list-style-image: url("chrome://global/skin/arrow/panelarrow-vertical.png");
   margin-left: 16px;
   margin-right: 16px;
