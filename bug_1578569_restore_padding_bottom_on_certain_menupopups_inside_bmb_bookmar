# HG changeset patch
# User Brian Grinstead <bgrinstead@mozilla.com>
# Date 1567548058 25200
#      Tue Sep 03 15:00:58 2019 -0700
# Node ID 6ac053c907f87772f387c6cff4b738ca2a281c7d
# Parent  0a0112c2cad482a23598fb164c86009c17f21ed1
Bug 1578569 - Restore padding-bottom on certain menupopups inside BMB_bookmarksPopup

This was removed in Bug 1573158, where the following line change forced it to 0px:
https://hg.mozilla.org/integration/autoland/rev/3f54e52c52eb#l2.12

This uses shadow parts instead of Shadow DOM + XBL selectors into the arrowscrollbox,
which unblocks arrowscrollbox Custom Element conversion and appears to have the same
visual effect as far as I can tell.

Differential Revision: https://phabricator.services.mozilla.com/D44556

diff --git a/browser/base/content/browser.xhtml b/browser/base/content/browser.xhtml
--- a/browser/base/content/browser.xhtml
+++ b/browser/base/content/browser.xhtml
@@ -1297,16 +1297,17 @@
           <menuseparator/>
           <menu id="BMB_bookmarksToolbar"
                 class="menu-iconic bookmark-item subviewbutton"
                 label="&personalbarCmd.label;"
                 container="true">
             <menupopup id="BMB_bookmarksToolbarPopup"
                        is="places-popup"
                        placespopup="true"
+                       nofooterpopup="true"
                        context="placesContext"
                        onpopupshowing="if (!this.parentNode._placesView)
                                          new PlacesMenu(event, `place:parent=${PlacesUtils.bookmarks.toolbarGuid}`,
                                                         PlacesUIUtils.getViewForNode(this.parentNode.parentNode).options);">
               <menuitem id="BMB_viewBookmarksToolbar"
                         class="menuitem-iconic subviewbutton"
                         label-show="&viewBookmarksToolbar.label;"
                         label-hide="&hideBookmarksToolbar.label;"
@@ -1317,29 +1318,31 @@
           </menu>
           <menu id="BMB_unsortedBookmarks"
                 class="menu-iconic bookmark-item subviewbutton"
                 label="&bookmarksMenuButton.other.label;"
                 container="true">
             <menupopup id="BMB_unsortedBookmarksPopup"
                        is="places-popup"
                        placespopup="true"
+                       nofooterpopup="true"
                        context="placesContext"
                        onpopupshowing="if (!this.parentNode._placesView)
                                          new PlacesMenu(event, `place:parent=${PlacesUtils.bookmarks.unfiledGuid}`,
                                                         PlacesUIUtils.getViewForNode(this.parentNode.parentNode).options);"/>
           </menu>
           <menu id="BMB_mobileBookmarks"
                 class="menu-iconic bookmark-item subviewbutton"
                 label="&bookmarksMenuButton.mobile.label;"
                 hidden="true"
                 container="true">
             <menupopup id="BMB_mobileBookmarksPopup"
                        is="places-popup"
                        placespopup="true"
+                       nofooterpopup="true"
                        context="placesContext"
                        onpopupshowing="if (!this.parentNode._placesView)
                                          new PlacesMenu(event, `place:parent=${PlacesUtils.bookmarks.mobileGuid}`,
                                                         PlacesUIUtils.getViewForNode(this.parentNode.parentNode).options);"/>
           </menu>
 
           <menuseparator/>
           <!-- Bookmarks menu items will go here -->
diff --git a/browser/components/places/content/browserPlacesViews.js b/browser/components/places/content/browserPlacesViews.js
--- a/browser/components/places/content/browserPlacesViews.js
+++ b/browser/components/places/content/browserPlacesViews.js
@@ -710,19 +710,19 @@ PlacesViewBase.prototype = {
           }
         }
         currentChild = currentChild.nextElementSibling;
       }
       hasMultipleURIs = numURINodes > 1;
     }
 
     if (!hasMultipleURIs) {
-      aPopup.setAttribute("singleitempopup", "true");
+      aPopup.setAttribute("nofooterpopup", "true");
     } else {
-      aPopup.removeAttribute("singleitempopup");
+      aPopup.removeAttribute("nofooterpopup");
     }
 
     if (!hasMultipleURIs) {
       // We don't have to show any option.
       if (aPopup._endOptOpenAllInTabs) {
         aPopup.removeChild(aPopup._endOptOpenAllInTabs);
         aPopup._endOptOpenAllInTabs = null;
 
diff --git a/browser/themes/shared/customizableui/panelUI.inc.css b/browser/themes/shared/customizableui/panelUI.inc.css
--- a/browser/themes/shared/customizableui/panelUI.inc.css
+++ b/browser/themes/shared/customizableui/panelUI.inc.css
@@ -237,16 +237,20 @@ panelview {
   padding: 0;
 }
 
 /* Remove padding on xul:arrowscrollbox to avoid extra padding on footer */
 #BMB_bookmarksPopup menupopup::part(popupbox) {
   padding-bottom: 0px;
 }
 
+#BMB_bookmarksPopup menupopup[nofooterpopup=true]::part(popupbox) {
+  padding-bottom: 4px;
+}
+
 #confirmation-hint {
   --arrowpanel-background: #0060df;
   --arrowpanel-border-color: #0060df;
   --arrowpanel-color: #fff;
   --arrowpanel-padding: 6px 10px;
   font-weight: 400;
   font-size: 1.1rem;
 }
